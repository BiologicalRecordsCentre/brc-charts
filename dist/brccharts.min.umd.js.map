{"version":3,"file":"brccharts.min.umd.js","sources":["../src/general.js","../src/pie/highlightitem.js","../src/pie/makepie.js","../src/pie/legend.js","../src/phen1/highlightitem.js","../src/phen1/makephen.js","../src/phen1/metricsplus.js","../src/phen1/legend.js","../src/trend2/trend2.js","../src/trend3/trend3.js","../src/density/density.js","../src/bar/bar.js","../src/yearly/highlightitem.js","../src/yearly/makeYearly.js","../src/yearly/legend.js","../src/temporal/highlightitem.js","../src/temporal/makeTemporal.js","../src/temporal/legend.js","../node_modules/proj4/lib/constants/values.js","../node_modules/proj4/lib/constants/PrimeMeridian.js","../node_modules/proj4/lib/constants/units.js","../node_modules/proj4/lib/match.js","../node_modules/proj4/lib/projString.js","../node_modules/wkt-parser/parser.js","../node_modules/wkt-parser/process.js","../node_modules/wkt-parser/index.js","../node_modules/proj4/lib/defs.js","../node_modules/proj4/lib/global.js","../node_modules/proj4/lib/parseCode.js","../node_modules/proj4/lib/extend.js","../node_modules/proj4/lib/common/msfnz.js","../node_modules/proj4/lib/common/sign.js","../node_modules/proj4/lib/common/adjust_lon.js","../node_modules/proj4/lib/common/tsfnz.js","../node_modules/proj4/lib/common/phi2z.js","../node_modules/proj4/lib/projections/longlat.js","../node_modules/proj4/lib/projections.js","../node_modules/proj4/lib/projections/merc.js","../node_modules/proj4/lib/constants/Ellipsoid.js","../node_modules/proj4/lib/constants/Datum.js","../node_modules/proj4/lib/nadgrid.js","../node_modules/proj4/lib/Proj.js","../node_modules/proj4/lib/deriveConstants.js","../node_modules/proj4/lib/datum.js","../node_modules/proj4/lib/datumUtils.js","../node_modules/proj4/lib/datum_transform.js","../node_modules/proj4/lib/adjust_axis.js","../node_modules/proj4/lib/common/toPoint.js","../node_modules/proj4/lib/checkSanity.js","../node_modules/proj4/lib/transform.js","../node_modules/proj4/lib/core.js","../node_modules/mgrs/mgrs.js","../node_modules/proj4/lib/Point.js","../node_modules/proj4/lib/common/pj_enfn.js","../node_modules/proj4/lib/common/pj_mlfn.js","../node_modules/proj4/lib/common/pj_inv_mlfn.js","../node_modules/proj4/lib/projections/tmerc.js","../node_modules/proj4/lib/common/sinh.js","../node_modules/proj4/lib/common/hypot.js","../node_modules/proj4/lib/common/asinhy.js","../node_modules/proj4/lib/common/log1py.js","../node_modules/proj4/lib/common/gatg.js","../node_modules/proj4/lib/common/clens_cmplx.js","../node_modules/proj4/lib/common/cosh.js","../node_modules/proj4/lib/projections/etmerc.js","../node_modules/proj4/lib/common/clens.js","../node_modules/proj4/lib/projections/utm.js","../node_modules/proj4/lib/common/adjust_zone.js","../node_modules/proj4/lib/common/srat.js","../node_modules/proj4/lib/projections/gauss.js","../node_modules/proj4/lib/projections/sterea.js","../node_modules/proj4/lib/projections/stere.js","../node_modules/proj4/lib/projections/somerc.js","../node_modules/proj4/lib/projections/omerc.js","../node_modules/proj4/lib/projections/lcc.js","../node_modules/proj4/lib/projections/krovak.js","../node_modules/proj4/lib/common/mlfn.js","../node_modules/proj4/lib/common/e0fn.js","../node_modules/proj4/lib/common/e1fn.js","../node_modules/proj4/lib/common/e2fn.js","../node_modules/proj4/lib/common/e3fn.js","../node_modules/proj4/lib/common/gN.js","../node_modules/proj4/lib/common/adjust_lat.js","../node_modules/proj4/lib/common/imlfn.js","../node_modules/proj4/lib/projections/cass.js","../node_modules/proj4/lib/common/qsfnz.js","../node_modules/proj4/lib/projections/laea.js","../node_modules/proj4/lib/common/asinz.js","../node_modules/proj4/lib/projections/aea.js","../node_modules/proj4/lib/projections/gnom.js","../node_modules/proj4/lib/projections/cea.js","../node_modules/proj4/lib/common/iqsfnz.js","../node_modules/proj4/lib/projections/eqc.js","../node_modules/proj4/lib/projections/poly.js","../node_modules/proj4/lib/projections/nzmg.js","../node_modules/proj4/lib/projections/mill.js","../node_modules/proj4/lib/projections/sinu.js","../node_modules/proj4/lib/projections/moll.js","../node_modules/proj4/lib/projections/eqdc.js","../node_modules/proj4/lib/projections/vandg.js","../node_modules/proj4/lib/projections/aeqd.js","../node_modules/proj4/lib/projections/ortho.js","../node_modules/proj4/lib/projections/qsc.js","../node_modules/proj4/lib/projections/robin.js","../node_modules/proj4/lib/projections/geocent.js","../node_modules/proj4/lib/projections/tpers.js","../node_modules/proj4/lib/index.js","../node_modules/proj4/projs.js","../node_modules/brc-atlas-bigr/dist/bigr.esm.js","../src/constants.js","../index.js","../src/accum.js","../src/altlat.js","../src/links.js","../src/phen1/phen1.js","../src/phen2.js","../src/pie/pie.js","../src/temporal/temporal.js","../src/trend.js","../src/yearly/yearly.js"],"sourcesContent":["import * as d3 from 'd3'\r\n\r\nexport function safeId(text) {\r\n  // Ensure selector starts with a letter. Replace white space with underscores.\r\n  return text ? `id_${text.replace(/\\W/g,'_')}` : null\r\n}\r\n\r\nexport function cloneData(data) {\r\n  return data.map(d => { return {...d}})\r\n}\r\n\r\nexport const month2day = [1, 32, 61, 92, 122, 153, 183, 214, 245, 275, 306, 336, 367]\r\nconst monthMid2day = [1]\r\nfor (let i=0; i<month2day.length-1; i++) {\r\n  monthMid2day.push((month2day[i] + (month2day[i+1]-month2day[i])/2))\r\n}\r\nmonthMid2day.push(367)\r\n\r\nexport function xAxisMonth(width, ticks, fontSize, font) {\r\n\r\n  const ysDomain = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\r\n  const ysRange = month2day.map(d => (d-1)/366 * width)\r\n  const xScaleTime = d3.scaleOrdinal().domain(ysDomain).range(ysRange)\r\n\r\n  const xAxis = d3.axisBottom()\r\n    .scale(xScaleTime)\r\n\r\n  // Work out the max text widths of the three styles\r\n  // of month representation\r\n  const svg = d3.select('body').append('svg')\r\n  const getMaxTextWidth = (aText) => {\r\n    return Math.max(...aText.map(m => {\r\n      const tmpText = svg.append('text')\r\n        .text(m)\r\n      if (font) tmpText.style('font-family', font)\r\n      if (fontSize) tmpText.style('font-size', fontSize)\r\n      const textWidth =  tmpText.node().getBBox().width\r\n      tmpText.remove()\r\n      return textWidth\r\n    }))\r\n  }\r\n  const maxFullMonth = getMaxTextWidth(ysDomain)\r\n  const maxMedMonth = getMaxTextWidth(ysDomain.map(m=>m.substr(0,3)))\r\n  const maxMinMonth = getMaxTextWidth(ysDomain.map(m=>m.substr(0,1)))\r\n  svg.remove()\r\n\r\n  if (ticks) {\r\n    xAxis.ticks(ysDomain)\r\n      .tickSize(width >= 200 ? 13 : 5, 0)\r\n      .tickFormat(month => {\r\n        //if (width >= 750) {\r\n        if (width / 12 > maxFullMonth + 4) {\r\n          return month\r\n        //} else if (width >= 330) {\r\n        } else if (width / 12 >= maxMedMonth + 4) {\r\n          return month.substr(0,3)\r\n        //} else if (width >= 200) {\r\n        } else if (width /12 >= maxMinMonth + 4) {\r\n          return month.substr(0,1)\r\n        } else {\r\n          return ''\r\n        }\r\n      })\r\n  } else {\r\n    xAxis.tickValues([]).tickSizeOuter(0)\r\n  }\r\n  return xAxis\r\n}\r\n\r\nexport function xAxisMonthNoText(width) {\r\n\r\n  const ysDomain = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\r\n  const ysRange = month2day.map(d => (d-1)/366 * width)\r\n  const xScaleTime = d3.scaleOrdinal().domain(ysDomain).range(ysRange)\r\n\r\n  const xAxis = d3.axisBottom()\r\n    .scale(xScaleTime)\r\n\r\n  xAxis.ticks(ysDomain)\r\n    .tickSize(width >= 200 ? 13 : 5, 0)\r\n    .tickFormat(() => '')\r\n \r\n  return xAxis\r\n}\r\n\r\nexport function xAxisMonthText(width, ticks, fontSize, font) {\r\n\r\n  const ysDomain = ['', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December']\r\n  const ysRange = monthMid2day.map(d => (d-1)/366 * width)\r\n  const xScaleTime = d3.scaleOrdinal().domain(ysDomain).range(ysRange)\r\n\r\n  const xAxis = d3.axisBottom()\r\n    .scale(xScaleTime)\r\n\r\n  // Work out the max text widths of the three styles\r\n  // of month representation\r\n  const svg = d3.select('body').append('svg')\r\n  const getMaxTextWidth = (aText) => {\r\n    return Math.max(...aText.map(m => {\r\n      const tmpText = svg.append('text')\r\n        .text(m)\r\n      if (font) tmpText.style('font-family', font)\r\n      if (fontSize) tmpText.style('font-size', fontSize)\r\n      const textWidth =  tmpText.node().getBBox().width\r\n      tmpText.remove()\r\n      return textWidth\r\n    }))\r\n  }\r\n  const maxFullMonth = getMaxTextWidth(ysDomain)\r\n  const maxMedMonth = getMaxTextWidth(ysDomain.map(m=>m.substr(0,3)))\r\n  const maxMinMonth = getMaxTextWidth(ysDomain.map(m=>m.substr(0,1)))\r\n  svg.remove()\r\n\r\n  if (ticks) {\r\n    xAxis.ticks(ysDomain)\r\n      .tickSize(0)\r\n      .tickFormat(month => { \r\n        if (month === '') {\r\n          return ''\r\n        } else if (width / 12 > maxFullMonth + 4) {\r\n          return month\r\n        } else if (width / 12 >= maxMedMonth + 4) {\r\n          return month.substr(0,3)\r\n        } else if (width /12 >= maxMinMonth + 4) {\r\n          return month.substr(0,1)\r\n        } else {\r\n          return ''\r\n        }\r\n      })\r\n  } else {\r\n    xAxis.tickValues([]).tickSizeOuter(0)\r\n  }\r\n  return xAxis\r\n}\r\n\r\nexport function xAxisYear(width, ticks, min, max, bars) {\r\n  const xScale = d3.scaleLinear()\r\n    .range([0, width])\r\n\r\n  if (bars) {\r\n    xScale.domain([min - 0.5, max + 0.5])\r\n  } else {\r\n    xScale.domain([min, max])\r\n  }\r\n\r\n  const xAxis = d3.axisBottom()\r\n    .scale(xScale)\r\n\r\n  if (ticks) {\r\n    const years = max - min\r\n    const threshold = 30\r\n\r\n    let ticks\r\n    if (width / years > threshold) {\r\n      ticks = years\r\n    } else if (width / years * 2 > threshold) {\r\n      ticks = years / 2\r\n    } else if (width / years * 5 > threshold) {\r\n      ticks = years / 5\r\n    } else if (width / years * 10 > threshold ) {\r\n      ticks = years / 10\r\n    } else {\r\n      ticks = 2\r\n    }\r\n    xAxis.ticks(ticks) \r\n\r\n    xAxis.tickFormat(year => year.toString())\r\n\r\n    if (bars) {\r\n      xAxis.tickSizeOuter(0)\r\n    }\r\n  } else {\r\n    xAxis.tickValues([]).tickSizeOuter(0)\r\n  }\r\n  return xAxis\r\n}\r\n\r\nexport function wrapText(text, svg, maxWidth, fontSize) {\r\n\r\n  const textSplit = text.split(\" \")\r\n  const lines = ['']\r\n  let line = 0\r\n\r\n  for (let i=0; i < textSplit.length; i++) {\r\n\r\n    if (textSplit[i] === '\\n') {\r\n      line++\r\n      lines[line] = ''\r\n    } else {\r\n      let workingText = `${lines[line]} ${textSplit[i]}`\r\n      workingText = workingText.trim()\r\n\r\n      const txt = svg.append('text')\r\n        .text(workingText)\r\n        .style('font-size', fontSize)\r\n\r\n      const width = txt.node().getBBox().width\r\n\r\n      if (width > maxWidth) {\r\n        line++\r\n        lines[line] = textSplit[i]\r\n      } else {\r\n        lines[line] = workingText\r\n      }\r\n      txt.remove()\r\n    }\r\n  }\r\n  return lines\r\n}\r\n\r\nexport function makeText (text, classText, fontSize, textAlign, textWidth, svg) {\r\n\r\n  let svgText = svg.select(`.${classText}`)\r\n  if (!svgText.size()) {\r\n    svgText = svg.append('svg').attr(\"class\", classText)\r\n  }\r\n  \r\n  const lines = wrapText(text, svgText, textWidth, fontSize)\r\n\r\n  const uText = svgText.selectAll(`.${classText}-line`)\r\n    .data(lines)\r\n\r\n  const eText = uText.enter()\r\n    .append('text')\r\n    .attr(\"class\", `${classText}-line`)\r\n\r\n  uText\r\n    .merge(eText)\r\n    .text(d => {\r\n      return d\r\n    })\r\n    .style('font-size', fontSize)\r\n\r\n  uText.exit()\r\n    .remove()\r\n\r\n  const height = svgText.select(`.${classText}-line`).node().getBBox().height\r\n  const widths = svgText.selectAll(`.${classText}-line`).nodes().map(n => (n.getBBox().width))\r\n\r\n  svgText.selectAll(`.${classText}-line`)\r\n    .attr('y', (d, i) => (i + 1) * height)\r\n    .attr('x', (d, i) => {\r\n      if (textAlign === 'centre') {\r\n        return (textWidth - widths[i]) / 2\r\n      } else if(textAlign === 'right') {\r\n        return textWidth - widths[i]\r\n      } else {\r\n        return 0\r\n      }\r\n    })\r\n  svgText.attr(\"height\", height * lines.length + height * 0.2) // The 0.2 allows for tails of letters like g, y etc.\r\n\r\n  return svgText\r\n}\r\n\r\nexport function positionMainElements(svg, expand, headPad) {\r\n\r\n    headPad = headPad ? headPad : 0 // For backward compatibility\r\n    const space = 10\r\n    const svgTitle = svg.select('.titleText')\r\n    const svgSubtitle = svg.select('.subtitleText')\r\n    const svgChart = svg.select('.mainChart')\r\n    const svgFooter = svg.select('.footerText')\r\n\r\n    svgTitle.attr(\"x\", headPad)\r\n    svgSubtitle.attr(\"x\", headPad)\r\n    svgFooter.attr(\"x\", headPad)\r\n\r\n    svgSubtitle.attr(\"y\", Number(svgTitle.attr(\"height\")))\r\n    svgChart.attr(\"y\", Number(svgTitle.attr(\"height\")) + Number(svgSubtitle.attr(\"height\")) + space)\r\n    svgFooter.attr(\"y\", Number(svgTitle.attr(\"height\")) + Number(svgSubtitle.attr(\"height\")) + space +  Number(svgChart.attr(\"height\")))\r\n  \r\n    const height = Number(svgTitle.attr(\"height\")) +\r\n      Number(svgSubtitle.attr(\"height\")) + \r\n      Number(svgChart.attr(\"height\")) + \r\n      Number(svgFooter.attr(\"height\")) +\r\n      2 * space\r\n\r\n    if (expand) {\r\n      svg.attr(\"viewBox\", \"0 0 \" + Number(svgChart.attr(\"width\")) + \" \" +  height)\r\n    } else {\r\n      svg.attr(\"width\", Number(svgChart.attr(\"width\")))\r\n      svg.attr(\"height\", height)\r\n    }\r\n\r\n}\r\n\r\nexport function saveChartImage(svg, expand, asSvg, filename, font) {\r\n\r\n  return new Promise((resolve) => {\r\n    if (asSvg) {\r\n      const blob1 =  serialize(svg, font)\r\n      if(filename) {\r\n        download(blob1, filename)\r\n      }\r\n      resolve(blob1)\r\n    } else {\r\n      rasterize(svg).then(blob2 => {\r\n        if(filename) {\r\n          download(blob2, filename)\r\n        }\r\n        resolve(blob2) \r\n      })\r\n    }\r\n  })\r\n\r\n  function download(data, filename) {\r\n    const dataUrl = URL.createObjectURL(data)\r\n    const file = asSvg ? `${filename}.svg` : `${filename}.png`\r\n    downloadLink(dataUrl, file)\r\n  }\r\n\r\n  function serialize(svg, font) {\r\n    const xmlns = \"http://www.w3.org/2000/xmlns/\"\r\n    const xlinkns = \"http://www.w3.org/1999/xlink\"\r\n    const svgns = \"http://www.w3.org/2000/svg\"\r\n  \r\n    const domSvg = svg.node()\r\n    const cloneSvg = domSvg.cloneNode(true)\r\n    const d3Clone = d3.select(cloneSvg)\r\n    // Explicitly change text in clone to required font\r\n    const fontOut = font ? font  : 'Arial, Helvetica, sans-serif'\r\n    d3Clone.selectAll('text').style(fontOut)\r\n  \r\n    cloneSvg.setAttributeNS(xmlns, \"xmlns\", svgns)\r\n    cloneSvg.setAttributeNS(xmlns, \"xmlns:xlink\", xlinkns)\r\n    const serializer = new window.XMLSerializer\r\n    const string = serializer.serializeToString(cloneSvg)\r\n    return new Blob([string], {type: \"image/svg+xml\"})\r\n  }\r\n  \r\n  function rasterize(svg, font) {\r\n    let resolve, reject\r\n    const domSvg = svg.node()\r\n    const promise = new Promise((y, n) => (resolve = y, reject = n))\r\n    const image = new Image\r\n    image.onerror = reject\r\n    image.onload = () => {\r\n      const rect = domSvg.getBoundingClientRect()\r\n      // Create a canvas element\r\n      let canvas = document.createElement('canvas')\r\n      canvas.width = rect.width\r\n      canvas.height = rect.height\r\n      let context = canvas.getContext('2d')\r\n      context.drawImage(image, 0, 0, rect.width, rect.height)\r\n      context.canvas.toBlob(resolve)\r\n    }\r\n    image.src = URL.createObjectURL(serialize(svg, font))\r\n    return promise\r\n  }\r\n\r\n  function downloadLink(dataUrl, file) {\r\n\r\n    // Create a link element\r\n    const link = document.createElement(\"a\")\r\n    // Set link's href to point to the data URL\r\n    link.href = dataUrl\r\n    link.download = file\r\n\r\n    // Append link to the body\r\n    document.body.appendChild(link)\r\n\r\n    // Dispatch click event on the link\r\n    // This is necessary as link.click() does not work on the latest firefox\r\n    link.dispatchEvent(\r\n      new MouseEvent('click', { \r\n        bubbles: true, \r\n        cancelable: true, \r\n        view: window \r\n      })\r\n    )\r\n    // Remove link from body\r\n    document.body.removeChild(link)\r\n  }\r\n}\r\n\r\nexport function transPromise(transition, pArray) {\r\n  // If the transition has any elements in selection, then\r\n  // create a promise that resolves when the transition of\r\n  // the last element completes. We do the check because it\r\n  // seems that with zero elements, the promise does not resolve\r\n  // (remains pending).\r\n  // The promise is created by\r\n  // using the 'end' method on the transition.\r\n  // The promise rejects if a transition is interrupted\r\n  // so need to handle that. (https://www.npmjs.com/package/d3-transition)\r\n  if (transition.size()) {\r\n    const p = transition.end()\r\n    p.catch(() => null)\r\n    pArray.push(p)\r\n  }\r\n}\r\n","import * as d3 from 'd3'\r\nimport * as gen from '../general'\r\n\r\nexport function addEventHandlers(svg, sel, isArc, interactivity, dataPrev, imageWidth, callback) {\r\n  sel\r\n    .on(\"mouseover\", function(d) {\r\n    if (interactivity === 'mousemove') {\r\n        highlightItem(svg, isArc ? d.data.name : d.name, true, dataPrev, imageWidth, callback)\r\n      }\r\n    })\r\n    .on(\"mouseout\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(svg, isArc ? d.data.name : d.name, false, dataPrev, imageWidth, callback)\r\n      }\r\n    })\r\n    .on(\"click\", function(d) {\r\n      if (interactivity === 'mouseclick') {\r\n        highlightItem(svg, isArc ? d.data.name : d.name, true, dataPrev, imageWidth, callback)\r\n        d3.event.stopPropagation()\r\n      }\r\n    })\r\n}\r\n\r\nexport function highlightItem (svg, name, show, dataPrev, imageWidth, callback) {\r\n  \r\n  const i = gen.safeId(name)\r\n  const imgSelected = svg.select('.brc-item-image')\r\n\r\n  if (show) {\r\n\r\n    // Callback\r\n    callback(name)\r\n\r\n    // Highlighting\r\n    svg.selectAll('path').classed('brc-lowlight', true)\r\n    svg.selectAll('.legendSwatch').classed('brc-lowlight', true)\r\n    svg.selectAll('.legendText').classed('brc-lowlight', true)\r\n    svg.selectAll('.labelsPie').classed('brc-lowlight', true)\r\n    svg.selectAll('.labelsPieHighlight').classed('brc-lowlight', true)\r\n\r\n    svg.select(`#swatch-${i}`).classed('brc-lowlight', false)\r\n    svg.select(`#legend-${i}`).classed('brc-lowlight', false)\r\n    svg.select(`#pie-${i}`).classed('brc-lowlight', false)\r\n    svg.select(`#label-highlight-${i}`).classed('brc-lowlight', false)\r\n    \r\n    svg.selectAll('.labelsPieHighlight').classed('brc-highlight', false)\r\n    svg.select(`#label-highlight-${i}`).classed('brc-highlight', true)\r\n\r\n    // Image display\r\n    const data = dataPrev.find(d => name === d.name)\r\n    if (data && data.image) {\r\n      // Loading image into SVG and setting to specified width\r\n      // and then querying bbox returns zero height. So in order\r\n      // to get the height of the image (required for correct)\r\n      // positioning, it is necessary first to load the image and\r\n      // get the dimensions.\r\n      if (data.imageHeight) {\r\n        if (imgSelected.attr('xlink:href') !== data.image) {\r\n          // The loaded image is different from that of the\r\n          // highlighted item, so load.\r\n          loadImage(data, svg)\r\n        }\r\n        imgSelected.classed('brc-item-image-hide', false)\r\n      } else {\r\n        // console.log('data', data)\r\n        const img = new Image\r\n        img.onload = function() {\r\n          data.imageWidth = imageWidth \r\n          data.imageHeight = imageWidth * this.height / this.width\r\n          loadImage(data, svg)\r\n        }\r\n        img.src = data.image\r\n        imgSelected.classed('brc-item-image-hide', false)\r\n      }\r\n    } else {\r\n      imgSelected.classed('brc-item-image-hide', true)\r\n    }\r\n  } else {\r\n    callback('')\r\n\r\n    svg.selectAll('.brc-lowlight').classed('brc-lowlight', false)\r\n    imgSelected.classed('brc-item-image-hide', true)\r\n    svg.selectAll('.labelsPie').classed('brc-highlight', false)\r\n\r\n    svg.selectAll('.labelsPieHighlight').classed('brc-highlight', false)\r\n    svg.selectAll('.labelsPieHighlight').classed('brc-lowlight', true)\r\n  }\r\n}\r\n\r\nfunction loadImage(d, svg) {\r\n  const imgSelected = svg.select('.brc-item-image')\r\n  imgSelected.attr('xlink:href', d.image)\r\n  imgSelected.attr('width', d.imageWidth)\r\n  imgSelected.attr('height', d.imageHeight)\r\n  imgSelected.attr(\"x\", -d.imageWidth / 2)\r\n  imgSelected.attr(\"y\", -d.imageHeight / 2)\r\n}","\r\nimport * as d3 from 'd3'\r\nimport * as gen from '../general'\r\nimport { addEventHandlers } from './highlightitem'\r\n\r\nexport function makePie (data, dataPrevIn, sort, strokeWidth, radius, innerRadius, innerRadius2, svg, svgChart, imageWidth, interactivity, duration, label, labelColour, labelFontSize, callback) {\r\n\r\n  //block = true\r\n\r\n  let dataDeleted, dataInserted, dataRetained\r\n  const init = !dataPrevIn\r\n  const dataNew = gen.cloneData(data)\r\n  let dataPrev\r\n  \r\n  if (init) {\r\n    dataInserted = []\r\n    dataDeleted = []\r\n    dataRetained = []\r\n    dataPrev = []\r\n  } else {\r\n    dataPrev = [...dataPrevIn]\r\n    const prevNames = dataPrev.map(d => d.name)\r\n    const newNames = dataNew.map(d => d.name)\r\n\r\n    dataDeleted = dataPrev.filter(d => !newNames.includes(d.name))\r\n    dataDeleted = gen.cloneData(dataDeleted)\r\n\r\n    dataInserted = dataNew.filter(d => !prevNames.includes(d.name))\r\n    dataInserted = gen.cloneData(dataInserted)\r\n\r\n    dataRetained = dataNew.filter(d => prevNames.includes(d.name))\r\n    dataRetained = gen.cloneData(dataRetained)\r\n  }\r\n\r\n  let fnSort\r\n  if (sort === 'asc') {\r\n    fnSort = (a,b) => b-a\r\n  } else if (sort === 'desc') {\r\n    fnSort = (a,b) => a-b\r\n  } else {\r\n    fnSort = null\r\n  }\r\n\r\n  const dataDeleted2 = dataDeleted.map(d => {\r\n    const nd = {...d}\r\n    nd.number = 0\r\n    return nd\r\n  })\r\n  const dataComb = gen.cloneData([...dataNew, ...dataDeleted2])\r\n\r\n  //const arcsPrev = d3.pie().value(d => d.number).sortValues(fnSort)(dataPrev)\r\n  //const arcsComb = d3.pie().value(d => d.number).sortValues(fnSort)(dataComb) \r\n  const arcsPrev = getArcs(dataPrev)\r\n  const arcsComb = getArcs(dataComb)\r\n\r\n  //console.log('dataComb',dataComb)\r\n\r\n  function getArcs(data){\r\n    const data1 = data.filter((d) => !d.set || d.set===1)\r\n    const data2 = data.filter((d) => d.set && d.set===2)\r\n\r\n    const arcs1 = d3.pie().value(d => d.number).sortValues(fnSort)(data1)\r\n    const arcs2 = d3.pie().value(d => d.number).sortValues(fnSort)(data2)\r\n    return [...arcs1, ...arcs2]\r\n  }\r\n  \r\n  arcsComb.forEach(arcComb => {\r\n    const prevArc = arcsPrev.find(arcPrev => arcComb.data.name === arcPrev.data.name)\r\n    if (prevArc) {\r\n      arcComb.prevArc = prevArc\r\n      if (dataDeleted.find(d => d.name === arcComb.data.name)) {\r\n        arcComb.deleted = true\r\n      }\r\n    }\r\n    if (dataInserted.find(d => d.name === arcComb.data.name)) {\r\n      arcComb.inserted = true\r\n    }\r\n  })\r\n\r\n  // Now data processing complete, reset dataPrev variable\r\n  dataPrev = data\r\n\r\n  const arcGenerator = d3.arc().innerRadius(innerRadius).outerRadius(radius)\r\n  const arcGeneratorLables = d3.arc().innerRadius(innerRadius).outerRadius(radius)\r\n  const arcGeneratorLables2 = d3.arc().innerRadius(innerRadius2).outerRadius(innerRadius)\r\n\r\n  // Good stuff here: https://bl.ocks.org/mbostock/4341417\r\n  // and here https://bl.ocks.org/mbostock/1346410\r\n  // Store the displayed angles in _current.\r\n  // Then, interpolate from _current to the new angles.\r\n  // During the transition, _current is updated in-place by d3.interpolate.\r\n  function arcTween(arc, _this, trans, radiusx, innerRadiusx, innerRadius2) {\r\n\r\n    let radius, innerRadius\r\n    if (!arc.data.set  || arc.data.set===1) {\r\n      radius = radiusx\r\n      innerRadius = innerRadiusx\r\n    } else {\r\n      radius = innerRadiusx\r\n      innerRadius = innerRadius2\r\n    }\r\n\r\n    let i\r\n    const iPrev = d3.interpolate(_this._current, arc.prevArc)\r\n    const iCurr = d3.interpolate(_this._current, arc)\r\n    const midRadius = innerRadius + (radius-innerRadius)/2\r\n\r\n    return function(t) {\r\n      if (trans === 1) {\r\n        if (init) {\r\n          i = iCurr\r\n          arcGenerator.outerRadius(d3.interpolate(innerRadius, radius)(t))\r\n          arcGenerator.innerRadius(innerRadius) \r\n        } else if (dataInserted.length) {\r\n          if (arc.deleted) {\r\n            // Previous arcs to be deleted\r\n            i = iPrev\r\n            if (dataRetained.length) {\r\n              arcGenerator.outerRadius(d3.interpolate(radius, midRadius)(t))\r\n              arcGenerator.innerRadius(d3.interpolate(innerRadius, midRadius)(t))\r\n            } else {\r\n              arcGenerator.outerRadius(d3.interpolate(radius, innerRadius)(t))\r\n              arcGenerator.innerRadius(innerRadius) \r\n            }\r\n          } else if (arc.inserted) {\r\n            // New arcs to be inserted (invisibly)\r\n            i = iCurr\r\n            arcGenerator.outerRadius(innerRadius)\r\n            arcGenerator.innerRadius(innerRadius)\r\n          } else {\r\n            // Existing arcs to be shrunk to outer ring\r\n            i = iPrev\r\n            arcGenerator.outerRadius(radius)\r\n            arcGenerator.innerRadius(d3.interpolate(innerRadius, midRadius)(t))\r\n          }\r\n        } else if (dataDeleted.length) {\r\n          if (arc.deleted) {\r\n            // Previous arcs to be deleted\r\n            i = iPrev\r\n            arcGenerator.outerRadius(d3.interpolate(radius, innerRadius)(t))\r\n            arcGenerator.innerRadius(innerRadius)\r\n          } else {\r\n            i = iPrev\r\n            arcGenerator.outerRadius(radius)\r\n            arcGenerator.innerRadius(innerRadius)\r\n          }\r\n        } else {\r\n          i = iCurr\r\n          arcGenerator.outerRadius(radius)\r\n          arcGenerator.innerRadius(innerRadius)\r\n        }\r\n      }\r\n\r\n      if (trans === 2) {\r\n        if (dataInserted.length) {\r\n          if (arc.inserted) {\r\n            i = iCurr\r\n            if (dataRetained.length) {\r\n              // Shown inserted arcs in inner ring\r\n              arcGenerator.outerRadius(d3.interpolate(innerRadius, midRadius)(t))\r\n              arcGenerator.innerRadius(innerRadius)\r\n            } else {\r\n              arcGenerator.outerRadius(d3.interpolate(innerRadius, radius)(t))\r\n              arcGenerator.innerRadius(innerRadius)\r\n            }\r\n          } else if (arc.deleted) {\r\n            i = iCurr\r\n            if (dataRetained.length) {\r\n              // Deleted arcs to be kept with inner & outer radius the same (invisible)\r\n              arcGenerator.outerRadius(midRadius)\r\n              arcGenerator.innerRadius(midRadius)\r\n            } else {\r\n              arcGenerator.outerRadius(innerRadius)\r\n              arcGenerator.innerRadius(innerRadius)\r\n            }\r\n          } else {\r\n            // Existing arcs to be shown in new positions in outer ring\r\n            i = iCurr\r\n            arcGenerator.outerRadius(radius)\r\n            arcGenerator.innerRadius(midRadius)\r\n          }\r\n        } else {\r\n          if (arc.deleted) {\r\n            i = iCurr\r\n            arcGenerator.outerRadius(innerRadius)\r\n            arcGenerator.innerRadius(innerRadius)\r\n          } else {\r\n            i = iCurr\r\n            arcGenerator.outerRadius(radius)\r\n            arcGenerator.innerRadius(innerRadius)\r\n          }\r\n        }\r\n      }\r\n\r\n      if (trans === 3) {\r\n        if (arc.inserted) {\r\n          // Shown inserted arcs in inner ring\r\n          i = iCurr\r\n          arcGenerator.outerRadius(d3.interpolate(midRadius, radius)(t))\r\n          arcGenerator.innerRadius(innerRadius)\r\n        } else if (!arc.deleted) {\r\n          // Existing arcs to be shown in new positions in outer ring\r\n          i = iCurr\r\n          arcGenerator.outerRadius(radius)\r\n          arcGenerator.innerRadius(d3.interpolate(midRadius, innerRadius)(t))\r\n        } else {\r\n          // Deletions - do nothing\r\n          i = iCurr\r\n        }\r\n      }\r\n        _this._current = i(0)\r\n      return arcGenerator(i(t))\r\n    }\r\n  }\r\n\r\n  function centroidTween(a) {\r\n    const i = d3.interpolate(this._current, a)\r\n    this._current = i(0)\r\n    return function(t) {\r\n      const gen = a.data.set && a.data.set===2 ? arcGeneratorLables2 : arcGeneratorLables\r\n      //console.log(i(t))\r\n      return `translate(${gen.centroid(i(t))})`\r\n    }\r\n  }\r\n\r\n  let svgPie, gPie\r\n  if (svg.select('.brc-chart-pie').size()) {\r\n    svgPie = svgChart.select('.brc-chart-pie')\r\n    gPie = svgPie.select('g')\r\n  } else {\r\n    svgPie = svgChart.append('svg').classed('brc-chart-pie', true)\r\n      .attr('width', 2 * radius)\r\n      .attr('height', 2 * radius)\r\n      .style('overflow', 'visible')\r\n    gPie = svgPie.append('g')\r\n      .attr('transform', `translate(${radius} ${radius})`)\r\n\r\n    gPie.append('image')\r\n      .classed('brc-item-image', true)\r\n      .classed('brc-item-image-hide', true)\r\n      .attr('width', imageWidth)\r\n  }\r\n\r\n  // Remove those paths that have been 'deleted'\r\n  // This because in our transition, we never actually remove\r\n  // arcs. Best done here because of better handling of\r\n  // interrupted transitions\r\n  gPie.selectAll(\"path[data-deleted='true']\").remove()\r\n\r\n  // map to data\r\n  const uPie =gPie.selectAll('path')\r\n    .data(arcsComb, d => d.data.name)\r\n\r\n  const ePie = uPie.enter()\r\n    .append('path')\r\n    .attr('id', (d) => `pie-${gen.safeId(d.data.name)}`)\r\n    .attr('stroke', 'white')\r\n    .style('stroke-width', `${strokeWidth}px`)\r\n    .style('opacity', 1)\r\n    .attr('fill', d => d.data.colour)\r\n    .each(function(d) { this._current = d })\r\n\r\n  addEventHandlers(svg, ePie, true, interactivity, dataPrev, imageWidth, callback)\r\n  const mPie = ePie.merge(uPie)\r\n  // Mark paths corresponding to deleted arcs as\r\n  // deleted so that they can be removed before next \r\n  // transition\r\n  mPie.attr('data-deleted', arc => arc.deleted)\r\n\r\n  let trans\r\n  let transDuration = duration\r\n  \r\n  // Transition 1\r\n  trans = mPie.transition()\r\n    .duration(duration)\r\n    .attrTween('d', function (arc) {\r\n      return arcTween(arc, this, 1, radius, innerRadius, innerRadius2)\r\n  })\r\n\r\n  // Transition 2 \r\n  if (dataDeleted.length || dataInserted.length) {\r\n    trans = trans.transition()\r\n      .duration(duration)\r\n      .attrTween('d', function (arc) {\r\n        return arcTween(arc, this, 2, radius, innerRadius, innerRadius2)\r\n      })\r\n    transDuration += duration\r\n  }\r\n\r\n  // Transition 3\r\n  if (dataInserted.length && dataRetained.length) {\r\n    trans = trans.transition()\r\n      .duration(duration)\r\n      .attrTween('d', function (arc) {\r\n        return arcTween(arc, this, 3, radius, innerRadius, innerRadius2)\r\n      })\r\n    transDuration += duration\r\n  }\r\n\r\n  // Because we always retain deleted items in order\r\n  // to make smooth transitions, the D3 exit selection\r\n  // is never populated. Instead we have to remove\r\n  // invisible deleted DOM items (SVG paths) ourselves after \r\n  // the last transition to avoid messing up the transition\r\n  // next time the data changes.\r\n  //uPie.exit().remove()  // there is no exit selection \r\n  trans.on(\"end\", function () {\r\n    // Be careful about doing anything in here in case transition interrupted\r\n    //if (arc.deleted) {\r\n      //d3.select(this).remove()\r\n    //}\r\n    //block = false\r\n  })\r\n\r\n  if (label) {\r\n\r\n    //const arcsNew = d3.pie().value(d => d.number).sortValues(fnSort)(dataNew) \r\n    //console.log(arcsNew)\r\n    const data1 = dataNew.filter((d) => !d.set || d.set===1)\r\n    const data2 = dataNew.filter((d) => d.set && d.set===2)\r\n\r\n    const arcs1 = d3.pie().value(d => d.number).sortValues(fnSort)(data1)\r\n    const arcs2 = d3.pie().value(d => d.number).sortValues(fnSort)(data2)\r\n    const arcsNew = [...arcs1, ...arcs2]\r\n\r\n    const total1 = data1.reduce((t, c) => {return t + c.number}, 0)\r\n    const total2 = data2.reduce((t, c) => {return t + c.number}, 0)\r\n\r\n    const uPieLabels = gPie.selectAll('.labelsPie')\r\n      .data(arcsNew, d => d.data.name)\r\n      \r\n    const ePieLabels = uPieLabels.enter()\r\n      .append('text')\r\n      .attr('id', (d) => `label-${gen.safeId(d.data.name)}`)\r\n      .attr(\"class\", \"labelsPie\")\r\n      .style('text-anchor', 'middle')\r\n      .style('font-size', labelFontSize)\r\n      .style('fill', labelColour)\r\n\r\n    addEventHandlers(svg, ePieLabels, true, interactivity, dataPrev, imageWidth, callback)\r\n\r\n    ePieLabels.merge(uPieLabels)\r\n      .text(d => {\r\n        if (label ==='value') {\r\n          return d.data.number\r\n        } else  {\r\n\r\n          let total = total1\r\n          if (d.data.set && d.data.set===2) {\r\n            total = total2\r\n          }\r\n\r\n          if (Number.isNaN(d.data.number) || total === 0) {\r\n              return ''\r\n          } else {\r\n            let l = Math.round(d.data.number / total * 100)\r\n            // if (l === 0) {\r\n            //   l = Math.ceil(d.data.number / total * 1000)/10\r\n            // }\r\n            return `${l}%`\r\n          }\r\n        }\r\n      })\r\n      .attr('opacity', 0)\r\n      .transition()\r\n      .duration(transDuration)\r\n      .attrTween('transform', centroidTween)\r\n      .transition()\r\n      .duration(0)\r\n      .attr('opacity', d => {\r\n        let total = total1\r\n        if (d.data.set && d.data.set===2) {\r\n          total = total2\r\n        }\r\n        if (Math.round(d.data.number / total * 100) === 0) {\r\n          return 0\r\n        } else {\r\n          return 1\r\n        }\r\n      })\r\n    uPieLabels.exit()\r\n      .remove()\r\n\r\n    const uPieLabelsHighlight = gPie.selectAll('.labelsPieHighlight')\r\n      .data(arcsNew, d => d.data.name)\r\n      \r\n    const ePieLabelsHighlight = uPieLabelsHighlight.enter()\r\n      .append('text')\r\n      .attr('id', (d) => `label-highlight-${gen.safeId(d.data.name)}`)\r\n      .classed('labelsPieHighlight', true)\r\n      .classed('brc-lowlight', true)\r\n      .style('text-anchor', 'middle')\r\n      .style('font-size', labelFontSize)\r\n      .style('fill', labelColour)\r\n\r\n    addEventHandlers(svg, ePieLabelsHighlight, true, interactivity, dataPrev, imageWidth, callback)\r\n\r\n    ePieLabelsHighlight.merge(uPieLabelsHighlight)\r\n      .text(d => {\r\n        if (label ==='value') {\r\n          return d.data.number\r\n        } else {\r\n          let total = total1\r\n          if (d.data.set && d.data.set===2) {\r\n            total = total2\r\n          }\r\n\r\n          if (Number.isNaN(d.data.number) || total === 0) {\r\n              return ''\r\n          } else {\r\n            let l = Math.round(d.data.number / total * 1000)/10\r\n            return label ==='pervalue' ? `${l}% (${d.data.number})` : `${l}%`\r\n          }\r\n        }\r\n      })\r\n      .attr('transform', d => {\r\n        const gen = d.data.set && d.data.set===2 ? arcGeneratorLables2 : arcGeneratorLables\r\n        return `translate(${gen.centroid(d)})`\r\n      })\r\n    uPieLabelsHighlight.exit()\r\n      .remove()\r\n  }\r\n\r\n  return dataPrev\r\n}","import * as gen from '../general'\r\nimport { addEventHandlers} from './highlightitem'\r\n\r\nexport function makeLegend (data, svg, svgChart, legendWidth, labelFontSize, legendSwatchSize, legendSwatchGap, legendTitle, legendTitle2, legendTitleFontSize, duration, interactivity, dataPrev, imageWidth, callback) {\r\n\r\n  let svgLegend\r\n  if (svg.select('.brc-chart-legend').size()) {\r\n    svgLegend = svgChart.select('.brc-chart-legend')\r\n  } else {\r\n    svgLegend = svgChart.append('svg').classed('brc-chart-legend', true)\r\n      .attr('overflow', 'auto')\r\n  }\r\n\r\n  // Constants relating to legendTexts\r\n  const legendTitleHeight = legendTitle  ? textHeight(legendTitleFontSize) : 0\r\n  const legendTitleGap = legendTitle  ? legendSwatchGap : 0\r\n  const legendTitleHeight2 = legendTitle2 ? textHeight(legendTitleFontSize) : 0\r\n  const legendTitleGap2 = legendTitle2 ? legendSwatchGap : 0\r\n\r\n  // Legend swatches\r\n  const uLegendSwatch = svgLegend.selectAll('.legendSwatch')\r\n    .data(data, d => d.name)\r\n\r\n  const durationUpdate = uLegendSwatch.nodes().length ? duration : 0\r\n  const durationExit = uLegendSwatch.exit().nodes().length ? duration : 0\r\n\r\n  const eLegendSwatch = uLegendSwatch.enter()\r\n    .append('rect')\r\n    .attr('id', (d) => `swatch-${gen.safeId(d.name)}`)\r\n    .classed('legendSwatch', true)\r\n    .attr('y', (d, i) => {\r\n      let titleHeight;\r\n      if (!d.set || d.set===1) {\r\n        titleHeight = legendTitleHeight + legendTitleGap\r\n      } else {\r\n        titleHeight = legendTitleHeight + legendTitleGap + legendTitleHeight2 + legendTitleGap2\r\n      }\r\n      return titleHeight + i * (legendSwatchSize + legendSwatchGap)\r\n    })\r\n    .attr('width', legendSwatchSize)\r\n    .attr('height', legendSwatchSize)\r\n    .style('fill', d => d.colour)\r\n    .attr('opacity', 0)\r\n\r\n  addEventHandlers(svg, eLegendSwatch, false, interactivity, dataPrev, imageWidth, callback)\r\n\r\n  eLegendSwatch.transition()\r\n    .delay(durationExit + durationUpdate)\r\n    .duration(duration)\r\n    .attr('opacity', 1)\r\n\r\n  uLegendSwatch\r\n    .transition()\r\n    .delay(durationExit)\r\n    .duration(duration)\r\n    .attr('y', (d, i) => {\r\n      let titleHeight;\r\n      if (!d.set || d.set===1) {\r\n        titleHeight = legendTitleHeight + legendTitleGap\r\n      } else {\r\n        titleHeight = legendTitleHeight + legendTitleGap + legendTitleHeight2 + legendTitleGap2\r\n      }\r\n      return titleHeight + i * (legendSwatchSize + legendSwatchGap)\r\n    })\r\n    .attr('opacity', 1)\r\n    \r\n  uLegendSwatch.exit()\r\n    .transition()\r\n    .duration(duration)\r\n    .attr('opacity', 0)\r\n    .remove()\r\n\r\n  // Legend text\r\n  const uLegendText = svgLegend.selectAll('.legendText')\r\n    .data(data, d => d.name)\r\n\r\n  const legendTextHeight = textHeight(labelFontSize)\r\n\r\n  const eLegendText = uLegendText.enter()\r\n    .append('text')\r\n    .text(d => d.name)\r\n    .attr('alignment-baseline', 'middle')\r\n    .attr('id', (d) => `legend-${gen.safeId(d.name)}`)\r\n    .classed('legendText', true)\r\n    .attr('x', () => legendSwatchSize + legendSwatchGap)\r\n    .attr('y', (d, i) => {\r\n      let titleHeight;\r\n      if (!d.set || d.set===1) {\r\n        titleHeight = legendTitleHeight + legendTitleGap\r\n      } else {\r\n        titleHeight = legendTitleHeight + legendTitleGap + legendTitleHeight2 + legendTitleGap2\r\n      }\r\n      return titleHeight + (i + 1) * (legendSwatchSize + legendSwatchGap) - (legendSwatchSize / 2) - (legendTextHeight / 3)\r\n    })\r\n    .style('font-size', labelFontSize)\r\n    .attr('opacity', 0)\r\n\r\n  addEventHandlers(svg, eLegendText, false, dataPrev, imageWidth, callback)\r\n\r\n  eLegendText.transition()\r\n    .delay(durationExit + durationUpdate)\r\n    .duration(duration)\r\n    .attr('opacity', 1)\r\n\r\n  uLegendText\r\n    .transition()\r\n    .delay(durationExit)\r\n    .duration(duration)\r\n    .attr('y', (d, i) => {\r\n      let titleHeight;\r\n      if (!d.set || d.set===1) {\r\n        titleHeight = legendTitleHeight + legendTitleGap\r\n      } else {\r\n        titleHeight = legendTitleHeight + legendTitleGap + legendTitleHeight2 + legendTitleGap2\r\n      }\r\n      return titleHeight + (i + 1) * (legendSwatchSize + legendSwatchGap) - (legendSwatchSize / 2) - (legendTextHeight / 3)\r\n    })\r\n    .attr('opacity', 1)\r\n    \r\n  uLegendText.exit()\r\n    .transition()\r\n    .duration(duration)\r\n    .attr('opacity', 0)\r\n    .remove()\r\n\r\n  // Legend titles\r\n  const legendTitles = []\r\n  if (legendTitle) legendTitles.push(legendTitle)\r\n  if (legendTitle2) legendTitles.push(legendTitle2)\r\n\r\n  const uLegendTitle = svgLegend.selectAll('.legendTitle')\r\n    .data(legendTitles, d => d)\r\n\r\n  const eLegendTitle = uLegendTitle.enter()\r\n    .append('text')\r\n    .text(d => d)\r\n    .attr('id', (d) => `legend-title-${gen.safeId(d)}`)\r\n    .classed('legendTitle', true)\r\n    .attr('y', (d, i) => {\r\n      if (i===0) {\r\n        return legendTitleHeight\r\n      } else {\r\n        const dataSet1Length = data.filter(d => !d.set || d.set === 1).length\r\n        return 2 * legendTitleHeight + legendTitleGap + dataSet1Length  * (legendSwatchSize + legendSwatchGap)\r\n      }\r\n    })\r\n    .style('font-size', legendTitleFontSize)\r\n    .attr('opacity', 0)\r\n\r\n  eLegendTitle.transition()\r\n    .delay(durationExit + durationUpdate)\r\n    .duration(duration)\r\n    .attr('opacity', 1)\r\n\r\n  uLegendTitle\r\n    .transition()\r\n    .delay(durationExit)\r\n    .duration(duration)\r\n    //.attr('y', (d, i) => i * (legendTitleFontSize + legendTitleGap))\r\n    .attr('y', (d, i) => {\r\n      if (i===0) {\r\n        return legendTitleHeight\r\n      } else {\r\n        const dataSet1Length = data.filter(d => !d.set || d.set === 1).length\r\n        return 2 * legendTitleHeight + legendTitleGap + dataSet1Length  * (legendSwatchSize + legendSwatchGap)\r\n      }\r\n    })\r\n    .attr('opacity', 1)\r\n    \r\n  uLegendTitle.exit()\r\n    .transition()\r\n    .duration(duration)\r\n    .attr('opacity', 0)\r\n    .remove()\r\n\r\n  //Legend size\r\n  svgLegend.attr(\"width\", legendWidth)\r\n  const legendHeight = legendTitleHeight + legendTitleGap + legendTitleHeight2 + legendTitleGap2 + data.length * (legendSwatchSize + legendSwatchGap) - legendSwatchGap\r\n  svgLegend.attr(\"height\", legendHeight > 0 ? legendHeight : 0)\r\n\r\n  // Helper functions\r\n  function textHeight(fontSize) {\r\n    const dummyText = svgLegend.append('text').attr('opacity', 0).style('font-size', fontSize).text('Dummy')\r\n    let textHeight = dummyText.node().getBBox().height\r\n    dummyText.remove()\r\n    return textHeight\r\n  }\r\n}","import * as d3 from 'd3'\r\nimport * as gen from '../general'\r\n\r\nexport function addEventHandlers(sel, prop, interactivity, svgChart) {\r\n  sel\r\n    .on(\"mouseover\", function(d) {\r\n    if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], true, svgChart)\r\n      }\r\n    })\r\n    .on(\"mouseout\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], false, svgChart)\r\n      }\r\n    })\r\n    .on(\"click\", function(d) {\r\n      if (interactivity === 'mouseclick') {\r\n        highlightItem(d[prop], true, svgChart)\r\n        d3.event.stopPropagation()\r\n      }\r\n    })\r\n}\r\n\r\nexport function highlightItem(id, highlight, svgChart) {\r\n\r\n  svgChart.selectAll('.phen-metric path')\r\n    .classed('lowlight', highlight)\r\n\r\n  svgChart.selectAll(`.phen-metric-${gen.safeId(id)} path`)\r\n    .classed('lowlight', false)\r\n\r\n  svgChart.selectAll(`.phen-metric path`)\r\n    .classed('highlight', false)\r\n\r\n  if (gen.safeId(id)) {\r\n    svgChart.selectAll(`.phen-metric-${gen.safeId(id)} path`)\r\n      .classed('highlight', highlight)\r\n  }\r\n\r\n  svgChart.selectAll('.phen-metric rect')\r\n    .classed('lowlight', highlight)\r\n\r\n  svgChart.selectAll(`.phen-metric-${gen.safeId(id)} rect`)\r\n    .classed('lowlight', false)\r\n\r\n  svgChart.selectAll(`.phen-metric rect`)\r\n    .classed('highlight', false)\r\n\r\n  if (gen.safeId(id)) {\r\n    svgChart.selectAll(`.phen-metric-${gen.safeId(id)} rect`)\r\n      .classed('highlight', highlight)\r\n  }\r\n  \r\n  svgChart.selectAll('.brc-legend-item')\r\n    .classed('lowlight', highlight)\r\n\r\n  if (id) {\r\n    svgChart.selectAll(`.brc-legend-item-${gen.safeId(id)}`)\r\n      .classed('lowlight', false)\r\n  }\r\n\r\n  if (id) {\r\n    svgChart.selectAll(`.brc-legend-item-${gen.safeId(id)}`)\r\n      .classed('highlight', highlight)\r\n  } else {\r\n    svgChart.selectAll(`.brc-legend-item`)\r\n      .classed('highlight', false)\r\n  }\r\n}","import * as d3 from 'd3'\r\nimport { month2day, safeId, xAxisMonthNoText, xAxisMonthText, transPromise } from '../general'\r\nimport { addEventHandlers} from './highlightitem'\r\n\r\nexport function makePhen (taxon, taxa, data, metricsin, svgChart, width, height, \r\n  ytype, spread, axisTop, axisBottom, axisLeft, axisRight, monthLineWidth, bands, lines,\r\n  style, stacked, duration, margin, showTaxonLabel, taxonLabelFontSize, taxonLabelItalics,\r\n  axisLabelFontSize, axisLeftLabel, interactivity, pTrans,  monthFontSize, font\r\n) {\r\n\r\n  // Examine the first record to see if week or month is specified for period\r\n  let period\r\n  if (data.length === 0 || 'week' in data[0]) {\r\n    period = 'week'\r\n  } else {\r\n    period = 'month'\r\n  }\r\n\r\n  // Reverse the metrics if this is a stacked display\r\n  const metrics = stacked ? [...metricsin].reverse() : [...metricsin]\r\n\r\n  // Pre-process data.\r\n  // Filter to named taxon and sort in week/month order\r\n  // Add max value to each.\r\n  const dataFiltered = data.filter(d => d.taxon === taxon)\r\n    .filter(d => period === 'week' ? d[period] < 53 : d[period] < 13)\r\n    .sort((a, b) => (a[period] > b[period]) ? 1 : -1)\r\n\r\n  const metricData = [] \r\n  const stackOffsets = new Array(period === 'week' ? 52 : 12).fill(0) \r\n\r\n  metrics.forEach(m => {\r\n    let total = dataFiltered.reduce((a, d) => a + d[m.prop], 0)\r\n    let max = Math.max(...dataFiltered.map(d => d[m.prop]))\r\n    let maxProportion =  Math.max(...dataFiltered.map(d => d[m.prop]/total))\r\n\r\n    // If there are no data for this metric, then reset values\r\n    // The metric will also be marked as no data so that it can\r\n    // be styled as required.\r\n    if (isNaN(total)) {\r\n      total = max = maxProportion = 0\r\n    }\r\n\r\n    let points = dataFiltered.map(d => {\r\n      return {\r\n        n: total ? d[m.prop] : 0,\r\n        period: d[period],\r\n        id: `${safeId(m.label)}-${d[period]}`,\r\n      }\r\n    })\r\n\r\n    // If the style is areas, then ensure that there is a point \r\n    // for every week or month.\r\n    if (style === 'areas') {\r\n      const maxPeriod = period === 'week' ? 52 : 12\r\n      const pointsPlus = []\r\n      for (let p = 1; p <= maxPeriod; p++) {\r\n        const match = points.find(p1 => p1.period === p)\r\n        if (typeof(match) !== 'undefined') {\r\n          pointsPlus.push(match)\r\n        } else {\r\n          pointsPlus.push({\r\n            n: 0,\r\n            period: p,\r\n            id: `${safeId(m.label)}-${p}`,\r\n          })\r\n        }\r\n      }\r\n      points = pointsPlus\r\n    }\r\n\r\n    // The closure array is a small array of points which can\r\n    // be used, in conjunction with the main points, to make\r\n    // a properly enclosed polygon that drops open sides down\r\n    // to the x axis.\r\n    let closure=[]\r\n    if (points.length) {\r\n      if (points[points.length-1].n > 0) {\r\n        closure.push({n: 0, period: points[points.length-1].period})\r\n      }\r\n      if (points[0].n > 0) {\r\n        closure.push({n: 0, period: points[0].period})\r\n      }\r\n    }\r\n\r\n    metricData.push({\r\n      id: safeId(m.label),\r\n      colour: m.colour,\r\n      strokeWidth: m.strokeWidth,\r\n      fill: m.fill ? m.fill : 'none',\r\n      max: max,\r\n      maxProportion: maxProportion,\r\n      total: total,\r\n      points: points,\r\n      stackOffsets: [...stackOffsets],\r\n      closure: closure,\r\n      hasData: total ? true : false\r\n    })\r\n\r\n    // If stacked display updated the stackOffsets array\r\n    if (stacked) {\r\n      points.forEach(d => stackOffsets[d.period-1] += d.n)\r\n    }\r\n  })\r\n\r\n  // Set the maximum value for the y axis\r\n  let yMax\r\n  if (ytype === 'normalized') {\r\n    yMax = 1\r\n  } else if (ytype === 'proportion') {\r\n    yMax = Math.max(...metricData.map(d => {\r\n      if (isNaN(d.maxProportion)) {\r\n        return 0\r\n      } else {\r\n        return d.maxProportion\r\n      }\r\n    }))\r\n  } else if (stacked) {\r\n    yMax = Math.max(...stackOffsets.filter(d => d))\r\n  } else {\r\n    yMax = Math.max(...metricData.map(d => d.max))\r\n    if (yMax < 5 && !spread && axisLeft === 'tick') yMax = 5\r\n  }\r\n  \r\n  // Calculate spread metrics\r\n  let maxMetricHeight = height\r\n  let topProp = 0\r\n  let spreadHeight = 0\r\n\r\n  if (spread && metricData.length > 1) {\r\n    const maxProp = 1.8\r\n    let valMax0, valMax1\r\n    if (ytype === 'normalized') {\r\n      valMax0 = metricData[0].hasData ? 1 : 0\r\n      valMax1 = metricData[1].hasData ? 1 : 0\r\n    } else if(ytype === 'proportion') {\r\n      valMax0 = metricData[0].maxProportion\r\n      valMax1 = metricData[1].maxProportion\r\n    } else {\r\n      valMax0 = metricData[0].max\r\n      valMax1 = metricData[1].max\r\n    }\r\n    const h1Prop = maxProp * valMax0 / yMax\r\n    const h2Prop = maxProp * valMax1 / yMax\r\n    topProp = Math.max(h1Prop, h2Prop-1)\r\n    spreadHeight = height / (0.5 + metricData.length-1 + topProp)\r\n    maxMetricHeight = maxProp * spreadHeight\r\n  }\r\n\r\n  // Value scales and related data and functions\r\n  function periodToDay(p) {\r\n    if (period === 'week') {\r\n      if (style === 'bars') {\r\n        return (p-1)*7\r\n      } else {\r\n        // style is lines\r\n        return (p-1)*7 + 3.5\r\n      }\r\n    } else {\r\n      // period === month\r\n      if (style === 'bars') {\r\n        return month2day[p-1]\r\n      } else {\r\n        // style is lines\r\n        return month2day[p-1] + ((month2day[p] - month2day[p-1]) / 2)\r\n      }\r\n    }\r\n  }\r\n  function periodToWidth(p) {\r\n    if (period === 'week') {\r\n      return xScale(7) - xScale(0) - 1\r\n    } else {\r\n      return xScale(month2day[p]) - xScale(month2day[p-1]) - 1\r\n    }\r\n  }\r\n  const xScale = d3.scaleLinear().domain([0, 366]).range([0, width])\r\n  const yScale = d3.scaleLinear().domain([0, yMax]).range([maxMetricHeight, 0])\r\n  // sScale is for the y axis for spread displays\r\n  const ysDomain = ['']\r\n  const ysRange = [0]\r\n  if (metrics.length){\r\n    for (let i=0; i<metrics.length; i++) {\r\n      ysDomain.push(metrics[i].label)\r\n      ysRange.push(topProp*spreadHeight+i*spreadHeight)\r\n    }\r\n    ysDomain.push('')\r\n    ysRange.push(height)\r\n  } else {\r\n    ysRange.push(height)\r\n  }\r\n  const sScale = d3.scaleOrdinal().domain(ysDomain).range(ysRange)\r\n\r\n  // Top axis\r\n  let tAxis\r\n  if (axisTop === 'on') {\r\n    tAxis = d3.axisTop()\r\n      .scale(xScale)\r\n      .tickValues([])\r\n      .tickSizeOuter(0)\r\n  }\r\n\r\n  // X (bottom) axis\r\n  let xAxis1, xAxis2\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    //xAxis = xAxisMonth(width, axisBottom === 'tick')\r\n    xAxis1 = xAxisMonthNoText(width)\r\n    xAxis2 = xAxisMonthText(width, axisBottom === 'tick', monthFontSize, font)\r\n  }\r\n\r\n  // Right axis\r\n  let rAxis\r\n  if (axisRight === 'on') {\r\n    rAxis = d3.axisRight()\r\n      .scale(yScale)\r\n      .tickValues([])\r\n      .tickSizeOuter(0)\r\n  }\r\n\r\n  // Y (left) axis\r\n  let yAxis\r\n  if (axisLeft === 'on' || axisLeft === 'tick') {\r\n    if (spread) {\r\n      yAxis = d3.axisLeft()\r\n        .scale(sScale)\r\n        .ticks(5)\r\n    } else {\r\n      yAxis = d3.axisLeft()\r\n        .scale(yScale)\r\n        .ticks(5)\r\n      if (axisLeft !== 'tick') {\r\n        yAxis.tickValues([]).tickSizeOuter(0)\r\n      } else if (ytype === 'count') {\r\n        yAxis.tickFormat(d3.format(\"d\"))\r\n      }\r\n    }\r\n  }\r\n\r\n  // Line generator with curves\r\n  const lineCurved = d3.line()\r\n    .curve(d3.curveMonotoneX)\r\n    .x(d => xScale(periodToDay(d.period)))\r\n    .y(d => height - maxMetricHeight + yScale(d.n))\r\n  // Line generator without curves\r\n  const lineNotCurved = d3.line()\r\n    .x(d => xScale(periodToDay(d.period)))\r\n    .y(d => height - maxMetricHeight + yScale(d.n))\r\n\r\n  // Create or get the relevant chart svg\r\n  let init, svgPhen1, gPhen1\r\n  if (taxa.length === 1 && svgChart.selectAll('.brc-chart-phen1').size() === 1) {\r\n    svgPhen1 = svgChart.select('.brc-chart-phen1')\r\n    gPhen1 = svgPhen1.select('.brc-chart-phen1-g')\r\n    init = false\r\n  } else if (svgChart.select(`#${safeId(taxon)}`).size()) {\r\n    svgPhen1 = svgChart.select(`#${safeId(taxon)}`)\r\n    gPhen1 = svgPhen1.select('.brc-chart-phen1-g')\r\n    init = false\r\n  } else {\r\n    svgPhen1 = svgChart.append('svg')\r\n      .classed('brc-chart-phen1', true)\r\n      .attr('id', safeId(taxon))\r\n      .style('overflow', 'visible')\r\n    gPhen1 = svgPhen1.append('g')\r\n      .classed('brc-chart-phen1-g', true)\r\n    init = true\r\n  }\r\n\r\n  // Vertical bands and lines\r\n  gPhen1.selectAll(\".brc-chart-month-band\")\r\n    .data(bands,  (b, i) => `month-band-${i}`)\r\n  .enter()\r\n    .append(\"rect\")\r\n    .attr(\"class\", `brc-chart-month-band`)\r\n    .style(\"fill\", (d,i) => bands[i])\r\n    .attr(\"y\", 0)\r\n    .attr(\"x\", (d,i) => xScale(month2day[i]) - 1)\r\n    .attr(\"height\", height)\r\n    .attr(\"width\", (d,i) => {\r\n      return xScale(month2day[i+1]) - xScale(month2day[i])\r\n    })\r\n  gPhen1.selectAll(\".brc-chart-month-line\")\r\n    .data(lines,  (b, i) => `month-line-${i}`)\r\n  .enter()\r\n    .append(\"rect\")\r\n    .attr(\"class\", `brc-chart-month-line`)\r\n    .style(\"fill\", (d,i) => lines[i])\r\n    .attr(\"y\", 0)\r\n    .attr(\"x\", (d,i) => xScale(month2day[i+1]) - monthLineWidth/2 - 1)\r\n    .attr(\"height\", height)\r\n    .attr(\"width\", monthLineWidth)\r\n\r\n  // Create/update the graphics for the metrics \r\n  const agroups = gPhen1.selectAll(\"g\")\r\n    .data(metricData,  d => d.id)\r\n  \r\n  const egroups = agroups.enter()\r\n    .append(\"g\")\r\n      .attr(\"opacity\", 0)\r\n      .attr(\"class\", d => `phen-metric-${d.id} phen-metric`)\r\n\r\n  addEventHandlers(egroups, 'id', interactivity, svgChart)\r\n\r\n  const mgroups = agroups.merge(egroups)\r\n    .classed(`phen-metric-no-data`, d => !d.hasData)\r\n\r\n  const t = svgChart.transition().duration(duration)\r\n\r\n  transPromise(mgroups.transition(t)\r\n    .attr('opacity', 1)\r\n    .attr(\"transform\", (d,i) => `translate(0,-${(metricData.length-1-i + 0.5) * spreadHeight})`), pTrans)\r\n\r\n  const xgroups = agroups.exit()\r\n\r\n  if (style === 'bars') {\r\n    \r\n    mgroups.each(d => {\r\n      const colour = d.colour\r\n      const max = d.max\r\n      const total = d.total\r\n      const stackOffsets = d.stackOffsets\r\n\r\n      gPhen1.select(`.phen-metric-${d.id}`).selectAll('rect')\r\n        .data(d.points,  d => d.id)\r\n        .join (\r\n          enter => enter.append(\"rect\")\r\n              .attr(\"fill\", colour)\r\n              .attr(\"stroke\", 'white')\r\n              .attr(\"stroke-width\", 1)\r\n              .attr(\"x\", d => xScale(periodToDay(d.period))-1)\r\n              .attr(\"y\", height)\r\n              .attr(\"width\", d => periodToWidth(d.period))\r\n              .attr(\"height\", 0),\r\n          update => update\r\n            // Use call for transitions to avoid breaking the\r\n            // method chain (https://observablehq.com/@d3/selection-join)\r\n            .call(update => transPromise(update.transition(t)\r\n              .attr(\"fill\", colour), pTrans)),\r\n          exit => exit\r\n            .call(exit => transPromise(exit.transition(t)\r\n              .attr(\"height\", 0)\r\n              .remove(), pTrans))\r\n        ).call(merge => transPromise(merge.transition(t)\r\n          .attr(\"y\", d => getBarY(d, max, total, stackOffsets))\r\n          .attr(\"height\", d => getBarHeight(d, max, total)), pTrans))\r\n    })\r\n  } else if (style === 'areas') {\r\n    egroups.append(\"path\")\r\n      .attr(\"class\", 'phen-path-area')\r\n      .attr(\"d\", d => flatPath(d, true))\r\n  } else {\r\n    // style ==='line'\r\n    egroups.append(\"path\")\r\n      .attr(\"class\", 'phen-path-fill')\r\n      .attr(\"d\", d => flatPath(d, true))\r\n       \r\n    egroups.append(\"path\")\r\n      .attr(\"class\", 'phen-path-line')\r\n      .attr(\"d\", d => flatPath(d, false))\r\n  }\r\n\r\n  // Each phenology line consists of both a line and polygon. This\r\n  // is necessary because if we relied on a single polygon, it is\r\n  // not always possible to confine the line graphics to the part\r\n  // of the polygon which represents the phenology line.\r\n\r\n  // Important for correct data binding to use select - NOT selectAll\r\n  // in sub-selections (https://bost.ocks.org/mike/selection/#non-grouping)\r\n  transPromise(mgroups.select('.phen-path-line')\r\n    .transition(t)\r\n    .attr(\"d\", d => getPath(d, false))\r\n    .attr(\"stroke\", d => d.colour)\r\n    .attr(\"stroke-width\", d => d.strokeWidth)\r\n    .attr(\"fill\", \"none\"), pTrans)\r\n\r\n  transPromise(mgroups.select('.phen-path-fill')\r\n    .transition(t)\r\n    .attr(\"d\", d => getPath(d, true))\r\n    .attr(\"fill\", d => d.fill), pTrans)\r\n\r\n  transPromise(mgroups.select('.phen-path-area')\r\n    .transition(t)\r\n    .attr(\"d\", d => getPath(d, true))\r\n    .attr(\"fill\", d => d.colour), pTrans)\r\n\r\n  transPromise(xgroups.select('.phen-path-line')\r\n    .transition(t)\r\n    .attr(\"d\", d => flatPath(d, false)), pTrans)\r\n\r\n  transPromise(xgroups.select('.phen-path-fill')\r\n    .transition(t)\r\n    .attr(\"d\", d => flatPath(d, true)), pTrans)\r\n\r\n  transPromise(xgroups.select('.phen-path-area')\r\n    .transition(t)\r\n    .attr(\"d\", d => flatPath(d, true)), pTrans)\r\n\r\n  transPromise(xgroups.transition(t)\r\n    .attr(\"opacity\", 0)\r\n    .remove(), pTrans)\r\n\r\n  // Path and bar generation helper functions\r\n  function flatPath(d, poly) {\r\n    const lineFn = style === 'areas' ? lineNotCurved : lineCurved\r\n    let flat = lineFn(d.points.map(p => {\r\n        return {\r\n          n: 0,\r\n          period: p.period,\r\n        }\r\n      }))\r\n    if (d.closure.length && poly) {\r\n      flat = `${flat}L${lineNotCurved(d.closure).substring(1)}`\r\n    } \r\n    return flat\r\n  }\r\n  function getPath(d, poly) {\r\n    const lineFn = style === 'areas' ? lineNotCurved : lineCurved\r\n    let lPath\r\n    if (ytype === 'normalized') {\r\n      lPath = lineFn(d.points.map(p => {\r\n        return {\r\n          n: d.max ? p.n/d.max : 0,\r\n          period: p.period,\r\n        }\r\n      }))\r\n    } else if (ytype === 'proportion') {\r\n      lPath = lineFn(d.points.map(p => {\r\n        return {\r\n          n: d.total === 0 ? 0 : p.n/d.total,\r\n          period: p.period,\r\n        }\r\n      }))\r\n    } else if (stacked) {\r\n      const so1 = [...d.stackOffsets]\r\n      const so2 = [...d.stackOffsets]\r\n      d.points.forEach(p => {\r\n        so2[p.period-1]+=p.n\r\n      })\r\n      const p1 = so1.map((n,i) => {return {period: i+1, n: n}})\r\n      const p2 = so2.map((n,i) => {return {period: i+1, n: n}})\r\n      const all = [...p1, ...p2.reverse()]\r\n      lPath = lineFn(all)\r\n    } else {\r\n      lPath = lineFn(d.points)\r\n    }\r\n    // If this is for a poly underneath a line\r\n    // display, close the path \r\n    if (poly && d.closure.length && !stacked) {\r\n      lPath = `${lPath}L${lineNotCurved(d.closure).substring(1)}`\r\n    }\r\n    return lPath\r\n  }\r\n  function getBarHeight(d, max, total) {\r\n    let v\r\n    if (ytype === 'normalized') {\r\n      v = max ? d.n/max : 0\r\n    } else if (ytype === 'proportion') {\r\n      v = total === 0 ? 0 : d.n/total\r\n    } else {\r\n      v = d.n\r\n    }\r\n    return maxMetricHeight - yScale(v)\r\n  }\r\n\r\n  function getBarY(d, max, total, stackOffsets) {\r\n    let barY\r\n    if (ytype === 'normalized') {\r\n      barY = yScale(max ? d.n/max : 0)\r\n    } else if (ytype === 'proportion') {\r\n      barY = yScale(total === 0 ? 0 : d.n/total)\r\n    } else if (stacked) {\r\n      barY = yScale(stackOffsets[d.period-1] + d.n)\r\n    } else {\r\n      barY = yScale(d.n)\r\n    }\r\n    return barY + (height - maxMetricHeight)\r\n  }\r\n\r\n  if (init) {\r\n    // Constants for positioning\r\n    const axisLeftPadX = margin.left ? margin.left : 0\r\n    const axisRightPadX = margin.right ? margin.right : 0\r\n    const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n    const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n    // Taxon title\r\n    if (showTaxonLabel) {\r\n      const taxonLabel = svgPhen1\r\n        .append('text')\r\n        .classed('brc-chart-phen1-label', true)\r\n        .text(taxon)\r\n        .style('font-size', taxonLabelFontSize)\r\n        .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n      const labelHeight = taxonLabel.node().getBBox().height\r\n      taxonLabel.attr(\"transform\", `translate(${axisLeftPadX}, ${labelHeight})`)\r\n    }\r\n    \r\n    // Size SVG\r\n    svgPhen1\r\n      .attr('width', width + axisLeftPadX + axisRightPadX)\r\n      //.attr('height', height + axisBottomPadY + axisTopPadY)\r\n      .attr('height', height + axisBottomPadY + axisTopPadY)\r\n\r\n    // Position chart\r\n    gPhen1.attr(\"transform\", `translate(${axisLeftPadX},${axisTopPadY})`)\r\n\r\n    // Create axes and position within SVG\r\n    const leftYaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${axisTopPadY})`\r\n    const topXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    //const bottomXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY + height})`\r\n    const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${axisTopPadY + height/2}) rotate(270)`\r\n    \r\n    // Create axes and position within SVG\r\n    if (yAxis) {\r\n      const gYaxis = svgPhen1.append(\"g\")\r\n        .attr(\"class\", \"y-axis\")\r\n      gYaxis.attr(\"transform\", leftYaxisTrans)\r\n    }\r\n    if (xAxis1 && xAxis2) {\r\n      // const gXaxis = svgPhen1.append(\"g\")\r\n      //   .attr(\"class\", \"x axis\")\r\n      //   .call(xAxis)\r\n\r\n      const gXaxis1 = svgPhen1.append(\"g\")\r\n        .attr(\"class\", \"x axis\")\r\n        .style('font-size', monthFontSize)\r\n        .call(xAxis1)\r\n\r\n      const gXaxis2 = svgPhen1.append(\"g\")\r\n        .attr(\"class\", \"x axis\")\r\n        .style('font-size', monthFontSize)\r\n        .call(xAxis2)\r\n\r\n      // gXaxis.selectAll(\".tick text\")\r\n      //   .style(\"text-anchor\", \"start\")\r\n      //   .attr(\"x\", 6)\r\n      //   .attr(\"y\", 6)\r\n\r\n      // gXaxis.attr(\"transform\", bottomXaxisTrans)\r\n\r\n      gXaxis2.selectAll(\".tick text\")\r\n        .style(\"text-anchor\", \"middle\")\r\n\r\n      gXaxis1.attr(\"transform\", `translate(${axisLeftPadX},${height + axisTopPadY})`)\r\n      gXaxis2.attr(\"transform\", `translate(${axisLeftPadX},${height + axisTopPadY})`)\r\n    }\r\n    if (tAxis) {\r\n      const gTaxis = svgPhen1.append(\"g\")\r\n        .call(tAxis)\r\n      gTaxis.attr(\"transform\", topXaxisTrans)\r\n    }\r\n    if (rAxis) {\r\n      const gRaxis = svgPhen1.append(\"g\")\r\n        .call(rAxis)\r\n      gRaxis.attr(\"transform\", rightYaxisTrans)\r\n    }\r\n\r\n    const tYaxisLeftLabel = svgPhen1.append(\"text\")\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n    tYaxisLeftLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n\r\n  } else if (taxa.length === 1) {\r\n    // Update taxon label\r\n    if (showTaxonLabel) {\r\n      svgPhen1.select('.brc-chart-phen1-label').text(taxon)\r\n    }\r\n  }\r\n\r\n  if (yAxis) {\r\n    transPromise(svgPhen1.select(\".y-axis\")\r\n      .transition(t)\r\n      .call(yAxis), pTrans)\r\n  }\r\n\r\n  return svgPhen1\r\n}","import * as d3 from 'd3'\r\n\r\nexport function preProcessMetrics (metrics) {\r\n  // Look for 'fading' colour in taxa and colour appropriately \r\n  // in fading shades of grey.\r\n  let iFading = 0\r\n  let metricsPlus = metrics.map(m => {\r\n    let iFade, strokeWidth\r\n    if (m.colour === 'fading') {\r\n      iFade = ++iFading\r\n      strokeWidth = 1\r\n    } else {\r\n      strokeWidth = m.strokeWidth\r\n    }\r\n    return {\r\n      prop: m.prop,\r\n      label: m.label,\r\n      colour: m.colour,\r\n      fill: m.fill,\r\n      fading: iFade,\r\n      strokeWidth: strokeWidth\r\n    }\r\n  }).reverse()\r\n\r\n  const grey = d3.scaleLinear()\r\n    .range(['#808080', '#E0E0E0'])\r\n    .domain([1, iFading])\r\n\r\n  metricsPlus.forEach(m => {\r\n    if (m.fading) {\r\n      m.colour = grey(m.fading)\r\n    }\r\n  })\r\n\r\n  return metricsPlus\r\n}","import * as gen from '../general'\r\nimport { addEventHandlers} from './highlightitem'\r\n\r\nexport function makeLegend (legendWidth, metrics, svgChart, legendFontSize, headPad, interactivity, style) {\r\n  \r\n  const swatchSize = 20\r\n  const swatchFact = 1.3\r\n\r\n  // Loop through all the legend elements and work out their\r\n  // positions based on swatch size, item lable text size and\r\n  // legend width.\r\n  const metricsReversed = gen.cloneData(metrics).reverse()\r\n\r\n  let rows = 0\r\n  let lineWidth = -swatchSize\r\n  metricsReversed.forEach(m => {\r\n    const tmpText = svgChart.append('text') //.style('display', 'none')\r\n      .text(m.label)\r\n      .style('font-size', legendFontSize)\r\n\r\n    const widthText = tmpText.node().getBBox().width\r\n    tmpText.remove()\r\n\r\n    if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n      ++rows\r\n      lineWidth = -swatchSize\r\n    }\r\n    m.x = lineWidth + swatchSize + headPad\r\n    m.y = rows * swatchSize * swatchFact\r\n\r\n    lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n  })\r\n  \r\n  const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const rect = enter.append(\"rect\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-rect brc-legend-item-${gen.safeId(m.label)}`)\r\n          .classed('brc-legend-item-line', style === 'lines')\r\n          .attr('width', swatchSize)\r\n          .attr('height', style === 'lines' ? 2 : swatchSize)\r\n        return rect\r\n    })\r\n    .attr('x', m => m.x)\r\n    .attr('y', m => {\r\n        if (style === 'bars' || style === 'areas'){\r\n          return m.y - swatchSize/5\r\n        } else {\r\n          return m.y + swatchSize/2\r\n        }\r\n    })\r\n    .attr('fill', m => m.colour)\r\n\r\n  const lt = svgChart.selectAll('.brc-legend-item-text')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const text = enter.append(\"text\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-text brc-legend-item-${gen.safeId(m.label)}`)\r\n          .text(m => m.label)\r\n          .style('font-size', legendFontSize)\r\n        return text\r\n    })\r\n    .attr('x', m => m.x + swatchSize * swatchFact)\r\n    .attr('y', m => m.y + legendFontSize * 1)\r\n\r\n  addEventHandlers(ls, 'label', interactivity, svgChart)\r\n  addEventHandlers(lt, 'label', interactivity, svgChart)\r\n\r\n  return swatchSize * swatchFact * (rows + 1)\r\n}","// README (updated 15/07/2022)\r\n// This chart is designed to show a trend line with a confidence band (data)\r\n// and, optionally, mean points with confidence bars (means).\r\n// Although many features of it have been generalised, it was\r\n// initially constructed to facilitate the BSBI atlas website and is\r\n// currently undocumented.\r\n\r\nimport * as d3 from 'd3'\r\nimport { xAxisYear } from '../general'\r\n\r\nexport function trend2({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'trend2-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 35, right: 0, top: 20, bottom: 5},\r\n  expand = false,\r\n  axisLabelFontSize = 10,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  axisLeftLabel = '',\r\n  duration = 1000,\r\n  yearMin = null,\r\n  yearMax = null,\r\n  yMin = null,\r\n  yMax = null,\r\n  adjust = true,\r\n  ylines = [],\r\n  data = [],\r\n  means = [],\r\n  style = {}\r\n} = {}) {\r\n\r\n  // Ensure default style properties are present\r\n  style.vStroke = style.vStroke ? style.vStroke : 'black'\r\n  style.vStrokeWidth = style.vStrokeWidth ? style.vStrokeWidth : 2\r\n  style.cStroke = style.cStroke ? style.cStroke : 'black'\r\n  style.cStrokeWidth = style.cStrokeWidth ? style.cStrokeWidth : 1\r\n  style.cFill = style.cFill ? style.cFill : 'silver'\r\n  style.mFill = style.mFill ? style.mFill : 'white'\r\n  style.mRad = style.mRad ? style.mRad : 2\r\n  style.mStroke = style.mStroke ? style.mStroke : 'black'\r\n  style.mStrokeWidth = style.mStrokeWidth ? style.mStrokeWidth : 1\r\n  style.sdStroke = style.sdStroke ? style.sdStroke : 'black'\r\n  style.sdStrokeWidth = style.sdStrokeWidth ? style.sdStrokeWidth : 1\r\n\r\n  const updateChart = makeChart(yMin, yMax, adjust, yearMin, yearMax, data, means, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration, style)\r\n\r\n  return {\r\n    updateChart: updateChart\r\n  }\r\n}\r\n\r\nfunction maxYear(data) {\r\n  return Math.max(...data.map(d => d.year))\r\n}\r\nfunction minYear(data) {\r\n  return Math.min(...data.map(d => d.year))\r\n}\r\nfunction maxY(data, means) {\r\n  const dMax = Math.max(...data.map(d => d.upper ? d.upper : d.value))\r\n  const mMax = Math.max(...means.map(d => d.mean + d.sd))\r\n  return Math.max(dMax, mMax)\r\n}\r\nfunction minY(data, means) {\r\n  const dMin = Math.min(...data.map(d => d.lower ? d.lower : d.value))\r\n  const mMin = Math.min(...means.map(d => d.mean - d.sd))\r\n  return Math.min(dMin, mMin)\r\n}\r\n\r\nfunction makeChart(yMin, yMax, adjust, yearMin, yearMax, data, means, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration, style) {\r\n\r\n  const svgWidth = width + margin.left + margin.right\r\n  const svgHeight = height + margin.top + margin.bottom\r\n\r\n  // Append the chart svg\r\n  const svgTrend = d3.select(`${selector}`)\r\n    .append('svg')\r\n    .attr('id', elid)\r\n\r\n  // Size the chart svg\r\n  if (expand) {\r\n    svgTrend.attr(\"viewBox\", `0 0 ${svgWidth} ${svgHeight}`)\r\n  } else {\r\n    svgTrend.attr(\"width\", svgWidth)\r\n    svgTrend.attr(\"height\", svgHeight)\r\n  }\r\n\r\n  // Axis labels\r\n  if (axisLeftLabel) {\r\n    svgTrend.append(\"text\")\r\n      .attr(\"transform\", `translate(${axisLabelFontSize},${margin.top + height/2}) rotate(270)`)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n  }\r\n\r\n  // Create axes and position within SVG\r\n  let tAxis, bAxis, lAxis, rAxis\r\n  if (axisLeft === 'on' || axisLeft === 'tick') {\r\n    lAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    bAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top + height})`)\r\n  }\r\n  if (axisTop === 'on') {\r\n    tAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisRight === 'on') {\r\n    rAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left + width}, ${margin.top})`)\r\n  }\r\n\r\n  // Create g element for chart elements\r\n  const gChart1 = svgTrend.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  const gChart2 = svgTrend.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n\r\n  // Create the API function for updating chart\r\n  const updateChart = makeUpdateChart(svgTrend, width, height, tAxis, bAxis, lAxis, rAxis, axisBottom, duration, gChart1, gChart2, style)\r\n  \r\n  // Update the chart with current data\r\n  updateChart(data, means, yearMin, yearMax, yMin, yMax, adjust, ylines)\r\n\r\n  // Return the api\r\n  return updateChart\r\n}\r\n\r\nfunction makeUpdateChart(\r\n  svg,\r\n  width,\r\n  height,\r\n  tAxis,\r\n  bAxis,\r\n  lAxis,\r\n  rAxis,\r\n  axisBottom,\r\n  duration,\r\n  gChart1,\r\n  gChart2,\r\n  style\r\n) {\r\n  return (data, means, yearMin, yearMax, yMin, yMax, adjust, ylines) => {\r\n\r\n    // Set ylines to empty array if not set\r\n    if (!ylines) {\r\n      ylines = []\r\n    }\r\n    \r\n    // Data\r\n    const dataWork = data.sort((a, b) => (a.year > b.year) ? 1 : -1)\r\n\r\n    // Adjustments\r\n    let yMinBuff, yMaxBuff\r\n    if (yMin !== null && yMax !== null && typeof yMin !== 'undefined' && typeof yMax !== 'undefined') { \r\n      yMinBuff = yMin\r\n      yMaxBuff = yMax\r\n      if (adjust) {\r\n        if (minY(dataWork, means) < yMinBuff) yMinBuff = minY(dataWork, means)\r\n        if (maxY(dataWork, means) > yMaxBuff) yMaxBuff = maxY(dataWork, means)\r\n        // Add a margin to min/max values\r\n        yMinBuff = yMinBuff - (yMaxBuff - yMinBuff) / 50\r\n        yMaxBuff = yMaxBuff + (yMaxBuff - yMinBuff) / 50\r\n      }\r\n\r\n    } else {\r\n      yMinBuff = minY(dataWork, means)\r\n      yMaxBuff = maxY(dataWork, means)\r\n      // Add a margin to min/max values\r\n      yMinBuff = yMinBuff - (yMaxBuff - yMinBuff) / 50\r\n      yMaxBuff = yMaxBuff + (yMaxBuff - yMinBuff) / 50\r\n    }\r\n\r\n    const yearMinData = minYear(dataWork)\r\n    const yearMaxData = maxYear(dataWork)\r\n    let yearMinBuff, yearMaxBuff\r\n    if (yearMin) {\r\n      yearMinBuff = yearMin\r\n    } else {\r\n      yearMinBuff = Math.floor(yearMinData - (yearMaxData - yearMinData) / 50)\r\n    }\r\n    if (yearMax) {\r\n      yearMaxBuff = yearMax\r\n    } else {\r\n      yearMaxBuff = Math.floor(yearMaxData + (yearMaxData - yearMinData) / 50)\r\n    }\r\n\r\n    // Value scales\r\n    const xScale = d3.scaleLinear().domain([yearMinBuff, yearMaxBuff]).range([0, width])\r\n    const yScale = d3.scaleLinear().domain([yMinBuff, yMaxBuff]).range([height, 0])\r\n\r\n    // Generate axes\r\n    if (tAxis) {\r\n      tAxis\r\n        .call(d3.axisTop()\r\n          .scale(xScale) // Actual scale doesn't matter, but needs one\r\n          .tickValues([])\r\n          .tickSizeOuter(0))\r\n    }\r\n    if (bAxis) {\r\n      bAxis.transition().duration(duration)\r\n        .call(xAxisYear(width, axisBottom === 'tick', yearMinBuff, yearMaxBuff, false))\r\n    }\r\n    if (lAxis) {\r\n      lAxis.transition().duration(duration)\r\n        .call(d3.axisLeft()\r\n        .scale(yScale)\r\n        .ticks(5))\r\n    }\r\n    if (rAxis) {\r\n      rAxis\r\n        .call(d3.axisRight()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0))\r\n    }\r\n\r\n    // Line path generator\r\n    const linePath = d3.line()\r\n      //.curve(d3.curveMonotoneX)\r\n      .x(d => xScale(d.y))\r\n      .y(d => yScale(d.v))\r\n\r\n    // Main data line\r\n    const vData = data.map(p => {return {y: p.year, v: p.value}})\r\n    d3Line(gChart2, linePath, duration, vData, 'valueLine', style.vStroke, style.vStrokeWidth, 'none')\r\n\r\n    // Upper confidence line\r\n    const uData = data.map(p => {return {y: p.year, v: p.upper}})\r\n    d3Line(gChart2, linePath, duration, uData, 'upperLine', style.cStroke, style.cStrokeWidth, 'none')\r\n\r\n    // Upper confidence line\r\n    const lData = data.map(p => {return {y: p.year, v: p.lower}})\r\n    d3Line(gChart2, linePath, duration, lData, 'lowerLine', style.cStroke, style.cStrokeWidth, 'none')\r\n\r\n    // Confidence polygon\r\n    lData.sort((a,b) => b.y - a.y) // Reverse order of lData\r\n    const pData = [...uData, ...lData]\r\n    d3Line(gChart1, linePath, duration, pData, 'confidence', 'none', 0, style.cFill)\r\n\r\n    // Mean and SDs\r\n    const tMeans = means.map(p => {\r\n      return {\r\n        x: xScale(p.year),\r\n        y: yScale(p.mean),\r\n        bar: linePath([{y: p.year, v: p.mean-p.sd}, {y: p.year, v: p.mean+p.sd}])\r\n      }\r\n    })\r\n    d3MeanSd(gChart2, linePath, duration, tMeans, style)\r\n\r\n    // Add path to ylines and generate\r\n    ylines.forEach(l => {\r\n      l.path = linePath([{y: yearMinBuff, v: l.y}, {y: yearMaxBuff, v: l.y}])\r\n    })\r\n    const tYlines = ylines.filter(l => l.y >= yMinBuff && l.y <= yMaxBuff)\r\n    d3Yline(gChart1, tYlines, duration)\r\n  }\r\n}\r\n\r\nfunction d3Line(gChart, linePath, duration, data, lClass, stroke, strokeWidth, fill) {\r\n\r\n    let aData\r\n    if (data.length === 0) {\r\n      aData = data\r\n    } else {\r\n      aData = [data]\r\n    }\r\n\r\n    gChart.selectAll(`.${lClass}`)\r\n      .data(aData)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr(\"d\", d => linePath(d))\r\n          .attr('class', lClass)\r\n          .style('fill', fill)\r\n          .style('stroke', stroke)\r\n          .style('stroke-width', strokeWidth)\r\n          .attr(\"opacity\", 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr(\"d\", d => linePath(d))\r\n          .attr(\"opacity\", 1)\r\n}\r\n\r\nfunction d3MeanSd(gChart, linePath, duration, means, style) {\r\n\r\n    //console.log(means)\r\n    //console.log(style)\r\n\r\n     // SDs\r\n    gChart.selectAll('.sds')\r\n      .data(means)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr('d', d => d.bar)\r\n          .attr('class', 'sds')\r\n          .style('stroke', style.sdStroke)\r\n          .style('stroke-width', style.sdStrokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr('d', d => d.bar)\r\n          .style('opacity', 1)\r\n\r\n    // Means\r\n    gChart.selectAll('.means')\r\n      .data(means)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr('cx', d => d.x)\r\n          .attr('cy', d => d.y)\r\n          .attr('r', style.mRad)\r\n          .attr('class', 'means')\r\n          .style('fill', style.mFill)\r\n          .style('stroke', style.mStroke)\r\n          .style('stroke-width', style.mStrokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n           .transition().duration(duration)\r\n           .attr('cx', d => d.x)\r\n           .attr('cy', d => d.y)\r\n           .style('opacity', 1)\r\n}\r\n\r\nfunction d3Yline(gChart, ylines, duration) {\r\n\r\n    // Horizontal y lines\r\n    gChart.selectAll('.ylines')\r\n      .data(ylines)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr('d', d => d.path)\r\n          .attr('class', 'ylines')\r\n          .style('stroke', d => d.stroke)\r\n          .style('stroke-width', d => d.strokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr('d', d => d.path)\r\n          .style('opacity', 1)\r\n}\r\n","// README (updated 15/07/2022)\r\n// This chart is designed to shown multiple gradient lines (data)\r\n// and, optionally, mean points with confidence bars (means).\r\n// Although many features of it have been generalised, it was\r\n// initially constructed to facilitate the BSBI atlas website and is\r\n// currently undocumented.\r\n\r\nimport * as d3 from 'd3'\r\nimport { xAxisYear } from '../general'\r\n\r\nexport function trend3({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'trend3-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 35, right: 0, top: 20, bottom: 5},\r\n  expand = false,\r\n  axisLabelFontSize = 10,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  axisLeftLabel = '',\r\n  duration = 1000,\r\n  yearMin = 1949,\r\n  yearMax = 2019,\r\n  yMin = null,\r\n  yMax = null,\r\n  adjust = false,\r\n  ylines = [],\r\n  data = [],\r\n  means = [],\r\n  style = {}\r\n} = {}) {\r\n\r\n  // Ensure default style properties are present\r\n  style.vStroke = style.vStroke ? style.vStroke : 'black'\r\n  style.vStrokeWidth = style.vStrokeWidth ? style.vStrokeWidth : 2\r\n  style.vOpacity = style.vOpacity ? style.vOpacity : 0.1\r\n  style.mFill = style.mFill ? style.mFill : 'white'\r\n  style.mRad = style.mRad ? style.mRad : 2\r\n  style.mStroke = style.mStroke ? style.mStroke : 'black'\r\n  style.mStrokeWidth = style.mStrokeWidth ? style.mStrokeWidth : 1\r\n  style.sdStroke = style.sdStroke ? style.sdStroke : 'black'\r\n  style.sdStrokeWidth = style.sdStrokeWidth ? style.sdStrokeWidth : 1\r\n\r\n  const updateChart = makeChart(yMin, yMax, adjust, yearMin, yearMax, data, means, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration, style)\r\n\r\n  return {\r\n    updateChart: updateChart\r\n  }\r\n}\r\n\r\nfunction maxY(data, means) {\r\n  const dMax = Math.max(...data.map(d =>  Math.max(d[0].v, d[1].v)))\r\n  const mMax = Math.max(...means.map(d => d.mean + d.sd))\r\n  return Math.max(dMax, mMax)\r\n}\r\nfunction minY(data, means) {\r\n  const dMin = Math.min(...data.map(d => Math.min(d[0].v, d[1].v)))\r\n  const mMin = Math.min(...means.map(d => d.mean - d.sd))\r\n  return Math.min(dMin, mMin)\r\n}\r\n\r\nfunction makeChart(yMin, yMax, adjust, yearMin, yearMax, data, means, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration, style) {\r\n\r\n  const svgWidth = width + margin.left + margin.right\r\n  const svgHeight = height + margin.top + margin.bottom\r\n\r\n  // Append the chart svg\r\n  const svgTrend = d3.select(`${selector}`)\r\n    .append('svg')\r\n    .attr('id', elid)\r\n\r\n  // Size the chart svg\r\n  if (expand) {\r\n    svgTrend.attr(\"viewBox\", `0 0 ${svgWidth} ${svgHeight}`)\r\n  } else {\r\n    svgTrend.attr(\"width\", svgWidth)\r\n    svgTrend.attr(\"height\", svgHeight)\r\n  }\r\n\r\n  // Axis labels\r\n  if (axisLeftLabel) {\r\n    svgTrend.append(\"text\")\r\n      .attr(\"transform\", `translate(${axisLabelFontSize},${margin.top + height/2}) rotate(270)`)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n  }\r\n\r\n  // Create axes and position within SVG\r\n  let tAxis, bAxis, lAxis, rAxis\r\n  if (axisLeft === 'on' || axisLeft === 'tick') {\r\n    lAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    bAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top + height})`)\r\n  }\r\n  if (axisTop === 'on') {\r\n    tAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisRight === 'on') {\r\n    rAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left + width}, ${margin.top})`)\r\n  }\r\n\r\n  // Create g element for chart elements\r\n  const gChart1 = svgTrend.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  const gChart2 = svgTrend.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n\r\n  // Create the API function for updating chart\r\n  const updateChart = makeUpdateChart(svgTrend, width, height, tAxis, bAxis, lAxis, rAxis, axisBottom, duration, gChart1, gChart2, style)\r\n  \r\n  // Update the chart with current data\r\n  updateChart(data, means, yearMin, yearMax, yMin, yMax, adjust, ylines)\r\n\r\n  // Return the api\r\n  return updateChart\r\n}\r\n\r\nfunction makeUpdateChart(\r\n  svg,\r\n  width,\r\n  height,\r\n  tAxis,\r\n  bAxis,\r\n  lAxis,\r\n  rAxis,\r\n  axisBottom,\r\n  duration,\r\n  gChart1,\r\n  gChart2,\r\n  style\r\n) {\r\n  return (data, means, yearMin, yearMax, yMin, yMax, adjust, ylines) => {\r\n\r\n    // Set ylines to empty array if not set\r\n    if (!ylines) {\r\n      ylines = []\r\n    }\r\n\r\n    // Convert data from an array of gradients and intercepts to an array \r\n    // of arrays of two point lines\r\n    const dataWork = data.map(d => {\r\n      const yStart = d.gradient * yearMin + d.intercept\r\n      const yEnd = d.gradient * yearMax + d.intercept\r\n      return [{y: yearMin, v: yStart}, {y: yearMax, v: yEnd}]\r\n    })\r\n\r\n    // Adjustments\r\n    let yMinBuff, yMaxBuff\r\n    if (yMin !== null && yMax !== null && typeof yMin !== 'undefined' && typeof yMax !== 'undefined') { \r\n      yMinBuff = yMin\r\n      yMaxBuff = yMax\r\n      if (adjust) {\r\n        if (minY(dataWork, means) < yMinBuff) yMinBuff = minY(dataWork, means)\r\n        if (maxY(dataWork, means) > yMaxBuff) yMaxBuff = maxY(dataWork, means)\r\n        // Add a margin to min/max values\r\n        yMinBuff = yMinBuff - (yMaxBuff - yMinBuff) / 50\r\n        yMaxBuff = yMaxBuff + (yMaxBuff - yMinBuff) / 50\r\n      }\r\n    } else {\r\n      yMinBuff = minY(dataWork, means)\r\n      yMaxBuff = maxY(dataWork, means)\r\n      // Add a margin to min/max values\r\n      yMinBuff = yMinBuff - (yMaxBuff - yMinBuff) / 50\r\n      yMaxBuff = yMaxBuff + (yMaxBuff - yMinBuff) / 50\r\n    }\r\n    const yearMinBuff = yearMin\r\n    const yearMaxBuff = yearMax\r\n\r\n    // Value scales\r\n    const xScale = d3.scaleLinear().domain([yearMinBuff, yearMaxBuff]).range([0, width])\r\n    const yScale = d3.scaleLinear().domain([yMinBuff, yMaxBuff]).range([height, 0])\r\n\r\n    // Generate axes\r\n    if (tAxis) {\r\n      tAxis\r\n        .call(d3.axisTop()\r\n          .scale(xScale) // Actual scale doesn't matter, but needs one\r\n          .tickValues([])\r\n          .tickSizeOuter(0))\r\n    }\r\n    if (bAxis) {\r\n      bAxis.transition().duration(duration)\r\n        .call(xAxisYear(width, axisBottom === 'tick', yearMinBuff, yearMaxBuff, false))\r\n    }\r\n    if (lAxis) {\r\n      lAxis.transition().duration(duration)\r\n        .call(d3.axisLeft()\r\n        .scale(yScale)\r\n        .ticks(5))\r\n    }\r\n    if (rAxis) {\r\n      rAxis\r\n        .call(d3.axisRight()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0))\r\n    }\r\n\r\n    // Line path generator\r\n    const linePath = d3.line()\r\n      //.curve(d3.curveMonotoneX)\r\n      .x(d => xScale(d.y))\r\n      .y(d => yScale(d.v))\r\n\r\n    // Main data line\r\n    d3Line(gChart2, linePath, duration, dataWork, style)\r\n\r\n    // Mean and SDs\r\n    const tMeans = means.map(p => {\r\n      return {\r\n        x: xScale(p.year),\r\n        y: yScale(p.mean),\r\n        bar: linePath([{y: p.year, v: p.mean-p.sd}, {y: p.year, v: p.mean+p.sd}]),\r\n        barStart: linePath([{y: p.year, v: yMinBuff}, {y: p.year, v: yMinBuff}])\r\n      }\r\n    })\r\n    d3MeanSd(gChart2, linePath, yScale(yMinBuff), duration, tMeans, style)\r\n\r\n    // Add path to ylines and generate\r\n    ylines.forEach(l => {\r\n      l.path = linePath([{y: yearMinBuff, v: l.y}, {y: yearMaxBuff, v: l.y}])\r\n    })\r\n    const tYlines = ylines.filter(l => l.y >= yMinBuff && l.y <= yMaxBuff)\r\n    d3Yline(gChart1, tYlines, duration)\r\n  }\r\n}\r\n\r\nfunction d3Line(gChart, linePath, duration, data, style) {\r\n\r\n    gChart.selectAll('.trend-line')\r\n      .data(data)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr(\"d\", d => linePath(d))\r\n          .attr('class', 'trend-line')\r\n          .style('stroke', style.vStroke)\r\n          .style('stroke-width', style.vStrokeWidth)\r\n          .attr(\"opacity\", 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr(\"d\", d => linePath(d))\r\n          .attr(\"opacity\", style.vOpacity)\r\n}\r\n\r\nfunction d3MeanSd(gChart, linePath, yMinBuff, duration, means, style) {\r\n\r\n     // SDs\r\n    gChart.selectAll('.sds')\r\n      .data(means)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr('d', d => d.bar)\r\n          .attr('class', 'sds')\r\n          .style('stroke', style.sdStroke)\r\n          .style('stroke-width', style.sdStrokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr('d', d => d.bar)\r\n          .style('opacity', 1)\r\n\r\n    // Means\r\n    gChart.selectAll('.means')\r\n      .data(means)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr('cx', d => d.x)\r\n          .attr('cy', d => d.y)\r\n          .attr('r', style.mRad)\r\n          .attr('class', 'means')\r\n          .style('fill', style.mFill)\r\n          .style('stroke', style.mStroke)\r\n          .style('stroke-width', style.mStrokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n           .transition().duration(duration)\r\n           .attr('cx', d => d.x)\r\n           .attr('cy', d => d.y)\r\n           .style('opacity', 1)\r\n}\r\n\r\nfunction d3Yline(gChart, ylines, duration) {\r\n\r\n    // Horizontal y lines\r\n    gChart.selectAll('.ylines')\r\n      .data(ylines)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr('d', d => d.path)\r\n          .attr('class', 'ylines')\r\n          .style('stroke', d => d.stroke)\r\n          .style('stroke-width', d => d.strokeWidth)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .transition().duration(duration)\r\n          .style(\"opacity\", 0)\r\n          .remove()\r\n      )\r\n      // Join returns merged enter and update selection\r\n          .transition().duration(duration)\r\n          .attr('d', d => d.path)\r\n          .style('opacity', 1)\r\n}","// README (updated 15/07/2022)\r\n// This chart is designed to show one or more density plots\r\n// derived from frequency data (data)\r\n// It was created to facilitate the BSBI 2020 Atlas website and\r\n// although some features have been generalised, it contains some\r\n// code that is specific for that use case.\r\n// It is currently undocumented.\r\n\r\nimport * as d3 from 'd3'\r\nimport { transPromise, saveChartImage } from '../general'\r\n\r\nexport function density({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'density-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 35, right: 0, top: 20, bottom: 5},\r\n  expand = false,\r\n  axisLabelFontSize = 10,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  axisLeftLabel = '',\r\n  axisBottomLabel = '',\r\n  duration = 1000,\r\n  xMin = null,\r\n  xMax = null,\r\n  ylines = [],\r\n  xlines = [],\r\n  data = [],\r\n  styles = [],\r\n  scaleHeight = false\r\n} = {}) {\r\n\r\n  const updateChart = makeChart(xMin, xMax, data, xlines, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisBottomLabel, axisLabelFontSize, duration, styles, scaleHeight)\r\n\r\n  return {\r\n    updateChart: updateChart,\r\n    saveImage: (asSvg, filename) => {\r\n      console.log('generate density image')\r\n      saveChartImage(d3.select(`#${elid}`), expand, asSvg, filename) \r\n    }\r\n  }\r\n}\r\n\r\nfunction maxX(data) {\r\n  return Math.max(...data.map(ds => Math.max(...ds.map(d => d.slope))))\r\n}\r\nfunction minX(data) {\r\n  return Math.min(...data.map(ds => Math.min(...ds.map(d => d.slope))))\r\n}\r\n\r\nfunction makeChart(xMin, xMax, data, xlines, ylines, selector, elid, width, height, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisBottomLabel, axisLabelFontSize, duration, styles, scaleHeight) {\r\n\r\n  const svgWidth = width + margin.left + margin.right\r\n  const svgHeight = height + margin.top + margin.bottom\r\n\r\n  // Append the chart svg\r\n  const svgDensity = d3.select(`${selector}`)\r\n    .append('svg')\r\n    .attr('id', elid)\r\n    .style('font-family', 'sans-serif')\r\n\r\n  // Size the chart svg\r\n  if (expand) {\r\n    svgDensity.attr(\"viewBox\", `0 0 ${svgWidth} ${svgHeight}`)\r\n  } else {\r\n    svgDensity.attr(\"width\", svgWidth)\r\n    svgDensity.attr(\"height\", svgHeight)\r\n  }\r\n\r\n  // Axis labels\r\n  if (axisLeftLabel) {\r\n    svgDensity.append(\"text\")\r\n      .attr(\"transform\", `translate(${axisLabelFontSize},${margin.top + height/2}) rotate(270)`)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n  }\r\n  if (axisBottomLabel) {\r\n    svgDensity.append(\"text\")\r\n      .attr(\"transform\", `translate(${margin.left + width/2},${margin.top + height + margin.bottom - axisLabelFontSize})`)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisBottomLabel) \r\n  }\r\n\r\n  // Create axes and position within SVG\r\n  let tAxis, bAxis, lAxis, rAxis\r\n  if (axisLeft === 'on' || axisLeft === 'tick') {\r\n    lAxis = svgDensity.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`) \r\n  }\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    bAxis = svgDensity.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top + height})`)\r\n  }\r\n  if (axisTop === 'on') {\r\n    tAxis = svgDensity.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisRight === 'on') {\r\n    rAxis = svgDensity.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left + width}, ${margin.top})`)\r\n  }\r\n\r\n  // Create g element for chart elements\r\n  const gChart1 = svgDensity.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  const gChart2 = svgDensity.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n\r\n  // Create the API function for updating chart\r\n  const updateChart = makeUpdateChart(svgDensity, width, height, tAxis, bAxis, lAxis, rAxis, axisBottom, duration, gChart1, gChart2, styles)\r\n  \r\n  // Update the chart with current data\r\n  updateChart(data, xMin, xMax, xlines, ylines, scaleHeight)\r\n\r\n  // Return the api\r\n  return updateChart\r\n}\r\n\r\nfunction makeUpdateChart(\r\n  svg,\r\n  width,\r\n  height,\r\n  tAxis,\r\n  bAxis,\r\n  lAxis,\r\n  rAxis,\r\n  axisBottom,\r\n  duration,\r\n  gChart1,\r\n  gChart2,\r\n  styles,\r\n) {\r\n  return (data, xMin, xMax, xlines, ylines, scaleHeight) => {\r\n\r\n    // d3 transition object\r\n    const t = svg.transition()\r\n        .duration(duration)\r\n    let pTrans = []\r\n\r\n    // Set ylines and xlines to empty array if not set\r\n    if (!xlines) xlines = []\r\n    if (!ylines) ylines = []\r\n    \r\n    // Data - do any data pre-processing here\r\n    const dataWork = data\r\n    \r\n    // Adjustments - do any min/max adjustments here\r\n    let xMinBuff, xMaxBuff\r\n    if (xMin !== null && xMax !== null && typeof xMin !== 'undefined' && typeof xMax !== 'undefined') { \r\n      xMinBuff = xMin\r\n      xMaxBuff = xMax\r\n    } else {\r\n      xMinBuff = minX(dataWork)\r\n      xMaxBuff = maxX(dataWork)\r\n      // Add a margin to min/max values\r\n      xMinBuff = xMinBuff - (xMaxBuff - xMinBuff) / 50\r\n      xMaxBuff = xMaxBuff + (xMaxBuff - xMinBuff) / 50\r\n    }\r\n\r\n    // X value scale\r\n    const xScale = d3.scaleLinear().domain([xMinBuff, xMaxBuff]).range([0, width])\r\n\r\n    // !!!!!!!!!!!!!!!! Non-general custom scale required for BSBI atlas\r\n    const custScale = d3.scaleOrdinal()\r\n      .domain(['', '- -', '-', '0', '+', '+ +', ''])\r\n      .range([xScale(xMinBuff), xScale(-0.004 - (-0.004-xMinBuff)/2), xScale(-0.0025), xScale(0), xScale(0.0025), xScale(0.004 + (xMaxBuff-0.004)/2), xScale(xMaxBuff)])\r\n\r\n    // Compute kernel density estimation\r\n    const bandwidths = dataWork.map(ds => {\r\n      const dataMin = Math.min(...ds.map(d => d.slope))\r\n      const dataMax = Math.max(...ds.map(d => d.slope))\r\n      const workMin = xMin === null ? dataMin : dataMin < xMin ? xMin : dataMin\r\n      const workMax = xMax === null ? dataMax : dataMax > xMax ? xMax : dataMax\r\n      return (workMax-workMin)/8\r\n    })\r\n    //console.log('bandwidths', bandwidths)\r\n\r\n    const densities = dataWork.map((ds,i) => {\r\n      //const ticks =  xScale.ticks(100)\r\n      const incr =  (xMaxBuff-xMinBuff)/99\r\n      const ticks = d3.range(xMinBuff, xMaxBuff+incr, incr) // For transitions need consistent number of ticks\r\n      const kde = kernelDensityEstimator(kernelEpanechnikov(bandwidths[i]), ticks)\r\n      return kde(ds.map(d => d.slope))\r\n    })\r\n\r\n    // For some reason which I don't understand, x values can occassionally overshoot\r\n    // xMaxBuff - so correct.\r\n    densities.forEach(ds => {\r\n      ds.forEach(d => {\r\n        if (d[0] > xMaxBuff) d[0] = xMaxBuff\r\n      })\r\n    })\r\n\r\n    // Y value scales must be done on the density values\r\n    // Add a buffer of 1/50 range so y value doesn't go to top of chart\r\n    // Create an overall scale.\r\n    const maxDensity = Math.max(...densities.map(ds => Math.max(...ds.map(d => d[1]))))\r\n    const yScale = d3.scaleLinear().domain([0, maxDensity * 1.02]).range([height, 0])\r\n    // Create a Y scale for each density curve. If the value of scaleHeight is set to false,\r\n    // these scales will all be identical, but if set to true then they will differ so that\r\n    // maximum value of each curve achieves the same height.\r\n    const yScales = densities.map(ds => {\r\n      if (scaleHeight) {\r\n        const maxDensity = Math.max(...ds.map(d => d[1]))\r\n        return d3.scaleLinear().domain([0, maxDensity * 1.02]).range([height, 0])\r\n      } else {\r\n        return yScale\r\n      }\r\n    })\r\n\r\n    // Generate axes\r\n    if (tAxis) {\r\n       transPromise(tAxis.transition(t)\r\n        .call(d3.axisTop()\r\n        .scale(data.length ? custScale : xScale) \r\n        .tickSize([0])\r\n        .ticks(5)\r\n        .tickSizeOuter(0)), pTrans)\r\n    }\r\n\r\n    if (bAxis) {\r\n       transPromise(bAxis.transition(t)\r\n        .call(d3.axisBottom()\r\n        .scale(xScale)\r\n        .ticks(5)), pTrans)\r\n    }\r\n    if (lAxis) {\r\n       transPromise(lAxis.transition(t)\r\n        .call(d3.axisLeft()\r\n        .scale(yScale)\r\n        .tickValues([])), pTrans)\r\n        //.ticks(5))\r\n    }\r\n    if (rAxis) {\r\n       rAxis\r\n        .call(d3.axisRight()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0))\r\n    }\r\n\r\n    // Line path generator\r\n    const linePath =  d3.line()\r\n      .curve(d3.curveMonotoneX)\r\n      .x(d => xScale(d[0]))\r\n      .y(d => yScale(d[1]))\r\n\r\n    const linePaths = yScales.map(s => {\r\n      return d3.line()\r\n        .curve(d3.curveMonotoneX)\r\n        .x(d => xScale(d[0]))\r\n        .y(d => s(d[1]))\r\n    })\r\n\r\n    if (dataWork.length) {\r\n      // console.log('dataWork', dataWork[0])\r\n      // console.log('densities', densities[0])\r\n      // console.log('linepath', linePath(densities[0]))\r\n    }\r\n    \r\n    // Generate density lines\r\n    pTrans = [...pTrans, ...d3Density(gChart1, densities, linePaths, styles, t)]\r\n\r\n    // Add path to ylines and generate\r\n    ylines.forEach(l => {\r\n      l.path = linePath([[xMinBuff, l.y], [xMaxBuff, l.y]])\r\n    })\r\n    pTrans = [...pTrans, ...d3Line(gChart1, ylines, 'ylines', t)]\r\n\r\n    // Add path to xlines and generate\r\n    xlines.forEach(l => {\r\n      l.path = linePath([[l.x, 0], [l.x, maxDensity * 1.02]])\r\n    })\r\n    pTrans = [...pTrans, ...d3Line(gChart1, xlines, 'xlines', t)]\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n}\r\n\r\nfunction d3Density(gChart, data, linePaths, styles, t) {\r\n\r\n  const pTrans = []\r\n\r\n  gChart.selectAll(`.density-line`)\r\n    .data(data)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr(\"opacity\", 0)\r\n        .attr(\"d\", (d,i) => linePaths[i](d))\r\n        .attr(\"class\", \"density-line\")\r\n        .style('fill', 'none')\r\n        .style('stroke', (d,i) => getStyle(styles, i).stroke)\r\n        .style('stroke-width', (d,i) => getStyle(styles, i).strokeWidth),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .remove(), pTrans))\r\n    )\r\n    // The selection returned by the join function is the merged\r\n    // enter and update selections\r\n    .call(merge => transPromise(merge.transition(t)\r\n        .attr(\"opacity\", 1)\r\n        .attr(\"d\", (d,i) => linePaths[i](d)), pTrans))\r\n\r\n  return pTrans\r\n}\r\n\r\nfunction d3Line(gChart, lines, lineClass, t) {\r\n\r\n  const pTrans = []\r\n\r\n  // Horizontal y lines\r\n  gChart.selectAll(`.${lineClass}`)\r\n    .data(lines)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr('d', d => d.path)\r\n        .attr('class', lineClass)\r\n        .style('stroke', d => d.stroke)\r\n        .style('stroke-width', d => d.strokeWidth)\r\n        .style ('stroke-dasharray', d => d.strokeDasharray)\r\n        .style('opacity', 0),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .remove(), pTrans))\r\n    )\r\n    // The selection returned by the join function is the merged\r\n    // enter and update selections\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .attr('d', d => d.path)\r\n      .style('opacity', 1), pTrans))\r\n\r\n  return pTrans\r\n}\r\n\r\n// Function to compute density\r\nfunction kernelDensityEstimator(kernel, X) {\r\n  return function(V) {\r\n    return X.map(function(x) {\r\n      return [x, d3.mean(V, function(v) { return kernel(x - v) })]\r\n    })\r\n  }\r\n}\r\nfunction kernelEpanechnikov(k) {\r\n  return function(v) {\r\n    return Math.abs(v /= k) <= 1 ? 0.75 * (1 - v * v) / k : 0\r\n  }\r\n}\r\n\r\nfunction getStyle(styles, i) {\r\n  let style\r\n  if (styles[i]) {\r\n    style = styles[i]\r\n  } else {\r\n    style = {}\r\n  }\r\n  // Default styles\r\n  style.stroke = style.stroke ? style.stroke : 'black'\r\n  style.strokeWidth = style.strokeWidth ? style.strokeWidth : 1\r\n  style.strokeDasharray = style.strokeDasharray ? style.strokeDasharray : '1'\r\n\r\n  return style\r\n}","// README (updated 15/07/2022)\r\n// This chart is designed to display a bar chart.\r\n// Although initiallly created to facilitate the BSBI altas website,\r\n// it has been generalised and can be used in other contexts\r\n// It is currently undocumented.\r\n\r\nimport * as d3 from 'd3'\r\nimport { transPromise, saveChartImage } from '../general'\r\n\r\nexport function bar({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'bar-chart',\r\n  width = 300,\r\n  height = 200,\r\n  padding = 0,\r\n  barHeightOnZero = 0,\r\n  margin = {left: 35, right: 0, top: 20, bottom: 5},\r\n  expand = false,\r\n  axisLabelFontSize = 10,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  axisLeftLabel = '',\r\n  duration = 1000,\r\n  data = [],\r\n  labelPosition = {}\r\n} = {}) {\r\n\r\n  const updateChart = makeChart(data, labelPosition, selector, elid, width, height, padding, barHeightOnZero, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration)\r\n\r\n  return {\r\n    updateChart: updateChart,\r\n    saveImage: (asSvg, filename) => {\r\n      console.log('generate density image')\r\n      saveChartImage(d3.select(`#${elid}`), expand, asSvg, filename) \r\n    }\r\n  }\r\n}\r\n\r\nfunction makeChart(data, labelPosition, selector, elid, width, height, padding, barHeightOnZero, margin, expand, axisLeft, axisRight, axisTop, axisBottom, axisLeftLabel, axisLabelFontSize, duration) {\r\n\r\n  const svgWidth = width + margin.left + margin.right\r\n  const svgHeight = height + margin.top + margin.bottom\r\n\r\n  // Append the chart svg\r\n  const svgTrend = d3.select(`${selector}`)\r\n    .append('svg')\r\n    .attr('id', elid)\r\n    .style('font-family', 'sans-serif')\r\n\r\n  // Size the chart svg\r\n  if (expand) {\r\n    svgTrend.attr(\"viewBox\", `0 0 ${svgWidth} ${svgHeight}`)\r\n  } else {\r\n    svgTrend.attr(\"width\", svgWidth)\r\n    svgTrend.attr(\"height\", svgHeight)\r\n  }\r\n\r\n  // Axis labels\r\n  if (axisLeftLabel) {\r\n    svgTrend.append(\"text\")\r\n      .attr(\"transform\", `translate(${axisLabelFontSize},${margin.top + height/2}) rotate(270)`)\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n  }\r\n\r\n  // Create axes and position within SVG\r\n  let tAxis, bAxis, lAxis, rAxis\r\n  if (axisLeft === 'on' || axisLeft === 'tick') {\r\n    lAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    bAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top + height})`)\r\n  }\r\n  if (axisTop === 'on') {\r\n    tAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n  }\r\n  if (axisRight === 'on') {\r\n    rAxis = svgTrend.append(\"g\")\r\n      .attr(\"transform\", `translate(${margin.left + width}, ${margin.top})`)\r\n  }\r\n\r\n  // Create g element for chart elements\r\n  const gChart = svgTrend.append(\"g\")\r\n    .attr(\"transform\", `translate(${margin.left},${margin.top})`)\r\n\r\n  // Create the API function for updating chart\r\n  const updateChart = makeUpdateChart(labelPosition, svgTrend, width, height, padding, barHeightOnZero, tAxis, bAxis, lAxis, rAxis, axisBottom, duration, gChart)\r\n  \r\n  // Update the chart with current data\r\n  updateChart(data)\r\n\r\n  // Return the api\r\n  return updateChart\r\n}\r\n\r\nfunction makeUpdateChart(\r\n  labelPosition,\r\n  svg,\r\n  width,\r\n  height,\r\n  padding,\r\n  barHeightOnZero,\r\n  tAxis,\r\n  bAxis,\r\n  lAxis,\r\n  rAxis,\r\n  axisBottom,\r\n  duration,\r\n  gChart\r\n) {\r\n\r\n  return (data) => {\r\n\r\n    // d3 transition object\r\n    const t = svg.transition()\r\n        .duration(duration)\r\n    let pTrans = []\r\n\r\n    // Value scales\r\n    let yMaxBuff = Math.max(...data.map(d => d.value))\r\n    const xScale = d3.scaleLinear().domain([0, 1]).range([0, width])\r\n    const yScale = d3.scaleLinear().domain([yMaxBuff, 0]).range([0, height])\r\n    const xScaleBottom = d3.scaleBand()\r\n      .domain(data.map(d => d.label))      \r\n      .range([0, width])                       \r\n      .padding([padding])  \r\n\r\n    // Generate axes\r\n    if (tAxis) {\r\n      tAxis\r\n        .call(d3.axisTop()\r\n        .scale(xScale) // Actual scale doesn't matter, but needs one\r\n        .tickValues([])\r\n        .tickSizeOuter(0))\r\n    }\r\n    if (bAxis && axisBottom === 'tick') {\r\n      transPromise(bAxis.transition(t)\r\n        .call(d3.axisBottom()\r\n        .scale(xScaleBottom)\r\n        .tickSizeOuter(0)), pTrans)\r\n\r\n      const labels = bAxis.selectAll(\"text\")\t\r\n      if (labelPosition[\"text-anchor\"]) labels.style(\"text-anchor\", labelPosition[\"text-anchor\"])\r\n      if (labelPosition[\"dx\"]) labels.attr(\"dx\", labelPosition[\"dx\"])\r\n      if (labelPosition[\"dy\"]) labels.attr(\"dy\", labelPosition[\"dy\"])\r\n      if (labelPosition[\"transform\"]) labels.attr(\"transform\", labelPosition[\"transform\"])\r\n    }\r\n\r\n    if (bAxis && axisBottom === 'on') {\r\n       transPromise(bAxis.transition(t)\r\n        .call(d3.axisBottom()\r\n        .scale(xScale) // Actual scale doesn't matter, but needs one\r\n        .tickValues([])\r\n        .tickSizeOuter(0)), pTrans)\r\n    }\r\n    if (lAxis) {\r\n       transPromise(lAxis.transition(t)\r\n        .call(d3.axisLeft()\r\n        .scale(yScale)\r\n        .ticks(5)), pTrans)\r\n    }\r\n    if (rAxis) {\r\n       transPromise(rAxis.transition(t)\r\n        .call(d3.axisRight()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0)), pTrans)\r\n    }\r\n    // Bar data\r\n    data.forEach(d => {\r\n      d.x = xScaleBottom(d.label)\r\n      d.y = yScale(d.value)\r\n      d.ye = height\r\n      d.width = xScaleBottom.bandwidth()\r\n      d.height = height - yScale(d.value) ? height - yScale(d.value) : barHeightOnZero\r\n    })\r\n    \r\n    pTrans = [...d3Bars(data, gChart, t), ...pTrans]\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n}\r\n\r\nfunction d3Bars(data, gChart, t) {\r\n\r\n  const pTrans = []\r\n\r\n  gChart.selectAll(`.bar`)\r\n    .data(data)\r\n    .join(\r\n      enter => enter.append('rect')\r\n        .attr('class', 'bar')\r\n        .style('fill', d => d.fill)\r\n        .style('stroke', d => d.stroke)\r\n        .style('stroke-width', d => d.strokeWidth)\r\n        .style('opacity', 0)\r\n        .attr('x', d => d.x)\r\n        .attr('y', d => d.ye)\r\n        .attr('width', d => d.width)\r\n        .attr('height', 0),\r\n\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style('opacity', 0)\r\n        .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .style('opacity', 1)\r\n      .attr('x', d => d.x)\r\n      .attr('y', d => d.y)\r\n      .attr('width', d => d.width)\r\n      .attr('height', d => d.height), pTrans))\r\n\r\n  gChart.selectAll(`.barLabel`)\r\n    .data(data)\r\n    .join(\r\n      enter => enter.append('text')\r\n        .attr('class', 'barLabel')\r\n        .style('opacity', 0)\r\n        .attr('x', d => d.x)\r\n        .attr('y', d => d.ye)\r\n        .attr('width', d => d.width)\r\n        .attr('height', 0),\r\n\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style('opacity', 0)\r\n        .remove(), pTrans))\r\n    )\r\n    // The selection returned by the join function is the merged\r\n    // enter and update selections\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .style('opacity', 1)\r\n      .attr('x', d => d.x)\r\n      .attr('y', d => d.y)\r\n      .attr('width', d => d.width)\r\n      .attr('height', d => d.height), pTrans))\r\n  \r\n  return pTrans\r\n}","import * as d3 from 'd3'\r\n\r\nexport function addEventHandlers(sel, prop, svgChart, interactivity) {\r\n  sel\r\n    .on(\"mouseover\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], true, svgChart)\r\n      }\r\n    })\r\n    .on(\"mouseout\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], false, svgChart)\r\n      }\r\n    })\r\n    .on(\"click\", function(d) {\r\n      if (interactivity === 'mouseclick') {\r\n        highlightItem(d[prop], true, svgChart)\r\n        d3.event.stopPropagation()\r\n      }\r\n    })\r\n}\r\n\r\nexport function highlightItem(id, highlight, svgChart) {\r\n\r\n  svgChart.selectAll('.yearly-graphic')\r\n    .classed('lowlight', false)\r\n\r\n  if (highlight) {\r\n    svgChart.selectAll('.yearly-graphic')\r\n      .classed('lowlight', true)\r\n    svgChart.selectAll(`.yearly-${id}`)\r\n      .classed('lowlight', false)\r\n  }\r\n}","import * as d3 from 'd3'\r\nimport { xAxisYear, safeId, transPromise } from '../general'\r\nimport { addEventHandlers } from './highlightitem'\r\n\r\nexport function makeYearly (\r\n  svgChart,\r\n  taxon,\r\n  taxa,\r\n  data,\r\n  dataPoints,\r\n  dataTrendLines,\r\n  minYear,\r\n  maxYear,\r\n  minYearTrans,\r\n  maxYearTrans,\r\n  minCount,\r\n  maxCount,\r\n  xPadPercent,\r\n  yPadPercent,\r\n  metricsPlus,\r\n  width,\r\n  height,\r\n  axisTop,\r\n  axisBottom,\r\n  showCounts,\r\n  axisLeft,\r\n  yAxisOpts,\r\n  axisRight,\r\n  duration,\r\n  interactivity,\r\n  margin,\r\n  showTaxonLabel,\r\n  taxonLabelFontSize,\r\n  taxonLabelItalics,\r\n  axisLabelFontSize,\r\n  axisLeftLabel,\r\n  axisRightLabel,\r\n  missingValues,\r\n  pTrans\r\n) {\r\n  // Pre-process data.\r\n  // Filter to named taxon and to min and max year and sort in year order\r\n  // Add max value to each.\r\n\r\n  const dataFiltered = data\r\n    .filter(d => d.taxon === taxon && d.year >= minYear && d.year <= maxYear)\r\n    .sort((a, b) => (a.year > b.year) ? 1 : -1)\r\n\r\n  const dataPointsFiltered = dataPoints\r\n    .filter(d => d.taxon === taxon && d.year >= minYear && d.year <= maxYear)\r\n    .sort((a, b) => (a.year > b.year) ? 1 : -1)\r\n\r\n  // Filter dataTrendLinesFiltered data on taxon and also from an array \r\n  // of gradients and intercepts to an array of arrays of two point lines\r\n  const dataTrendLinesFiltered = dataTrendLines\r\n    .filter(d => d.taxon === taxon)\r\n    .map(d => {\r\n      return {\r\n        taxon: d.taxon,\r\n        colour: d.colour,\r\n        width: d.width,\r\n        opacity: d.opacity,\r\n        y1: d.gradient * minYear + d.intercept,\r\n        y2: d.gradient * maxYear + d.intercept\r\n      }\r\n    })\r\n\r\n\r\n  //Set the min and maximum values for the y axis\r\n  const maxMetricCounts = metricsPlus.map(m => Math.max(\r\n    ...dataFiltered.map(d => d[m.prop]),\r\n    ...dataFiltered.filter(d => d[m.bandUpper]).map(d => d[m.bandUpper])\r\n  ))\r\n\r\n  const maxCountA = maxCount !== null ? [maxCount] : []\r\n  let yMaxCount = Math.max(\r\n    ...maxCountA,\r\n    ...maxMetricCounts,\r\n    ...dataPointsFiltered.map(d => d.y),\r\n    ...dataPointsFiltered.filter(d => d.upper).map(d => d.upper),\r\n    ...dataTrendLinesFiltered.map(d => d.y1),\r\n    ...dataTrendLinesFiltered.map(d => d.y2)\r\n  )\r\n  const minMetricCounts = metricsPlus.map(m => Math.min(\r\n    ...dataFiltered.map(d => d[m.prop]),\r\n    ...dataFiltered.filter(d => d[m.bandLower]).map(d => d[m.bandLower])\r\n  ))\r\n\r\n  const minCountA = minCount !== null ? [minCount] : []\r\n  let yMinCount = Math.min(\r\n    ...minCountA,\r\n    ...minMetricCounts,\r\n    ...dataPointsFiltered.map(d => d.y),\r\n    ...dataPointsFiltered.filter(d => d.lower).map(d => d.lower),\r\n    ...dataTrendLinesFiltered.map(d => d.y1),\r\n    ...dataTrendLinesFiltered.map(d => d.y2)\r\n  )\r\n\r\n  if (yAxisOpts.minMax !== null) {\r\n    if (yMaxCount < yAxisOpts.minMax) {\r\n      yMaxCount = yAxisOpts.minMax\r\n    }\r\n  }\r\n  if (yAxisOpts.fixedMin !== null) {\r\n    yMinCount = yAxisOpts.fixedMin\r\n  }\r\n  \r\n  // Value scales\r\n  let years = []\r\n  for (let i = minYear; i <= maxYear; i++) {\r\n    years.push(i)\r\n  }\r\n\r\n  const xPadding = (maxYear-minYear) * xPadPercent\r\n  const yPadding = (yMaxCount-yMinCount) * yPadPercent\r\n\r\n  const xScaleBar = d3.scaleBand().domain(years).range([0, width]).paddingInner(0.1)\r\n  const xScaleLine = d3.scaleLinear().domain([minYear - xPadding, maxYear + xPadding]).range([0, width])\r\n  const yScale = d3.scaleLinear().domain([yMinCount - yPadding, yMaxCount + yPadding]).range([height, 0])\r\n  \r\n  // Top axis\r\n  let tAxis\r\n  if (axisTop === 'on') {\r\n    tAxis = d3.axisTop()\r\n      .scale(xScaleLine) // Actual scale doesn't matter, but needs one\r\n      .tickValues([])\r\n      .tickSizeOuter(0)\r\n  }\r\n\r\n  // Bottom axis\r\n  let bAxis\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    bAxis = xAxisYear(width, axisBottom === 'tick', minYear - xPadding, maxYear + xPadding, showCounts === 'bar')\r\n  }\r\n\r\n  // Left and right axes\r\n  const makeXaxis = (leftRight, axisOpt) => {\r\n    let axis\r\n    const d3axis = leftRight === 'left' ? d3.axisLeft() : d3.axisRight()\r\n    switch(axisOpt) {\r\n      case 'on':\r\n        axis = d3axis.scale(yScale).tickValues([]).tickSizeOuter(0)\r\n        break\r\n      case 'tick':\r\n        axis = d3axis.scale(yScale).ticks(5).tickFormat(d3.format(yAxisOpts.numFormat))\r\n        break\r\n    }\r\n    return axis\r\n  }\r\n  const lAxis = makeXaxis('left', axisLeft)\r\n  const rAxis = makeXaxis('right', axisRight)\r\n\r\n  // Create or get the relevant chart svg\r\n  let init, svgYearly, gYearly\r\n\r\n  if (taxa.length === 1 && svgChart.selectAll('.brc-chart-yearly').size() === 1) {\r\n    svgYearly = svgChart.select('.brc-chart-yearly')\r\n    gYearly = svgYearly.select('.brc-chart-yearly-g')\r\n    init = false\r\n  } else if (svgChart.select(`#${safeId(taxon)}`).size()) {\r\n    svgYearly = svgChart.select(`#${safeId(taxon)}`)\r\n    gYearly = svgYearly.select('.brc-chart-yearly-g')\r\n    init = false\r\n  } else {\r\n    svgYearly = svgChart.append('svg')\r\n      .classed('brc-chart-yearly', true)\r\n      .attr('id', safeId(taxon))\r\n      .style('overflow', 'visible')\r\n      .style('font-family', 'sans-serif')\r\n    gYearly = svgYearly.append('g')\r\n      .classed('brc-chart-yearly-g', true)\r\n    init = true\r\n  }\r\n\r\n  // Line path generator\r\n  const lineCounts = d3.line()\r\n    //.curve(d3.curveMonotoneX) // Interpolating curves can make transitions of polygons iffy\r\n                                // because resulting number of points in path is not constant.\r\n    .x(d => xScaleLine(d.year))\r\n    .y(d => yScale(d.n))\r\n\r\n  let chartLines = []\r\n  let chartBars = []\r\n  let chartBands = []\r\n  let chartPoints = []\r\n  let chartErrorBars = []\r\n\r\n  metricsPlus.forEach(m => {\r\n\r\n    // Create a collection of the years in the dataset.\r\n    const dataDict = dataFiltered.reduce((a,d) => {\r\n      a[d.year]=d[m.prop]\r\n      return a\r\n    }, {})\r\n\r\n    // Construct data structure for line charts.\r\n    if (showCounts === 'line' && isFinite(yMinCount)) {\r\n\r\n      const pointSets = adjustForTrans(years.map(y => {\r\n        // Replace any missing values (for a given year)\r\n        // with the missing value specified (can be a value\r\n        // or 'bridge' or 'break')\r\n        return {\r\n          year: y,\r\n          n: dataDict[y] ? dataDict[y] : missingValues,\r\n        }\r\n      }))\r\n      pointSets.forEach((points, i) => {\r\n        chartLines.push({\r\n          colour: m.colour,\r\n          opacity: m.opacity,\r\n          strokeWidth: m.strokeWidth,\r\n          type: 'counts',\r\n          prop: m.prop,\r\n          part: i,\r\n          yMin: yMinCount,\r\n          pathEnter: lineCounts(points.map(p => {\r\n            return {\r\n              n: yMinCount,\r\n              year: p.year\r\n            }\r\n          })),\r\n          path: lineCounts(points)\r\n        })\r\n      })\r\n    }\r\n\r\n    // Construct data structure for confidence band on line charts.\r\n    if (showCounts === 'line' && m.bandUpper && m.bandLower && isFinite(yMinCount)) {\r\n      const ddUpper = dataFiltered.reduce((a,d) => {\r\n        a[d.year]=d[m.bandUpper]\r\n        return a\r\n      }, {})\r\n      const ddLower = dataFiltered.reduce((a,d) => {\r\n        a[d.year]=d[m.bandLower]\r\n        return a\r\n      }, {})\r\n      const upperLine = years.map(y => {\r\n        return {\r\n          year: y,\r\n          n: ddUpper[y] ? ddUpper[y] : missingValues,\r\n        }\r\n      })\r\n      const lowerLine = [...years].map(y => {\r\n        return {\r\n          year: y,\r\n          n: ddLower[y] ? ddLower[y] : missingValues,\r\n        }\r\n      })\r\n\r\n      const pointsLowerSet = adjustForTrans(lowerLine)\r\n      const pointsUpperSet = adjustForTrans(upperLine)\r\n      for (let i=0; i<pointsLowerSet.length; i++) {\r\n\r\n        const pointsLower = pointsLowerSet[i]\r\n        const pointsUpper = pointsUpperSet[i]\r\n        const pointsBand = [...pointsLowerSet[i], ...pointsUpperSet[i].reverse()]\r\n\r\n        const pointsLowerEnter = pointsLower.map(p => {\r\n          return {\r\n            n: yMinCount,\r\n            year: p.year\r\n          }\r\n        })\r\n        const pointsUpperEnter = pointsUpper.map(p => {\r\n          return {\r\n            n: yMinCount,\r\n            year: p.year\r\n          }\r\n        })\r\n\r\n        chartBands.push({\r\n          fill: m.bandFill ? m.bandFill : 'silver',\r\n          stroke: m.bandStroke ? m.bandStroke : 'grey',\r\n          fillOpacity: m.bandOpacity !== undefined ? m.bandOpacity : 0.5,\r\n          strokeOpacity: m.bandStrokeOpacity !== undefined ? m.bandStrokeOpacity : 1,\r\n          strokeWidth: m.bandStrokeWidth !== undefined ? m.bandStrokeWidth : 1,\r\n          type: 'counts',\r\n          prop: m.prop,\r\n          part: i,\r\n          bandPath: lineCounts(pointsBand),\r\n          bandPathEnter: lineCounts(pointsBand.map(p => {\r\n            return {\r\n              n: yMinCount,\r\n              year: p.year\r\n            }\r\n          })),\r\n          bandBorders: [lineCounts(pointsLower), lineCounts(pointsUpper)],\r\n          bandBordersEnter: [lineCounts(pointsLowerEnter), lineCounts(pointsUpperEnter)]\r\n        })\r\n      }\r\n    }\r\n\r\n    // Construct data structure for bar charts.\r\n    if (showCounts === 'bar') {\r\n      const bars = dataFiltered.map(d => {\r\n        return {\r\n          colour: m.colour,\r\n          opacity: m.opacity,\r\n          type: 'counts',\r\n          prop: m.prop,\r\n          year: d.year,\r\n          n: yScale(d[m.prop]),\r\n        }\r\n      })\r\n      chartBars = [...chartBars, ...bars]\r\n    }\r\n\r\n    // Construct data structure for points.\r\n    // TODO - if at some point we parameterise display styles\r\n    // for points bars, then it must be specified in here.\r\n    if (m.points) {\r\n      const points = dataFiltered.filter(d => d[m.prop]).map(d => {\r\n        let x\r\n        if (showCounts === 'bar') {\r\n          x = xScaleBar(d.year) + xScaleBar.bandwidth() / 2\r\n        } else {\r\n          x = xScaleLine(d.year)\r\n        }\r\n        return {\r\n          x: x,\r\n          y: yScale(d[m.prop]),\r\n          year: d.year,\r\n          prop: m.prop,\r\n        }\r\n      })\r\n      chartPoints = [...chartPoints, ...points]\r\n    }\r\n\r\n    // Construct data structure for error bars.\r\n    // TODO - if at some point we parameterise display styles\r\n    // for error bars, then it must be specified in here.\r\n    if (m.errorBarUpper && m.errorBarLower) {\r\n      const errorBars = dataFiltered.map(d => {\r\n        let x\r\n        if (showCounts === 'bar') {\r\n          x = xScaleBar(d.year) + xScaleBar.bandwidth() / 2\r\n        } else {\r\n          x = xScaleLine(d.year)\r\n        }\r\n        return {\r\n          year: d.year,\r\n          pathEnter:  `M ${x} ${height} L ${x} ${height}`,\r\n          path: `M ${x} ${yScale(d[m.errorBarLower])} L ${x} ${yScale(d[m.errorBarUpper])}`,\r\n          prop: m.prop,\r\n        }\r\n      })\r\n      chartErrorBars = [...chartErrorBars, ...errorBars]\r\n    } \r\n  })\r\n\r\n  // Construct data structure for supplementary trend lines.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartTrendLineSup = dataTrendLinesFiltered.map(d => {\r\n    // y = mx + c\r\n    let x1, x2\r\n    const minx = minYear - xPadding\r\n    const maxx = maxYear + xPadding\r\n    if (showCounts === 'bar') {\r\n      x1 = xScaleBar(minx)\r\n      x2 = xScaleBar(maxx) + xScaleBar.bandwidth() \r\n    } else {\r\n      x1 = xScaleLine(minx)\r\n      x2 = xScaleLine(maxx)\r\n    }\r\n    return {\r\n      colour: d.colour ? d.colour : 'red',\r\n      width: d.width ? d.width : '1',\r\n      opacity: d.opacity ? d.opacity : '1',\r\n      pathEnter:  `M ${x1} ${height} L ${x2} ${height}`,\r\n      path: `M ${x1} ${yScale( d.y1)} L ${x2} ${yScale( d.y2)}`,\r\n    }\r\n  })\r\n\r\n  // Construct data structure for supplementary points.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartPointsSup = dataPointsFiltered.map(d => {\r\n    let x \r\n    // if (showCounts === 'bar') {\r\n    //   x = xScaleBar(Math.floor(d.year)) + xScaleBar.bandwidth() * 0.5 +(d.year % 1)\r\n    // } else {\r\n    //   x = xScaleLine(d.year)\r\n    // }\r\n    x = xScaleLine(d.year)\r\n\r\n    return {\r\n      x: x,\r\n      y: yScale(d.y),\r\n      year: d.year\r\n    }\r\n  })\r\n\r\n  // Construct data structure for supplementary point error bars.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartPointsSupErrorBars = dataPointsFiltered.map(d => {\r\n    const x = xScaleLine(d.year)\r\n    return {\r\n      pathEnter:  `M ${x} ${height} L ${x} ${height}`,\r\n      path: `M ${x} ${yScale(d.lower)} L ${x} ${yScale(d.upper)}`,\r\n      year: d.year\r\n    }\r\n  })\r\n\r\n  // d3 transition object\r\n  const t = svgYearly.transition()\r\n      .duration(duration)\r\n\r\n  // Bars\r\n  gYearly.selectAll(\".yearly-bar\")\r\n    .data(chartBars, d => `bars-${d.prop}-${d.year}`)\r\n    .join(\r\n      enter => enter.append(\"rect\")\r\n        .attr(\"class\", d => `yearly-bar yearly-graphic yearly-${d.prop}`)\r\n        .attr('width', xScaleBar.bandwidth())\r\n        .attr('height', 0)\r\n        .attr('fill', d => d.colour)\r\n        .attr('opacity', 0)\r\n        .attr('y', height)\r\n        .attr('x', d => xScaleBar(d.year)),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr('height', 0)\r\n          .attr('y', height)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr('y', d => d.n)\r\n      .attr('x', d => xScaleBar(d.year))\r\n      .attr('height', d => height - d.n)\r\n      .attr('width', xScaleBar.bandwidth())\r\n      .attr(\"fill\", d => d.colour)\r\n      .attr(\"opacity\", d => d.opacity), pTrans))\r\n\r\n  // Bands\r\n  gYearly.selectAll(\".yearly-band\")\r\n    .data(chartBands, d => `band-${d.prop}-${d.part}`)\r\n    .join(\r\n      enter => enter.append(\"path\")\r\n        .attr(\"class\", d => `yearly-band yearly-graphic yearly-${d.prop}`)\r\n        .attr(\"opacity\", 0)\r\n        .attr(\"fill\", d => d.fill)\r\n        .attr(\"stroke\", \"none\")\r\n        .attr(\"d\", d => d.bandPathEnter),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr(\"d\", d => d.bandPathEnter)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr(\"d\", d => d.bandPath)\r\n      .attr(\"opacity\", d => d.fillOpacity)\r\n      .attr(\"fill\", d => d.fill), pTrans))\r\n\r\n\r\n  // Band lines\r\n  for (let iLine=0; iLine<2; iLine++) { \r\n    gYearly.selectAll(`.yearly-band-border-${iLine}`)\r\n      .data(chartBands, d => `band-line-${d.prop}-${iLine}-${d.part}`)\r\n      .join(\r\n        enter => enter.append(\"path\")\r\n          .attr(\"class\", d => `yearly-band-border-${iLine} yearly-graphic yearly-${d.prop}`)\r\n          .attr(\"opacity\", 0)\r\n          .attr(\"fill\",\"none\")\r\n          .attr(\"stroke\", d => d.stroke)\r\n          .attr(\"stroke-width\", d => d.strokeWidth)\r\n          .attr(\"d\", d => d.bandBordersEnter[iLine]),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit =>  transPromise(exit.transition(t)\r\n            .attr(\"d\", d => d.bandBordersEnter[iLine])\r\n            .style(\"opacity\", 0)\r\n            .remove(), pTrans))\r\n         ).call(merge => transPromise(merge.transition(t)\r\n          // The selection returned by the join function is the merged\r\n          // enter and update selections\r\n          .attr(\"d\", d => d.bandBorders[iLine])\r\n          .attr(\"opacity\", d => d.strokeOpacity)\r\n          .attr(\"stroke\", d => d.stroke)\r\n          .attr(\"stroke-width\", d => d.strokeWidth), pTrans))\r\n  }\r\n\r\n  // Main lines\r\n  gYearly.selectAll(\".yearly-line\")\r\n    .data(chartLines,  d => `line-${d.prop}-${d.part}`)\r\n    .join(\r\n      enter => enter.append(\"path\")\r\n        .attr(\"class\", d => `yearly-line yearly-graphic yearly-${d.prop}`)\r\n        .attr(\"opacity\", 0)\r\n        .attr(\"fill\", \"none\")\r\n        .attr(\"stroke\", d => d.colour)\r\n        .attr(\"stroke-width\", d => d.strokeWidth)\r\n        .attr(\"d\", d => d.pathEnter),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr(\"d\", d => d.path)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .attr(\"stroke\", d => d.colour)\r\n      .attr(\"stroke-width\", d => d.strokeWidth), pTrans))\r\n\r\n  // Error bars\r\n  gYearly.selectAll('.yearly-error-bars')\r\n      .data(chartErrorBars, d => `error-bars-${d.prop}-${d.year}`)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr(\"class\", d => `yearly-error-bars yearly-graphic yearly-${d.prop}`)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .style('fill', 'none')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit.call(exit => transPromise(exit\r\n          .transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr(\"d\", d => d.path)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  // Points\r\n  gYearly.selectAll('.yearly-point')\r\n      .data(chartPoints, d => `point-${d.prop}-${d.year}`)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr(\"class\", d => `yearly-point yearly-graphic yearly-${d.prop}`)\r\n          .attr('cx', d => d.x)\r\n          //.attr('cy', d => d.y)\r\n          .attr('cy', height)\r\n          .attr('r', 3)\r\n          .style('fill', 'white')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => transPromise(exit.transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr('cy', height)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr('cx', d => d.x)\r\n        .attr('cy', d => d.y)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  // Supplementary trend lines\r\n  gYearly.selectAll('.yearly-trend-lines-sup')\r\n    .data(chartTrendLineSup)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .attr('class', 'yearly-trend-lines-sup')\r\n        .style('stroke', d => d.colour)\r\n        .style('stroke-width', d => d.width)\r\n        .attr(\"opacity\", 0),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .remove(), pTrans))\r\n    )\r\n    // Join returns merged enter and update selection\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .attr(\"d\", d => d.path)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .style('stroke', d => d.colour)\r\n      .style('stroke-width', d => d.width), pTrans))\r\n \r\n  // Supplementary points error bars\r\n  gYearly.selectAll('.yearly-error-bars-sup')\r\n    .data(chartPointsSupErrorBars, d => `error-bars-sup-${d.year}`)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr(\"class\", `yearly-error-bars-sup`)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .style('fill', 'none')\r\n        .style('stroke', 'black')\r\n        .style('stroke-width', 1)\r\n        .style('opacity', 0),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .remove(), pTrans))\r\n    )\r\n    // The selection returned by the join function is the merged\r\n    // enter and update selections\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .attr(\"d\", d => d.path)\r\n      .style('opacity', 1), pTrans))\r\n      \r\n  // Supplementary points\r\n  gYearly.selectAll('.yearly-point-data-sup')\r\n      .data(chartPointsSup, d => `point-data-sup-${d.year}`)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr(\"class\", `yearly-point-data-sup`)\r\n          .attr('cx', d => d.x)\r\n          //.attr('cy', d => d.y)\r\n          .attr('cy', height)\r\n          .attr('r', 3)\r\n          .style('fill', 'white')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => transPromise(exit.transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr('cy', height)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr('cx', d => d.x)\r\n        .attr('cy', d => d.y)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  addEventHandlers(gYearly.selectAll(\"path\"), 'prop', svgChart, interactivity)\r\n  addEventHandlers(gYearly.selectAll(\".yearly-bar\"), 'prop', svgChart, interactivity)\r\n  addEventHandlers(gYearly.selectAll(\".yearly-point\"), 'prop', svgChart, interactivity)\r\n      \r\n  if (init) {\r\n\r\n    // Constants for positioning\r\n    const axisLeftPadX = margin.left ? margin.left : 0\r\n    const axisRightPadX = margin.right ? margin.right : 0\r\n    const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n    const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n    // Taxon title\r\n    if (showTaxonLabel) {\r\n      const taxonLabel = svgYearly\r\n        .append('text')\r\n        .classed('brc-chart-yearly-label', true)\r\n        .text(taxon)\r\n        .style('font-size', taxonLabelFontSize)\r\n        .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n      const labelHeight = taxonLabel.node().getBBox().height\r\n      taxonLabel.attr(\"transform\", `translate(${axisLeftPadX}, ${labelHeight})`)\r\n    }\r\n    \r\n      // Size SVG\r\n    svgYearly\r\n      .attr('width', width + axisLeftPadX + axisRightPadX)\r\n      .attr('height', height + axisBottomPadY + axisTopPadY)\r\n\r\n    // Position chart\r\n    gYearly.attr(\"transform\", `translate(${axisLeftPadX},${axisTopPadY})`)\r\n    \r\n    // Create axes and position within SVG\r\n    const leftYaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${axisTopPadY + height/2}) rotate(270)`\r\n    const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${axisTopPadY})`\r\n    const rightYaxisLabelTrans = `translate(${axisLeftPadX + width + axisRightPadX - axisLabelFontSize}, ${axisTopPadY + height/2}) rotate(90)`\r\n    const topXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    const bottomXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY + height})`\r\n\r\n    // Create axes and position within SVG\r\n    if (lAxis) {\r\n      const gLaxis = svgYearly.append(\"g\")\r\n        .attr(\"class\", \"l-axis\")\r\n        // .classed('yearly-type-counts',  axisLeft === 'tick')\r\n        // .classed('yearly-type-props',  axisLeft !== 'tick')\r\n      gLaxis.attr(\"transform\", leftYaxisTrans)\r\n    }\r\n    if (bAxis) {\r\n      const gBaxis = svgYearly.append(\"g\")\r\n        .attr(\"class\", \"x axis\")\r\n        .call(bAxis)\r\n      gBaxis.attr(\"transform\", bottomXaxisTrans)\r\n    }\r\n    if (tAxis) {\r\n      const gTaxis = svgYearly.append(\"g\")\r\n        .call(tAxis)\r\n      gTaxis.attr(\"transform\", topXaxisTrans)\r\n    }\r\n    if (rAxis) {\r\n      const gRaxis = svgYearly.append(\"g\")\r\n        //.call(rAxis)\r\n        .attr(\"class\", \"r-axis\")\r\n        // .classed('yearly-type-counts',  axisRight === 'tick')\r\n        // .classed('yearly-type-props',  axisRight !== 'tick')\r\n      gRaxis.attr(\"transform\", rightYaxisTrans)\r\n    }\r\n\r\n    const tYaxisLeftLabel = svgYearly.append(\"text\")\r\n      // .classed('yearly-type-counts',  axisLeft === 'tick')\r\n      // .classed('yearly-type-props',  axisLeft !== 'tick')\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n    tYaxisLeftLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n\r\n    const tYaxisRightLabel = svgYearly.append(\"text\")\r\n      // .classed('yearly-type-counts',  axisRight === 'tick')\r\n      // .classed('yearly-type-props',  axisRight !== 'tick')\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisRightLabel) \r\n    tYaxisRightLabel.attr(\"transform\", rightYaxisLabelTrans)\r\n\r\n  } else {\r\n    if (taxa.length === 1) {\r\n      // Update taxon label\r\n      if (showTaxonLabel) {\r\n        svgYearly.select('.brc-chart-yearly-label').text(taxon)\r\n      }\r\n    }\r\n\r\n    // Update the bottom axis if it exists. We do this because\r\n    // yearMin and/or yearMax may have changed.\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      transPromise(svgYearly.select(\".x.axis\")\r\n        .transition(t)\r\n        .call(bAxis), pTrans)\r\n    }\r\n  }\r\n\r\n  if (svgYearly.selectAll(\".l-axis\").size()){\r\n\r\n    transPromise(svgYearly.select(\".l-axis\")\r\n      .transition(t)\r\n      .call(lAxis), pTrans)\r\n  }\r\n\r\n  if (svgYearly.selectAll(\".r-axis\").size()){\r\n    transPromise(svgYearly.select(\".r-axis\")\r\n      .transition(t)\r\n      .call(rAxis), pTrans)\r\n  }\r\n  \r\n  return svgYearly\r\n\r\n  function adjustForTrans(pntsIn) {\r\n    // Return an array of arrays of points. There may be more than one array\r\n    // of points in the main array if there are breaks in the input array\r\n    // of points.\r\n\r\n    // First restructure the passed in points to an array of arrays.\r\n    let pntsSplit = []\r\n    pntsIn.forEach(p => {\r\n      if (p.n === 'break') {\r\n        // Add a new array\r\n        pntsSplit.push([])\r\n      } else {\r\n        if (pntsSplit.length === 0) {\r\n          // Fist value so first add a new array\r\n          pntsSplit.push([])\r\n        }\r\n        // Add point to array\r\n        pntsSplit[pntsSplit.length - 1].push(p)\r\n      }\r\n    })\r\n    // At this point pntsSplit could have empty arrays, e.g. if there\r\n    // where consecutive 'breaks' so weed these out.\r\n    pntsSplit = pntsSplit.filter(a => a.length > 0)\r\n\r\n    // Adjust of transition year ranges\r\n    const retSet = []\r\n    pntsSplit.forEach(pnts => {\r\n\r\n      const ret = [...pnts]\r\n      retSet.push(ret)\r\n\r\n      // If missing year values are being bridged, add a point at last\r\n      // known value.\r\n      for (let i = 0; i < pnts.length; i++) {\r\n        if (pnts[i].n === 'bridge') {\r\n          pnts[i].n = pnts[i-1].n\r\n          pnts[i].year = pnts[i-1].year\r\n        }\r\n      }\r\n\r\n      // When minYearTans and MaxYearTrans are set, then each trend line\r\n      // must have the same number of points in (MaxYearTrans - minYearTans + 1 points).\r\n      // This is to make nice looking transitions between lines with otherwise\r\n      // different numbers of points.\r\n      if (minYearTrans) {\r\n        for(let i=minYearTrans; i<pnts[0].year; i++) {\r\n          ret.unshift({\r\n            n: pnts[0].n,\r\n            year: pnts[0].year\r\n          })\r\n        }\r\n      }\r\n      if (maxYearTrans) {\r\n        for(let i=pnts[pnts.length-1].year + 1; i <= maxYearTrans; i++) {\r\n          ret.push({\r\n            n: pnts[pnts.length-1].n,\r\n            year: pnts[pnts.length-1].year\r\n          })\r\n        }\r\n      }\r\n    })\r\n    \r\n    return retSet\r\n    //return retSet[retSet.length - 1]\r\n  }\r\n}","import * as gen from '../general'\r\nimport { addEventHandlers } from './highlightitem'\r\n\r\nexport function makeLegend (\r\n  svgChart,\r\n  metricsPlus,\r\n  legendWidth,\r\n  legendFontSize,\r\n  headPad,\r\n  showCounts,\r\n  interactivity\r\n) {\r\n  \r\n  const swatchSize = 15\r\n  const swatchFact = 1.3\r\n\r\n  // Loop through all the legend elements and work out their\r\n  // positions based on swatch size, item label text size and\r\n  // legend width.\r\n  const metricsReversed = gen.cloneData(metricsPlus).reverse()\r\n\r\n  let rows = 0\r\n  let lineWidth = -swatchSize\r\n  metricsReversed.forEach(m => {\r\n    const tmpText = svgChart.append('text') //.style('display', 'none')\r\n      .text(m.label)\r\n      .style('font-size', legendFontSize)\r\n\r\n    const widthText = tmpText.node().getBBox().width\r\n    tmpText.remove()\r\n\r\n    if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n      ++rows\r\n      lineWidth = -swatchSize\r\n    }\r\n    m.x = lineWidth + swatchSize + headPad\r\n    m.y = rows * swatchSize * swatchFact\r\n\r\n    lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n  })\r\n\r\n  const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const rect = enter.append(\"rect\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-rect yearly-graphic yearly-${m.prop}`)\r\n          .attr('width', swatchSize)\r\n          .attr('height', showCounts === 'bar' ? swatchSize : 2)\r\n        return rect\r\n    })\r\n    .attr('x', m => m.x)\r\n    .attr('y', m => showCounts === 'bar' ?  m.y + swatchSize/5 : m.y + swatchSize/2)\r\n    .attr('fill', m => m.colour)\r\n\r\n  const lt = svgChart.selectAll('.brc-legend-item-text')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const text = enter.append(\"text\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-text yearly-graphic yearly-${m.prop}`)\r\n          .text(m => m.label)\r\n          .style('font-size', legendFontSize)\r\n        return text\r\n    })\r\n    .attr('x', m => m.x + swatchSize * swatchFact)\r\n    .attr('y', m => m.y + legendFontSize * 1)\r\n\r\n  addEventHandlers(ls, 'prop', svgChart, interactivity)\r\n  addEventHandlers(lt, 'prop', svgChart, interactivity)\r\n\r\n  return swatchSize * swatchFact * (rows + 1)\r\n}","import * as d3 from 'd3'\r\n\r\nexport function addEventHandlers(sel, prop, svgChart, interactivity) {\r\n  sel\r\n    .on(\"mouseover\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], true, svgChart)\r\n      }\r\n    })\r\n    .on(\"mouseout\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n        highlightItem(d[prop], false, svgChart)\r\n      }\r\n    })\r\n    .on(\"click\", function(d) {\r\n      if (interactivity === 'mouseclick') {\r\n        highlightItem(d[prop], true, svgChart)\r\n        d3.event.stopPropagation()\r\n      }\r\n    })\r\n}\r\n\r\nexport function highlightItem(id, highlight, svgChart) {\r\n\r\n  svgChart.selectAll('.temporal-graphic')\r\n    .classed('lowlight', false)\r\n\r\n  if (highlight) {\r\n    svgChart.selectAll('.temporal-graphic')\r\n      .classed('lowlight', true)\r\n    svgChart.selectAll(`.temporal-${id}`)\r\n      .classed('lowlight', false)\r\n  }\r\n}","import * as d3 from 'd3'\r\nimport { xAxisYear, xAxisMonthText, xAxisMonthNoText, safeId, transPromise } from '../general'\r\nimport { addEventHandlers } from './highlightitem'\r\n\r\nexport function makeTemporal (\r\n  svgChart,\r\n  taxon,\r\n  taxa,\r\n  data,\r\n  dataPoints,\r\n  dataTrendLines,\r\n  periodType,\r\n  minPeriod,\r\n  maxPeriod,\r\n  minPeriodTrans,\r\n  maxPeriodTrans,\r\n  minY,\r\n  maxY,\r\n  xPadPercent,\r\n  yPadPercent,\r\n  metricsPlus,\r\n  width,\r\n  height,\r\n  axisTop,\r\n  axisBottom,\r\n  chartStyle,\r\n  axisLeft,\r\n  yAxisOpts,\r\n  axisRight,\r\n  duration,\r\n  interactivity,\r\n  margin,\r\n  showTaxonLabel,\r\n  taxonLabelFontSize,\r\n  taxonLabelItalics,\r\n  axisLabelFontSize,\r\n  axisLeftLabel,\r\n  axisRightLabel,\r\n  missingValues,\r\n  pTrans\r\n) {\r\n  // Pre-process data.\r\n  // Filter to named taxon and to min and max period and sort in period order\r\n  // Add max value to each.\r\n\r\n  const dataFiltered = data\r\n    .filter(d => d.taxon === taxon && d.period >= minPeriod && d.period <= maxPeriod)\r\n    .sort((a, b) => (a.period > b.period) ? 1 : -1)\r\n\r\n  const dataPointsFiltered = dataPoints\r\n    .filter(d => d.taxon === taxon && d.period >= minPeriod && d.period <= maxPeriod)\r\n    .sort((a, b) => (a.period > b.period) ? 1 : -1)\r\n\r\n  // Filter dataTrendLinesFiltered data on taxon and also from an array \r\n  // of gradients and intercepts to an array of arrays of two point lines\r\n  const dataTrendLinesFiltered = dataTrendLines\r\n    .filter(d => d.taxon === taxon)\r\n    .map(d => {\r\n      return {\r\n        taxon: d.taxon,\r\n        colour: d.colour,\r\n        width: d.width,\r\n        opacity: d.opacity,\r\n        y1: d.gradient * minPeriod + d.intercept,\r\n        y2: d.gradient * maxPeriod + d.intercept\r\n      }\r\n    })\r\n\r\n\r\n  //Set the min and maximum values for the y axis\r\n  const maxMetricYs = metricsPlus.map(m => Math.max(\r\n    ...dataFiltered.map(d => d[m.prop]),\r\n    ...dataFiltered.filter(d => d[m.bandUpper]).map(d => d[m.bandUpper])\r\n  ))\r\n\r\n  const maxYA = maxY !== null ? [maxY] : []\r\n  let ymaxY = Math.max(\r\n    ...maxYA,\r\n    ...maxMetricYs,\r\n    ...dataPointsFiltered.map(d => d.y),\r\n    ...dataPointsFiltered.filter(d => d.upper).map(d => d.upper),\r\n    ...dataTrendLinesFiltered.map(d => d.y1),\r\n    ...dataTrendLinesFiltered.map(d => d.y2)\r\n  )\r\n  const minMetricYs = metricsPlus.map(m => Math.min(\r\n    ...dataFiltered.map(d => d[m.prop]),\r\n    ...dataFiltered.filter(d => d[m.bandLower]).map(d => d[m.bandLower])\r\n  ))\r\n\r\n  const minYA = minY !== null ? [minY] : []\r\n  let yminY = Math.min(\r\n    ...minYA,\r\n    ...minMetricYs,\r\n    ...dataPointsFiltered.map(d => d.y),\r\n    ...dataPointsFiltered.filter(d => d.lower).map(d => d.lower),\r\n    ...dataTrendLinesFiltered.map(d => d.y1),\r\n    ...dataTrendLinesFiltered.map(d => d.y2)\r\n  )\r\n\r\n  if (yAxisOpts.minMax !== null) {\r\n    if (ymaxY < yAxisOpts.minMax) {\r\n      ymaxY = yAxisOpts.minMax\r\n    }\r\n  }\r\n  if (yAxisOpts.fixedMin !== null) {\r\n    yminY = yAxisOpts.fixedMin\r\n  }\r\n  \r\n  // Value scales\r\n  let periods = []\r\n  for (let i = minPeriod; i <= maxPeriod; i++) {\r\n    periods.push(i)\r\n  }\r\n\r\n  const xPadding = (maxPeriod-minPeriod) * xPadPercent\r\n  const yPadding = (ymaxY-yminY) * yPadPercent\r\n\r\n  const xScaleBar = d3.scaleBand().domain(periods).range([0, width]).paddingInner(0.1)\r\n  const xScaleLine = d3.scaleLinear().domain([minPeriod - xPadding, maxPeriod + xPadding]).range([0, width])\r\n  const yScale = d3.scaleLinear().domain([yminY - yPadding, ymaxY + yPadding]).range([height, 0])\r\n  \r\n  // Top axis\r\n  let tAxis\r\n  if (axisTop === 'on') {\r\n    tAxis = d3.axisTop()\r\n      .scale(xScaleLine) // Actual scale doesn't matter, but needs one\r\n      .tickValues([])\r\n      .tickSizeOuter(0)\r\n  }\r\n\r\n  // Bottom axis\r\n  let bAxis, bAxisTicks\r\n  if (axisBottom === 'on' || axisBottom === 'tick') {\r\n    if (periodType === 'year') {\r\n      bAxis = xAxisYear(width, axisBottom === 'tick', minPeriod - xPadding, maxPeriod + xPadding, chartStyle === 'bar')\r\n    } else {\r\n      bAxis = xAxisMonthNoText(width)\r\n      //bAxis = xAxisMonthText(width, axisBottom === 'tick', axisLabelFontSize, 'Arial')\r\n    }\r\n  }\r\n\r\n  // Left and right axes\r\n  const makeXaxis = (leftRight, axisOpt) => {\r\n    let axis\r\n    const d3axis = leftRight === 'left' ? d3.axisLeft() : d3.axisRight()\r\n    switch(axisOpt) {\r\n      case 'on':\r\n        axis = d3axis.scale(yScale).tickValues([]).tickSizeOuter(0)\r\n        break\r\n      case 'tick':\r\n        axis = d3axis.scale(yScale).ticks(5).tickFormat(d3.format(yAxisOpts.numFormat))\r\n        break\r\n    }\r\n    return axis\r\n  }\r\n  const lAxis = makeXaxis('left', axisLeft)\r\n  const rAxis = makeXaxis('right', axisRight)\r\n\r\n  // Create or get the relevant chart svg\r\n  let init, svgTemporal, gTemporal\r\n\r\n  if (taxa.length === 1 && svgChart.selectAll('.brc-chart-temporal').size() === 1) {\r\n    svgTemporal = svgChart.select('.brc-chart-temporal')\r\n    gTemporal = svgTemporal.select('.brc-chart-temporal-g')\r\n    init = false\r\n  } else if (svgChart.select(`#${safeId(taxon)}`).size()) {\r\n    svgTemporal = svgChart.select(`#${safeId(taxon)}`)\r\n    gTemporal = svgTemporal.select('.brc-chart-temporal-g')\r\n    init = false\r\n  } else {\r\n    svgTemporal = svgChart.append('svg')\r\n      .classed('brc-chart-temporal', true)\r\n      .attr('id', safeId(taxon))\r\n      .style('overflow', 'visible')\r\n      .style('font-family', 'sans-serif')\r\n    gTemporal = svgTemporal.append('g')\r\n      .classed('brc-chart-temporal-g', true)\r\n    init = true\r\n  }\r\n\r\n  // Line path generator\r\n  const lineValues = d3.line()\r\n    //.curve(d3.curveMonotoneX) // Interpolating curves can make transitions of polygons iffy\r\n                                // because resulting number of points in path is not constant.\r\n    .x(d => xScaleLine(d.period))\r\n    .y(d => yScale(d.n))\r\n\r\n  let chartLines = []\r\n  let chartBars = []\r\n  let chartBands = []\r\n  let chartPoints = []\r\n  let chartErrorBars = []\r\n\r\n  metricsPlus.forEach(m => {\r\n\r\n    // Create a collection of the periods in the dataset.\r\n    const dataDict = dataFiltered.reduce((a,d) => {\r\n      a[d.period]=d[m.prop]\r\n      return a\r\n    }, {})\r\n\r\n    // Construct data structure for line charts.\r\n    if (chartStyle === 'line' && isFinite(yminY)) {\r\n\r\n      const pointSets = adjustForTrans(periods.map(y => {\r\n        // Replace any missing values (for a given period)\r\n        // with the missing value specified (can be a value\r\n        // or 'bridge' or 'break')\r\n        return {\r\n          period: y,\r\n          n: dataDict[y] ? dataDict[y] : missingValues,\r\n        }\r\n      }))\r\n      pointSets.forEach((points, i) => {\r\n        chartLines.push({\r\n          colour: m.colour,\r\n          opacity: m.opacity,\r\n          strokeWidth: m.strokeWidth,\r\n          type: 'counts',\r\n          prop: m.prop,\r\n          part: i,\r\n          yMin: yminY,\r\n          pathEnter: lineValues(points.map(p => {\r\n            return {\r\n              n: yminY,\r\n              period: p.period\r\n            }\r\n          })),\r\n          path: lineValues(points)\r\n        })\r\n      })\r\n    }\r\n\r\n    // Construct data structure for confidence band on line charts.\r\n    if (chartStyle === 'line' && m.bandUpper && m.bandLower && isFinite(yminY)) {\r\n      const ddUpper = dataFiltered.reduce((a,d) => {\r\n        a[d.period]=d[m.bandUpper]\r\n        return a\r\n      }, {})\r\n      const ddLower = dataFiltered.reduce((a,d) => {\r\n        a[d.period]=d[m.bandLower]\r\n        return a\r\n      }, {})\r\n      const upperLine = periods.map(y => {\r\n        return {\r\n          period: y,\r\n          n: ddUpper[y] ? ddUpper[y] : missingValues,\r\n        }\r\n      })\r\n      const lowerLine = [...periods].map(y => {\r\n        return {\r\n          period: y,\r\n          n: ddLower[y] ? ddLower[y] : missingValues,\r\n        }\r\n      })\r\n\r\n      const pointsLowerSet = adjustForTrans(lowerLine)\r\n      const pointsUpperSet = adjustForTrans(upperLine)\r\n      for (let i=0; i<pointsLowerSet.length; i++) {\r\n\r\n        const pointsLower = pointsLowerSet[i]\r\n        const pointsUpper = pointsUpperSet[i]\r\n        const pointsBand = [...pointsLowerSet[i], ...pointsUpperSet[i].reverse()]\r\n\r\n        const pointsLowerEnter = pointsLower.map(p => {\r\n          return {\r\n            n: yminY,\r\n            period: p.period\r\n          }\r\n        })\r\n        const pointsUpperEnter = pointsUpper.map(p => {\r\n          return {\r\n            n: yminY,\r\n            period: p.period\r\n          }\r\n        })\r\n\r\n        chartBands.push({\r\n          fill: m.bandFill ? m.bandFill : 'silver',\r\n          stroke: m.bandStroke ? m.bandStroke : 'grey',\r\n          fillOpacity: m.bandOpacity !== undefined ? m.bandOpacity : 0.5,\r\n          strokeOpacity: m.bandStrokeOpacity !== undefined ? m.bandStrokeOpacity : 1,\r\n          strokeWidth: m.bandStrokeWidth !== undefined ? m.bandStrokeWidth : 1,\r\n          //type: 'counts',\r\n          prop: m.prop,\r\n          part: i,\r\n          bandPath: lineValues(pointsBand),\r\n          bandPathEnter: lineValues(pointsBand.map(p => {\r\n            return {\r\n              n: yminY,\r\n              period: p.period\r\n            }\r\n          })),\r\n          bandBorders: [lineValues(pointsLower), lineValues(pointsUpper)],\r\n          bandBordersEnter: [lineValues(pointsLowerEnter), lineValues(pointsUpperEnter)]\r\n        })\r\n      }\r\n    }\r\n\r\n    // Construct data structure for bar charts.\r\n    if (chartStyle === 'bar') {\r\n      const bars = dataFiltered.map(d => {\r\n        return {\r\n          colour: m.colour,\r\n          opacity: m.opacity,\r\n          //type: 'counts',\r\n          prop: m.prop,\r\n          period: d.period,\r\n          n: yScale(d[m.prop]),\r\n        }\r\n      })\r\n      chartBars = [...chartBars, ...bars]\r\n    }\r\n\r\n    // Construct data structure for points.\r\n    // TODO - if at some point we parameterise display styles\r\n    // for points bars, then it must be specified in here.\r\n    if (m.points) {\r\n      const points = dataFiltered.filter(d => d[m.prop]).map(d => {\r\n        let x\r\n        if (chartStyle === 'bar') {\r\n          x = xScaleBar(d.period) + xScaleBar.bandwidth() / 2\r\n        } else {\r\n          x = xScaleLine(d.period)\r\n        }\r\n        return {\r\n          x: x,\r\n          y: yScale(d[m.prop]),\r\n          period: d.period,\r\n          prop: m.prop,\r\n        }\r\n      })\r\n      chartPoints = [...chartPoints, ...points]\r\n    }\r\n\r\n    // Construct data structure for error bars.\r\n    // TODO - if at some point we parameterise display styles\r\n    // for error bars, then it must be specified in here.\r\n    if (m.errorBarUpper && m.errorBarLower) {\r\n      const errorBars = dataFiltered.map(d => {\r\n        let x\r\n        if (chartStyle === 'bar') {\r\n          x = xScaleBar(d.period) + xScaleBar.bandwidth() / 2\r\n        } else {\r\n          x = xScaleLine(d.period)\r\n        }\r\n        return {\r\n          period: d.period,\r\n          pathEnter:  `M ${x} ${height} L ${x} ${height}`,\r\n          path: `M ${x} ${yScale(d[m.errorBarLower])} L ${x} ${yScale(d[m.errorBarUpper])}`,\r\n          prop: m.prop,\r\n        }\r\n      })\r\n      chartErrorBars = [...chartErrorBars, ...errorBars]\r\n    } \r\n  })\r\n\r\n  // Construct data structure for supplementary trend lines.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartTrendLineSup = dataTrendLinesFiltered.map(d => {\r\n    // y = mx + c\r\n    let x1, x2\r\n    const minx = minPeriod - xPadding\r\n    const maxx = maxPeriod + xPadding\r\n    if (chartStyle === 'bar') {\r\n      x1 = xScaleBar(minx)\r\n      x2 = xScaleBar(maxx) + xScaleBar.bandwidth() \r\n    } else {\r\n      x1 = xScaleLine(minx)\r\n      x2 = xScaleLine(maxx)\r\n    }\r\n    return {\r\n      colour: d.colour ? d.colour : 'red',\r\n      width: d.width ? d.width : '1',\r\n      opacity: d.opacity ? d.opacity : '1',\r\n      pathEnter:  `M ${x1} ${height} L ${x2} ${height}`,\r\n      path: `M ${x1} ${yScale( d.y1)} L ${x2} ${yScale( d.y2)}`,\r\n    }\r\n  })\r\n\r\n  // Construct data structure for supplementary points.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartPointsSup = dataPointsFiltered.map(d => {\r\n    let x \r\n    // if (chartStyle === 'bar') {\r\n    //   x = xScaleBar(Math.floor(d.period)) + xScaleBar.bandwidth() * 0.5 +(d.period % 1)\r\n    // } else {\r\n    //   x = xScaleLine(d.period)\r\n    // }\r\n    x = xScaleLine(d.period)\r\n\r\n    return {\r\n      x: x,\r\n      y: yScale(d.y),\r\n      period: d.period\r\n    }\r\n  })\r\n\r\n  // Construct data structure for supplementary point error bars.\r\n  // TODO - if at some point we parameterise display styles,\r\n  // then it must be specified in here.\r\n  const chartPointsSupErrorBars = dataPointsFiltered.map(d => {\r\n    const x = xScaleLine(d.period)\r\n    return {\r\n      pathEnter:  `M ${x} ${height} L ${x} ${height}`,\r\n      path: `M ${x} ${yScale(d.lower)} L ${x} ${yScale(d.upper)}`,\r\n      period: d.period\r\n    }\r\n  })\r\n\r\n  // d3 transition object\r\n  const t = svgTemporal.transition()\r\n      .duration(duration)\r\n\r\n  // Bars\r\n  gTemporal.selectAll(\".temporal-bar\")\r\n    .data(chartBars, d => `bars-${d.prop}-${d.period}`)\r\n    .join(\r\n      enter => enter.append(\"rect\")\r\n        .attr(\"class\", d => `temporal-bar temporal-graphic temporal-${d.prop}`)\r\n        .attr('width', xScaleBar.bandwidth())\r\n        .attr('height', 0)\r\n        .attr('fill', d => d.colour)\r\n        .attr('opacity', 0)\r\n        .attr('y', height)\r\n        .attr('x', d => xScaleBar(d.period)),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr('height', 0)\r\n          .attr('y', height)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr('y', d => d.n)\r\n      .attr('x', d => xScaleBar(d.period))\r\n      .attr('height', d => height - d.n)\r\n      .attr('width', xScaleBar.bandwidth())\r\n      .attr(\"fill\", d => d.colour)\r\n      .attr(\"opacity\", d => d.opacity), pTrans))\r\n\r\n  // Bands\r\n  gTemporal.selectAll(\".temporal-band\")\r\n    .data(chartBands, d => `band-${d.prop}-${d.part}`)\r\n    .join(\r\n      enter => enter.append(\"path\")\r\n        .attr(\"class\", d => `temporal-band temporal-graphic temporal-${d.prop}`)\r\n        .attr(\"opacity\", 0)\r\n        .attr(\"fill\", d => d.fill)\r\n        .attr(\"stroke\", \"none\")\r\n        .attr(\"d\", d => d.bandPathEnter),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr(\"d\", d => d.bandPathEnter)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr(\"d\", d => d.bandPath)\r\n      .attr(\"opacity\", d => d.fillOpacity)\r\n      .attr(\"fill\", d => d.fill), pTrans))\r\n\r\n\r\n  // Band lines\r\n  for (let iLine=0; iLine<2; iLine++) { \r\n    gTemporal.selectAll(`.temporal-band-border-${iLine}`)\r\n      .data(chartBands, d => `band-line-${d.prop}-${iLine}-${d.part}`)\r\n      .join(\r\n        enter => enter.append(\"path\")\r\n          .attr(\"class\", d => `temporal-band-border-${iLine} temporal-graphic temporal-${d.prop}`)\r\n          .attr(\"opacity\", 0)\r\n          .attr(\"fill\",\"none\")\r\n          .attr(\"stroke\", d => d.stroke)\r\n          .attr(\"stroke-width\", d => d.strokeWidth)\r\n          .attr(\"d\", d => d.bandBordersEnter[iLine]),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit =>  transPromise(exit.transition(t)\r\n            .attr(\"d\", d => d.bandBordersEnter[iLine])\r\n            .style(\"opacity\", 0)\r\n            .remove(), pTrans))\r\n         ).call(merge => transPromise(merge.transition(t)\r\n          // The selection returned by the join function is the merged\r\n          // enter and update selections\r\n          .attr(\"d\", d => d.bandBorders[iLine])\r\n          .attr(\"opacity\", d => d.strokeOpacity)\r\n          .attr(\"stroke\", d => d.stroke)\r\n          .attr(\"stroke-width\", d => d.strokeWidth), pTrans))\r\n  }\r\n\r\n  // Main lines\r\n  gTemporal.selectAll(\".temporal-line\")\r\n    .data(chartLines,  d => `line-${d.prop}-${d.part}`)\r\n    .join(\r\n      enter => enter.append(\"path\")\r\n        .attr(\"class\", d => `temporal-line temporal-graphic temporal-${d.prop}`)\r\n        .attr(\"opacity\", 0)\r\n        .attr(\"fill\", \"none\")\r\n        .attr(\"stroke\", d => d.colour)\r\n        .attr(\"stroke-width\", d => d.strokeWidth)\r\n        .attr(\"d\", d => d.pathEnter),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .style(\"opacity\", 0)\r\n          .remove(), pTrans))\r\n    ).call(merge => transPromise(merge.transition(t)\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .attr(\"d\", d => d.path)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .attr(\"stroke\", d => d.colour)\r\n      .attr(\"stroke-width\", d => d.strokeWidth), pTrans))\r\n\r\n  // Error bars\r\n  gTemporal.selectAll('.temporal-error-bars')\r\n      .data(chartErrorBars, d => `error-bars-${d.prop}-${d.period}`)\r\n      .join(\r\n        enter => enter.append('path')\r\n          .attr(\"class\", d => `temporal-error-bars temporal-graphic temporal-${d.prop}`)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .style('fill', 'none')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit.call(exit => transPromise(exit\r\n          .transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr(\"d\", d => d.pathEnter)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr(\"d\", d => d.path)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  // Points\r\n  gTemporal.selectAll('.temporal-point')\r\n      .data(chartPoints, d => `point-${d.prop}-${d.period}`)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr(\"class\", d => `temporal-point temporal-graphic temporal-${d.prop}`)\r\n          .attr('cx', d => d.x)\r\n          //.attr('cy', d => d.y)\r\n          .attr('cy', height)\r\n          .attr('r', 3)\r\n          .style('fill', 'white')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => transPromise(exit.transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr('cy', height)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr('cx', d => d.x)\r\n        .attr('cy', d => d.y)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  // Supplementary trend lines\r\n  gTemporal.selectAll('.temporal-trend-lines-sup')\r\n    .data(chartTrendLineSup)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .attr('class', 'temporal-trend-lines-sup')\r\n        .style('stroke', d => d.colour)\r\n        .style('stroke-width', d => d.width)\r\n        .attr(\"opacity\", 0),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .remove(), pTrans))\r\n    )\r\n    // Join returns merged enter and update selection\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .attr(\"d\", d => d.path)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .style('stroke', d => d.colour)\r\n      .style('stroke-width', d => d.width), pTrans))\r\n \r\n  // Supplementary points error bars\r\n  gTemporal.selectAll('.temporal-error-bars-sup')\r\n    .data(chartPointsSupErrorBars, d => `error-bars-sup-${d.period}`)\r\n    .join(\r\n      enter => enter.append('path')\r\n        .attr(\"class\", `temporal-error-bars-sup`)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .style('fill', 'none')\r\n        .style('stroke', 'black')\r\n        .style('stroke-width', 1)\r\n        .style('opacity', 0),\r\n      update => update,\r\n      exit => exit\r\n        .call(exit => transPromise(exit.transition(t)\r\n        .style(\"opacity\", 0)\r\n        .attr(\"d\", d => d.pathEnter)\r\n        .remove(), pTrans))\r\n    )\r\n    // The selection returned by the join function is the merged\r\n    // enter and update selections\r\n    .call(merge => transPromise(merge.transition(t)\r\n      .attr(\"d\", d => d.path)\r\n      .style('opacity', 1), pTrans))\r\n      \r\n  // Supplementary points\r\n  gTemporal.selectAll('.temporal-point-data-sup')\r\n      .data(chartPointsSup, d => `point-data-sup-${d.period}`)\r\n      .join(\r\n        enter => enter.append('circle')\r\n          .attr(\"class\", `temporal-point-data-sup`)\r\n          .attr('cx', d => d.x)\r\n          //.attr('cy', d => d.y)\r\n          .attr('cy', height)\r\n          .attr('r', 3)\r\n          .style('fill', 'white')\r\n          .style('stroke', 'black')\r\n          .style('stroke-width', 1)\r\n          .style('opacity', 0),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => transPromise(exit.transition(t)\r\n          .style(\"opacity\", 0)\r\n          .attr('cy', height)\r\n          .remove(), pTrans))\r\n      )\r\n      // The selection returned by the join function is the merged\r\n      // enter and update selections\r\n      .call(merge => transPromise(merge.transition(t)\r\n        .attr('cx', d => d.x)\r\n        .attr('cy', d => d.y)\r\n        .style('opacity', 1), pTrans))\r\n\r\n  addEventHandlers(gTemporal.selectAll(\"path\"), 'prop', svgChart, interactivity)\r\n  addEventHandlers(gTemporal.selectAll(\".temporal-bar\"), 'prop', svgChart, interactivity)\r\n  addEventHandlers(gTemporal.selectAll(\".temporal-point\"), 'prop', svgChart, interactivity)\r\n      \r\n  if (init) {\r\n\r\n    // Constants for positioning\r\n    const axisLeftPadX = margin.left ? margin.left : 0\r\n    const axisRightPadX = margin.right ? margin.right : 0\r\n    const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n    const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n    // Taxon title\r\n    if (showTaxonLabel) {\r\n      const taxonLabel = svgTemporal\r\n        .append('text')\r\n        .classed('brc-chart-temporal-label', true)\r\n        .text(taxon)\r\n        .style('font-size', taxonLabelFontSize)\r\n        .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n      const labelHeight = taxonLabel.node().getBBox().height\r\n      taxonLabel.attr(\"transform\", `translate(${axisLeftPadX}, ${labelHeight})`)\r\n    }\r\n    \r\n      // Size SVG\r\n    svgTemporal\r\n      .attr('width', width + axisLeftPadX + axisRightPadX)\r\n      .attr('height', height + axisBottomPadY + axisTopPadY)\r\n\r\n    // Position chart\r\n    gTemporal.attr(\"transform\", `translate(${axisLeftPadX},${axisTopPadY})`)\r\n    \r\n    // Create axes and position within SVG\r\n    const leftYaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${axisTopPadY + height/2}) rotate(270)`\r\n    const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${axisTopPadY})`\r\n    const rightYaxisLabelTrans = `translate(${axisLeftPadX + width + axisRightPadX - axisLabelFontSize}, ${axisTopPadY + height/2}) rotate(90)`\r\n    const topXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n    const bottomXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY + height})`\r\n\r\n    // Create axes and position within SVG\r\n    if (lAxis) {\r\n      const gLaxis = svgTemporal.append(\"g\")\r\n        .attr(\"class\", \"l-axis\")\r\n        // .classed('temporal-type-counts',  axisLeft === 'tick')\r\n        // .classed('temporal-type-props',  axisLeft !== 'tick')\r\n      gLaxis.attr(\"transform\", leftYaxisTrans)\r\n    }\r\n    if (bAxis) {\r\n      const gBaxis = svgTemporal.append(\"g\")\r\n        .attr(\"class\", \"x axis\")\r\n        .call(bAxis)\r\n      gBaxis.attr(\"transform\", bottomXaxisTrans)\r\n    }\r\n    if (tAxis) {\r\n      const gTaxis = svgTemporal.append(\"g\")\r\n        .call(tAxis)\r\n      gTaxis.attr(\"transform\", topXaxisTrans)\r\n    }\r\n    if (rAxis) {\r\n      const gRaxis = svgTemporal.append(\"g\")\r\n        //.call(rAxis)\r\n        .attr(\"class\", \"r-axis\")\r\n        // .classed('temporal-type-counts',  axisRight === 'tick')\r\n        // .classed('temporal-type-props',  axisRight !== 'tick')\r\n      gRaxis.attr(\"transform\", rightYaxisTrans)\r\n    }\r\n\r\n    const tYaxisLeftLabel = svgTemporal.append(\"text\")\r\n      // .classed('temporal-type-counts',  axisLeft === 'tick')\r\n      // .classed('temporal-type-props',  axisLeft !== 'tick')\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisLeftLabel) \r\n    tYaxisLeftLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n\r\n    const tYaxisRightLabel = svgTemporal.append(\"text\")\r\n      // .classed('temporal-type-counts',  axisRight === 'tick')\r\n      // .classed('temporal-type-props',  axisRight !== 'tick')\r\n      .style(\"text-anchor\", \"middle\")\r\n      .style('font-size', axisLabelFontSize)\r\n      .text(axisRightLabel) \r\n    tYaxisRightLabel.attr(\"transform\", rightYaxisLabelTrans)\r\n\r\n  } else {\r\n    if (taxa.length === 1) {\r\n      // Update taxon label\r\n      if (showTaxonLabel) {\r\n        svgTemporal.select('.brc-chart-temporal-label').text(taxon)\r\n      }\r\n    }\r\n\r\n    // Update the bottom axis if it exists. We do this because\r\n    // periodMin and/or periodMax may have changed.\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      transPromise(svgTemporal.select(\".x.axis\")\r\n        .transition(t)\r\n        .call(bAxis), pTrans)\r\n    }\r\n  }\r\n\r\n  if (svgTemporal.selectAll(\".l-axis\").size()){\r\n\r\n    transPromise(svgTemporal.select(\".l-axis\")\r\n      .transition(t)\r\n      .call(lAxis), pTrans)\r\n  }\r\n\r\n  if (svgTemporal.selectAll(\".r-axis\").size()){\r\n    transPromise(svgTemporal.select(\".r-axis\")\r\n      .transition(t)\r\n      .call(rAxis), pTrans)\r\n  }\r\n  \r\n  return svgTemporal\r\n\r\n  function adjustForTrans(pntsIn) {\r\n    // Return an array of arrays of points. There may be more than one array\r\n    // of points in the main array if there are breaks in the input array\r\n    // of points.\r\n\r\n    // First restructure the passed in points to an array of arrays.\r\n    let pntsSplit = []\r\n    pntsIn.forEach(p => {\r\n      if (p.n === 'break') {\r\n        // Add a new array\r\n        pntsSplit.push([])\r\n      } else {\r\n        if (pntsSplit.length === 0) {\r\n          // Fist value so first add a new array\r\n          pntsSplit.push([])\r\n        }\r\n        // Add point to array\r\n        pntsSplit[pntsSplit.length - 1].push(p)\r\n      }\r\n    })\r\n    // At this point pntsSplit could have empty arrays, e.g. if there\r\n    // where consecutive 'breaks' so weed these out.\r\n    pntsSplit = pntsSplit.filter(a => a.length > 0)\r\n\r\n    // Adjust of transition temporal ranges\r\n    const retSet = []\r\n    pntsSplit.forEach(pnts => {\r\n\r\n      const ret = [...pnts]\r\n      retSet.push(ret)\r\n\r\n      // If missing period values are being bridged, add a point at last\r\n      // known value.\r\n      for (let i = 0; i < pnts.length; i++) {\r\n        if (pnts[i].n === 'bridge') {\r\n          pnts[i].n = pnts[i-1].n\r\n          pnts[i].period = pnts[i-1].period\r\n        }\r\n      }\r\n\r\n      // When minPeriodTans and MaxPeriodTrans are set, then each trend line\r\n      // must have the same number of points in (MaxPeriodTrans - minPeriodTans + 1 points).\r\n      // This is to make nice looking transitions between lines with otherwise\r\n      // different numbers of points.\r\n      if (minPeriodTrans) {\r\n        for(let i=minPeriodTrans; i<pnts[0].period; i++) {\r\n          ret.unshift({\r\n            n: pnts[0].n,\r\n            period: pnts[0].period\r\n          })\r\n        }\r\n      }\r\n      if (maxPeriodTrans) {\r\n        for(let i=pnts[pnts.length-1].period + 1; i <= maxPeriodTrans; i++) {\r\n          ret.push({\r\n            n: pnts[pnts.length-1].n,\r\n            period: pnts[pnts.length-1].period\r\n          })\r\n        }\r\n      }\r\n    })\r\n    \r\n    return retSet\r\n    //return retSet[retSet.length - 1]\r\n  }\r\n}","import * as gen from '../general'\r\nimport { addEventHandlers } from './highlightitem'\r\n\r\nexport function makeLegend (\r\n  svgChart,\r\n  metricsPlus,\r\n  legendWidth,\r\n  legendFontSize,\r\n  headPad,\r\n  showCounts,\r\n  interactivity\r\n) {\r\n  \r\n  const swatchSize = 15\r\n  const swatchFact = 1.3\r\n\r\n  // Loop through all the legend elements and work out their\r\n  // positions based on swatch size, item label text size and\r\n  // legend width.\r\n  const metricsReversed = gen.cloneData(metricsPlus).reverse()\r\n\r\n  let rows = 0\r\n  let lineWidth = -swatchSize\r\n  metricsReversed.forEach(m => {\r\n    const tmpText = svgChart.append('text') //.style('display', 'none')\r\n      .text(m.label)\r\n      .style('font-size', legendFontSize)\r\n\r\n    const widthText = tmpText.node().getBBox().width\r\n    tmpText.remove()\r\n\r\n    if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n      ++rows\r\n      lineWidth = -swatchSize\r\n    }\r\n    m.x = lineWidth + swatchSize + headPad\r\n    m.y = rows * swatchSize * swatchFact\r\n\r\n    lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n  })\r\n\r\n  const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const rect = enter.append(\"rect\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-rect temporal-graphic temporal-${m.prop}`)\r\n          .attr('width', swatchSize)\r\n          .attr('height', showCounts === 'bar' ? swatchSize : 2)\r\n        return rect\r\n    })\r\n    .attr('x', m => m.x)\r\n    .attr('y', m => showCounts === 'bar' ?  m.y + swatchSize/5 : m.y + swatchSize/2)\r\n    .attr('fill', m => m.colour)\r\n\r\n  const lt = svgChart.selectAll('.brc-legend-item-text')\r\n    .data(metricsReversed, m => gen.safeId(m.label))\r\n    .join(enter => {\r\n        const text = enter.append(\"text\")\r\n          .attr(\"class\", m=> `brc-legend-item brc-legend-item-text temporal-graphic temporal-${m.prop}`)\r\n          .text(m => m.label)\r\n          .style('font-size', legendFontSize)\r\n        return text\r\n    })\r\n    .attr('x', m => m.x + swatchSize * swatchFact)\r\n    .attr('y', m => m.y + legendFontSize * 1)\r\n\r\n  addEventHandlers(ls, 'prop', svgChart, interactivity)\r\n  addEventHandlers(lt, 'prop', svgChart, interactivity)\r\n\r\n  return swatchSize * swatchFact * (rows + 1)\r\n}","export var PJD_3PARAM = 1;\nexport var PJD_7PARAM = 2;\nexport var PJD_GRIDSHIFT = 3;\nexport var PJD_WGS84 = 4; // WGS84 or equivalent\nexport var PJD_NODATUM = 5; // WGS84 or equivalent\nexport var SRS_WGS84_SEMIMAJOR = 6378137.0;  // only used in grid shift transforms\nexport var SRS_WGS84_SEMIMINOR = 6356752.314;  // only used in grid shift transforms\nexport var SRS_WGS84_ESQUARED = 0.0066943799901413165; // only used in grid shift transforms\nexport var SEC_TO_RAD = 4.84813681109535993589914102357e-6;\nexport var HALF_PI = Math.PI/2;\n// ellipoid pj_set_ell.c\nexport var SIXTH = 0.1666666666666666667;\n/* 1/6 */\nexport var RA4 = 0.04722222222222222222;\n/* 17/360 */\nexport var RA6 = 0.02215608465608465608;\nexport var EPSLN = 1.0e-10;\n// you'd think you could use Number.EPSILON above but that makes\n// Mollweide get into an infinate loop.\n\nexport var D2R = 0.01745329251994329577;\nexport var R2D = 57.29577951308232088;\nexport var FORTPI = Math.PI/4;\nexport var TWO_PI = Math.PI * 2;\n// SPI is slightly greater than Math.PI, so values that exceed the -180..180\n// degree range by a tiny amount don't get wrapped. This prevents points that\n// have drifted from their original location along the 180th meridian (due to\n// floating point error) from changing their sign.\nexport var SPI = 3.14159265359;\n","var exports = {};\nexport {exports as default};\n\nexports.greenwich = 0.0; //\"0dE\",\nexports.lisbon = -9.131906111111; //\"9d07'54.862\\\"W\",\nexports.paris = 2.337229166667; //\"2d20'14.025\\\"E\",\nexports.bogota = -74.080916666667; //\"74d04'51.3\\\"W\",\nexports.madrid = -3.687938888889; //\"3d41'16.58\\\"W\",\nexports.rome = 12.452333333333; //\"12d27'8.4\\\"E\",\nexports.bern = 7.439583333333; //\"7d26'22.5\\\"E\",\nexports.jakarta = 106.807719444444; //\"106d48'27.79\\\"E\",\nexports.ferro = -17.666666666667; //\"17d40'W\",\nexports.brussels = 4.367975; //\"4d22'4.71\\\"E\",\nexports.stockholm = 18.058277777778; //\"18d3'29.8\\\"E\",\nexports.athens = 23.7163375; //\"23d42'58.815\\\"E\",\nexports.oslo = 10.722916666667; //\"10d43'22.5\\\"E\"\n","export default {\n  ft: {to_meter: 0.3048},\n  'us-ft': {to_meter: 1200 / 3937}\n};\n","var ignoredChar = /[\\s_\\-\\/\\(\\)]/g;\nexport default function match(obj, key) {\n  if (obj[key]) {\n    return obj[key];\n  }\n  var keys = Object.keys(obj);\n  var lkey = key.toLowerCase().replace(ignoredChar, '');\n  var i = -1;\n  var testkey, processedKey;\n  while (++i < keys.length) {\n    testkey = keys[i];\n    processedKey = testkey.toLowerCase().replace(ignoredChar, '');\n    if (processedKey === lkey) {\n      return obj[testkey];\n    }\n  }\n}\n","import {D2R} from './constants/values';\nimport PrimeMeridian from './constants/PrimeMeridian';\nimport units from './constants/units';\nimport match from './match';\n\nexport default function(defData) {\n  var self = {};\n  var paramObj = defData.split('+').map(function(v) {\n    return v.trim();\n  }).filter(function(a) {\n    return a;\n  }).reduce(function(p, a) {\n    var split = a.split('=');\n    split.push(true);\n    p[split[0].toLowerCase()] = split[1];\n    return p;\n  }, {});\n  var paramName, paramVal, paramOutname;\n  var params = {\n    proj: 'projName',\n    datum: 'datumCode',\n    rf: function(v) {\n      self.rf = parseFloat(v);\n    },\n    lat_0: function(v) {\n      self.lat0 = v * D2R;\n    },\n    lat_1: function(v) {\n      self.lat1 = v * D2R;\n    },\n    lat_2: function(v) {\n      self.lat2 = v * D2R;\n    },\n    lat_ts: function(v) {\n      self.lat_ts = v * D2R;\n    },\n    lon_0: function(v) {\n      self.long0 = v * D2R;\n    },\n    lon_1: function(v) {\n      self.long1 = v * D2R;\n    },\n    lon_2: function(v) {\n      self.long2 = v * D2R;\n    },\n    alpha: function(v) {\n      self.alpha = parseFloat(v) * D2R;\n    },\n    gamma: function(v) {\n      self.rectified_grid_angle = parseFloat(v);\n    },\n    lonc: function(v) {\n      self.longc = v * D2R;\n    },\n    x_0: function(v) {\n      self.x0 = parseFloat(v);\n    },\n    y_0: function(v) {\n      self.y0 = parseFloat(v);\n    },\n    k_0: function(v) {\n      self.k0 = parseFloat(v);\n    },\n    k: function(v) {\n      self.k0 = parseFloat(v);\n    },\n    a: function(v) {\n      self.a = parseFloat(v);\n    },\n    b: function(v) {\n      self.b = parseFloat(v);\n    },\n    r_a: function() {\n      self.R_A = true;\n    },\n    zone: function(v) {\n      self.zone = parseInt(v, 10);\n    },\n    south: function() {\n      self.utmSouth = true;\n    },\n    towgs84: function(v) {\n      self.datum_params = v.split(\",\").map(function(a) {\n        return parseFloat(a);\n      });\n    },\n    to_meter: function(v) {\n      self.to_meter = parseFloat(v);\n    },\n    units: function(v) {\n      self.units = v;\n      var unit = match(units, v);\n      if (unit) {\n        self.to_meter = unit.to_meter;\n      }\n    },\n    from_greenwich: function(v) {\n      self.from_greenwich = v * D2R;\n    },\n    pm: function(v) {\n      var pm = match(PrimeMeridian, v);\n      self.from_greenwich = (pm ? pm : parseFloat(v)) * D2R;\n    },\n    nadgrids: function(v) {\n      if (v === '@null') {\n        self.datumCode = 'none';\n      }\n      else {\n        self.nadgrids = v;\n      }\n    },\n    axis: function(v) {\n      var legalAxis = \"ewnsud\";\n      if (v.length === 3 && legalAxis.indexOf(v.substr(0, 1)) !== -1 && legalAxis.indexOf(v.substr(1, 1)) !== -1 && legalAxis.indexOf(v.substr(2, 1)) !== -1) {\n        self.axis = v;\n      }\n    },\n    approx: function() {\n      self.approx = true;\n    }\n  };\n  for (paramName in paramObj) {\n    paramVal = paramObj[paramName];\n    if (paramName in params) {\n      paramOutname = params[paramName];\n      if (typeof paramOutname === 'function') {\n        paramOutname(paramVal);\n      }\n      else {\n        self[paramOutname] = paramVal;\n      }\n    }\n    else {\n      self[paramName] = paramVal;\n    }\n  }\n  if(typeof self.datumCode === 'string' && self.datumCode !== \"WGS84\"){\n    self.datumCode = self.datumCode.toLowerCase();\n  }\n  return self;\n}\n","export default parseString;\n\nvar NEUTRAL = 1;\nvar KEYWORD = 2;\nvar NUMBER = 3;\nvar QUOTED = 4;\nvar AFTERQUOTE = 5;\nvar ENDED = -1;\nvar whitespace = /\\s/;\nvar latin = /[A-Za-z]/;\nvar keyword = /[A-Za-z84]/;\nvar endThings = /[,\\]]/;\nvar digets = /[\\d\\.E\\-\\+]/;\n// const ignoredChar = /[\\s_\\-\\/\\(\\)]/g;\nfunction Parser(text) {\n  if (typeof text !== 'string') {\n    throw new Error('not a string');\n  }\n  this.text = text.trim();\n  this.level = 0;\n  this.place = 0;\n  this.root = null;\n  this.stack = [];\n  this.currentObject = null;\n  this.state = NEUTRAL;\n}\nParser.prototype.readCharicter = function() {\n  var char = this.text[this.place++];\n  if (this.state !== QUOTED) {\n    while (whitespace.test(char)) {\n      if (this.place >= this.text.length) {\n        return;\n      }\n      char = this.text[this.place++];\n    }\n  }\n  switch (this.state) {\n    case NEUTRAL:\n      return this.neutral(char);\n    case KEYWORD:\n      return this.keyword(char)\n    case QUOTED:\n      return this.quoted(char);\n    case AFTERQUOTE:\n      return this.afterquote(char);\n    case NUMBER:\n      return this.number(char);\n    case ENDED:\n      return;\n  }\n};\nParser.prototype.afterquote = function(char) {\n  if (char === '\"') {\n    this.word += '\"';\n    this.state = QUOTED;\n    return;\n  }\n  if (endThings.test(char)) {\n    this.word = this.word.trim();\n    this.afterItem(char);\n    return;\n  }\n  throw new Error('havn\\'t handled \"' +char + '\" in afterquote yet, index ' + this.place);\n};\nParser.prototype.afterItem = function(char) {\n  if (char === ',') {\n    if (this.word !== null) {\n      this.currentObject.push(this.word);\n    }\n    this.word = null;\n    this.state = NEUTRAL;\n    return;\n  }\n  if (char === ']') {\n    this.level--;\n    if (this.word !== null) {\n      this.currentObject.push(this.word);\n      this.word = null;\n    }\n    this.state = NEUTRAL;\n    this.currentObject = this.stack.pop();\n    if (!this.currentObject) {\n      this.state = ENDED;\n    }\n\n    return;\n  }\n};\nParser.prototype.number = function(char) {\n  if (digets.test(char)) {\n    this.word += char;\n    return;\n  }\n  if (endThings.test(char)) {\n    this.word = parseFloat(this.word);\n    this.afterItem(char);\n    return;\n  }\n  throw new Error('havn\\'t handled \"' +char + '\" in number yet, index ' + this.place);\n};\nParser.prototype.quoted = function(char) {\n  if (char === '\"') {\n    this.state = AFTERQUOTE;\n    return;\n  }\n  this.word += char;\n  return;\n};\nParser.prototype.keyword = function(char) {\n  if (keyword.test(char)) {\n    this.word += char;\n    return;\n  }\n  if (char === '[') {\n    var newObjects = [];\n    newObjects.push(this.word);\n    this.level++;\n    if (this.root === null) {\n      this.root = newObjects;\n    } else {\n      this.currentObject.push(newObjects);\n    }\n    this.stack.push(this.currentObject);\n    this.currentObject = newObjects;\n    this.state = NEUTRAL;\n    return;\n  }\n  if (endThings.test(char)) {\n    this.afterItem(char);\n    return;\n  }\n  throw new Error('havn\\'t handled \"' +char + '\" in keyword yet, index ' + this.place);\n};\nParser.prototype.neutral = function(char) {\n  if (latin.test(char)) {\n    this.word = char;\n    this.state = KEYWORD;\n    return;\n  }\n  if (char === '\"') {\n    this.word = '';\n    this.state = QUOTED;\n    return;\n  }\n  if (digets.test(char)) {\n    this.word = char;\n    this.state = NUMBER;\n    return;\n  }\n  if (endThings.test(char)) {\n    this.afterItem(char);\n    return;\n  }\n  throw new Error('havn\\'t handled \"' +char + '\" in neutral yet, index ' + this.place);\n};\nParser.prototype.output = function() {\n  while (this.place < this.text.length) {\n    this.readCharicter();\n  }\n  if (this.state === ENDED) {\n    return this.root;\n  }\n  throw new Error('unable to parse string \"' +this.text + '\". State is ' + this.state);\n};\n\nfunction parseString(txt) {\n  var parser = new Parser(txt);\n  return parser.output();\n}\n","\n\nfunction mapit(obj, key, value) {\n  if (Array.isArray(key)) {\n    value.unshift(key);\n    key = null;\n  }\n  var thing = key ? {} : obj;\n\n  var out = value.reduce(function(newObj, item) {\n    sExpr(item, newObj);\n    return newObj\n  }, thing);\n  if (key) {\n    obj[key] = out;\n  }\n}\n\nexport function sExpr(v, obj) {\n  if (!Array.isArray(v)) {\n    obj[v] = true;\n    return;\n  }\n  var key = v.shift();\n  if (key === 'PARAMETER') {\n    key = v.shift();\n  }\n  if (v.length === 1) {\n    if (Array.isArray(v[0])) {\n      obj[key] = {};\n      sExpr(v[0], obj[key]);\n      return;\n    }\n    obj[key] = v[0];\n    return;\n  }\n  if (!v.length) {\n    obj[key] = true;\n    return;\n  }\n  if (key === 'TOWGS84') {\n    obj[key] = v;\n    return;\n  }\n  if (key === 'AXIS') {\n    if (!(key in obj)) {\n      obj[key] = [];\n    }\n    obj[key].push(v);\n    return;\n  }\n  if (!Array.isArray(key)) {\n    obj[key] = {};\n  }\n\n  var i;\n  switch (key) {\n    case 'UNIT':\n    case 'PRIMEM':\n    case 'VERT_DATUM':\n      obj[key] = {\n        name: v[0].toLowerCase(),\n        convert: v[1]\n      };\n      if (v.length === 3) {\n        sExpr(v[2], obj[key]);\n      }\n      return;\n    case 'SPHEROID':\n    case 'ELLIPSOID':\n      obj[key] = {\n        name: v[0],\n        a: v[1],\n        rf: v[2]\n      };\n      if (v.length === 4) {\n        sExpr(v[3], obj[key]);\n      }\n      return;\n    case 'PROJECTEDCRS':\n    case 'PROJCRS':\n    case 'GEOGCS':\n    case 'GEOCCS':\n    case 'PROJCS':\n    case 'LOCAL_CS':\n    case 'GEODCRS':\n    case 'GEODETICCRS':\n    case 'GEODETICDATUM':\n    case 'EDATUM':\n    case 'ENGINEERINGDATUM':\n    case 'VERT_CS':\n    case 'VERTCRS':\n    case 'VERTICALCRS':\n    case 'COMPD_CS':\n    case 'COMPOUNDCRS':\n    case 'ENGINEERINGCRS':\n    case 'ENGCRS':\n    case 'FITTED_CS':\n    case 'LOCAL_DATUM':\n    case 'DATUM':\n      v[0] = ['name', v[0]];\n      mapit(obj, key, v);\n      return;\n    default:\n      i = -1;\n      while (++i < v.length) {\n        if (!Array.isArray(v[i])) {\n          return sExpr(v, obj[key]);\n        }\n      }\n      return mapit(obj, key, v);\n  }\n}\n","var D2R = 0.01745329251994329577;\nimport parser from './parser';\nimport {sExpr} from './process';\n\n\n\nfunction rename(obj, params) {\n  var outName = params[0];\n  var inName = params[1];\n  if (!(outName in obj) && (inName in obj)) {\n    obj[outName] = obj[inName];\n    if (params.length === 3) {\n      obj[outName] = params[2](obj[outName]);\n    }\n  }\n}\n\nfunction d2r(input) {\n  return input * D2R;\n}\n\nfunction cleanWKT(wkt) {\n  if (wkt.type === 'GEOGCS') {\n    wkt.projName = 'longlat';\n  } else if (wkt.type === 'LOCAL_CS') {\n    wkt.projName = 'identity';\n    wkt.local = true;\n  } else {\n    if (typeof wkt.PROJECTION === 'object') {\n      wkt.projName = Object.keys(wkt.PROJECTION)[0];\n    } else {\n      wkt.projName = wkt.PROJECTION;\n    }\n  }\n  if (wkt.AXIS) {\n    var axisOrder = '';\n    for (var i = 0, ii = wkt.AXIS.length; i < ii; ++i) {\n      var axis = [wkt.AXIS[i][0].toLowerCase(), wkt.AXIS[i][1].toLowerCase()];\n      if (axis[0].indexOf('north') !== -1 || ((axis[0] === 'y' || axis[0] === 'lat') && axis[1] === 'north')) {\n        axisOrder += 'n';\n      } else if (axis[0].indexOf('south') !== -1 || ((axis[0] === 'y' || axis[0] === 'lat') && axis[1] === 'south')) {\n        axisOrder += 's';\n      } else if (axis[0].indexOf('east') !== -1 || ((axis[0] === 'x' || axis[0] === 'lon') && axis[1] === 'east')) {\n        axisOrder += 'e';\n      } else if (axis[0].indexOf('west') !== -1 || ((axis[0] === 'x' || axis[0] === 'lon') && axis[1] === 'west')) {\n        axisOrder += 'w';\n      }\n    }\n    if (axisOrder.length === 2) {\n      axisOrder += 'u';\n    }\n    if (axisOrder.length === 3) {\n      wkt.axis = axisOrder;\n    }\n  }\n  if (wkt.UNIT) {\n    wkt.units = wkt.UNIT.name.toLowerCase();\n    if (wkt.units === 'metre') {\n      wkt.units = 'meter';\n    }\n    if (wkt.UNIT.convert) {\n      if (wkt.type === 'GEOGCS') {\n        if (wkt.DATUM && wkt.DATUM.SPHEROID) {\n          wkt.to_meter = wkt.UNIT.convert*wkt.DATUM.SPHEROID.a;\n        }\n      } else {\n        wkt.to_meter = wkt.UNIT.convert;\n      }\n    }\n  }\n  var geogcs = wkt.GEOGCS;\n  if (wkt.type === 'GEOGCS') {\n    geogcs = wkt;\n  }\n  if (geogcs) {\n    //if(wkt.GEOGCS.PRIMEM&&wkt.GEOGCS.PRIMEM.convert){\n    //  wkt.from_greenwich=wkt.GEOGCS.PRIMEM.convert*D2R;\n    //}\n    if (geogcs.DATUM) {\n      wkt.datumCode = geogcs.DATUM.name.toLowerCase();\n    } else {\n      wkt.datumCode = geogcs.name.toLowerCase();\n    }\n    if (wkt.datumCode.slice(0, 2) === 'd_') {\n      wkt.datumCode = wkt.datumCode.slice(2);\n    }\n    if (wkt.datumCode === 'new_zealand_geodetic_datum_1949' || wkt.datumCode === 'new_zealand_1949') {\n      wkt.datumCode = 'nzgd49';\n    }\n    if (wkt.datumCode === 'wgs_1984' || wkt.datumCode === 'world_geodetic_system_1984') {\n      if (wkt.PROJECTION === 'Mercator_Auxiliary_Sphere') {\n        wkt.sphere = true;\n      }\n      wkt.datumCode = 'wgs84';\n    }\n    if (wkt.datumCode.slice(-6) === '_ferro') {\n      wkt.datumCode = wkt.datumCode.slice(0, - 6);\n    }\n    if (wkt.datumCode.slice(-8) === '_jakarta') {\n      wkt.datumCode = wkt.datumCode.slice(0, - 8);\n    }\n    if (~wkt.datumCode.indexOf('belge')) {\n      wkt.datumCode = 'rnb72';\n    }\n    if (geogcs.DATUM && geogcs.DATUM.SPHEROID) {\n      wkt.ellps = geogcs.DATUM.SPHEROID.name.replace('_19', '').replace(/[Cc]larke\\_18/, 'clrk');\n      if (wkt.ellps.toLowerCase().slice(0, 13) === 'international') {\n        wkt.ellps = 'intl';\n      }\n\n      wkt.a = geogcs.DATUM.SPHEROID.a;\n      wkt.rf = parseFloat(geogcs.DATUM.SPHEROID.rf, 10);\n    }\n\n    if (geogcs.DATUM && geogcs.DATUM.TOWGS84) {\n      wkt.datum_params = geogcs.DATUM.TOWGS84;\n    }\n    if (~wkt.datumCode.indexOf('osgb_1936')) {\n      wkt.datumCode = 'osgb36';\n    }\n    if (~wkt.datumCode.indexOf('osni_1952')) {\n      wkt.datumCode = 'osni52';\n    }\n    if (~wkt.datumCode.indexOf('tm65')\n      || ~wkt.datumCode.indexOf('geodetic_datum_of_1965')) {\n      wkt.datumCode = 'ire65';\n    }\n    if (wkt.datumCode === 'ch1903+') {\n      wkt.datumCode = 'ch1903';\n    }\n    if (~wkt.datumCode.indexOf('israel')) {\n      wkt.datumCode = 'isr93';\n    }\n  }\n  if (wkt.b && !isFinite(wkt.b)) {\n    wkt.b = wkt.a;\n  }\n\n  function toMeter(input) {\n    var ratio = wkt.to_meter || 1;\n    return input * ratio;\n  }\n  var renamer = function(a) {\n    return rename(wkt, a);\n  };\n  var list = [\n    ['standard_parallel_1', 'Standard_Parallel_1'],\n    ['standard_parallel_1', 'Latitude of 1st standard parallel'],\n    ['standard_parallel_2', 'Standard_Parallel_2'],\n    ['standard_parallel_2', 'Latitude of 2nd standard parallel'],\n    ['false_easting', 'False_Easting'],\n    ['false_easting', 'False easting'],\n    ['false-easting', 'Easting at false origin'],\n    ['false_northing', 'False_Northing'],\n    ['false_northing', 'False northing'],\n    ['false_northing', 'Northing at false origin'],\n    ['central_meridian', 'Central_Meridian'],\n    ['central_meridian', 'Longitude of natural origin'],\n    ['central_meridian', 'Longitude of false origin'],\n    ['latitude_of_origin', 'Latitude_Of_Origin'],\n    ['latitude_of_origin', 'Central_Parallel'],\n    ['latitude_of_origin', 'Latitude of natural origin'],\n    ['latitude_of_origin', 'Latitude of false origin'],\n    ['scale_factor', 'Scale_Factor'],\n    ['k0', 'scale_factor'],\n    ['latitude_of_center', 'Latitude_Of_Center'],\n    ['latitude_of_center', 'Latitude_of_center'],\n    ['lat0', 'latitude_of_center', d2r],\n    ['longitude_of_center', 'Longitude_Of_Center'],\n    ['longitude_of_center', 'Longitude_of_center'],\n    ['longc', 'longitude_of_center', d2r],\n    ['x0', 'false_easting', toMeter],\n    ['y0', 'false_northing', toMeter],\n    ['long0', 'central_meridian', d2r],\n    ['lat0', 'latitude_of_origin', d2r],\n    ['lat0', 'standard_parallel_1', d2r],\n    ['lat1', 'standard_parallel_1', d2r],\n    ['lat2', 'standard_parallel_2', d2r],\n    ['azimuth', 'Azimuth'],\n    ['alpha', 'azimuth', d2r],\n    ['srsCode', 'name']\n  ];\n  list.forEach(renamer);\n  if (!wkt.long0 && wkt.longc && (wkt.projName === 'Albers_Conic_Equal_Area' || wkt.projName === 'Lambert_Azimuthal_Equal_Area')) {\n    wkt.long0 = wkt.longc;\n  }\n  if (!wkt.lat_ts && wkt.lat1 && (wkt.projName === 'Stereographic_South_Pole' || wkt.projName === 'Polar Stereographic (variant B)')) {\n    wkt.lat0 = d2r(wkt.lat1 > 0 ? 90 : -90);\n    wkt.lat_ts = wkt.lat1;\n  }\n}\nexport default function(wkt) {\n  var lisp = parser(wkt);\n  var type = lisp.shift();\n  var name = lisp.shift();\n  lisp.unshift(['name', name]);\n  lisp.unshift(['type', type]);\n  var obj = {};\n  sExpr(lisp, obj);\n  cleanWKT(obj);\n  return obj;\n}\n","import globals from './global';\nimport parseProj from './projString';\nimport wkt from 'wkt-parser';\n\nfunction defs(name) {\n  /*global console*/\n  var that = this;\n  if (arguments.length === 2) {\n    var def = arguments[1];\n    if (typeof def === 'string') {\n      if (def.charAt(0) === '+') {\n        defs[name] = parseProj(arguments[1]);\n      }\n      else {\n        defs[name] = wkt(arguments[1]);\n      }\n    } else {\n      defs[name] = def;\n    }\n  }\n  else if (arguments.length === 1) {\n    if (Array.isArray(name)) {\n      return name.map(function(v) {\n        if (Array.isArray(v)) {\n          defs.apply(that, v);\n        }\n        else {\n          defs(v);\n        }\n      });\n    }\n    else if (typeof name === 'string') {\n      if (name in defs) {\n        return defs[name];\n      }\n    }\n    else if ('EPSG' in name) {\n      defs['EPSG:' + name.EPSG] = name;\n    }\n    else if ('ESRI' in name) {\n      defs['ESRI:' + name.ESRI] = name;\n    }\n    else if ('IAU2000' in name) {\n      defs['IAU2000:' + name.IAU2000] = name;\n    }\n    else {\n      console.log(name);\n    }\n    return;\n  }\n\n\n}\nglobals(defs);\nexport default defs;\n","export default function(defs) {\n  defs('EPSG:4326', \"+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees\");\n  defs('EPSG:4269', \"+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees\");\n  defs('EPSG:3857', \"+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs\");\n\n  defs.WGS84 = defs['EPSG:4326'];\n  defs['EPSG:3785'] = defs['EPSG:3857']; // maintain backward compat, official code is 3857\n  defs.GOOGLE = defs['EPSG:3857'];\n  defs['EPSG:900913'] = defs['EPSG:3857'];\n  defs['EPSG:102113'] = defs['EPSG:3857'];\n}\n","import defs from './defs';\nimport wkt from 'wkt-parser';\nimport projStr from './projString';\nimport match from './match';\nfunction testObj(code){\n  return typeof code === 'string';\n}\nfunction testDef(code){\n  return code in defs;\n}\nvar codeWords = ['PROJECTEDCRS', 'PROJCRS', 'GEOGCS','GEOCCS','PROJCS','LOCAL_CS', 'GEODCRS', 'GEODETICCRS', 'GEODETICDATUM', 'ENGCRS', 'ENGINEERINGCRS'];\nfunction testWKT(code){\n  return codeWords.some(function (word) {\n    return code.indexOf(word) > -1;\n  });\n}\nvar codes = ['3857', '900913', '3785', '102113'];\nfunction checkMercator(item) {\n  var auth = match(item, 'authority');\n  if (!auth) {\n    return;\n  }\n  var code = match(auth, 'epsg');\n  return code && codes.indexOf(code) > -1;\n}\nfunction checkProjStr(item) {\n  var ext = match(item, 'extension');\n  if (!ext) {\n    return;\n  }\n  return match(ext, 'proj4');\n}\nfunction testProj(code){\n  return code[0] === '+';\n}\nfunction parse(code){\n  if (testObj(code)) {\n    //check to see if this is a WKT string\n    if (testDef(code)) {\n      return defs[code];\n    }\n    if (testWKT(code)) {\n      var out = wkt(code);\n      // test of spetial case, due to this being a very common and often malformed\n      if (checkMercator(out)) {\n        return defs['EPSG:3857'];\n      }\n      var maybeProjStr = checkProjStr(out);\n      if (maybeProjStr) {\n        return projStr(maybeProjStr);\n      }\n      return out;\n    }\n    if (testProj(code)) {\n      return projStr(code);\n    }\n  }else{\n    return code;\n  }\n}\n\nexport default parse;\n","export default function(destination, source) {\n  destination = destination || {};\n  var value, property;\n  if (!source) {\n    return destination;\n  }\n  for (property in source) {\n    value = source[property];\n    if (value !== undefined) {\n      destination[property] = value;\n    }\n  }\n  return destination;\n}\n","export default function(eccent, sinphi, cosphi) {\n  var con = eccent * sinphi;\n  return cosphi / (Math.sqrt(1 - con * con));\n}","export default function(x) {\n  return x<0 ? -1 : 1;\n}","\nimport {TWO_PI, SPI} from '../constants/values';\nimport sign from './sign';\n\nexport default function(x) {\n  return (Math.abs(x) <= SPI) ? x : (x - (sign(x) * TWO_PI));\n}\n","import {HALF_PI} from '../constants/values';\n\nexport default function(eccent, phi, sinphi) {\n  var con = eccent * sinphi;\n  var com = 0.5 * eccent;\n  con = Math.pow(((1 - con) / (1 + con)), com);\n  return (Math.tan(0.5 * (HALF_PI - phi)) / con);\n}\n","import {HALF_PI} from '../constants/values';\n\nexport default function(eccent, ts) {\n  var eccnth = 0.5 * eccent;\n  var con, dphi;\n  var phi = HALF_PI - 2 * Math.atan(ts);\n  for (var i = 0; i <= 15; i++) {\n    con = eccent * Math.sin(phi);\n    dphi = HALF_PI - 2 * Math.atan(ts * (Math.pow(((1 - con) / (1 + con)), eccnth))) - phi;\n    phi += dphi;\n    if (Math.abs(dphi) <= 0.0000000001) {\n      return phi;\n    }\n  }\n  //console.log(\"phi2z has NoConvergence\");\n  return -9999;\n}\n","export function init() {\n  //no-op for longlat\n}\n\nfunction identity(pt) {\n  return pt;\n}\nexport {identity as forward};\nexport {identity as inverse};\nexport var names = [\"longlat\", \"identity\"];\nexport default {\n  init: init,\n  forward: identity,\n  inverse: identity,\n  names: names\n};\n","import merc from \"./projections/merc\";\nimport longlat from \"./projections/longlat\";\nvar projs = [merc, longlat];\nvar names = {};\nvar projStore = [];\n\nfunction add(proj, i) {\n  var len = projStore.length;\n  if (!proj.names) {\n    console.log(i);\n    return true;\n  }\n  projStore[len] = proj;\n  proj.names.forEach(function(n) {\n    names[n.toLowerCase()] = len;\n  });\n  return this;\n}\n\nexport {add};\n\nexport function get(name) {\n  if (!name) {\n    return false;\n  }\n  var n = name.toLowerCase();\n  if (typeof names[n] !== 'undefined' && projStore[names[n]]) {\n    return projStore[names[n]];\n  }\n}\n\nexport function start() {\n  projs.forEach(add);\n}\nexport default {\n  start: start,\n  add: add,\n  get: get\n};\n","import msfnz from '../common/msfnz';\n\nimport adjust_lon from '../common/adjust_lon';\nimport tsfnz from '../common/tsfnz';\nimport phi2z from '../common/phi2z';\nimport {FORTPI, R2D, EPSLN, HALF_PI} from '../constants/values';\nexport function init() {\n  var con = this.b / this.a;\n  this.es = 1 - con * con;\n  if(!('x0' in this)){\n    this.x0 = 0;\n  }\n  if(!('y0' in this)){\n    this.y0 = 0;\n  }\n  this.e = Math.sqrt(this.es);\n  if (this.lat_ts) {\n    if (this.sphere) {\n      this.k0 = Math.cos(this.lat_ts);\n    }\n    else {\n      this.k0 = msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts));\n    }\n  }\n  else {\n    if (!this.k0) {\n      if (this.k) {\n        this.k0 = this.k;\n      }\n      else {\n        this.k0 = 1;\n      }\n    }\n  }\n}\n\n/* Mercator forward equations--mapping lat,long to x,y\n  --------------------------------------------------*/\n\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  // convert to radians\n  if (lat * R2D > 90 && lat * R2D < -90 && lon * R2D > 180 && lon * R2D < -180) {\n    return null;\n  }\n\n  var x, y;\n  if (Math.abs(Math.abs(lat) - HALF_PI) <= EPSLN) {\n    return null;\n  }\n  else {\n    if (this.sphere) {\n      x = this.x0 + this.a * this.k0 * adjust_lon(lon - this.long0);\n      y = this.y0 + this.a * this.k0 * Math.log(Math.tan(FORTPI + 0.5 * lat));\n    }\n    else {\n      var sinphi = Math.sin(lat);\n      var ts = tsfnz(this.e, lat, sinphi);\n      x = this.x0 + this.a * this.k0 * adjust_lon(lon - this.long0);\n      y = this.y0 - this.a * this.k0 * Math.log(ts);\n    }\n    p.x = x;\n    p.y = y;\n    return p;\n  }\n}\n\n/* Mercator inverse equations--mapping x,y to lat/long\n  --------------------------------------------------*/\nexport function inverse(p) {\n\n  var x = p.x - this.x0;\n  var y = p.y - this.y0;\n  var lon, lat;\n\n  if (this.sphere) {\n    lat = HALF_PI - 2 * Math.atan(Math.exp(-y / (this.a * this.k0)));\n  }\n  else {\n    var ts = Math.exp(-y / (this.a * this.k0));\n    lat = phi2z(this.e, ts);\n    if (lat === -9999) {\n      return null;\n    }\n  }\n  lon = adjust_lon(this.long0 + x / (this.a * this.k0));\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Mercator\", \"Popular Visualisation Pseudo Mercator\", \"Mercator_1SP\", \"Mercator_Auxiliary_Sphere\", \"merc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","var exports = {};\nexport {exports as default};\nexports.MERIT = {\n  a: 6378137.0,\n  rf: 298.257,\n  ellipseName: \"MERIT 1983\"\n};\n\nexports.SGS85 = {\n  a: 6378136.0,\n  rf: 298.257,\n  ellipseName: \"Soviet Geodetic System 85\"\n};\n\nexports.GRS80 = {\n  a: 6378137.0,\n  rf: 298.257222101,\n  ellipseName: \"GRS 1980(IUGG, 1980)\"\n};\n\nexports.IAU76 = {\n  a: 6378140.0,\n  rf: 298.257,\n  ellipseName: \"IAU 1976\"\n};\n\nexports.airy = {\n  a: 6377563.396,\n  b: 6356256.910,\n  ellipseName: \"Airy 1830\"\n};\n\nexports.APL4 = {\n  a: 6378137,\n  rf: 298.25,\n  ellipseName: \"Appl. Physics. 1965\"\n};\n\nexports.NWL9D = {\n  a: 6378145.0,\n  rf: 298.25,\n  ellipseName: \"Naval Weapons Lab., 1965\"\n};\n\nexports.mod_airy = {\n  a: 6377340.189,\n  b: 6356034.446,\n  ellipseName: \"Modified Airy\"\n};\n\nexports.andrae = {\n  a: 6377104.43,\n  rf: 300.0,\n  ellipseName: \"Andrae 1876 (Den., Iclnd.)\"\n};\n\nexports.aust_SA = {\n  a: 6378160.0,\n  rf: 298.25,\n  ellipseName: \"Australian Natl & S. Amer. 1969\"\n};\n\nexports.GRS67 = {\n  a: 6378160.0,\n  rf: 298.2471674270,\n  ellipseName: \"GRS 67(IUGG 1967)\"\n};\n\nexports.bessel = {\n  a: 6377397.155,\n  rf: 299.1528128,\n  ellipseName: \"Bessel 1841\"\n};\n\nexports.bess_nam = {\n  a: 6377483.865,\n  rf: 299.1528128,\n  ellipseName: \"Bessel 1841 (Namibia)\"\n};\n\nexports.clrk66 = {\n  a: 6378206.4,\n  b: 6356583.8,\n  ellipseName: \"Clarke 1866\"\n};\n\nexports.clrk80 = {\n  a: 6378249.145,\n  rf: 293.4663,\n  ellipseName: \"Clarke 1880 mod.\"\n};\n\nexports.clrk58 = {\n  a: 6378293.645208759,\n  rf: 294.2606763692654,\n  ellipseName: \"Clarke 1858\"\n};\n\nexports.CPM = {\n  a: 6375738.7,\n  rf: 334.29,\n  ellipseName: \"Comm. des Poids et Mesures 1799\"\n};\n\nexports.delmbr = {\n  a: 6376428.0,\n  rf: 311.5,\n  ellipseName: \"Delambre 1810 (Belgium)\"\n};\n\nexports.engelis = {\n  a: 6378136.05,\n  rf: 298.2566,\n  ellipseName: \"Engelis 1985\"\n};\n\nexports.evrst30 = {\n  a: 6377276.345,\n  rf: 300.8017,\n  ellipseName: \"Everest 1830\"\n};\n\nexports.evrst48 = {\n  a: 6377304.063,\n  rf: 300.8017,\n  ellipseName: \"Everest 1948\"\n};\n\nexports.evrst56 = {\n  a: 6377301.243,\n  rf: 300.8017,\n  ellipseName: \"Everest 1956\"\n};\n\nexports.evrst69 = {\n  a: 6377295.664,\n  rf: 300.8017,\n  ellipseName: \"Everest 1969\"\n};\n\nexports.evrstSS = {\n  a: 6377298.556,\n  rf: 300.8017,\n  ellipseName: \"Everest (Sabah & Sarawak)\"\n};\n\nexports.fschr60 = {\n  a: 6378166.0,\n  rf: 298.3,\n  ellipseName: \"Fischer (Mercury Datum) 1960\"\n};\n\nexports.fschr60m = {\n  a: 6378155.0,\n  rf: 298.3,\n  ellipseName: \"Fischer 1960\"\n};\n\nexports.fschr68 = {\n  a: 6378150.0,\n  rf: 298.3,\n  ellipseName: \"Fischer 1968\"\n};\n\nexports.helmert = {\n  a: 6378200.0,\n  rf: 298.3,\n  ellipseName: \"Helmert 1906\"\n};\n\nexports.hough = {\n  a: 6378270.0,\n  rf: 297.0,\n  ellipseName: \"Hough\"\n};\n\nexports.intl = {\n  a: 6378388.0,\n  rf: 297.0,\n  ellipseName: \"International 1909 (Hayford)\"\n};\n\nexports.kaula = {\n  a: 6378163.0,\n  rf: 298.24,\n  ellipseName: \"Kaula 1961\"\n};\n\nexports.lerch = {\n  a: 6378139.0,\n  rf: 298.257,\n  ellipseName: \"Lerch 1979\"\n};\n\nexports.mprts = {\n  a: 6397300.0,\n  rf: 191.0,\n  ellipseName: \"Maupertius 1738\"\n};\n\nexports.new_intl = {\n  a: 6378157.5,\n  b: 6356772.2,\n  ellipseName: \"New International 1967\"\n};\n\nexports.plessis = {\n  a: 6376523.0,\n  rf: 6355863.0,\n  ellipseName: \"Plessis 1817 (France)\"\n};\n\nexports.krass = {\n  a: 6378245.0,\n  rf: 298.3,\n  ellipseName: \"Krassovsky, 1942\"\n};\n\nexports.SEasia = {\n  a: 6378155.0,\n  b: 6356773.3205,\n  ellipseName: \"Southeast Asia\"\n};\n\nexports.walbeck = {\n  a: 6376896.0,\n  b: 6355834.8467,\n  ellipseName: \"Walbeck\"\n};\n\nexports.WGS60 = {\n  a: 6378165.0,\n  rf: 298.3,\n  ellipseName: \"WGS 60\"\n};\n\nexports.WGS66 = {\n  a: 6378145.0,\n  rf: 298.25,\n  ellipseName: \"WGS 66\"\n};\n\nexports.WGS7 = {\n  a: 6378135.0,\n  rf: 298.26,\n  ellipseName: \"WGS 72\"\n};\n\nexport var WGS84 = exports.WGS84 = {\n  a: 6378137.0,\n  rf: 298.257223563,\n  ellipseName: \"WGS 84\"\n};\n\nexports.sphere = {\n  a: 6370997.0,\n  b: 6370997.0,\n  ellipseName: \"Normal Sphere (r=6370997)\"\n};\n","var exports = {};\nexport {exports as default};\nexports.wgs84 = {\n  towgs84: \"0,0,0\",\n  ellipse: \"WGS84\",\n  datumName: \"WGS84\"\n};\n\nexports.ch1903 = {\n  towgs84: \"674.374,15.056,405.346\",\n  ellipse: \"bessel\",\n  datumName: \"swiss\"\n};\n\nexports.ggrs87 = {\n  towgs84: \"-199.87,74.79,246.62\",\n  ellipse: \"GRS80\",\n  datumName: \"Greek_Geodetic_Reference_System_1987\"\n};\n\nexports.nad83 = {\n  towgs84: \"0,0,0\",\n  ellipse: \"GRS80\",\n  datumName: \"North_American_Datum_1983\"\n};\n\nexports.nad27 = {\n  nadgrids: \"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat\",\n  ellipse: \"clrk66\",\n  datumName: \"North_American_Datum_1927\"\n};\n\nexports.potsdam = {\n  towgs84: \"598.1,73.7,418.2,0.202,0.045,-2.455,6.7\",\n  ellipse: \"bessel\",\n  datumName: \"Potsdam Rauenberg 1950 DHDN\"\n};\n\nexports.carthage = {\n  towgs84: \"-263.0,6.0,431.0\",\n  ellipse: \"clark80\",\n  datumName: \"Carthage 1934 Tunisia\"\n};\n\nexports.hermannskogel = {\n  towgs84: \"577.326,90.129,463.919,5.137,1.474,5.297,2.4232\",\n  ellipse: \"bessel\",\n  datumName: \"Hermannskogel\"\n};\n\nexports.osni52 = {\n  towgs84: \"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15\",\n  ellipse: \"airy\",\n  datumName: \"Irish National\"\n};\n\nexports.ire65 = {\n  towgs84: \"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15\",\n  ellipse: \"mod_airy\",\n  datumName: \"Ireland 1965\"\n};\n\nexports.rassadiran = {\n  towgs84: \"-133.63,-157.5,-158.62\",\n  ellipse: \"intl\",\n  datumName: \"Rassadiran\"\n};\n\nexports.nzgd49 = {\n  towgs84: \"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993\",\n  ellipse: \"intl\",\n  datumName: \"New Zealand Geodetic Datum 1949\"\n};\n\nexports.osgb36 = {\n  towgs84: \"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894\",\n  ellipse: \"airy\",\n  datumName: \"Airy 1830\"\n};\n\nexports.s_jtsk = {\n  towgs84: \"589,76,480\",\n  ellipse: 'bessel',\n  datumName: 'S-JTSK (Ferro)'\n};\n\nexports.beduaram = {\n  towgs84: '-106,-87,188',\n  ellipse: 'clrk80',\n  datumName: 'Beduaram'\n};\n\nexports.gunung_segara = {\n  towgs84: '-403,684,41',\n  ellipse: 'bessel',\n  datumName: 'Gunung Segara Jakarta'\n};\n\nexports.rnb72 = {\n  towgs84: \"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1\",\n  ellipse: \"intl\",\n  datumName: \"Reseau National Belge 1972\"\n};\n","/**\n * Resources for details of NTv2 file formats:\n * - https://web.archive.org/web/20140127204822if_/http://www.mgs.gov.on.ca:80/stdprodconsume/groups/content/@mgs/@iandit/documents/resourcelist/stel02_047447.pdf\n * - http://mimaka.com/help/gs/html/004_NTV2%20Data%20Format.htm\n */\n\nvar loadedNadgrids = {};\n\n/**\n * Load a binary NTv2 file (.gsb) to a key that can be used in a proj string like +nadgrids=<key>. Pass the NTv2 file\n * as an ArrayBuffer.\n */\nexport default function nadgrid(key, data) {\n  var view = new DataView(data);\n  var isLittleEndian = detectLittleEndian(view);\n  var header = readHeader(view, isLittleEndian);\n  if (header.nSubgrids > 1) {\n    console.log('Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored');\n  }\n  var subgrids = readSubgrids(view, header, isLittleEndian);\n  var nadgrid = {header: header, subgrids: subgrids};\n  loadedNadgrids[key] = nadgrid;\n  return nadgrid;\n}\n\n/**\n * Given a proj4 value for nadgrids, return an array of loaded grids\n */\nexport function getNadgrids(nadgrids) {\n  // Format details: http://proj.maptools.org/gen_parms.html\n  if (nadgrids === undefined) { return null; }\n  var grids = nadgrids.split(',');\n  return grids.map(parseNadgridString);\n}\n\nfunction parseNadgridString(value) {\n  if (value.length === 0) {\n    return null;\n  }\n  var optional = value[0] === '@';\n  if (optional) {\n    value = value.slice(1);\n  }\n  if (value === 'null') {\n    return {name: 'null', mandatory: !optional, grid: null, isNull: true};\n  }\n  return {\n    name: value,\n    mandatory: !optional,\n    grid: loadedNadgrids[value] || null,\n    isNull: false\n  };\n}\n\nfunction secondsToRadians(seconds) {\n  return (seconds / 3600) * Math.PI / 180;\n}\n\nfunction detectLittleEndian(view) {\n  var nFields = view.getInt32(8, false);\n  if (nFields === 11) {\n    return false;\n  }\n  nFields = view.getInt32(8, true);\n  if (nFields !== 11) {\n    console.warn('Failed to detect nadgrid endian-ness, defaulting to little-endian');\n  }\n  return true;\n}\n\nfunction readHeader(view, isLittleEndian) {\n  return {\n    nFields: view.getInt32(8, isLittleEndian),\n    nSubgridFields: view.getInt32(24, isLittleEndian),\n    nSubgrids: view.getInt32(40, isLittleEndian),\n    shiftType: decodeString(view, 56, 56 + 8).trim(),\n    fromSemiMajorAxis: view.getFloat64(120, isLittleEndian),\n    fromSemiMinorAxis: view.getFloat64(136, isLittleEndian),\n    toSemiMajorAxis: view.getFloat64(152, isLittleEndian),\n    toSemiMinorAxis: view.getFloat64(168, isLittleEndian),\n  };\n}\n\nfunction decodeString(view, start, end) {\n  return String.fromCharCode.apply(null, new Uint8Array(view.buffer.slice(start, end)));\n}\n\nfunction readSubgrids(view, header, isLittleEndian) {\n  var gridOffset = 176;\n  var grids = [];\n  for (var i = 0; i < header.nSubgrids; i++) {\n    var subHeader = readGridHeader(view, gridOffset, isLittleEndian);\n    var nodes = readGridNodes(view, gridOffset, subHeader, isLittleEndian);\n    var lngColumnCount = Math.round(\n      1 + (subHeader.upperLongitude - subHeader.lowerLongitude) / subHeader.longitudeInterval);\n    var latColumnCount = Math.round(\n      1 + (subHeader.upperLatitude - subHeader.lowerLatitude) / subHeader.latitudeInterval);\n    // Proj4 operates on radians whereas the coordinates are in seconds in the grid\n    grids.push({\n      ll: [secondsToRadians(subHeader.lowerLongitude), secondsToRadians(subHeader.lowerLatitude)],\n      del: [secondsToRadians(subHeader.longitudeInterval), secondsToRadians(subHeader.latitudeInterval)],\n      lim: [lngColumnCount, latColumnCount],\n      count: subHeader.gridNodeCount,\n      cvs: mapNodes(nodes)\n    });\n  }\n  return grids;\n}\n\nfunction mapNodes(nodes) {\n  return nodes.map(function (r) {return [secondsToRadians(r.longitudeShift), secondsToRadians(r.latitudeShift)];});\n}\n\nfunction readGridHeader(view, offset, isLittleEndian) {\n  return {\n    name: decodeString(view, offset + 8, offset + 16).trim(),\n    parent: decodeString(view, offset + 24, offset + 24 + 8).trim(),\n    lowerLatitude: view.getFloat64(offset + 72, isLittleEndian),\n    upperLatitude: view.getFloat64(offset + 88, isLittleEndian),\n    lowerLongitude: view.getFloat64(offset + 104, isLittleEndian),\n    upperLongitude: view.getFloat64(offset + 120, isLittleEndian),\n    latitudeInterval: view.getFloat64(offset + 136, isLittleEndian),\n    longitudeInterval: view.getFloat64(offset + 152, isLittleEndian),\n    gridNodeCount: view.getInt32(offset + 168, isLittleEndian)\n  };\n}\n\nfunction readGridNodes(view, offset, gridHeader, isLittleEndian) {\n  var nodesOffset = offset + 176;\n  var gridRecordLength = 16;\n  var gridShiftRecords = [];\n  for (var i = 0; i < gridHeader.gridNodeCount; i++) {\n    var record = {\n      latitudeShift: view.getFloat32(nodesOffset + i * gridRecordLength, isLittleEndian),\n      longitudeShift: view.getFloat32(nodesOffset + i * gridRecordLength + 4, isLittleEndian),\n      latitudeAccuracy: view.getFloat32(nodesOffset + i * gridRecordLength + 8, isLittleEndian),\n      longitudeAccuracy: view.getFloat32(nodesOffset + i * gridRecordLength + 12, isLittleEndian),\n    };\n    gridShiftRecords.push(record);\n  }\n  return gridShiftRecords;\n}\n","import parseCode from './parseCode';\nimport extend from './extend';\nimport projections from './projections';\nimport {sphere as dc_sphere, eccentricity as dc_eccentricity} from './deriveConstants';\nimport Datum from './constants/Datum';\nimport datum from './datum';\nimport match from './match';\nimport {getNadgrids} from \"./nadgrid\";\n\nfunction Projection(srsCode,callback) {\n  if (!(this instanceof Projection)) {\n    return new Projection(srsCode);\n  }\n  callback = callback || function(error){\n    if(error){\n      throw error;\n    }\n  };\n  var json = parseCode(srsCode);\n  if(typeof json !== 'object'){\n    callback(srsCode);\n    return;\n  }\n  var ourProj = Projection.projections.get(json.projName);\n  if(!ourProj){\n    callback(srsCode);\n    return;\n  }\n  if (json.datumCode && json.datumCode !== 'none') {\n    var datumDef = match(Datum, json.datumCode);\n    if (datumDef) {\n      json.datum_params = json.datum_params || (datumDef.towgs84 ? datumDef.towgs84.split(',') : null);\n      json.ellps = datumDef.ellipse;\n      json.datumName = datumDef.datumName ? datumDef.datumName : json.datumCode;\n    }\n  }\n  json.k0 = json.k0 || 1.0;\n  json.axis = json.axis || 'enu';\n  json.ellps = json.ellps || 'wgs84';\n  json.lat1 = json.lat1 || json.lat0; // Lambert_Conformal_Conic_1SP, for example, needs this\n\n  var sphere_ = dc_sphere(json.a, json.b, json.rf, json.ellps, json.sphere);\n  var ecc = dc_eccentricity(sphere_.a, sphere_.b, sphere_.rf, json.R_A);\n  var nadgrids = getNadgrids(json.nadgrids);\n  var datumObj = json.datum || datum(json.datumCode, json.datum_params, sphere_.a, sphere_.b, ecc.es, ecc.ep2,\n    nadgrids);\n\n  extend(this, json); // transfer everything over from the projection because we don't know what we'll need\n  extend(this, ourProj); // transfer all the methods from the projection\n\n  // copy the 4 things over we calulated in deriveConstants.sphere\n  this.a = sphere_.a;\n  this.b = sphere_.b;\n  this.rf = sphere_.rf;\n  this.sphere = sphere_.sphere;\n\n  // copy the 3 things we calculated in deriveConstants.eccentricity\n  this.es = ecc.es;\n  this.e = ecc.e;\n  this.ep2 = ecc.ep2;\n\n  // add in the datum object\n  this.datum = datumObj;\n\n  // init the projection\n  this.init();\n\n  // legecy callback from back in the day when it went to spatialreference.org\n  callback(null, this);\n\n}\nProjection.projections = projections;\nProjection.projections.start();\nexport default Projection;\n","import {SIXTH, RA4, RA6, EPSLN} from './constants/values';\nimport {default as Ellipsoid, WGS84} from './constants/Ellipsoid';\nimport match from './match';\n\nexport function eccentricity(a, b, rf, R_A) {\n  var a2 = a * a; // used in geocentric\n  var b2 = b * b; // used in geocentric\n  var es = (a2 - b2) / a2; // e ^ 2\n  var e = 0;\n  if (R_A) {\n    a *= 1 - es * (SIXTH + es * (RA4 + es * RA6));\n    a2 = a * a;\n    es = 0;\n  } else {\n    e = Math.sqrt(es); // eccentricity\n  }\n  var ep2 = (a2 - b2) / b2; // used in geocentric\n  return {\n    es: es,\n    e: e,\n    ep2: ep2\n  };\n}\nexport function sphere(a, b, rf, ellps, sphere) {\n  if (!a) { // do we have an ellipsoid?\n    var ellipse = match(Ellipsoid, ellps);\n    if (!ellipse) {\n      ellipse = WGS84;\n    }\n    a = ellipse.a;\n    b = ellipse.b;\n    rf = ellipse.rf;\n  }\n\n  if (rf && !b) {\n    b = (1.0 - 1.0 / rf) * a;\n  }\n  if (rf === 0 || Math.abs(a - b) < EPSLN) {\n    sphere = true;\n    b = a;\n  }\n  return {\n    a: a,\n    b: b,\n    rf: rf,\n    sphere: sphere\n  };\n}\n","import {PJD_3PARAM, PJD_7PARAM, PJD_GRIDSHIFT, PJD_WGS84, PJD_NODATUM, SEC_TO_RAD} from './constants/values';\n\nfunction datum(datumCode, datum_params, a, b, es, ep2, nadgrids) {\n  var out = {};\n\n  if (datumCode === undefined || datumCode === 'none') {\n    out.datum_type = PJD_NODATUM;\n  } else {\n    out.datum_type = PJD_WGS84;\n  }\n\n  if (datum_params) {\n    out.datum_params = datum_params.map(parseFloat);\n    if (out.datum_params[0] !== 0 || out.datum_params[1] !== 0 || out.datum_params[2] !== 0) {\n      out.datum_type = PJD_3PARAM;\n    }\n    if (out.datum_params.length > 3) {\n      if (out.datum_params[3] !== 0 || out.datum_params[4] !== 0 || out.datum_params[5] !== 0 || out.datum_params[6] !== 0) {\n        out.datum_type = PJD_7PARAM;\n        out.datum_params[3] *= SEC_TO_RAD;\n        out.datum_params[4] *= SEC_TO_RAD;\n        out.datum_params[5] *= SEC_TO_RAD;\n        out.datum_params[6] = (out.datum_params[6] / 1000000.0) + 1.0;\n      }\n    }\n  }\n\n  if (nadgrids) {\n    out.datum_type = PJD_GRIDSHIFT;\n    out.grids = nadgrids;\n  }\n  out.a = a; //datum object also uses these values\n  out.b = b;\n  out.es = es;\n  out.ep2 = ep2;\n  return out;\n}\n\nexport default datum;\n","'use strict';\nimport {PJD_3PARAM, PJD_7PARAM, HALF_PI} from './constants/values';\nexport function compareDatums(source, dest) {\n  if (source.datum_type !== dest.datum_type) {\n    return false; // false, datums are not equal\n  } else if (source.a !== dest.a || Math.abs(source.es - dest.es) > 0.000000000050) {\n    // the tolerance for es is to ensure that GRS80 and WGS84\n    // are considered identical\n    return false;\n  } else if (source.datum_type === PJD_3PARAM) {\n    return (source.datum_params[0] === dest.datum_params[0] && source.datum_params[1] === dest.datum_params[1] && source.datum_params[2] === dest.datum_params[2]);\n  } else if (source.datum_type === PJD_7PARAM) {\n    return (source.datum_params[0] === dest.datum_params[0] && source.datum_params[1] === dest.datum_params[1] && source.datum_params[2] === dest.datum_params[2] && source.datum_params[3] === dest.datum_params[3] && source.datum_params[4] === dest.datum_params[4] && source.datum_params[5] === dest.datum_params[5] && source.datum_params[6] === dest.datum_params[6]);\n  } else {\n    return true; // datums are equal\n  }\n} // cs_compare_datums()\n\n/*\n * The function Convert_Geodetic_To_Geocentric converts geodetic coordinates\n * (latitude, longitude, and height) to geocentric coordinates (X, Y, Z),\n * according to the current ellipsoid parameters.\n *\n *    Latitude  : Geodetic latitude in radians                     (input)\n *    Longitude : Geodetic longitude in radians                    (input)\n *    Height    : Geodetic height, in meters                       (input)\n *    X         : Calculated Geocentric X coordinate, in meters    (output)\n *    Y         : Calculated Geocentric Y coordinate, in meters    (output)\n *    Z         : Calculated Geocentric Z coordinate, in meters    (output)\n *\n */\nexport function geodeticToGeocentric(p, es, a) {\n  var Longitude = p.x;\n  var Latitude = p.y;\n  var Height = p.z ? p.z : 0; //Z value not always supplied\n\n  var Rn; /*  Earth radius at location  */\n  var Sin_Lat; /*  Math.sin(Latitude)  */\n  var Sin2_Lat; /*  Square of Math.sin(Latitude)  */\n  var Cos_Lat; /*  Math.cos(Latitude)  */\n\n  /*\n   ** Don't blow up if Latitude is just a little out of the value\n   ** range as it may just be a rounding issue.  Also removed longitude\n   ** test, it should be wrapped by Math.cos() and Math.sin().  NFW for PROJ.4, Sep/2001.\n   */\n  if (Latitude < -HALF_PI && Latitude > -1.001 * HALF_PI) {\n    Latitude = -HALF_PI;\n  } else if (Latitude > HALF_PI && Latitude < 1.001 * HALF_PI) {\n    Latitude = HALF_PI;\n  } else if (Latitude < -HALF_PI) {\n    /* Latitude out of range */\n    //..reportError('geocent:lat out of range:' + Latitude);\n    return { x: -Infinity, y: -Infinity, z: p.z };\n  } else if (Latitude > HALF_PI) {\n    /* Latitude out of range */\n    return { x: Infinity, y: Infinity, z: p.z };\n  }\n\n  if (Longitude > Math.PI) {\n    Longitude -= (2 * Math.PI);\n  }\n  Sin_Lat = Math.sin(Latitude);\n  Cos_Lat = Math.cos(Latitude);\n  Sin2_Lat = Sin_Lat * Sin_Lat;\n  Rn = a / (Math.sqrt(1.0e0 - es * Sin2_Lat));\n  return {\n    x: (Rn + Height) * Cos_Lat * Math.cos(Longitude),\n    y: (Rn + Height) * Cos_Lat * Math.sin(Longitude),\n    z: ((Rn * (1 - es)) + Height) * Sin_Lat\n  };\n} // cs_geodetic_to_geocentric()\n\nexport function geocentricToGeodetic(p, es, a, b) {\n  /* local defintions and variables */\n  /* end-criterium of loop, accuracy of sin(Latitude) */\n  var genau = 1e-12;\n  var genau2 = (genau * genau);\n  var maxiter = 30;\n\n  var P; /* distance between semi-minor axis and location */\n  var RR; /* distance between center and location */\n  var CT; /* sin of geocentric latitude */\n  var ST; /* cos of geocentric latitude */\n  var RX;\n  var RK;\n  var RN; /* Earth radius at location */\n  var CPHI0; /* cos of start or old geodetic latitude in iterations */\n  var SPHI0; /* sin of start or old geodetic latitude in iterations */\n  var CPHI; /* cos of searched geodetic latitude */\n  var SPHI; /* sin of searched geodetic latitude */\n  var SDPHI; /* end-criterium: addition-theorem of sin(Latitude(iter)-Latitude(iter-1)) */\n  var iter; /* # of continous iteration, max. 30 is always enough (s.a.) */\n\n  var X = p.x;\n  var Y = p.y;\n  var Z = p.z ? p.z : 0.0; //Z value not always supplied\n  var Longitude;\n  var Latitude;\n  var Height;\n\n  P = Math.sqrt(X * X + Y * Y);\n  RR = Math.sqrt(X * X + Y * Y + Z * Z);\n\n  /*      special cases for latitude and longitude */\n  if (P / a < genau) {\n\n    /*  special case, if P=0. (X=0., Y=0.) */\n    Longitude = 0.0;\n\n    /*  if (X,Y,Z)=(0.,0.,0.) then Height becomes semi-minor axis\n     *  of ellipsoid (=center of mass), Latitude becomes PI/2 */\n    if (RR / a < genau) {\n      Latitude = HALF_PI;\n      Height = -b;\n      return {\n        x: p.x,\n        y: p.y,\n        z: p.z\n      };\n    }\n  } else {\n    /*  ellipsoidal (geodetic) longitude\n     *  interval: -PI < Longitude <= +PI */\n    Longitude = Math.atan2(Y, X);\n  }\n\n  /* --------------------------------------------------------------\n   * Following iterative algorithm was developped by\n   * \"Institut for Erdmessung\", University of Hannover, July 1988.\n   * Internet: www.ife.uni-hannover.de\n   * Iterative computation of CPHI,SPHI and Height.\n   * Iteration of CPHI and SPHI to 10**-12 radian resp.\n   * 2*10**-7 arcsec.\n   * --------------------------------------------------------------\n   */\n  CT = Z / RR;\n  ST = P / RR;\n  RX = 1.0 / Math.sqrt(1.0 - es * (2.0 - es) * ST * ST);\n  CPHI0 = ST * (1.0 - es) * RX;\n  SPHI0 = CT * RX;\n  iter = 0;\n\n  /* loop to find sin(Latitude) resp. Latitude\n   * until |sin(Latitude(iter)-Latitude(iter-1))| < genau */\n  do {\n    iter++;\n    RN = a / Math.sqrt(1.0 - es * SPHI0 * SPHI0);\n\n    /*  ellipsoidal (geodetic) height */\n    Height = P * CPHI0 + Z * SPHI0 - RN * (1.0 - es * SPHI0 * SPHI0);\n\n    RK = es * RN / (RN + Height);\n    RX = 1.0 / Math.sqrt(1.0 - RK * (2.0 - RK) * ST * ST);\n    CPHI = ST * (1.0 - RK) * RX;\n    SPHI = CT * RX;\n    SDPHI = SPHI * CPHI0 - CPHI * SPHI0;\n    CPHI0 = CPHI;\n    SPHI0 = SPHI;\n  }\n  while (SDPHI * SDPHI > genau2 && iter < maxiter);\n\n  /*      ellipsoidal (geodetic) latitude */\n  Latitude = Math.atan(SPHI / Math.abs(CPHI));\n  return {\n    x: Longitude,\n    y: Latitude,\n    z: Height\n  };\n} // cs_geocentric_to_geodetic()\n\n/****************************************************************/\n// pj_geocentic_to_wgs84( p )\n//  p = point to transform in geocentric coordinates (x,y,z)\n\n\n/** point object, nothing fancy, just allows values to be\n    passed back and forth by reference rather than by value.\n    Other point classes may be used as long as they have\n    x and y properties, which will get modified in the transform method.\n*/\nexport function geocentricToWgs84(p, datum_type, datum_params) {\n\n  if (datum_type === PJD_3PARAM) {\n    // if( x[io] === HUGE_VAL )\n    //    continue;\n    return {\n      x: p.x + datum_params[0],\n      y: p.y + datum_params[1],\n      z: p.z + datum_params[2],\n    };\n  } else if (datum_type === PJD_7PARAM) {\n    var Dx_BF = datum_params[0];\n    var Dy_BF = datum_params[1];\n    var Dz_BF = datum_params[2];\n    var Rx_BF = datum_params[3];\n    var Ry_BF = datum_params[4];\n    var Rz_BF = datum_params[5];\n    var M_BF = datum_params[6];\n    // if( x[io] === HUGE_VAL )\n    //    continue;\n    return {\n      x: M_BF * (p.x - Rz_BF * p.y + Ry_BF * p.z) + Dx_BF,\n      y: M_BF * (Rz_BF * p.x + p.y - Rx_BF * p.z) + Dy_BF,\n      z: M_BF * (-Ry_BF * p.x + Rx_BF * p.y + p.z) + Dz_BF\n    };\n  }\n} // cs_geocentric_to_wgs84\n\n/****************************************************************/\n// pj_geocentic_from_wgs84()\n//  coordinate system definition,\n//  point to transform in geocentric coordinates (x,y,z)\nexport function geocentricFromWgs84(p, datum_type, datum_params) {\n\n  if (datum_type === PJD_3PARAM) {\n    //if( x[io] === HUGE_VAL )\n    //    continue;\n    return {\n      x: p.x - datum_params[0],\n      y: p.y - datum_params[1],\n      z: p.z - datum_params[2],\n    };\n\n  } else if (datum_type === PJD_7PARAM) {\n    var Dx_BF = datum_params[0];\n    var Dy_BF = datum_params[1];\n    var Dz_BF = datum_params[2];\n    var Rx_BF = datum_params[3];\n    var Ry_BF = datum_params[4];\n    var Rz_BF = datum_params[5];\n    var M_BF = datum_params[6];\n    var x_tmp = (p.x - Dx_BF) / M_BF;\n    var y_tmp = (p.y - Dy_BF) / M_BF;\n    var z_tmp = (p.z - Dz_BF) / M_BF;\n    //if( x[io] === HUGE_VAL )\n    //    continue;\n\n    return {\n      x: x_tmp + Rz_BF * y_tmp - Ry_BF * z_tmp,\n      y: -Rz_BF * x_tmp + y_tmp + Rx_BF * z_tmp,\n      z: Ry_BF * x_tmp - Rx_BF * y_tmp + z_tmp\n    };\n  } //cs_geocentric_from_wgs84()\n}\n","import {\n  PJD_3PARAM,\n  PJD_7PARAM,\n  PJD_GRIDSHIFT,\n  PJD_NODATUM,\n  R2D,\n  SRS_WGS84_ESQUARED,\n  SRS_WGS84_SEMIMAJOR, SRS_WGS84_SEMIMINOR\n} from './constants/values';\n\nimport {geodeticToGeocentric, geocentricToGeodetic, geocentricToWgs84, geocentricFromWgs84, compareDatums} from './datumUtils';\nimport adjust_lon from \"./common/adjust_lon\";\nfunction checkParams(type) {\n  return (type === PJD_3PARAM || type === PJD_7PARAM);\n}\n\nexport default function(source, dest, point) {\n  // Short cut if the datums are identical.\n  if (compareDatums(source, dest)) {\n    return point; // in this case, zero is sucess,\n    // whereas cs_compare_datums returns 1 to indicate TRUE\n    // confusing, should fix this\n  }\n\n  // Explicitly skip datum transform by setting 'datum=none' as parameter for either source or dest\n  if (source.datum_type === PJD_NODATUM || dest.datum_type === PJD_NODATUM) {\n    return point;\n  }\n\n  // If this datum requires grid shifts, then apply it to geodetic coordinates.\n  var source_a = source.a;\n  var source_es = source.es;\n  if (source.datum_type === PJD_GRIDSHIFT) {\n    var gridShiftCode = applyGridShift(source, false, point);\n    if (gridShiftCode !== 0) {\n      return undefined;\n    }\n    source_a = SRS_WGS84_SEMIMAJOR;\n    source_es = SRS_WGS84_ESQUARED;\n  }\n\n  var dest_a = dest.a;\n  var dest_b = dest.b;\n  var dest_es = dest.es;\n  if (dest.datum_type === PJD_GRIDSHIFT) {\n    dest_a = SRS_WGS84_SEMIMAJOR;\n    dest_b = SRS_WGS84_SEMIMINOR;\n    dest_es = SRS_WGS84_ESQUARED;\n  }\n\n  // Do we need to go through geocentric coordinates?\n  if (source_es === dest_es && source_a === dest_a && !checkParams(source.datum_type) &&  !checkParams(dest.datum_type)) {\n    return point;\n  }\n\n  // Convert to geocentric coordinates.\n  point = geodeticToGeocentric(point, source_es, source_a);\n  // Convert between datums\n  if (checkParams(source.datum_type)) {\n    point = geocentricToWgs84(point, source.datum_type, source.datum_params);\n  }\n  if (checkParams(dest.datum_type)) {\n    point = geocentricFromWgs84(point, dest.datum_type, dest.datum_params);\n  }\n  point = geocentricToGeodetic(point, dest_es, dest_a, dest_b);\n\n  if (dest.datum_type === PJD_GRIDSHIFT) {\n    var destGridShiftResult = applyGridShift(dest, true, point);\n    if (destGridShiftResult !== 0) {\n      return undefined;\n    }\n  }\n\n  return point;\n}\n\nexport function applyGridShift(source, inverse, point) {\n  if (source.grids === null || source.grids.length === 0) {\n    console.log('Grid shift grids not found');\n    return -1;\n  }\n  var input = {x: -point.x, y: point.y};\n  var output = {x: Number.NaN, y: Number.NaN};\n  var onlyMandatoryGrids = false;\n  var attemptedGrids = [];\n  for (var i = 0; i < source.grids.length; i++) {\n    var grid = source.grids[i];\n    attemptedGrids.push(grid.name);\n    if (grid.isNull) {\n      output = input;\n      break;\n    }\n    onlyMandatoryGrids = grid.mandatory;\n    if (grid.grid === null) {\n      if (grid.mandatory) {\n        console.log(\"Unable to find mandatory grid '\" + grid.name + \"'\");\n        return -1;\n      }\n      continue;\n    }\n    var subgrid = grid.grid.subgrids[0];\n    // skip tables that don't match our point at all\n    var epsilon = (Math.abs(subgrid.del[1]) + Math.abs(subgrid.del[0])) / 10000.0;\n    var minX = subgrid.ll[0] - epsilon;\n    var minY = subgrid.ll[1] - epsilon;\n    var maxX = subgrid.ll[0] + (subgrid.lim[0] - 1) * subgrid.del[0] + epsilon;\n    var maxY = subgrid.ll[1] + (subgrid.lim[1] - 1) * subgrid.del[1] + epsilon;\n    if (minY > input.y || minX > input.x || maxY < input.y || maxX < input.x ) {\n      continue;\n    }\n    output = applySubgridShift(input, inverse, subgrid);\n    if (!isNaN(output.x)) {\n      break;\n    }\n  }\n  if (isNaN(output.x)) {\n    console.log(\"Failed to find a grid shift table for location '\"+\n      -input.x * R2D + \" \" + input.y * R2D + \" tried: '\" + attemptedGrids + \"'\");\n    return -1;\n  }\n  point.x = -output.x;\n  point.y = output.y;\n  return 0;\n}\n\nfunction applySubgridShift(pin, inverse, ct) {\n  var val = {x: Number.NaN, y: Number.NaN};\n  if (isNaN(pin.x)) { return val; }\n  var tb = {x: pin.x, y: pin.y};\n  tb.x -= ct.ll[0];\n  tb.y -= ct.ll[1];\n  tb.x = adjust_lon(tb.x - Math.PI) + Math.PI;\n  var t = nadInterpolate(tb, ct);\n  if (inverse) {\n    if (isNaN(t.x)) {\n      return val;\n    }\n    t.x = tb.x - t.x;\n    t.y = tb.y - t.y;\n    var i = 9, tol = 1e-12;\n    var dif, del;\n    do {\n      del = nadInterpolate(t, ct);\n      if (isNaN(del.x)) {\n        console.log(\"Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.\");\n        break;\n      }\n      dif = {x: tb.x - (del.x + t.x), y: tb.y - (del.y + t.y)};\n      t.x += dif.x;\n      t.y += dif.y;\n    } while (i-- && Math.abs(dif.x) > tol && Math.abs(dif.y) > tol);\n    if (i < 0) {\n      console.log(\"Inverse grid shift iterator failed to converge.\");\n      return val;\n    }\n    val.x = adjust_lon(t.x + ct.ll[0]);\n    val.y = t.y + ct.ll[1];\n  } else {\n    if (!isNaN(t.x)) {\n      val.x = pin.x + t.x;\n      val.y = pin.y + t.y;\n    }\n  }\n  return val;\n}\n\nfunction nadInterpolate(pin, ct) {\n  var t = {x: pin.x / ct.del[0], y: pin.y / ct.del[1]};\n  var indx = {x: Math.floor(t.x), y: Math.floor(t.y)};\n  var frct = {x: t.x - 1.0 * indx.x, y: t.y - 1.0 * indx.y};\n  var val= {x: Number.NaN, y: Number.NaN};\n  var inx;\n  if (indx.x < 0 || indx.x >= ct.lim[0]) {\n    return val;\n  }\n  if (indx.y < 0 || indx.y >= ct.lim[1]) {\n    return val;\n  }\n  inx = (indx.y * ct.lim[0]) + indx.x;\n  var f00 = {x: ct.cvs[inx][0], y: ct.cvs[inx][1]};\n  inx++;\n  var f10= {x: ct.cvs[inx][0], y: ct.cvs[inx][1]};\n  inx += ct.lim[0];\n  var f11 = {x: ct.cvs[inx][0], y: ct.cvs[inx][1]};\n  inx--;\n  var f01 = {x: ct.cvs[inx][0], y: ct.cvs[inx][1]};\n  var m11 = frct.x * frct.y, m10 = frct.x * (1.0 - frct.y),\n    m00 = (1.0 - frct.x) * (1.0 - frct.y), m01 = (1.0 - frct.x) * frct.y;\n  val.x = (m00 * f00.x + m10 * f10.x + m01 * f01.x + m11 * f11.x);\n  val.y = (m00 * f00.y + m10 * f10.y + m01 * f01.y + m11 * f11.y);\n  return val;\n}\n","export default function(crs, denorm, point) {\n  var xin = point.x,\n    yin = point.y,\n    zin = point.z || 0.0;\n  var v, t, i;\n  var out = {};\n  for (i = 0; i < 3; i++) {\n    if (denorm && i === 2 && point.z === undefined) {\n      continue;\n    }\n    if (i === 0) {\n      v = xin;\n      if (\"ew\".indexOf(crs.axis[i]) !== -1) {\n        t = 'x';\n      } else {\n        t = 'y';\n      }\n\n    }\n    else if (i === 1) {\n      v = yin;\n      if (\"ns\".indexOf(crs.axis[i]) !== -1) {\n        t = 'y';\n      } else {\n        t = 'x';\n      }\n    }\n    else {\n      v = zin;\n      t = 'z';\n    }\n    switch (crs.axis[i]) {\n    case 'e':\n      out[t] = v;\n      break;\n    case 'w':\n      out[t] = -v;\n      break;\n    case 'n':\n      out[t] = v;\n      break;\n    case 's':\n      out[t] = -v;\n      break;\n    case 'u':\n      if (point[t] !== undefined) {\n        out.z = v;\n      }\n      break;\n    case 'd':\n      if (point[t] !== undefined) {\n        out.z = -v;\n      }\n      break;\n    default:\n      //console.log(\"ERROR: unknow axis (\"+crs.axis[i]+\") - check definition of \"+crs.projName);\n      return null;\n    }\n  }\n  return out;\n}\n","export default function (array){\n  var out = {\n    x: array[0],\n    y: array[1]\n  };\n  if (array.length>2) {\n    out.z = array[2];\n  }\n  if (array.length>3) {\n    out.m = array[3];\n  }\n  return out;\n}","export default function (point) {\n  checkCoord(point.x);\n  checkCoord(point.y);\n}\nfunction checkCoord(num) {\n  if (typeof Number.isFinite === 'function') {\n    if (Number.isFinite(num)) {\n      return;\n    }\n    throw new TypeError('coordinates must be finite numbers');\n  }\n  if (typeof num !== 'number' || num !== num || !isFinite(num)) {\n    throw new TypeError('coordinates must be finite numbers');\n  }\n}\n","import {D2R, R2D, PJD_3PARAM, PJD_7PARAM} from './constants/values';\nimport datum_transform from './datum_transform';\nimport adjust_axis from './adjust_axis';\nimport proj from './Proj';\nimport toPoint from './common/toPoint';\nimport checkSanity from './checkSanity';\n\nfunction checkNotWGS(source, dest) {\n  return ((source.datum.datum_type === PJD_3PARAM || source.datum.datum_type === PJD_7PARAM) && dest.datumCode !== 'WGS84') || ((dest.datum.datum_type === PJD_3PARAM || dest.datum.datum_type === PJD_7PARAM) && source.datumCode !== 'WGS84');\n}\n\nexport default function transform(source, dest, point, enforceAxis) {\n  var wgs84;\n  if (Array.isArray(point)) {\n    point = toPoint(point);\n  }\n  checkSanity(point);\n  // Workaround for datum shifts towgs84, if either source or destination projection is not wgs84\n  if (source.datum && dest.datum && checkNotWGS(source, dest)) {\n    wgs84 = new proj('WGS84');\n    point = transform(source, wgs84, point, enforceAxis);\n    source = wgs84;\n  }\n  // DGR, 2010/11/12\n  if (enforceAxis && source.axis !== 'enu') {\n    point = adjust_axis(source, false, point);\n  }\n  // Transform source points to long/lat, if they aren't already.\n  if (source.projName === 'longlat') {\n    point = {\n      x: point.x * D2R,\n      y: point.y * D2R,\n      z: point.z || 0\n    };\n  } else {\n    if (source.to_meter) {\n      point = {\n        x: point.x * source.to_meter,\n        y: point.y * source.to_meter,\n        z: point.z || 0\n      };\n    }\n    point = source.inverse(point); // Convert Cartesian to longlat\n    if (!point) {\n      return;\n    }\n  }\n  // Adjust for the prime meridian if necessary\n  if (source.from_greenwich) {\n    point.x += source.from_greenwich;\n  }\n\n  // Convert datums if needed, and if possible.\n  point = datum_transform(source.datum, dest.datum, point);\n  if (!point) {\n    return;\n  }\n\n  // Adjust for the prime meridian if necessary\n  if (dest.from_greenwich) {\n    point = {\n      x: point.x - dest.from_greenwich,\n      y: point.y,\n      z: point.z || 0\n    };\n  }\n\n  if (dest.projName === 'longlat') {\n    // convert radians to decimal degrees\n    point = {\n      x: point.x * R2D,\n      y: point.y * R2D,\n      z: point.z || 0\n    };\n  } else { // else project\n    point = dest.forward(point);\n    if (dest.to_meter) {\n      point = {\n        x: point.x / dest.to_meter,\n        y: point.y / dest.to_meter,\n        z: point.z || 0\n      };\n    }\n  }\n\n  // DGR, 2010/11/12\n  if (enforceAxis && dest.axis !== 'enu') {\n    return adjust_axis(dest, true, point);\n  }\n\n  return point;\n}\n","import proj from './Proj';\nimport transform from './transform';\nvar wgs84 = proj('WGS84');\n\nfunction transformer(from, to, coords, enforceAxis) {\n  var transformedArray, out, keys;\n  if (Array.isArray(coords)) {\n    transformedArray = transform(from, to, coords, enforceAxis) || {x: NaN, y: NaN};\n    if (coords.length > 2) {\n      if ((typeof from.name !== 'undefined' && from.name === 'geocent') || (typeof to.name !== 'undefined' && to.name === 'geocent')) {\n        if (typeof transformedArray.z === 'number') {\n          return [transformedArray.x, transformedArray.y, transformedArray.z].concat(coords.splice(3));\n        } else {\n          return [transformedArray.x, transformedArray.y, coords[2]].concat(coords.splice(3));\n        }\n      } else {\n        return [transformedArray.x, transformedArray.y].concat(coords.splice(2));\n      }\n    } else {\n      return [transformedArray.x, transformedArray.y];\n    }\n  } else {\n    out = transform(from, to, coords, enforceAxis);\n    keys = Object.keys(coords);\n    if (keys.length === 2) {\n      return out;\n    }\n    keys.forEach(function (key) {\n      if ((typeof from.name !== 'undefined' && from.name === 'geocent') || (typeof to.name !== 'undefined' && to.name === 'geocent')) {\n        if (key === 'x' || key === 'y' || key === 'z') {\n          return;\n        }\n      } else {\n        if (key === 'x' || key === 'y') {\n          return;\n        }\n      }\n      out[key] = coords[key];\n    });\n    return out;\n  }\n}\n\nfunction checkProj(item) {\n  if (item instanceof proj) {\n    return item;\n  }\n  if (item.oProj) {\n    return item.oProj;\n  }\n  return proj(item);\n}\n\nfunction proj4(fromProj, toProj, coord) {\n  fromProj = checkProj(fromProj);\n  var single = false;\n  var obj;\n  if (typeof toProj === 'undefined') {\n    toProj = fromProj;\n    fromProj = wgs84;\n    single = true;\n  } else if (typeof toProj.x !== 'undefined' || Array.isArray(toProj)) {\n    coord = toProj;\n    toProj = fromProj;\n    fromProj = wgs84;\n    single = true;\n  }\n  toProj = checkProj(toProj);\n  if (coord) {\n    return transformer(fromProj, toProj, coord);\n  } else {\n    obj = {\n      forward: function (coords, enforceAxis) {\n        return transformer(fromProj, toProj, coords, enforceAxis);\n      },\n      inverse: function (coords, enforceAxis) {\n        return transformer(toProj, fromProj, coords, enforceAxis);\n      }\n    };\n    if (single) {\n      obj.oProj = toProj;\n    }\n    return obj;\n  }\n}\nexport default proj4;","\n\n\n/**\n * UTM zones are grouped, and assigned to one of a group of 6\n * sets.\n *\n * {int} @private\n */\nvar NUM_100K_SETS = 6;\n\n/**\n * The column letters (for easting) of the lower left value, per\n * set.\n *\n * {string} @private\n */\nvar SET_ORIGIN_COLUMN_LETTERS = 'AJSAJS';\n\n/**\n * The row letters (for northing) of the lower left value, per\n * set.\n *\n * {string} @private\n */\nvar SET_ORIGIN_ROW_LETTERS = 'AFAFAF';\n\nvar A = 65; // A\nvar I = 73; // I\nvar O = 79; // O\nvar V = 86; // V\nvar Z = 90; // Z\nexport default {\n  forward: forward,\n  inverse: inverse,\n  toPoint: toPoint\n};\n/**\n * Conversion of lat/lon to MGRS.\n *\n * @param {object} ll Object literal with lat and lon properties on a\n *     WGS84 ellipsoid.\n * @param {int} accuracy Accuracy in digits (5 for 1 m, 4 for 10 m, 3 for\n *      100 m, 2 for 1000 m or 1 for 10000 m). Optional, default is 5.\n * @return {string} the MGRS string for the given location and accuracy.\n */\nexport function forward(ll, accuracy) {\n  accuracy = accuracy || 5; // default accuracy 1m\n  return encode(LLtoUTM({\n    lat: ll[1],\n    lon: ll[0]\n  }), accuracy);\n};\n\n/**\n * Conversion of MGRS to lat/lon.\n *\n * @param {string} mgrs MGRS string.\n * @return {array} An array with left (longitude), bottom (latitude), right\n *     (longitude) and top (latitude) values in WGS84, representing the\n *     bounding box for the provided MGRS reference.\n */\nexport function inverse(mgrs) {\n  var bbox = UTMtoLL(decode(mgrs.toUpperCase()));\n  if (bbox.lat && bbox.lon) {\n    return [bbox.lon, bbox.lat, bbox.lon, bbox.lat];\n  }\n  return [bbox.left, bbox.bottom, bbox.right, bbox.top];\n};\n\nexport function toPoint(mgrs) {\n  var bbox = UTMtoLL(decode(mgrs.toUpperCase()));\n  if (bbox.lat && bbox.lon) {\n    return [bbox.lon, bbox.lat];\n  }\n  return [(bbox.left + bbox.right) / 2, (bbox.top + bbox.bottom) / 2];\n};\n/**\n * Conversion from degrees to radians.\n *\n * @private\n * @param {number} deg the angle in degrees.\n * @return {number} the angle in radians.\n */\nfunction degToRad(deg) {\n  return (deg * (Math.PI / 180.0));\n}\n\n/**\n * Conversion from radians to degrees.\n *\n * @private\n * @param {number} rad the angle in radians.\n * @return {number} the angle in degrees.\n */\nfunction radToDeg(rad) {\n  return (180.0 * (rad / Math.PI));\n}\n\n/**\n * Converts a set of Longitude and Latitude co-ordinates to UTM\n * using the WGS84 ellipsoid.\n *\n * @private\n * @param {object} ll Object literal with lat and lon properties\n *     representing the WGS84 coordinate to be converted.\n * @return {object} Object literal containing the UTM value with easting,\n *     northing, zoneNumber and zoneLetter properties, and an optional\n *     accuracy property in digits. Returns null if the conversion failed.\n */\nfunction LLtoUTM(ll) {\n  var Lat = ll.lat;\n  var Long = ll.lon;\n  var a = 6378137.0; //ellip.radius;\n  var eccSquared = 0.00669438; //ellip.eccsq;\n  var k0 = 0.9996;\n  var LongOrigin;\n  var eccPrimeSquared;\n  var N, T, C, A, M;\n  var LatRad = degToRad(Lat);\n  var LongRad = degToRad(Long);\n  var LongOriginRad;\n  var ZoneNumber;\n  // (int)\n  ZoneNumber = Math.floor((Long + 180) / 6) + 1;\n\n  //Make sure the longitude 180.00 is in Zone 60\n  if (Long === 180) {\n    ZoneNumber = 60;\n  }\n\n  // Special zone for Norway\n  if (Lat >= 56.0 && Lat < 64.0 && Long >= 3.0 && Long < 12.0) {\n    ZoneNumber = 32;\n  }\n\n  // Special zones for Svalbard\n  if (Lat >= 72.0 && Lat < 84.0) {\n    if (Long >= 0.0 && Long < 9.0) {\n      ZoneNumber = 31;\n    }\n    else if (Long >= 9.0 && Long < 21.0) {\n      ZoneNumber = 33;\n    }\n    else if (Long >= 21.0 && Long < 33.0) {\n      ZoneNumber = 35;\n    }\n    else if (Long >= 33.0 && Long < 42.0) {\n      ZoneNumber = 37;\n    }\n  }\n\n  LongOrigin = (ZoneNumber - 1) * 6 - 180 + 3; //+3 puts origin\n  // in middle of\n  // zone\n  LongOriginRad = degToRad(LongOrigin);\n\n  eccPrimeSquared = (eccSquared) / (1 - eccSquared);\n\n  N = a / Math.sqrt(1 - eccSquared * Math.sin(LatRad) * Math.sin(LatRad));\n  T = Math.tan(LatRad) * Math.tan(LatRad);\n  C = eccPrimeSquared * Math.cos(LatRad) * Math.cos(LatRad);\n  A = Math.cos(LatRad) * (LongRad - LongOriginRad);\n\n  M = a * ((1 - eccSquared / 4 - 3 * eccSquared * eccSquared / 64 - 5 * eccSquared * eccSquared * eccSquared / 256) * LatRad - (3 * eccSquared / 8 + 3 * eccSquared * eccSquared / 32 + 45 * eccSquared * eccSquared * eccSquared / 1024) * Math.sin(2 * LatRad) + (15 * eccSquared * eccSquared / 256 + 45 * eccSquared * eccSquared * eccSquared / 1024) * Math.sin(4 * LatRad) - (35 * eccSquared * eccSquared * eccSquared / 3072) * Math.sin(6 * LatRad));\n\n  var UTMEasting = (k0 * N * (A + (1 - T + C) * A * A * A / 6.0 + (5 - 18 * T + T * T + 72 * C - 58 * eccPrimeSquared) * A * A * A * A * A / 120.0) + 500000.0);\n\n  var UTMNorthing = (k0 * (M + N * Math.tan(LatRad) * (A * A / 2 + (5 - T + 9 * C + 4 * C * C) * A * A * A * A / 24.0 + (61 - 58 * T + T * T + 600 * C - 330 * eccPrimeSquared) * A * A * A * A * A * A / 720.0)));\n  if (Lat < 0.0) {\n    UTMNorthing += 10000000.0; //10000000 meter offset for\n    // southern hemisphere\n  }\n\n  return {\n    northing: Math.round(UTMNorthing),\n    easting: Math.round(UTMEasting),\n    zoneNumber: ZoneNumber,\n    zoneLetter: getLetterDesignator(Lat)\n  };\n}\n\n/**\n * Converts UTM coords to lat/long, using the WGS84 ellipsoid. This is a convenience\n * class where the Zone can be specified as a single string eg.\"60N\" which\n * is then broken down into the ZoneNumber and ZoneLetter.\n *\n * @private\n * @param {object} utm An object literal with northing, easting, zoneNumber\n *     and zoneLetter properties. If an optional accuracy property is\n *     provided (in meters), a bounding box will be returned instead of\n *     latitude and longitude.\n * @return {object} An object literal containing either lat and lon values\n *     (if no accuracy was provided), or top, right, bottom and left values\n *     for the bounding box calculated according to the provided accuracy.\n *     Returns null if the conversion failed.\n */\nfunction UTMtoLL(utm) {\n\n  var UTMNorthing = utm.northing;\n  var UTMEasting = utm.easting;\n  var zoneLetter = utm.zoneLetter;\n  var zoneNumber = utm.zoneNumber;\n  // check the ZoneNummber is valid\n  if (zoneNumber < 0 || zoneNumber > 60) {\n    return null;\n  }\n\n  var k0 = 0.9996;\n  var a = 6378137.0; //ellip.radius;\n  var eccSquared = 0.00669438; //ellip.eccsq;\n  var eccPrimeSquared;\n  var e1 = (1 - Math.sqrt(1 - eccSquared)) / (1 + Math.sqrt(1 - eccSquared));\n  var N1, T1, C1, R1, D, M;\n  var LongOrigin;\n  var mu, phi1Rad;\n\n  // remove 500,000 meter offset for longitude\n  var x = UTMEasting - 500000.0;\n  var y = UTMNorthing;\n\n  // We must know somehow if we are in the Northern or Southern\n  // hemisphere, this is the only time we use the letter So even\n  // if the Zone letter isn't exactly correct it should indicate\n  // the hemisphere correctly\n  if (zoneLetter < 'N') {\n    y -= 10000000.0; // remove 10,000,000 meter offset used\n    // for southern hemisphere\n  }\n\n  // There are 60 zones with zone 1 being at West -180 to -174\n  LongOrigin = (zoneNumber - 1) * 6 - 180 + 3; // +3 puts origin\n  // in middle of\n  // zone\n\n  eccPrimeSquared = (eccSquared) / (1 - eccSquared);\n\n  M = y / k0;\n  mu = M / (a * (1 - eccSquared / 4 - 3 * eccSquared * eccSquared / 64 - 5 * eccSquared * eccSquared * eccSquared / 256));\n\n  phi1Rad = mu + (3 * e1 / 2 - 27 * e1 * e1 * e1 / 32) * Math.sin(2 * mu) + (21 * e1 * e1 / 16 - 55 * e1 * e1 * e1 * e1 / 32) * Math.sin(4 * mu) + (151 * e1 * e1 * e1 / 96) * Math.sin(6 * mu);\n  // double phi1 = ProjMath.radToDeg(phi1Rad);\n\n  N1 = a / Math.sqrt(1 - eccSquared * Math.sin(phi1Rad) * Math.sin(phi1Rad));\n  T1 = Math.tan(phi1Rad) * Math.tan(phi1Rad);\n  C1 = eccPrimeSquared * Math.cos(phi1Rad) * Math.cos(phi1Rad);\n  R1 = a * (1 - eccSquared) / Math.pow(1 - eccSquared * Math.sin(phi1Rad) * Math.sin(phi1Rad), 1.5);\n  D = x / (N1 * k0);\n\n  var lat = phi1Rad - (N1 * Math.tan(phi1Rad) / R1) * (D * D / 2 - (5 + 3 * T1 + 10 * C1 - 4 * C1 * C1 - 9 * eccPrimeSquared) * D * D * D * D / 24 + (61 + 90 * T1 + 298 * C1 + 45 * T1 * T1 - 252 * eccPrimeSquared - 3 * C1 * C1) * D * D * D * D * D * D / 720);\n  lat = radToDeg(lat);\n\n  var lon = (D - (1 + 2 * T1 + C1) * D * D * D / 6 + (5 - 2 * C1 + 28 * T1 - 3 * C1 * C1 + 8 * eccPrimeSquared + 24 * T1 * T1) * D * D * D * D * D / 120) / Math.cos(phi1Rad);\n  lon = LongOrigin + radToDeg(lon);\n\n  var result;\n  if (utm.accuracy) {\n    var topRight = UTMtoLL({\n      northing: utm.northing + utm.accuracy,\n      easting: utm.easting + utm.accuracy,\n      zoneLetter: utm.zoneLetter,\n      zoneNumber: utm.zoneNumber\n    });\n    result = {\n      top: topRight.lat,\n      right: topRight.lon,\n      bottom: lat,\n      left: lon\n    };\n  }\n  else {\n    result = {\n      lat: lat,\n      lon: lon\n    };\n  }\n  return result;\n}\n\n/**\n * Calculates the MGRS letter designator for the given latitude.\n *\n * @private\n * @param {number} lat The latitude in WGS84 to get the letter designator\n *     for.\n * @return {char} The letter designator.\n */\nfunction getLetterDesignator(lat) {\n  //This is here as an error flag to show that the Latitude is\n  //outside MGRS limits\n  var LetterDesignator = 'Z';\n\n  if ((84 >= lat) && (lat >= 72)) {\n    LetterDesignator = 'X';\n  }\n  else if ((72 > lat) && (lat >= 64)) {\n    LetterDesignator = 'W';\n  }\n  else if ((64 > lat) && (lat >= 56)) {\n    LetterDesignator = 'V';\n  }\n  else if ((56 > lat) && (lat >= 48)) {\n    LetterDesignator = 'U';\n  }\n  else if ((48 > lat) && (lat >= 40)) {\n    LetterDesignator = 'T';\n  }\n  else if ((40 > lat) && (lat >= 32)) {\n    LetterDesignator = 'S';\n  }\n  else if ((32 > lat) && (lat >= 24)) {\n    LetterDesignator = 'R';\n  }\n  else if ((24 > lat) && (lat >= 16)) {\n    LetterDesignator = 'Q';\n  }\n  else if ((16 > lat) && (lat >= 8)) {\n    LetterDesignator = 'P';\n  }\n  else if ((8 > lat) && (lat >= 0)) {\n    LetterDesignator = 'N';\n  }\n  else if ((0 > lat) && (lat >= -8)) {\n    LetterDesignator = 'M';\n  }\n  else if ((-8 > lat) && (lat >= -16)) {\n    LetterDesignator = 'L';\n  }\n  else if ((-16 > lat) && (lat >= -24)) {\n    LetterDesignator = 'K';\n  }\n  else if ((-24 > lat) && (lat >= -32)) {\n    LetterDesignator = 'J';\n  }\n  else if ((-32 > lat) && (lat >= -40)) {\n    LetterDesignator = 'H';\n  }\n  else if ((-40 > lat) && (lat >= -48)) {\n    LetterDesignator = 'G';\n  }\n  else if ((-48 > lat) && (lat >= -56)) {\n    LetterDesignator = 'F';\n  }\n  else if ((-56 > lat) && (lat >= -64)) {\n    LetterDesignator = 'E';\n  }\n  else if ((-64 > lat) && (lat >= -72)) {\n    LetterDesignator = 'D';\n  }\n  else if ((-72 > lat) && (lat >= -80)) {\n    LetterDesignator = 'C';\n  }\n  return LetterDesignator;\n}\n\n/**\n * Encodes a UTM location as MGRS string.\n *\n * @private\n * @param {object} utm An object literal with easting, northing,\n *     zoneLetter, zoneNumber\n * @param {number} accuracy Accuracy in digits (1-5).\n * @return {string} MGRS string for the given UTM location.\n */\nfunction encode(utm, accuracy) {\n  // prepend with leading zeroes\n  var seasting = \"00000\" + utm.easting,\n    snorthing = \"00000\" + utm.northing;\n\n  return utm.zoneNumber + utm.zoneLetter + get100kID(utm.easting, utm.northing, utm.zoneNumber) + seasting.substr(seasting.length - 5, accuracy) + snorthing.substr(snorthing.length - 5, accuracy);\n}\n\n/**\n * Get the two letter 100k designator for a given UTM easting,\n * northing and zone number value.\n *\n * @private\n * @param {number} easting\n * @param {number} northing\n * @param {number} zoneNumber\n * @return the two letter 100k designator for the given UTM location.\n */\nfunction get100kID(easting, northing, zoneNumber) {\n  var setParm = get100kSetForZone(zoneNumber);\n  var setColumn = Math.floor(easting / 100000);\n  var setRow = Math.floor(northing / 100000) % 20;\n  return getLetter100kID(setColumn, setRow, setParm);\n}\n\n/**\n * Given a UTM zone number, figure out the MGRS 100K set it is in.\n *\n * @private\n * @param {number} i An UTM zone number.\n * @return {number} the 100k set the UTM zone is in.\n */\nfunction get100kSetForZone(i) {\n  var setParm = i % NUM_100K_SETS;\n  if (setParm === 0) {\n    setParm = NUM_100K_SETS;\n  }\n\n  return setParm;\n}\n\n/**\n * Get the two-letter MGRS 100k designator given information\n * translated from the UTM northing, easting and zone number.\n *\n * @private\n * @param {number} column the column index as it relates to the MGRS\n *        100k set spreadsheet, created from the UTM easting.\n *        Values are 1-8.\n * @param {number} row the row index as it relates to the MGRS 100k set\n *        spreadsheet, created from the UTM northing value. Values\n *        are from 0-19.\n * @param {number} parm the set block, as it relates to the MGRS 100k set\n *        spreadsheet, created from the UTM zone. Values are from\n *        1-60.\n * @return two letter MGRS 100k code.\n */\nfunction getLetter100kID(column, row, parm) {\n  // colOrigin and rowOrigin are the letters at the origin of the set\n  var index = parm - 1;\n  var colOrigin = SET_ORIGIN_COLUMN_LETTERS.charCodeAt(index);\n  var rowOrigin = SET_ORIGIN_ROW_LETTERS.charCodeAt(index);\n\n  // colInt and rowInt are the letters to build to return\n  var colInt = colOrigin + column - 1;\n  var rowInt = rowOrigin + row;\n  var rollover = false;\n\n  if (colInt > Z) {\n    colInt = colInt - Z + A - 1;\n    rollover = true;\n  }\n\n  if (colInt === I || (colOrigin < I && colInt > I) || ((colInt > I || colOrigin < I) && rollover)) {\n    colInt++;\n  }\n\n  if (colInt === O || (colOrigin < O && colInt > O) || ((colInt > O || colOrigin < O) && rollover)) {\n    colInt++;\n\n    if (colInt === I) {\n      colInt++;\n    }\n  }\n\n  if (colInt > Z) {\n    colInt = colInt - Z + A - 1;\n  }\n\n  if (rowInt > V) {\n    rowInt = rowInt - V + A - 1;\n    rollover = true;\n  }\n  else {\n    rollover = false;\n  }\n\n  if (((rowInt === I) || ((rowOrigin < I) && (rowInt > I))) || (((rowInt > I) || (rowOrigin < I)) && rollover)) {\n    rowInt++;\n  }\n\n  if (((rowInt === O) || ((rowOrigin < O) && (rowInt > O))) || (((rowInt > O) || (rowOrigin < O)) && rollover)) {\n    rowInt++;\n\n    if (rowInt === I) {\n      rowInt++;\n    }\n  }\n\n  if (rowInt > V) {\n    rowInt = rowInt - V + A - 1;\n  }\n\n  var twoLetter = String.fromCharCode(colInt) + String.fromCharCode(rowInt);\n  return twoLetter;\n}\n\n/**\n * Decode the UTM parameters from a MGRS string.\n *\n * @private\n * @param {string} mgrsString an UPPERCASE coordinate string is expected.\n * @return {object} An object literal with easting, northing, zoneLetter,\n *     zoneNumber and accuracy (in meters) properties.\n */\nfunction decode(mgrsString) {\n\n  if (mgrsString && mgrsString.length === 0) {\n    throw (\"MGRSPoint coverting from nothing\");\n  }\n\n  var length = mgrsString.length;\n\n  var hunK = null;\n  var sb = \"\";\n  var testChar;\n  var i = 0;\n\n  // get Zone number\n  while (!(/[A-Z]/).test(testChar = mgrsString.charAt(i))) {\n    if (i >= 2) {\n      throw (\"MGRSPoint bad conversion from: \" + mgrsString);\n    }\n    sb += testChar;\n    i++;\n  }\n\n  var zoneNumber = parseInt(sb, 10);\n\n  if (i === 0 || i + 3 > length) {\n    // A good MGRS string has to be 4-5 digits long,\n    // ##AAA/#AAA at least.\n    throw (\"MGRSPoint bad conversion from: \" + mgrsString);\n  }\n\n  var zoneLetter = mgrsString.charAt(i++);\n\n  // Should we check the zone letter here? Why not.\n  if (zoneLetter <= 'A' || zoneLetter === 'B' || zoneLetter === 'Y' || zoneLetter >= 'Z' || zoneLetter === 'I' || zoneLetter === 'O') {\n    throw (\"MGRSPoint zone letter \" + zoneLetter + \" not handled: \" + mgrsString);\n  }\n\n  hunK = mgrsString.substring(i, i += 2);\n\n  var set = get100kSetForZone(zoneNumber);\n\n  var east100k = getEastingFromChar(hunK.charAt(0), set);\n  var north100k = getNorthingFromChar(hunK.charAt(1), set);\n\n  // We have a bug where the northing may be 2000000 too low.\n  // How\n  // do we know when to roll over?\n\n  while (north100k < getMinNorthing(zoneLetter)) {\n    north100k += 2000000;\n  }\n\n  // calculate the char index for easting/northing separator\n  var remainder = length - i;\n\n  if (remainder % 2 !== 0) {\n    throw (\"MGRSPoint has to have an even number \\nof digits after the zone letter and two 100km letters - front \\nhalf for easting meters, second half for \\nnorthing meters\" + mgrsString);\n  }\n\n  var sep = remainder / 2;\n\n  var sepEasting = 0.0;\n  var sepNorthing = 0.0;\n  var accuracyBonus, sepEastingString, sepNorthingString, easting, northing;\n  if (sep > 0) {\n    accuracyBonus = 100000.0 / Math.pow(10, sep);\n    sepEastingString = mgrsString.substring(i, i + sep);\n    sepEasting = parseFloat(sepEastingString) * accuracyBonus;\n    sepNorthingString = mgrsString.substring(i + sep);\n    sepNorthing = parseFloat(sepNorthingString) * accuracyBonus;\n  }\n\n  easting = sepEasting + east100k;\n  northing = sepNorthing + north100k;\n\n  return {\n    easting: easting,\n    northing: northing,\n    zoneLetter: zoneLetter,\n    zoneNumber: zoneNumber,\n    accuracy: accuracyBonus\n  };\n}\n\n/**\n * Given the first letter from a two-letter MGRS 100k zone, and given the\n * MGRS table set for the zone number, figure out the easting value that\n * should be added to the other, secondary easting value.\n *\n * @private\n * @param {char} e The first letter from a two-letter MGRS 100k zone.\n * @param {number} set The MGRS table set for the zone number.\n * @return {number} The easting value for the given letter and set.\n */\nfunction getEastingFromChar(e, set) {\n  // colOrigin is the letter at the origin of the set for the\n  // column\n  var curCol = SET_ORIGIN_COLUMN_LETTERS.charCodeAt(set - 1);\n  var eastingValue = 100000.0;\n  var rewindMarker = false;\n\n  while (curCol !== e.charCodeAt(0)) {\n    curCol++;\n    if (curCol === I) {\n      curCol++;\n    }\n    if (curCol === O) {\n      curCol++;\n    }\n    if (curCol > Z) {\n      if (rewindMarker) {\n        throw (\"Bad character: \" + e);\n      }\n      curCol = A;\n      rewindMarker = true;\n    }\n    eastingValue += 100000.0;\n  }\n\n  return eastingValue;\n}\n\n/**\n * Given the second letter from a two-letter MGRS 100k zone, and given the\n * MGRS table set for the zone number, figure out the northing value that\n * should be added to the other, secondary northing value. You have to\n * remember that Northings are determined from the equator, and the vertical\n * cycle of letters mean a 2000000 additional northing meters. This happens\n * approx. every 18 degrees of latitude. This method does *NOT* count any\n * additional northings. You have to figure out how many 2000000 meters need\n * to be added for the zone letter of the MGRS coordinate.\n *\n * @private\n * @param {char} n Second letter of the MGRS 100k zone\n * @param {number} set The MGRS table set number, which is dependent on the\n *     UTM zone number.\n * @return {number} The northing value for the given letter and set.\n */\nfunction getNorthingFromChar(n, set) {\n\n  if (n > 'V') {\n    throw (\"MGRSPoint given invalid Northing \" + n);\n  }\n\n  // rowOrigin is the letter at the origin of the set for the\n  // column\n  var curRow = SET_ORIGIN_ROW_LETTERS.charCodeAt(set - 1);\n  var northingValue = 0.0;\n  var rewindMarker = false;\n\n  while (curRow !== n.charCodeAt(0)) {\n    curRow++;\n    if (curRow === I) {\n      curRow++;\n    }\n    if (curRow === O) {\n      curRow++;\n    }\n    // fixing a bug making whole application hang in this loop\n    // when 'n' is a wrong character\n    if (curRow > V) {\n      if (rewindMarker) { // making sure that this loop ends\n        throw (\"Bad character: \" + n);\n      }\n      curRow = A;\n      rewindMarker = true;\n    }\n    northingValue += 100000.0;\n  }\n\n  return northingValue;\n}\n\n/**\n * The function getMinNorthing returns the minimum northing value of a MGRS\n * zone.\n *\n * Ported from Geotrans' c Lattitude_Band_Value structure table.\n *\n * @private\n * @param {char} zoneLetter The MGRS zone to get the min northing for.\n * @return {number}\n */\nfunction getMinNorthing(zoneLetter) {\n  var northing;\n  switch (zoneLetter) {\n  case 'C':\n    northing = 1100000.0;\n    break;\n  case 'D':\n    northing = 2000000.0;\n    break;\n  case 'E':\n    northing = 2800000.0;\n    break;\n  case 'F':\n    northing = 3700000.0;\n    break;\n  case 'G':\n    northing = 4600000.0;\n    break;\n  case 'H':\n    northing = 5500000.0;\n    break;\n  case 'J':\n    northing = 6400000.0;\n    break;\n  case 'K':\n    northing = 7300000.0;\n    break;\n  case 'L':\n    northing = 8200000.0;\n    break;\n  case 'M':\n    northing = 9100000.0;\n    break;\n  case 'N':\n    northing = 0.0;\n    break;\n  case 'P':\n    northing = 800000.0;\n    break;\n  case 'Q':\n    northing = 1700000.0;\n    break;\n  case 'R':\n    northing = 2600000.0;\n    break;\n  case 'S':\n    northing = 3500000.0;\n    break;\n  case 'T':\n    northing = 4400000.0;\n    break;\n  case 'U':\n    northing = 5300000.0;\n    break;\n  case 'V':\n    northing = 6200000.0;\n    break;\n  case 'W':\n    northing = 7000000.0;\n    break;\n  case 'X':\n    northing = 7900000.0;\n    break;\n  default:\n    northing = -1.0;\n  }\n  if (northing >= 0.0) {\n    return northing;\n  }\n  else {\n    throw (\"Invalid zone letter: \" + zoneLetter);\n  }\n\n}\n","import {toPoint, forward} from 'mgrs';\n\nfunction Point(x, y, z) {\n  if (!(this instanceof Point)) {\n    return new Point(x, y, z);\n  }\n  if (Array.isArray(x)) {\n    this.x = x[0];\n    this.y = x[1];\n    this.z = x[2] || 0.0;\n  } else if(typeof x === 'object') {\n    this.x = x.x;\n    this.y = x.y;\n    this.z = x.z || 0.0;\n  } else if (typeof x === 'string' && typeof y === 'undefined') {\n    var coords = x.split(',');\n    this.x = parseFloat(coords[0], 10);\n    this.y = parseFloat(coords[1], 10);\n    this.z = parseFloat(coords[2], 10) || 0.0;\n  } else {\n    this.x = x;\n    this.y = y;\n    this.z = z || 0.0;\n  }\n  console.warn('proj4.Point will be removed in version 3, use proj4.toPoint');\n}\n\nPoint.fromMGRS = function(mgrsStr) {\n  return new Point(toPoint(mgrsStr));\n};\nPoint.prototype.toMGRS = function(accuracy) {\n  return forward([this.x, this.y], accuracy);\n};\nexport default Point;\n","var C00 = 1;\nvar C02 = 0.25;\nvar C04 = 0.046875;\nvar C06 = 0.01953125;\nvar C08 = 0.01068115234375;\nvar C22 = 0.75;\nvar C44 = 0.46875;\nvar C46 = 0.01302083333333333333;\nvar C48 = 0.00712076822916666666;\nvar C66 = 0.36458333333333333333;\nvar C68 = 0.00569661458333333333;\nvar C88 = 0.3076171875;\n\nexport default function(es) {\n  var en = [];\n  en[0] = C00 - es * (C02 + es * (C04 + es * (C06 + es * C08)));\n  en[1] = es * (C22 - es * (C04 + es * (C06 + es * C08)));\n  var t = es * es;\n  en[2] = t * (C44 - es * (C46 + es * C48));\n  t *= es;\n  en[3] = t * (C66 - es * C68);\n  en[4] = t * es * C88;\n  return en;\n}","export default function(phi, sphi, cphi, en) {\n  cphi *= sphi;\n  sphi *= sphi;\n  return (en[0] * phi - cphi * (en[1] + sphi * (en[2] + sphi * (en[3] + sphi * en[4]))));\n}","import pj_mlfn from \"./pj_mlfn\";\nimport {EPSLN} from '../constants/values';\n\nvar MAX_ITER = 20;\n\nexport default function(arg, es, en) {\n  var k = 1 / (1 - es);\n  var phi = arg;\n  for (var i = MAX_ITER; i; --i) { /* rarely goes over 2 iterations */\n    var s = Math.sin(phi);\n    var t = 1 - es * s * s;\n    //t = this.pj_mlfn(phi, s, Math.cos(phi), en) - arg;\n    //phi -= t * (t * Math.sqrt(t)) * k;\n    t = (pj_mlfn(phi, s, Math.cos(phi), en) - arg) * (t * Math.sqrt(t)) * k;\n    phi -= t;\n    if (Math.abs(t) < EPSLN) {\n      return phi;\n    }\n  }\n  //..reportError(\"cass:pj_inv_mlfn: Convergence error\");\n  return phi;\n}\n","// Heavily based on this tmerc projection implementation\n// https://github.com/mbloch/mapshaper-proj/blob/master/src/projections/tmerc.js\n\nimport pj_enfn from '../common/pj_enfn';\nimport pj_mlfn from '../common/pj_mlfn';\nimport pj_inv_mlfn from '../common/pj_inv_mlfn';\nimport adjust_lon from '../common/adjust_lon';\n\nimport {EPSLN, HALF_PI} from '../constants/values';\nimport sign from '../common/sign';\n\nexport function init() {\n  this.x0 = this.x0 !== undefined ? this.x0 : 0;\n  this.y0 = this.y0 !== undefined ? this.y0 : 0;\n  this.long0 = this.long0 !== undefined ? this.long0 : 0;\n  this.lat0 = this.lat0 !== undefined ? this.lat0 : 0;\n\n  if (this.es) {\n    this.en = pj_enfn(this.es);\n    this.ml0 = pj_mlfn(this.lat0, Math.sin(this.lat0), Math.cos(this.lat0), this.en);\n  }\n}\n\n/**\n    Transverse Mercator Forward  - long/lat to x/y\n    long/lat in radians\n  */\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n\n  var delta_lon = adjust_lon(lon - this.long0);\n  var con;\n  var x, y;\n  var sin_phi = Math.sin(lat);\n  var cos_phi = Math.cos(lat);\n\n  if (!this.es) {\n    var b = cos_phi * Math.sin(delta_lon);\n\n    if ((Math.abs(Math.abs(b) - 1)) < EPSLN) {\n      return (93);\n    }\n    else {\n      x = 0.5 * this.a * this.k0 * Math.log((1 + b) / (1 - b)) + this.x0;\n      y = cos_phi * Math.cos(delta_lon) / Math.sqrt(1 - Math.pow(b, 2));\n      b = Math.abs(y);\n\n      if (b >= 1) {\n        if ((b - 1) > EPSLN) {\n          return (93);\n        }\n        else {\n          y = 0;\n        }\n      }\n      else {\n        y = Math.acos(y);\n      }\n\n      if (lat < 0) {\n        y = -y;\n      }\n\n      y = this.a * this.k0 * (y - this.lat0) + this.y0;\n    }\n  }\n  else {\n    var al = cos_phi * delta_lon;\n    var als = Math.pow(al, 2);\n    var c = this.ep2 * Math.pow(cos_phi, 2);\n    var cs = Math.pow(c, 2);\n    var tq = Math.abs(cos_phi) > EPSLN ? Math.tan(lat) : 0;\n    var t = Math.pow(tq, 2);\n    var ts = Math.pow(t, 2);\n    con = 1 - this.es * Math.pow(sin_phi, 2);\n    al = al / Math.sqrt(con);\n    var ml = pj_mlfn(lat, sin_phi, cos_phi, this.en);\n\n    x = this.a * (this.k0 * al * (1 +\n      als / 6 * (1 - t + c +\n      als / 20 * (5 - 18 * t + ts + 14 * c - 58 * t * c +\n      als / 42 * (61 + 179 * ts - ts * t - 479 * t))))) +\n      this.x0;\n\n    y = this.a * (this.k0 * (ml - this.ml0 +\n      sin_phi * delta_lon * al / 2 * (1 +\n      als / 12 * (5 - t + 9 * c + 4 * cs +\n      als / 30 * (61 + ts - 58 * t + 270 * c - 330 * t * c +\n      als / 56 * (1385 + 543 * ts - ts * t - 3111 * t)))))) +\n      this.y0;\n  }\n\n  p.x = x;\n  p.y = y;\n\n  return p;\n}\n\n/**\n    Transverse Mercator Inverse  -  x/y to long/lat\n  */\nexport function inverse(p) {\n  var con, phi;\n  var lat, lon;\n  var x = (p.x - this.x0) * (1 / this.a);\n  var y = (p.y - this.y0) * (1 / this.a);\n\n  if (!this.es) {\n    var f = Math.exp(x / this.k0);\n    var g = 0.5 * (f - 1 / f);\n    var temp = this.lat0 + y / this.k0;\n    var h = Math.cos(temp);\n    con = Math.sqrt((1 - Math.pow(h, 2)) / (1 + Math.pow(g, 2)));\n    lat = Math.asin(con);\n\n    if (y < 0) {\n      lat = -lat;\n    }\n\n    if ((g === 0) && (h === 0)) {\n      lon = 0;\n    }\n    else {\n      lon = adjust_lon(Math.atan2(g, h) + this.long0);\n    }\n  }\n  else { // ellipsoidal form\n    con = this.ml0 + y / this.k0;\n    phi = pj_inv_mlfn(con, this.es, this.en);\n\n    if (Math.abs(phi) < HALF_PI) {\n      var sin_phi = Math.sin(phi);\n      var cos_phi = Math.cos(phi);\n      var tan_phi = Math.abs(cos_phi) > EPSLN ? Math.tan(phi) : 0;\n      var c = this.ep2 * Math.pow(cos_phi, 2);\n      var cs = Math.pow(c, 2);\n      var t = Math.pow(tan_phi, 2);\n      var ts = Math.pow(t, 2);\n      con = 1 - this.es * Math.pow(sin_phi, 2);\n      var d = x * Math.sqrt(con) / this.k0;\n      var ds = Math.pow(d, 2);\n      con = con * tan_phi;\n\n      lat = phi - (con * ds / (1 - this.es)) * 0.5 * (1 -\n        ds / 12 * (5 + 3 * t - 9 * c * t + c - 4 * cs -\n        ds / 30 * (61 + 90 * t - 252 * c * t + 45 * ts + 46 * c -\n        ds / 56 * (1385 + 3633 * t + 4095 * ts + 1574 * ts * t))));\n\n      lon = adjust_lon(this.long0 + (d * (1 -\n        ds / 6 * (1 + 2 * t + c -\n        ds / 20 * (5 + 28 * t + 24 * ts + 8 * c * t + 6 * c -\n        ds / 42 * (61 + 662 * t + 1320 * ts + 720 * ts * t)))) / cos_phi));\n    }\n    else {\n      lat = HALF_PI * sign(y);\n      lon = 0;\n    }\n  }\n\n  p.x = lon;\n  p.y = lat;\n\n  return p;\n}\n\nexport var names = [\"Fast_Transverse_Mercator\", \"Fast Transverse Mercator\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","export default function(x) {\n  var r = Math.exp(x);\n  r = (r - 1 / r) / 2;\n  return r;\n}","export default function(x, y) {\n  x = Math.abs(x);\n  y = Math.abs(y);\n  var a = Math.max(x, y);\n  var b = Math.min(x, y) / (a ? a : 1);\n\n  return a * Math.sqrt(1 + Math.pow(b, 2));\n}\n","import hypot from './hypot';\nimport log1py from './log1py';\n\nexport default function(x) {\n  var y = Math.abs(x);\n  y = log1py(y * (1 + y / (hypot(1, y) + 1)));\n\n  return x < 0 ? -y : y;\n}\n","export default function(x) {\n  var y = 1 + x;\n  var z = y - 1;\n\n  return z === 0 ? x : x * Math.log(y) / z;\n}\n","export default function(pp, B) {\n  var cos_2B = 2 * Math.cos(2 * B);\n  var i = pp.length - 1;\n  var h1 = pp[i];\n  var h2 = 0;\n  var h;\n\n  while (--i >= 0) {\n    h = -h2 + cos_2B * h1 + pp[i];\n    h2 = h1;\n    h1 = h;\n  }\n\n  return (B + h * Math.sin(2 * B));\n}\n","import sinh from './sinh';\nimport cosh from './cosh';\n\nexport default function(pp, arg_r, arg_i) {\n  var sin_arg_r = Math.sin(arg_r);\n  var cos_arg_r = Math.cos(arg_r);\n  var sinh_arg_i = sinh(arg_i);\n  var cosh_arg_i = cosh(arg_i);\n  var r = 2 * cos_arg_r * cosh_arg_i;\n  var i = -2 * sin_arg_r * sinh_arg_i;\n  var j = pp.length - 1;\n  var hr = pp[j];\n  var hi1 = 0;\n  var hr1 = 0;\n  var hi = 0;\n  var hr2;\n  var hi2;\n\n  while (--j >= 0) {\n    hr2 = hr1;\n    hi2 = hi1;\n    hr1 = hr;\n    hi1 = hi;\n    hr = -hr2 + r * hr1 - i * hi1 + pp[j];\n    hi = -hi2 + i * hr1 + r * hi1;\n  }\n\n  r = sin_arg_r * cosh_arg_i;\n  i = cos_arg_r * sinh_arg_i;\n\n  return [r * hr - i * hi, r * hi + i * hr];\n}\n","export default function(x) {\n  var r = Math.exp(x);\n  r = (r + 1 / r) / 2;\n  return r;\n}","// Heavily based on this etmerc projection implementation\n// https://github.com/mbloch/mapshaper-proj/blob/master/src/projections/etmerc.js\n\nimport tmerc from '../projections/tmerc';\nimport sinh from '../common/sinh';\nimport hypot from '../common/hypot';\nimport asinhy from '../common/asinhy';\nimport gatg from '../common/gatg';\nimport clens from '../common/clens';\nimport clens_cmplx from '../common/clens_cmplx';\nimport adjust_lon from '../common/adjust_lon';\n\nexport function init() {\n  if (!this.approx && (isNaN(this.es) || this.es <= 0)) {\n    throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION[\"Fast_Transverse_Mercator\"] in the WKT.');\n  }\n  if (this.approx) {\n    // When '+approx' is set, use tmerc instead\n    tmerc.init.apply(this);\n    this.forward = tmerc.forward;\n    this.inverse = tmerc.inverse;\n  }\n\n  this.x0 = this.x0 !== undefined ? this.x0 : 0;\n  this.y0 = this.y0 !== undefined ? this.y0 : 0;\n  this.long0 = this.long0 !== undefined ? this.long0 : 0;\n  this.lat0 = this.lat0 !== undefined ? this.lat0 : 0;\n\n  this.cgb = [];\n  this.cbg = [];\n  this.utg = [];\n  this.gtu = [];\n\n  var f = this.es / (1 + Math.sqrt(1 - this.es));\n  var n = f / (2 - f);\n  var np = n;\n\n  this.cgb[0] = n * (2 + n * (-2 / 3 + n * (-2 + n * (116 / 45 + n * (26 / 45 + n * (-2854 / 675 ))))));\n  this.cbg[0] = n * (-2 + n * ( 2 / 3 + n * ( 4 / 3 + n * (-82 / 45 + n * (32 / 45 + n * (4642 / 4725))))));\n\n  np = np * n;\n  this.cgb[1] = np * (7 / 3 + n * (-8 / 5 + n * (-227 / 45 + n * (2704 / 315 + n * (2323 / 945)))));\n  this.cbg[1] = np * (5 / 3 + n * (-16 / 15 + n * ( -13 / 9 + n * (904 / 315 + n * (-1522 / 945)))));\n\n  np = np * n;\n  this.cgb[2] = np * (56 / 15 + n * (-136 / 35 + n * (-1262 / 105 + n * (73814 / 2835))));\n  this.cbg[2] = np * (-26 / 15 + n * (34 / 21 + n * (8 / 5 + n * (-12686 / 2835))));\n\n  np = np * n;\n  this.cgb[3] = np * (4279 / 630 + n * (-332 / 35 + n * (-399572 / 14175)));\n  this.cbg[3] = np * (1237 / 630 + n * (-12 / 5 + n * ( -24832 / 14175)));\n\n  np = np * n;\n  this.cgb[4] = np * (4174 / 315 + n * (-144838 / 6237));\n  this.cbg[4] = np * (-734 / 315 + n * (109598 / 31185));\n\n  np = np * n;\n  this.cgb[5] = np * (601676 / 22275);\n  this.cbg[5] = np * (444337 / 155925);\n\n  np = Math.pow(n, 2);\n  this.Qn = this.k0 / (1 + n) * (1 + np * (1 / 4 + np * (1 / 64 + np / 256)));\n\n  this.utg[0] = n * (-0.5 + n * ( 2 / 3 + n * (-37 / 96 + n * ( 1 / 360 + n * (81 / 512 + n * (-96199 / 604800))))));\n  this.gtu[0] = n * (0.5 + n * (-2 / 3 + n * (5 / 16 + n * (41 / 180 + n * (-127 / 288 + n * (7891 / 37800))))));\n\n  this.utg[1] = np * (-1 / 48 + n * (-1 / 15 + n * (437 / 1440 + n * (-46 / 105 + n * (1118711 / 3870720)))));\n  this.gtu[1] = np * (13 / 48 + n * (-3 / 5 + n * (557 / 1440 + n * (281 / 630 + n * (-1983433 / 1935360)))));\n\n  np = np * n;\n  this.utg[2] = np * (-17 / 480 + n * (37 / 840 + n * (209 / 4480 + n * (-5569 / 90720 ))));\n  this.gtu[2] = np * (61 / 240 + n * (-103 / 140 + n * (15061 / 26880 + n * (167603 / 181440))));\n\n  np = np * n;\n  this.utg[3] = np * (-4397 / 161280 + n * (11 / 504 + n * (830251 / 7257600)));\n  this.gtu[3] = np * (49561 / 161280 + n * (-179 / 168 + n * (6601661 / 7257600)));\n\n  np = np * n;\n  this.utg[4] = np * (-4583 / 161280 + n * (108847 / 3991680));\n  this.gtu[4] = np * (34729 / 80640 + n * (-3418889 / 1995840));\n\n  np = np * n;\n  this.utg[5] = np * (-20648693 / 638668800);\n  this.gtu[5] = np * (212378941 / 319334400);\n\n  var Z = gatg(this.cbg, this.lat0);\n  this.Zb = -this.Qn * (Z + clens(this.gtu, 2 * Z));\n}\n\nexport function forward(p) {\n  var Ce = adjust_lon(p.x - this.long0);\n  var Cn = p.y;\n\n  Cn = gatg(this.cbg, Cn);\n  var sin_Cn = Math.sin(Cn);\n  var cos_Cn = Math.cos(Cn);\n  var sin_Ce = Math.sin(Ce);\n  var cos_Ce = Math.cos(Ce);\n\n  Cn = Math.atan2(sin_Cn, cos_Ce * cos_Cn);\n  Ce = Math.atan2(sin_Ce * cos_Cn, hypot(sin_Cn, cos_Cn * cos_Ce));\n  Ce = asinhy(Math.tan(Ce));\n\n  var tmp = clens_cmplx(this.gtu, 2 * Cn, 2 * Ce);\n\n  Cn = Cn + tmp[0];\n  Ce = Ce + tmp[1];\n\n  var x;\n  var y;\n\n  if (Math.abs(Ce) <= 2.623395162778) {\n    x = this.a * (this.Qn * Ce) + this.x0;\n    y = this.a * (this.Qn * Cn + this.Zb) + this.y0;\n  }\n  else {\n    x = Infinity;\n    y = Infinity;\n  }\n\n  p.x = x;\n  p.y = y;\n\n  return p;\n}\n\nexport function inverse(p) {\n  var Ce = (p.x - this.x0) * (1 / this.a);\n  var Cn = (p.y - this.y0) * (1 / this.a);\n\n  Cn = (Cn - this.Zb) / this.Qn;\n  Ce = Ce / this.Qn;\n\n  var lon;\n  var lat;\n\n  if (Math.abs(Ce) <= 2.623395162778) {\n    var tmp = clens_cmplx(this.utg, 2 * Cn, 2 * Ce);\n\n    Cn = Cn + tmp[0];\n    Ce = Ce + tmp[1];\n    Ce = Math.atan(sinh(Ce));\n\n    var sin_Cn = Math.sin(Cn);\n    var cos_Cn = Math.cos(Cn);\n    var sin_Ce = Math.sin(Ce);\n    var cos_Ce = Math.cos(Ce);\n\n    Cn = Math.atan2(sin_Cn * cos_Ce, hypot(sin_Ce, cos_Ce * cos_Cn));\n    Ce = Math.atan2(sin_Ce, cos_Ce * cos_Cn);\n\n    lon = adjust_lon(Ce + this.long0);\n    lat = gatg(this.cgb, Cn);\n  }\n  else {\n    lon = Infinity;\n    lat = Infinity;\n  }\n\n  p.x = lon;\n  p.y = lat;\n\n  return p;\n}\n\nexport var names = [\"Extended_Transverse_Mercator\", \"Extended Transverse Mercator\", \"etmerc\", \"Transverse_Mercator\", \"Transverse Mercator\", \"tmerc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","export default function(pp, arg_r) {\n  var r = 2 * Math.cos(arg_r);\n  var i = pp.length - 1;\n  var hr1 = pp[i];\n  var hr2 = 0;\n  var hr;\n\n  while (--i >= 0) {\n    hr = -hr2 + r * hr1 + pp[i];\n    hr2 = hr1;\n    hr1 = hr;\n  }\n\n  return Math.sin(arg_r) * hr;\n}\n","import adjust_zone from '../common/adjust_zone';\nimport etmerc from './etmerc';\nexport var dependsOn = 'etmerc';\nimport {D2R} from '../constants/values';\n\n\nexport function init() {\n  var zone = adjust_zone(this.zone, this.long0);\n  if (zone === undefined) {\n    throw new Error('unknown utm zone');\n  }\n  this.lat0 = 0;\n  this.long0 =  ((6 * Math.abs(zone)) - 183) * D2R;\n  this.x0 = 500000;\n  this.y0 = this.utmSouth ? 10000000 : 0;\n  this.k0 = 0.9996;\n\n  etmerc.init.apply(this);\n  this.forward = etmerc.forward;\n  this.inverse = etmerc.inverse;\n}\n\nexport var names = [\"Universal Transverse Mercator System\", \"utm\"];\nexport default {\n  init: init,\n  names: names,\n  dependsOn: dependsOn\n};\n","import adjust_lon from './adjust_lon';\n\nexport default function(zone, lon) {\n  if (zone === undefined) {\n    zone = Math.floor((adjust_lon(lon) + Math.PI) * 30 / Math.PI) + 1;\n\n    if (zone < 0) {\n      return 0;\n    } else if (zone > 60) {\n      return 60;\n    }\n  }\n  return zone;\n}\n","export default function(esinp, exp) {\n  return (Math.pow((1 - esinp) / (1 + esinp), exp));\n}","import srat from '../common/srat';\nvar MAX_ITER = 20;\nimport {HALF_PI, FORTPI} from '../constants/values';\n\nexport function init() {\n  var sphi = Math.sin(this.lat0);\n  var cphi = Math.cos(this.lat0);\n  cphi *= cphi;\n  this.rc = Math.sqrt(1 - this.es) / (1 - this.es * sphi * sphi);\n  this.C = Math.sqrt(1 + this.es * cphi * cphi / (1 - this.es));\n  this.phic0 = Math.asin(sphi / this.C);\n  this.ratexp = 0.5 * this.C * this.e;\n  this.K = Math.tan(0.5 * this.phic0 + FORTPI) / (Math.pow(Math.tan(0.5 * this.lat0 + FORTPI), this.C) * srat(this.e * sphi, this.ratexp));\n}\n\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n\n  p.y = 2 * Math.atan(this.K * Math.pow(Math.tan(0.5 * lat + FORTPI), this.C) * srat(this.e * Math.sin(lat), this.ratexp)) - HALF_PI;\n  p.x = this.C * lon;\n  return p;\n}\n\nexport function inverse(p) {\n  var DEL_TOL = 1e-14;\n  var lon = p.x / this.C;\n  var lat = p.y;\n  var num = Math.pow(Math.tan(0.5 * lat + FORTPI) / this.K, 1 / this.C);\n  for (var i = MAX_ITER; i > 0; --i) {\n    lat = 2 * Math.atan(num * srat(this.e * Math.sin(p.y), - 0.5 * this.e)) - HALF_PI;\n    if (Math.abs(lat - p.y) < DEL_TOL) {\n      break;\n    }\n    p.y = lat;\n  }\n  /* convergence failed */\n  if (!i) {\n    return null;\n  }\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"gauss\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import gauss from './gauss';\nimport adjust_lon from '../common/adjust_lon';\n\nexport function init() {\n  gauss.init.apply(this);\n  if (!this.rc) {\n    return;\n  }\n  this.sinc0 = Math.sin(this.phic0);\n  this.cosc0 = Math.cos(this.phic0);\n  this.R2 = 2 * this.rc;\n  if (!this.title) {\n    this.title = \"Oblique Stereographic Alternative\";\n  }\n}\n\nexport function forward(p) {\n  var sinc, cosc, cosl, k;\n  p.x = adjust_lon(p.x - this.long0);\n  gauss.forward.apply(this, [p]);\n  sinc = Math.sin(p.y);\n  cosc = Math.cos(p.y);\n  cosl = Math.cos(p.x);\n  k = this.k0 * this.R2 / (1 + this.sinc0 * sinc + this.cosc0 * cosc * cosl);\n  p.x = k * cosc * Math.sin(p.x);\n  p.y = k * (this.cosc0 * sinc - this.sinc0 * cosc * cosl);\n  p.x = this.a * p.x + this.x0;\n  p.y = this.a * p.y + this.y0;\n  return p;\n}\n\nexport function inverse(p) {\n  var sinc, cosc, lon, lat, rho;\n  p.x = (p.x - this.x0) / this.a;\n  p.y = (p.y - this.y0) / this.a;\n\n  p.x /= this.k0;\n  p.y /= this.k0;\n  if ((rho = Math.sqrt(p.x * p.x + p.y * p.y))) {\n    var c = 2 * Math.atan2(rho, this.R2);\n    sinc = Math.sin(c);\n    cosc = Math.cos(c);\n    lat = Math.asin(cosc * this.sinc0 + p.y * sinc * this.cosc0 / rho);\n    lon = Math.atan2(p.x * sinc, rho * this.cosc0 * cosc - p.y * this.sinc0 * sinc);\n  }\n  else {\n    lat = this.phic0;\n    lon = 0;\n  }\n\n  p.x = lon;\n  p.y = lat;\n  gauss.inverse.apply(this, [p]);\n  p.x = adjust_lon(p.x + this.long0);\n  return p;\n}\n\nexport var names = [\"Stereographic_North_Pole\", \"Oblique_Stereographic\", \"Polar_Stereographic\", \"sterea\",\"Oblique Stereographic Alternative\",\"Double_Stereographic\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import {EPSLN, HALF_PI} from '../constants/values';\n\nimport sign from '../common/sign';\nimport msfnz from '../common/msfnz';\nimport tsfnz from '../common/tsfnz';\nimport phi2z from '../common/phi2z';\nimport adjust_lon from '../common/adjust_lon';\n\nexport function ssfn_(phit, sinphi, eccen) {\n  sinphi *= eccen;\n  return (Math.tan(0.5 * (HALF_PI + phit)) * Math.pow((1 - sinphi) / (1 + sinphi), 0.5 * eccen));\n}\n\nexport function init() {\n  this.coslat0 = Math.cos(this.lat0);\n  this.sinlat0 = Math.sin(this.lat0);\n  if (this.sphere) {\n    if (this.k0 === 1 && !isNaN(this.lat_ts) && Math.abs(this.coslat0) <= EPSLN) {\n      this.k0 = 0.5 * (1 + sign(this.lat0) * Math.sin(this.lat_ts));\n    }\n  }\n  else {\n    if (Math.abs(this.coslat0) <= EPSLN) {\n      if (this.lat0 > 0) {\n        //North pole\n        //trace('stere:north pole');\n        this.con = 1;\n      }\n      else {\n        //South pole\n        //trace('stere:south pole');\n        this.con = -1;\n      }\n    }\n    this.cons = Math.sqrt(Math.pow(1 + this.e, 1 + this.e) * Math.pow(1 - this.e, 1 - this.e));\n    if (this.k0 === 1 && !isNaN(this.lat_ts) && Math.abs(this.coslat0) <= EPSLN) {\n      this.k0 = 0.5 * this.cons * msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts)) / tsfnz(this.e, this.con * this.lat_ts, this.con * Math.sin(this.lat_ts));\n    }\n    this.ms1 = msfnz(this.e, this.sinlat0, this.coslat0);\n    this.X0 = 2 * Math.atan(this.ssfn_(this.lat0, this.sinlat0, this.e)) - HALF_PI;\n    this.cosX0 = Math.cos(this.X0);\n    this.sinX0 = Math.sin(this.X0);\n  }\n}\n\n// Stereographic forward equations--mapping lat,long to x,y\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  var sinlat = Math.sin(lat);\n  var coslat = Math.cos(lat);\n  var A, X, sinX, cosX, ts, rh;\n  var dlon = adjust_lon(lon - this.long0);\n\n  if (Math.abs(Math.abs(lon - this.long0) - Math.PI) <= EPSLN && Math.abs(lat + this.lat0) <= EPSLN) {\n    //case of the origine point\n    //trace('stere:this is the origin point');\n    p.x = NaN;\n    p.y = NaN;\n    return p;\n  }\n  if (this.sphere) {\n    //trace('stere:sphere case');\n    A = 2 * this.k0 / (1 + this.sinlat0 * sinlat + this.coslat0 * coslat * Math.cos(dlon));\n    p.x = this.a * A * coslat * Math.sin(dlon) + this.x0;\n    p.y = this.a * A * (this.coslat0 * sinlat - this.sinlat0 * coslat * Math.cos(dlon)) + this.y0;\n    return p;\n  }\n  else {\n    X = 2 * Math.atan(this.ssfn_(lat, sinlat, this.e)) - HALF_PI;\n    cosX = Math.cos(X);\n    sinX = Math.sin(X);\n    if (Math.abs(this.coslat0) <= EPSLN) {\n      ts = tsfnz(this.e, lat * this.con, this.con * sinlat);\n      rh = 2 * this.a * this.k0 * ts / this.cons;\n      p.x = this.x0 + rh * Math.sin(lon - this.long0);\n      p.y = this.y0 - this.con * rh * Math.cos(lon - this.long0);\n      //trace(p.toString());\n      return p;\n    }\n    else if (Math.abs(this.sinlat0) < EPSLN) {\n      //Eq\n      //trace('stere:equateur');\n      A = 2 * this.a * this.k0 / (1 + cosX * Math.cos(dlon));\n      p.y = A * sinX;\n    }\n    else {\n      //other case\n      //trace('stere:normal case');\n      A = 2 * this.a * this.k0 * this.ms1 / (this.cosX0 * (1 + this.sinX0 * sinX + this.cosX0 * cosX * Math.cos(dlon)));\n      p.y = A * (this.cosX0 * sinX - this.sinX0 * cosX * Math.cos(dlon)) + this.y0;\n    }\n    p.x = A * cosX * Math.sin(dlon) + this.x0;\n  }\n  //trace(p.toString());\n  return p;\n}\n\n//* Stereographic inverse equations--mapping x,y to lat/long\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n  var lon, lat, ts, ce, Chi;\n  var rh = Math.sqrt(p.x * p.x + p.y * p.y);\n  if (this.sphere) {\n    var c = 2 * Math.atan(rh / (2 * this.a * this.k0));\n    lon = this.long0;\n    lat = this.lat0;\n    if (rh <= EPSLN) {\n      p.x = lon;\n      p.y = lat;\n      return p;\n    }\n    lat = Math.asin(Math.cos(c) * this.sinlat0 + p.y * Math.sin(c) * this.coslat0 / rh);\n    if (Math.abs(this.coslat0) < EPSLN) {\n      if (this.lat0 > 0) {\n        lon = adjust_lon(this.long0 + Math.atan2(p.x, - 1 * p.y));\n      }\n      else {\n        lon = adjust_lon(this.long0 + Math.atan2(p.x, p.y));\n      }\n    }\n    else {\n      lon = adjust_lon(this.long0 + Math.atan2(p.x * Math.sin(c), rh * this.coslat0 * Math.cos(c) - p.y * this.sinlat0 * Math.sin(c)));\n    }\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n  else {\n    if (Math.abs(this.coslat0) <= EPSLN) {\n      if (rh <= EPSLN) {\n        lat = this.lat0;\n        lon = this.long0;\n        p.x = lon;\n        p.y = lat;\n        //trace(p.toString());\n        return p;\n      }\n      p.x *= this.con;\n      p.y *= this.con;\n      ts = rh * this.cons / (2 * this.a * this.k0);\n      lat = this.con * phi2z(this.e, ts);\n      lon = this.con * adjust_lon(this.con * this.long0 + Math.atan2(p.x, - 1 * p.y));\n    }\n    else {\n      ce = 2 * Math.atan(rh * this.cosX0 / (2 * this.a * this.k0 * this.ms1));\n      lon = this.long0;\n      if (rh <= EPSLN) {\n        Chi = this.X0;\n      }\n      else {\n        Chi = Math.asin(Math.cos(ce) * this.sinX0 + p.y * Math.sin(ce) * this.cosX0 / rh);\n        lon = adjust_lon(this.long0 + Math.atan2(p.x * Math.sin(ce), rh * this.cosX0 * Math.cos(ce) - p.y * this.sinX0 * Math.sin(ce)));\n      }\n      lat = -1 * phi2z(this.e, Math.tan(0.5 * (HALF_PI + Chi)));\n    }\n  }\n  p.x = lon;\n  p.y = lat;\n\n  //trace(p.toString());\n  return p;\n\n}\n\nexport var names = [\"stere\", \"Stereographic_South_Pole\", \"Polar Stereographic (variant B)\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names,\n  ssfn_: ssfn_\n};\n","/*\n  references:\n    Formules et constantes pour le Calcul pour la\n    projection cylindrique conforme  axe oblique et pour la transformation entre\n    des systmes de rfrence.\n    http://www.swisstopo.admin.ch/internet/swisstopo/fr/home/topics/survey/sys/refsys/switzerland.parsysrelated1.31216.downloadList.77004.DownloadFile.tmp/swissprojectionfr.pdf\n  */\n\nexport function init() {\n  var phy0 = this.lat0;\n  this.lambda0 = this.long0;\n  var sinPhy0 = Math.sin(phy0);\n  var semiMajorAxis = this.a;\n  var invF = this.rf;\n  var flattening = 1 / invF;\n  var e2 = 2 * flattening - Math.pow(flattening, 2);\n  var e = this.e = Math.sqrt(e2);\n  this.R = this.k0 * semiMajorAxis * Math.sqrt(1 - e2) / (1 - e2 * Math.pow(sinPhy0, 2));\n  this.alpha = Math.sqrt(1 + e2 / (1 - e2) * Math.pow(Math.cos(phy0), 4));\n  this.b0 = Math.asin(sinPhy0 / this.alpha);\n  var k1 = Math.log(Math.tan(Math.PI / 4 + this.b0 / 2));\n  var k2 = Math.log(Math.tan(Math.PI / 4 + phy0 / 2));\n  var k3 = Math.log((1 + e * sinPhy0) / (1 - e * sinPhy0));\n  this.K = k1 - this.alpha * k2 + this.alpha * e / 2 * k3;\n}\n\nexport function forward(p) {\n  var Sa1 = Math.log(Math.tan(Math.PI / 4 - p.y / 2));\n  var Sa2 = this.e / 2 * Math.log((1 + this.e * Math.sin(p.y)) / (1 - this.e * Math.sin(p.y)));\n  var S = -this.alpha * (Sa1 + Sa2) + this.K;\n\n  // spheric latitude\n  var b = 2 * (Math.atan(Math.exp(S)) - Math.PI / 4);\n\n  // spheric longitude\n  var I = this.alpha * (p.x - this.lambda0);\n\n  // psoeudo equatorial rotation\n  var rotI = Math.atan(Math.sin(I) / (Math.sin(this.b0) * Math.tan(b) + Math.cos(this.b0) * Math.cos(I)));\n\n  var rotB = Math.asin(Math.cos(this.b0) * Math.sin(b) - Math.sin(this.b0) * Math.cos(b) * Math.cos(I));\n\n  p.y = this.R / 2 * Math.log((1 + Math.sin(rotB)) / (1 - Math.sin(rotB))) + this.y0;\n  p.x = this.R * rotI + this.x0;\n  return p;\n}\n\nexport function inverse(p) {\n  var Y = p.x - this.x0;\n  var X = p.y - this.y0;\n\n  var rotI = Y / this.R;\n  var rotB = 2 * (Math.atan(Math.exp(X / this.R)) - Math.PI / 4);\n\n  var b = Math.asin(Math.cos(this.b0) * Math.sin(rotB) + Math.sin(this.b0) * Math.cos(rotB) * Math.cos(rotI));\n  var I = Math.atan(Math.sin(rotI) / (Math.cos(this.b0) * Math.cos(rotI) - Math.sin(this.b0) * Math.tan(rotB)));\n\n  var lambda = this.lambda0 + I / this.alpha;\n\n  var S = 0;\n  var phy = b;\n  var prevPhy = -1000;\n  var iteration = 0;\n  while (Math.abs(phy - prevPhy) > 0.0000001) {\n    if (++iteration > 20) {\n      //...reportError(\"omercFwdInfinity\");\n      return;\n    }\n    //S = Math.log(Math.tan(Math.PI / 4 + phy / 2));\n    S = 1 / this.alpha * (Math.log(Math.tan(Math.PI / 4 + b / 2)) - this.K) + this.e * Math.log(Math.tan(Math.PI / 4 + Math.asin(this.e * Math.sin(phy)) / 2));\n    prevPhy = phy;\n    phy = 2 * Math.atan(Math.exp(S)) - Math.PI / 2;\n  }\n\n  p.x = lambda;\n  p.y = phy;\n  return p;\n}\n\nexport var names = [\"somerc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import tsfnz from '../common/tsfnz';\nimport adjust_lon from '../common/adjust_lon';\nimport phi2z from '../common/phi2z';\nimport { D2R, EPSLN, HALF_PI, TWO_PI, FORTPI } from '../constants/values';\n\nvar TOL = 1e-7;\n\nfunction isTypeA(P) {\n  var typeAProjections = ['Hotine_Oblique_Mercator','Hotine_Oblique_Mercator_Azimuth_Natural_Origin'];\n  var projectionName = typeof P.PROJECTION === \"object\" ? Object.keys(P.PROJECTION)[0] : P.PROJECTION;\n  \n  return 'no_uoff' in P || 'no_off' in P || typeAProjections.indexOf(projectionName) !== -1;\n}\n\n\n/* Initialize the Oblique Mercator  projection\n    ------------------------------------------*/\nexport function init() {  \n  var con, com, cosph0, D, F, H, L, sinph0, p, J, gamma = 0,\n    gamma0, lamc = 0, lam1 = 0, lam2 = 0, phi1 = 0, phi2 = 0, alpha_c = 0, AB;\n  \n  // only Type A uses the no_off or no_uoff property\n  // https://github.com/OSGeo/proj.4/issues/104\n  this.no_off = isTypeA(this);\n  this.no_rot = 'no_rot' in this;\n  \n  var alp = false;\n  if (\"alpha\" in this) {\n    alp = true;\n  }\n\n  var gam = false;\n  if (\"rectified_grid_angle\" in this) {\n    gam = true;\n  }\n\n  if (alp) {\n    alpha_c = this.alpha;\n  }\n  \n  if (gam) {\n    gamma = (this.rectified_grid_angle * D2R);\n  }\n  \n  if (alp || gam) {\n    lamc = this.longc;\n  } else {\n    lam1 = this.long1;\n    phi1 = this.lat1;\n    lam2 = this.long2;\n    phi2 = this.lat2;\n    \n    if (Math.abs(phi1 - phi2) <= TOL || (con = Math.abs(phi1)) <= TOL ||\n        Math.abs(con - HALF_PI) <= TOL || Math.abs(Math.abs(this.lat0) - HALF_PI) <= TOL ||\n        Math.abs(Math.abs(phi2) - HALF_PI) <= TOL) {\n      throw new Error();\n    }\n  }\n  \n  var one_es = 1.0 - this.es;\n  com = Math.sqrt(one_es);\n  \n  if (Math.abs(this.lat0) > EPSLN) {\n    sinph0 = Math.sin(this.lat0);\n    cosph0 = Math.cos(this.lat0);\n    con = 1 - this.es * sinph0 * sinph0;\n    this.B = cosph0 * cosph0;\n    this.B = Math.sqrt(1 + this.es * this.B * this.B / one_es);\n    this.A = this.B * this.k0 * com / con;\n    D = this.B * com / (cosph0 * Math.sqrt(con));\n    F = D * D -1;\n    \n    if (F <= 0) {\n      F = 0;\n    } else {\n      F = Math.sqrt(F);\n      if (this.lat0 < 0) {\n        F = -F;\n      }\n    }\n    \n    this.E = F += D;\n    this.E *= Math.pow(tsfnz(this.e, this.lat0, sinph0), this.B);\n  } else {\n    this.B = 1 / com;\n    this.A = this.k0;\n    this.E = D = F = 1;\n  }\n  \n  if (alp || gam) {\n    if (alp) {\n      gamma0 = Math.asin(Math.sin(alpha_c) / D);\n      if (!gam) {\n        gamma = alpha_c;\n      }\n    } else {\n      gamma0 = gamma;\n      alpha_c = Math.asin(D * Math.sin(gamma0));\n    }\n    this.lam0 = lamc - Math.asin(0.5 * (F - 1 / F) * Math.tan(gamma0)) / this.B;\n  } else {\n    H = Math.pow(tsfnz(this.e, phi1, Math.sin(phi1)), this.B);\n    L = Math.pow(tsfnz(this.e, phi2, Math.sin(phi2)), this.B);\n    F = this.E / H;\n    p = (L - H) / (L + H);\n    J = this.E * this.E;\n    J = (J - L * H) / (J + L * H);\n    con = lam1 - lam2;\n    \n    if (con < -Math.pi) {\n      lam2 -=TWO_PI;\n    } else if (con > Math.pi) {\n      lam2 += TWO_PI;\n    }\n    \n    this.lam0 = adjust_lon(0.5 * (lam1 + lam2) - Math.atan(J * Math.tan(0.5 * this.B * (lam1 - lam2)) / p) / this.B);\n    gamma0 = Math.atan(2 * Math.sin(this.B * adjust_lon(lam1 - this.lam0)) / (F - 1 / F));\n    gamma = alpha_c = Math.asin(D * Math.sin(gamma0));\n  }\n  \n  this.singam = Math.sin(gamma0);\n  this.cosgam = Math.cos(gamma0);\n  this.sinrot = Math.sin(gamma);\n  this.cosrot = Math.cos(gamma);\n  \n  this.rB = 1 / this.B;\n  this.ArB = this.A * this.rB;\n  this.BrA = 1 / this.ArB;\n  AB = this.A * this.B;\n  \n  if (this.no_off) {\n    this.u_0 = 0;\n  } else {\n    this.u_0 = Math.abs(this.ArB * Math.atan(Math.sqrt(D * D - 1) / Math.cos(alpha_c)));\n    \n    if (this.lat0 < 0) {\n      this.u_0 = - this.u_0;\n    }  \n  }\n    \n  F = 0.5 * gamma0;\n  this.v_pole_n = this.ArB * Math.log(Math.tan(FORTPI - F));\n  this.v_pole_s = this.ArB * Math.log(Math.tan(FORTPI + F));\n}\n\n\n/* Oblique Mercator forward equations--mapping lat,long to x,y\n    ----------------------------------------------------------*/\nexport function forward(p) {\n  var coords = {};\n  var S, T, U, V, W, temp, u, v;\n  p.x = p.x - this.lam0;\n  \n  if (Math.abs(Math.abs(p.y) - HALF_PI) > EPSLN) {\n    W = this.E / Math.pow(tsfnz(this.e, p.y, Math.sin(p.y)), this.B);\n    \n    temp = 1 / W;\n    S = 0.5 * (W - temp);\n    T = 0.5 * (W + temp);\n    V = Math.sin(this.B * p.x);\n    U = (S * this.singam - V * this.cosgam) / T;\n        \n    if (Math.abs(Math.abs(U) - 1.0) < EPSLN) {\n      throw new Error();\n    }\n    \n    v = 0.5 * this.ArB * Math.log((1 - U)/(1 + U));\n    temp = Math.cos(this.B * p.x);\n    \n    if (Math.abs(temp) < TOL) {\n      u = this.A * p.x;\n    } else {\n      u = this.ArB * Math.atan2((S * this.cosgam + V * this.singam), temp);\n    }    \n  } else {\n    v = p.y > 0 ? this.v_pole_n : this.v_pole_s;\n    u = this.ArB * p.y;\n  }\n     \n  if (this.no_rot) {\n    coords.x = u;\n    coords.y = v;\n  } else {\n    u -= this.u_0;\n    coords.x = v * this.cosrot + u * this.sinrot;\n    coords.y = u * this.cosrot - v * this.sinrot;\n  }\n  \n  coords.x = (this.a * coords.x + this.x0);\n  coords.y = (this.a * coords.y + this.y0);\n  \n  return coords;\n}\n\nexport function inverse(p) {\n  var u, v, Qp, Sp, Tp, Vp, Up;\n  var coords = {};\n  \n  p.x = (p.x - this.x0) * (1.0 / this.a);\n  p.y = (p.y - this.y0) * (1.0 / this.a);\n\n  if (this.no_rot) {\n    v = p.y;\n    u = p.x;\n  } else {\n    v = p.x * this.cosrot - p.y * this.sinrot;\n    u = p.y * this.cosrot + p.x * this.sinrot + this.u_0;\n  }\n  \n  Qp = Math.exp(-this.BrA * v);\n  Sp = 0.5 * (Qp - 1 / Qp);\n  Tp = 0.5 * (Qp + 1 / Qp);\n  Vp = Math.sin(this.BrA * u);\n  Up = (Vp * this.cosgam + Sp * this.singam) / Tp;\n  \n  if (Math.abs(Math.abs(Up) - 1) < EPSLN) {\n    coords.x = 0;\n    coords.y = Up < 0 ? -HALF_PI : HALF_PI;\n  } else {\n    coords.y = this.E / Math.sqrt((1 + Up) / (1 - Up));\n    coords.y = phi2z(this.e, Math.pow(coords.y, 1 / this.B));\n    \n    if (coords.y === Infinity) {\n      throw new Error();\n    }\n        \n    coords.x = -this.rB * Math.atan2((Sp * this.cosgam - Vp * this.singam), Math.cos(this.BrA * u));\n  }\n  \n  coords.x += this.lam0;\n  \n  return coords;\n}\n\nexport var names = [\"Hotine_Oblique_Mercator\", \"Hotine Oblique Mercator\", \"Hotine_Oblique_Mercator_Azimuth_Natural_Origin\", \"Hotine_Oblique_Mercator_Two_Point_Natural_Origin\", \"Hotine_Oblique_Mercator_Azimuth_Center\", \"Oblique_Mercator\", \"omerc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import msfnz from '../common/msfnz';\nimport tsfnz from '../common/tsfnz';\nimport sign from '../common/sign';\nimport adjust_lon from '../common/adjust_lon';\nimport phi2z from '../common/phi2z';\nimport {HALF_PI, EPSLN} from '../constants/values';\nexport function init() {\n  \n  //double lat0;                    /* the reference latitude               */\n  //double long0;                   /* the reference longitude              */\n  //double lat1;                    /* first standard parallel              */\n  //double lat2;                    /* second standard parallel             */\n  //double r_maj;                   /* major axis                           */\n  //double r_min;                   /* minor axis                           */\n  //double false_east;              /* x offset in meters                   */\n  //double false_north;             /* y offset in meters                   */\n  \n  //the above value can be set with proj4.defs\n  //example: proj4.defs(\"EPSG:2154\",\"+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\");\n\n  if (!this.lat2) {\n    this.lat2 = this.lat1;\n  } //if lat2 is not defined\n  if (!this.k0) {\n    this.k0 = 1;\n  }\n  this.x0 = this.x0 || 0;\n  this.y0 = this.y0 || 0;\n  // Standard Parallels cannot be equal and on opposite sides of the equator\n  if (Math.abs(this.lat1 + this.lat2) < EPSLN) {\n    return;\n  }\n\n  var temp = this.b / this.a;\n  this.e = Math.sqrt(1 - temp * temp);\n\n  var sin1 = Math.sin(this.lat1);\n  var cos1 = Math.cos(this.lat1);\n  var ms1 = msfnz(this.e, sin1, cos1);\n  var ts1 = tsfnz(this.e, this.lat1, sin1);\n\n  var sin2 = Math.sin(this.lat2);\n  var cos2 = Math.cos(this.lat2);\n  var ms2 = msfnz(this.e, sin2, cos2);\n  var ts2 = tsfnz(this.e, this.lat2, sin2);\n\n  var ts0 = tsfnz(this.e, this.lat0, Math.sin(this.lat0));\n\n  if (Math.abs(this.lat1 - this.lat2) > EPSLN) {\n    this.ns = Math.log(ms1 / ms2) / Math.log(ts1 / ts2);\n  }\n  else {\n    this.ns = sin1;\n  }\n  if (isNaN(this.ns)) {\n    this.ns = sin1;\n  }\n  this.f0 = ms1 / (this.ns * Math.pow(ts1, this.ns));\n  this.rh = this.a * this.f0 * Math.pow(ts0, this.ns);\n  if (!this.title) {\n    this.title = \"Lambert Conformal Conic\";\n  }\n}\n\n// Lambert Conformal conic forward equations--mapping lat,long to x,y\n// -----------------------------------------------------------------\nexport function forward(p) {\n\n  var lon = p.x;\n  var lat = p.y;\n\n  // singular cases :\n  if (Math.abs(2 * Math.abs(lat) - Math.PI) <= EPSLN) {\n    lat = sign(lat) * (HALF_PI - 2 * EPSLN);\n  }\n\n  var con = Math.abs(Math.abs(lat) - HALF_PI);\n  var ts, rh1;\n  if (con > EPSLN) {\n    ts = tsfnz(this.e, lat, Math.sin(lat));\n    rh1 = this.a * this.f0 * Math.pow(ts, this.ns);\n  }\n  else {\n    con = lat * this.ns;\n    if (con <= 0) {\n      return null;\n    }\n    rh1 = 0;\n  }\n  var theta = this.ns * adjust_lon(lon - this.long0);\n  p.x = this.k0 * (rh1 * Math.sin(theta)) + this.x0;\n  p.y = this.k0 * (this.rh - rh1 * Math.cos(theta)) + this.y0;\n\n  return p;\n}\n\n// Lambert Conformal Conic inverse equations--mapping x,y to lat/long\n// -----------------------------------------------------------------\nexport function inverse(p) {\n\n  var rh1, con, ts;\n  var lat, lon;\n  var x = (p.x - this.x0) / this.k0;\n  var y = (this.rh - (p.y - this.y0) / this.k0);\n  if (this.ns > 0) {\n    rh1 = Math.sqrt(x * x + y * y);\n    con = 1;\n  }\n  else {\n    rh1 = -Math.sqrt(x * x + y * y);\n    con = -1;\n  }\n  var theta = 0;\n  if (rh1 !== 0) {\n    theta = Math.atan2((con * x), (con * y));\n  }\n  if ((rh1 !== 0) || (this.ns > 0)) {\n    con = 1 / this.ns;\n    ts = Math.pow((rh1 / (this.a * this.f0)), con);\n    lat = phi2z(this.e, ts);\n    if (lat === -9999) {\n      return null;\n    }\n  }\n  else {\n    lat = -HALF_PI;\n  }\n  lon = adjust_lon(theta / this.ns + this.long0);\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\n  \"Lambert Tangential Conformal Conic Projection\",\n  \"Lambert_Conformal_Conic\",\n  \"Lambert_Conformal_Conic_1SP\",\n  \"Lambert_Conformal_Conic_2SP\",\n  \"lcc\"\n];\n\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\n\nexport function init() {\n  this.a = 6377397.155;\n  this.es = 0.006674372230614;\n  this.e = Math.sqrt(this.es);\n  if (!this.lat0) {\n    this.lat0 = 0.863937979737193;\n  }\n  if (!this.long0) {\n    this.long0 = 0.7417649320975901 - 0.308341501185665;\n  }\n  /* if scale not set default to 0.9999 */\n  if (!this.k0) {\n    this.k0 = 0.9999;\n  }\n  this.s45 = 0.785398163397448; /* 45 */\n  this.s90 = 2 * this.s45;\n  this.fi0 = this.lat0;\n  this.e2 = this.es;\n  this.e = Math.sqrt(this.e2);\n  this.alfa = Math.sqrt(1 + (this.e2 * Math.pow(Math.cos(this.fi0), 4)) / (1 - this.e2));\n  this.uq = 1.04216856380474;\n  this.u0 = Math.asin(Math.sin(this.fi0) / this.alfa);\n  this.g = Math.pow((1 + this.e * Math.sin(this.fi0)) / (1 - this.e * Math.sin(this.fi0)), this.alfa * this.e / 2);\n  this.k = Math.tan(this.u0 / 2 + this.s45) / Math.pow(Math.tan(this.fi0 / 2 + this.s45), this.alfa) * this.g;\n  this.k1 = this.k0;\n  this.n0 = this.a * Math.sqrt(1 - this.e2) / (1 - this.e2 * Math.pow(Math.sin(this.fi0), 2));\n  this.s0 = 1.37008346281555;\n  this.n = Math.sin(this.s0);\n  this.ro0 = this.k1 * this.n0 / Math.tan(this.s0);\n  this.ad = this.s90 - this.uq;\n}\n\n/* ellipsoid */\n/* calculate xy from lat/lon */\n/* Constants, identical to inverse transform function */\nexport function forward(p) {\n  var gfi, u, deltav, s, d, eps, ro;\n  var lon = p.x;\n  var lat = p.y;\n  var delta_lon = adjust_lon(lon - this.long0);\n  /* Transformation */\n  gfi = Math.pow(((1 + this.e * Math.sin(lat)) / (1 - this.e * Math.sin(lat))), (this.alfa * this.e / 2));\n  u = 2 * (Math.atan(this.k * Math.pow(Math.tan(lat / 2 + this.s45), this.alfa) / gfi) - this.s45);\n  deltav = -delta_lon * this.alfa;\n  s = Math.asin(Math.cos(this.ad) * Math.sin(u) + Math.sin(this.ad) * Math.cos(u) * Math.cos(deltav));\n  d = Math.asin(Math.cos(u) * Math.sin(deltav) / Math.cos(s));\n  eps = this.n * d;\n  ro = this.ro0 * Math.pow(Math.tan(this.s0 / 2 + this.s45), this.n) / Math.pow(Math.tan(s / 2 + this.s45), this.n);\n  p.y = ro * Math.cos(eps) / 1;\n  p.x = ro * Math.sin(eps) / 1;\n\n  if (!this.czech) {\n    p.y *= -1;\n    p.x *= -1;\n  }\n  return (p);\n}\n\n/* calculate lat/lon from xy */\nexport function inverse(p) {\n  var u, deltav, s, d, eps, ro, fi1;\n  var ok;\n\n  /* Transformation */\n  /* revert y, x*/\n  var tmp = p.x;\n  p.x = p.y;\n  p.y = tmp;\n  if (!this.czech) {\n    p.y *= -1;\n    p.x *= -1;\n  }\n  ro = Math.sqrt(p.x * p.x + p.y * p.y);\n  eps = Math.atan2(p.y, p.x);\n  d = eps / Math.sin(this.s0);\n  s = 2 * (Math.atan(Math.pow(this.ro0 / ro, 1 / this.n) * Math.tan(this.s0 / 2 + this.s45)) - this.s45);\n  u = Math.asin(Math.cos(this.ad) * Math.sin(s) - Math.sin(this.ad) * Math.cos(s) * Math.cos(d));\n  deltav = Math.asin(Math.cos(s) * Math.sin(d) / Math.cos(u));\n  p.x = this.long0 - deltav / this.alfa;\n  fi1 = u;\n  ok = 0;\n  var iter = 0;\n  do {\n    p.y = 2 * (Math.atan(Math.pow(this.k, - 1 / this.alfa) * Math.pow(Math.tan(u / 2 + this.s45), 1 / this.alfa) * Math.pow((1 + this.e * Math.sin(fi1)) / (1 - this.e * Math.sin(fi1)), this.e / 2)) - this.s45);\n    if (Math.abs(fi1 - p.y) < 0.0000000001) {\n      ok = 1;\n    }\n    fi1 = p.y;\n    iter += 1;\n  } while (ok === 0 && iter < 15);\n  if (iter >= 15) {\n    return null;\n  }\n\n  return (p);\n}\n\nexport var names = [\"Krovak\", \"krovak\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","export default function(e0, e1, e2, e3, phi) {\n  return (e0 * phi - e1 * Math.sin(2 * phi) + e2 * Math.sin(4 * phi) - e3 * Math.sin(6 * phi));\n}","export default function(x) {\n  return (1 - 0.25 * x * (1 + x / 16 * (3 + 1.25 * x)));\n}","export default function(x) {\n  return (0.375 * x * (1 + 0.25 * x * (1 + 0.46875 * x)));\n}","export default function(x) {\n  return (0.05859375 * x * x * (1 + 0.75 * x));\n}","export default function(x) {\n  return (x * x * x * (35 / 3072));\n}","export default function(a, e, sinphi) {\n  var temp = e * sinphi;\n  return a / Math.sqrt(1 - temp * temp);\n}","import {HALF_PI} from '../constants/values';\nimport sign from './sign';\n\nexport default function(x) {\n  return (Math.abs(x) < HALF_PI) ? x : (x - (sign(x) * Math.PI));\n}\n","export default function(ml, e0, e1, e2, e3) {\n  var phi;\n  var dphi;\n\n  phi = ml / e0;\n  for (var i = 0; i < 15; i++) {\n    dphi = (ml - (e0 * phi - e1 * Math.sin(2 * phi) + e2 * Math.sin(4 * phi) - e3 * Math.sin(6 * phi))) / (e0 - 2 * e1 * Math.cos(2 * phi) + 4 * e2 * Math.cos(4 * phi) - 6 * e3 * Math.cos(6 * phi));\n    phi += dphi;\n    if (Math.abs(dphi) <= 0.0000000001) {\n      return phi;\n    }\n  }\n\n  //..reportError(\"IMLFN-CONV:Latitude failed to converge after 15 iterations\");\n  return NaN;\n}","import mlfn from '../common/mlfn';\nimport e0fn from '../common/e0fn';\nimport e1fn from '../common/e1fn';\nimport e2fn from '../common/e2fn';\nimport e3fn from '../common/e3fn';\nimport gN from '../common/gN';\nimport adjust_lon from '../common/adjust_lon';\nimport adjust_lat from '../common/adjust_lat';\nimport imlfn from '../common/imlfn';\nimport {HALF_PI, EPSLN} from '../constants/values';\n\nexport function init() {\n  if (!this.sphere) {\n    this.e0 = e0fn(this.es);\n    this.e1 = e1fn(this.es);\n    this.e2 = e2fn(this.es);\n    this.e3 = e3fn(this.es);\n    this.ml0 = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);\n  }\n}\n\n/* Cassini forward equations--mapping lat,long to x,y\n  -----------------------------------------------------------------------*/\nexport function forward(p) {\n\n  /* Forward equations\n      -----------------*/\n  var x, y;\n  var lam = p.x;\n  var phi = p.y;\n  lam = adjust_lon(lam - this.long0);\n\n  if (this.sphere) {\n    x = this.a * Math.asin(Math.cos(phi) * Math.sin(lam));\n    y = this.a * (Math.atan2(Math.tan(phi), Math.cos(lam)) - this.lat0);\n  }\n  else {\n    //ellipsoid\n    var sinphi = Math.sin(phi);\n    var cosphi = Math.cos(phi);\n    var nl = gN(this.a, this.e, sinphi);\n    var tl = Math.tan(phi) * Math.tan(phi);\n    var al = lam * Math.cos(phi);\n    var asq = al * al;\n    var cl = this.es * cosphi * cosphi / (1 - this.es);\n    var ml = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, phi);\n\n    x = nl * al * (1 - asq * tl * (1 / 6 - (8 - tl + 8 * cl) * asq / 120));\n    y = ml - this.ml0 + nl * sinphi / cosphi * asq * (0.5 + (5 - tl + 6 * cl) * asq / 24);\n\n\n  }\n\n  p.x = x + this.x0;\n  p.y = y + this.y0;\n  return p;\n}\n\n/* Inverse equations\n  -----------------*/\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n  var x = p.x / this.a;\n  var y = p.y / this.a;\n  var phi, lam;\n\n  if (this.sphere) {\n    var dd = y + this.lat0;\n    phi = Math.asin(Math.sin(dd) * Math.cos(x));\n    lam = Math.atan2(Math.tan(x), Math.cos(dd));\n  }\n  else {\n    /* ellipsoid */\n    var ml1 = this.ml0 / this.a + y;\n    var phi1 = imlfn(ml1, this.e0, this.e1, this.e2, this.e3);\n    if (Math.abs(Math.abs(phi1) - HALF_PI) <= EPSLN) {\n      p.x = this.long0;\n      p.y = HALF_PI;\n      if (y < 0) {\n        p.y *= -1;\n      }\n      return p;\n    }\n    var nl1 = gN(this.a, this.e, Math.sin(phi1));\n\n    var rl1 = nl1 * nl1 * nl1 / this.a / this.a * (1 - this.es);\n    var tl1 = Math.pow(Math.tan(phi1), 2);\n    var dl = x * this.a / nl1;\n    var dsq = dl * dl;\n    phi = phi1 - nl1 * Math.tan(phi1) / rl1 * dl * dl * (0.5 - (1 + 3 * tl1) * dl * dl / 24);\n    lam = dl * (1 - dsq * (tl1 / 3 + (1 + 3 * tl1) * tl1 * dsq / 15)) / Math.cos(phi1);\n\n  }\n\n  p.x = adjust_lon(lam + this.long0);\n  p.y = adjust_lat(phi);\n  return p;\n\n}\n\nexport var names = [\"Cassini\", \"Cassini_Soldner\", \"cass\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","export default function(eccent, sinphi) {\n  var con;\n  if (eccent > 1.0e-7) {\n    con = eccent * sinphi;\n    return ((1 - eccent * eccent) * (sinphi / (1 - con * con) - (0.5 / eccent) * Math.log((1 - con) / (1 + con))));\n  }\n  else {\n    return (2 * sinphi);\n  }\n}","\nimport {HALF_PI, EPSLN, FORTPI} from '../constants/values';\n\nimport qsfnz from '../common/qsfnz';\nimport adjust_lon from '../common/adjust_lon';\n\n/*\n  reference\n    \"New Equal-Area Map Projections for Noncircular Regions\", John P. Snyder,\n    The American Cartographer, Vol 15, No. 4, October 1988, pp. 341-355.\n  */\n\nexport var S_POLE = 1;\n\nexport var N_POLE = 2;\nexport var EQUIT = 3;\nexport var OBLIQ = 4;\n\n/* Initialize the Lambert Azimuthal Equal Area projection\n  ------------------------------------------------------*/\nexport function init() {\n  var t = Math.abs(this.lat0);\n  if (Math.abs(t - HALF_PI) < EPSLN) {\n    this.mode = this.lat0 < 0 ? this.S_POLE : this.N_POLE;\n  }\n  else if (Math.abs(t) < EPSLN) {\n    this.mode = this.EQUIT;\n  }\n  else {\n    this.mode = this.OBLIQ;\n  }\n  if (this.es > 0) {\n    var sinphi;\n\n    this.qp = qsfnz(this.e, 1);\n    this.mmf = 0.5 / (1 - this.es);\n    this.apa = authset(this.es);\n    switch (this.mode) {\n    case this.N_POLE:\n      this.dd = 1;\n      break;\n    case this.S_POLE:\n      this.dd = 1;\n      break;\n    case this.EQUIT:\n      this.rq = Math.sqrt(0.5 * this.qp);\n      this.dd = 1 / this.rq;\n      this.xmf = 1;\n      this.ymf = 0.5 * this.qp;\n      break;\n    case this.OBLIQ:\n      this.rq = Math.sqrt(0.5 * this.qp);\n      sinphi = Math.sin(this.lat0);\n      this.sinb1 = qsfnz(this.e, sinphi) / this.qp;\n      this.cosb1 = Math.sqrt(1 - this.sinb1 * this.sinb1);\n      this.dd = Math.cos(this.lat0) / (Math.sqrt(1 - this.es * sinphi * sinphi) * this.rq * this.cosb1);\n      this.ymf = (this.xmf = this.rq) / this.dd;\n      this.xmf *= this.dd;\n      break;\n    }\n  }\n  else {\n    if (this.mode === this.OBLIQ) {\n      this.sinph0 = Math.sin(this.lat0);\n      this.cosph0 = Math.cos(this.lat0);\n    }\n  }\n}\n\n/* Lambert Azimuthal Equal Area forward equations--mapping lat,long to x,y\n  -----------------------------------------------------------------------*/\nexport function forward(p) {\n\n  /* Forward equations\n      -----------------*/\n  var x, y, coslam, sinlam, sinphi, q, sinb, cosb, b, cosphi;\n  var lam = p.x;\n  var phi = p.y;\n\n  lam = adjust_lon(lam - this.long0);\n  if (this.sphere) {\n    sinphi = Math.sin(phi);\n    cosphi = Math.cos(phi);\n    coslam = Math.cos(lam);\n    if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {\n      y = (this.mode === this.EQUIT) ? 1 + cosphi * coslam : 1 + this.sinph0 * sinphi + this.cosph0 * cosphi * coslam;\n      if (y <= EPSLN) {\n        return null;\n      }\n      y = Math.sqrt(2 / y);\n      x = y * cosphi * Math.sin(lam);\n      y *= (this.mode === this.EQUIT) ? sinphi : this.cosph0 * sinphi - this.sinph0 * cosphi * coslam;\n    }\n    else if (this.mode === this.N_POLE || this.mode === this.S_POLE) {\n      if (this.mode === this.N_POLE) {\n        coslam = -coslam;\n      }\n      if (Math.abs(phi + this.lat0) < EPSLN) {\n        return null;\n      }\n      y = FORTPI - phi * 0.5;\n      y = 2 * ((this.mode === this.S_POLE) ? Math.cos(y) : Math.sin(y));\n      x = y * Math.sin(lam);\n      y *= coslam;\n    }\n  }\n  else {\n    sinb = 0;\n    cosb = 0;\n    b = 0;\n    coslam = Math.cos(lam);\n    sinlam = Math.sin(lam);\n    sinphi = Math.sin(phi);\n    q = qsfnz(this.e, sinphi);\n    if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {\n      sinb = q / this.qp;\n      cosb = Math.sqrt(1 - sinb * sinb);\n    }\n    switch (this.mode) {\n    case this.OBLIQ:\n      b = 1 + this.sinb1 * sinb + this.cosb1 * cosb * coslam;\n      break;\n    case this.EQUIT:\n      b = 1 + cosb * coslam;\n      break;\n    case this.N_POLE:\n      b = HALF_PI + phi;\n      q = this.qp - q;\n      break;\n    case this.S_POLE:\n      b = phi - HALF_PI;\n      q = this.qp + q;\n      break;\n    }\n    if (Math.abs(b) < EPSLN) {\n      return null;\n    }\n    switch (this.mode) {\n    case this.OBLIQ:\n    case this.EQUIT:\n      b = Math.sqrt(2 / b);\n      if (this.mode === this.OBLIQ) {\n        y = this.ymf * b * (this.cosb1 * sinb - this.sinb1 * cosb * coslam);\n      }\n      else {\n        y = (b = Math.sqrt(2 / (1 + cosb * coslam))) * sinb * this.ymf;\n      }\n      x = this.xmf * b * cosb * sinlam;\n      break;\n    case this.N_POLE:\n    case this.S_POLE:\n      if (q >= 0) {\n        x = (b = Math.sqrt(q)) * sinlam;\n        y = coslam * ((this.mode === this.S_POLE) ? b : -b);\n      }\n      else {\n        x = y = 0;\n      }\n      break;\n    }\n  }\n\n  p.x = this.a * x + this.x0;\n  p.y = this.a * y + this.y0;\n  return p;\n}\n\n/* Inverse equations\n  -----------------*/\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n  var x = p.x / this.a;\n  var y = p.y / this.a;\n  var lam, phi, cCe, sCe, q, rho, ab;\n  if (this.sphere) {\n    var cosz = 0,\n      rh, sinz = 0;\n\n    rh = Math.sqrt(x * x + y * y);\n    phi = rh * 0.5;\n    if (phi > 1) {\n      return null;\n    }\n    phi = 2 * Math.asin(phi);\n    if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {\n      sinz = Math.sin(phi);\n      cosz = Math.cos(phi);\n    }\n    switch (this.mode) {\n    case this.EQUIT:\n      phi = (Math.abs(rh) <= EPSLN) ? 0 : Math.asin(y * sinz / rh);\n      x *= sinz;\n      y = cosz * rh;\n      break;\n    case this.OBLIQ:\n      phi = (Math.abs(rh) <= EPSLN) ? this.lat0 : Math.asin(cosz * this.sinph0 + y * sinz * this.cosph0 / rh);\n      x *= sinz * this.cosph0;\n      y = (cosz - Math.sin(phi) * this.sinph0) * rh;\n      break;\n    case this.N_POLE:\n      y = -y;\n      phi = HALF_PI - phi;\n      break;\n    case this.S_POLE:\n      phi -= HALF_PI;\n      break;\n    }\n    lam = (y === 0 && (this.mode === this.EQUIT || this.mode === this.OBLIQ)) ? 0 : Math.atan2(x, y);\n  }\n  else {\n    ab = 0;\n    if (this.mode === this.OBLIQ || this.mode === this.EQUIT) {\n      x /= this.dd;\n      y *= this.dd;\n      rho = Math.sqrt(x * x + y * y);\n      if (rho < EPSLN) {\n        p.x = this.long0;\n        p.y = this.lat0;\n        return p;\n      }\n      sCe = 2 * Math.asin(0.5 * rho / this.rq);\n      cCe = Math.cos(sCe);\n      x *= (sCe = Math.sin(sCe));\n      if (this.mode === this.OBLIQ) {\n        ab = cCe * this.sinb1 + y * sCe * this.cosb1 / rho;\n        q = this.qp * ab;\n        y = rho * this.cosb1 * cCe - y * this.sinb1 * sCe;\n      }\n      else {\n        ab = y * sCe / rho;\n        q = this.qp * ab;\n        y = rho * cCe;\n      }\n    }\n    else if (this.mode === this.N_POLE || this.mode === this.S_POLE) {\n      if (this.mode === this.N_POLE) {\n        y = -y;\n      }\n      q = (x * x + y * y);\n      if (!q) {\n        p.x = this.long0;\n        p.y = this.lat0;\n        return p;\n      }\n      ab = 1 - q / this.qp;\n      if (this.mode === this.S_POLE) {\n        ab = -ab;\n      }\n    }\n    lam = Math.atan2(x, y);\n    phi = authlat(Math.asin(ab), this.apa);\n  }\n\n  p.x = adjust_lon(this.long0 + lam);\n  p.y = phi;\n  return p;\n}\n\n/* determine latitude from authalic latitude */\nvar P00 = 0.33333333333333333333;\n\nvar P01 = 0.17222222222222222222;\nvar P02 = 0.10257936507936507936;\nvar P10 = 0.06388888888888888888;\nvar P11 = 0.06640211640211640211;\nvar P20 = 0.01641501294219154443;\n\nfunction authset(es) {\n  var t;\n  var APA = [];\n  APA[0] = es * P00;\n  t = es * es;\n  APA[0] += t * P01;\n  APA[1] = t * P10;\n  t *= es;\n  APA[0] += t * P02;\n  APA[1] += t * P11;\n  APA[2] = t * P20;\n  return APA;\n}\n\nfunction authlat(beta, APA) {\n  var t = beta + beta;\n  return (beta + APA[0] * Math.sin(t) + APA[1] * Math.sin(t + t) + APA[2] * Math.sin(t + t + t));\n}\n\nexport var names = [\"Lambert Azimuthal Equal Area\", \"Lambert_Azimuthal_Equal_Area\", \"laea\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names,\n  S_POLE: S_POLE,\n  N_POLE: N_POLE,\n  EQUIT: EQUIT,\n  OBLIQ: OBLIQ\n};\n","export default function(x) {\n  if (Math.abs(x) > 1) {\n    x = (x > 1) ? 1 : -1;\n  }\n  return Math.asin(x);\n}","import msfnz from '../common/msfnz';\nimport qsfnz from '../common/qsfnz';\nimport adjust_lon from '../common/adjust_lon';\nimport asinz from '../common/asinz';\nimport {EPSLN} from '../constants/values';\n\nexport function init() {\n\n  if (Math.abs(this.lat1 + this.lat2) < EPSLN) {\n    return;\n  }\n  this.temp = this.b / this.a;\n  this.es = 1 - Math.pow(this.temp, 2);\n  this.e3 = Math.sqrt(this.es);\n\n  this.sin_po = Math.sin(this.lat1);\n  this.cos_po = Math.cos(this.lat1);\n  this.t1 = this.sin_po;\n  this.con = this.sin_po;\n  this.ms1 = msfnz(this.e3, this.sin_po, this.cos_po);\n  this.qs1 = qsfnz(this.e3, this.sin_po, this.cos_po);\n\n  this.sin_po = Math.sin(this.lat2);\n  this.cos_po = Math.cos(this.lat2);\n  this.t2 = this.sin_po;\n  this.ms2 = msfnz(this.e3, this.sin_po, this.cos_po);\n  this.qs2 = qsfnz(this.e3, this.sin_po, this.cos_po);\n\n  this.sin_po = Math.sin(this.lat0);\n  this.cos_po = Math.cos(this.lat0);\n  this.t3 = this.sin_po;\n  this.qs0 = qsfnz(this.e3, this.sin_po, this.cos_po);\n\n  if (Math.abs(this.lat1 - this.lat2) > EPSLN) {\n    this.ns0 = (this.ms1 * this.ms1 - this.ms2 * this.ms2) / (this.qs2 - this.qs1);\n  }\n  else {\n    this.ns0 = this.con;\n  }\n  this.c = this.ms1 * this.ms1 + this.ns0 * this.qs1;\n  this.rh = this.a * Math.sqrt(this.c - this.ns0 * this.qs0) / this.ns0;\n}\n\n/* Albers Conical Equal Area forward equations--mapping lat,long to x,y\n  -------------------------------------------------------------------*/\nexport function forward(p) {\n\n  var lon = p.x;\n  var lat = p.y;\n\n  this.sin_phi = Math.sin(lat);\n  this.cos_phi = Math.cos(lat);\n\n  var qs = qsfnz(this.e3, this.sin_phi, this.cos_phi);\n  var rh1 = this.a * Math.sqrt(this.c - this.ns0 * qs) / this.ns0;\n  var theta = this.ns0 * adjust_lon(lon - this.long0);\n  var x = rh1 * Math.sin(theta) + this.x0;\n  var y = this.rh - rh1 * Math.cos(theta) + this.y0;\n\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\nexport function inverse(p) {\n  var rh1, qs, con, theta, lon, lat;\n\n  p.x -= this.x0;\n  p.y = this.rh - p.y + this.y0;\n  if (this.ns0 >= 0) {\n    rh1 = Math.sqrt(p.x * p.x + p.y * p.y);\n    con = 1;\n  }\n  else {\n    rh1 = -Math.sqrt(p.x * p.x + p.y * p.y);\n    con = -1;\n  }\n  theta = 0;\n  if (rh1 !== 0) {\n    theta = Math.atan2(con * p.x, con * p.y);\n  }\n  con = rh1 * this.ns0 / this.a;\n  if (this.sphere) {\n    lat = Math.asin((this.c - con * con) / (2 * this.ns0));\n  }\n  else {\n    qs = (this.c - con * con) / this.ns0;\n    lat = this.phi1z(this.e3, qs);\n  }\n\n  lon = adjust_lon(theta / this.ns0 + this.long0);\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\n/* Function to compute phi1, the latitude for the inverse of the\n   Albers Conical Equal-Area projection.\n-------------------------------------------*/\nexport function phi1z(eccent, qs) {\n  var sinphi, cosphi, con, com, dphi;\n  var phi = asinz(0.5 * qs);\n  if (eccent < EPSLN) {\n    return phi;\n  }\n\n  var eccnts = eccent * eccent;\n  for (var i = 1; i <= 25; i++) {\n    sinphi = Math.sin(phi);\n    cosphi = Math.cos(phi);\n    con = eccent * sinphi;\n    com = 1 - con * con;\n    dphi = 0.5 * com * com / cosphi * (qs / (1 - eccnts) - sinphi / com + 0.5 / eccent * Math.log((1 - con) / (1 + con)));\n    phi = phi + dphi;\n    if (Math.abs(dphi) <= 1e-7) {\n      return phi;\n    }\n  }\n  return null;\n}\n\nexport var names = [\"Albers_Conic_Equal_Area\", \"Albers\", \"aea\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names,\n  phi1z: phi1z\n};\n","import adjust_lon from '../common/adjust_lon';\nimport asinz from '../common/asinz';\nimport {EPSLN} from '../constants/values';\n\n/*\n  reference:\n    Wolfram Mathworld \"Gnomonic Projection\"\n    http://mathworld.wolfram.com/GnomonicProjection.html\n    Accessed: 12th November 2009\n  */\nexport function init() {\n\n  /* Place parameters in static storage for common use\n      -------------------------------------------------*/\n  this.sin_p14 = Math.sin(this.lat0);\n  this.cos_p14 = Math.cos(this.lat0);\n  // Approximation for projecting points to the horizon (infinity)\n  this.infinity_dist = 1000 * this.a;\n  this.rc = 1;\n}\n\n/* Gnomonic forward equations--mapping lat,long to x,y\n    ---------------------------------------------------*/\nexport function forward(p) {\n  var sinphi, cosphi; /* sin and cos value        */\n  var dlon; /* delta longitude value      */\n  var coslon; /* cos of longitude        */\n  var ksp; /* scale factor          */\n  var g;\n  var x, y;\n  var lon = p.x;\n  var lat = p.y;\n  /* Forward equations\n      -----------------*/\n  dlon = adjust_lon(lon - this.long0);\n\n  sinphi = Math.sin(lat);\n  cosphi = Math.cos(lat);\n\n  coslon = Math.cos(dlon);\n  g = this.sin_p14 * sinphi + this.cos_p14 * cosphi * coslon;\n  ksp = 1;\n  if ((g > 0) || (Math.abs(g) <= EPSLN)) {\n    x = this.x0 + this.a * ksp * cosphi * Math.sin(dlon) / g;\n    y = this.y0 + this.a * ksp * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon) / g;\n  }\n  else {\n\n    // Point is in the opposing hemisphere and is unprojectable\n    // We still need to return a reasonable point, so we project\n    // to infinity, on a bearing\n    // equivalent to the northern hemisphere equivalent\n    // This is a reasonable approximation for short shapes and lines that\n    // straddle the horizon.\n\n    x = this.x0 + this.infinity_dist * cosphi * Math.sin(dlon);\n    y = this.y0 + this.infinity_dist * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon);\n\n  }\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\nexport function inverse(p) {\n  var rh; /* Rho */\n  var sinc, cosc;\n  var c;\n  var lon, lat;\n\n  /* Inverse equations\n      -----------------*/\n  p.x = (p.x - this.x0) / this.a;\n  p.y = (p.y - this.y0) / this.a;\n\n  p.x /= this.k0;\n  p.y /= this.k0;\n\n  if ((rh = Math.sqrt(p.x * p.x + p.y * p.y))) {\n    c = Math.atan2(rh, this.rc);\n    sinc = Math.sin(c);\n    cosc = Math.cos(c);\n\n    lat = asinz(cosc * this.sin_p14 + (p.y * sinc * this.cos_p14) / rh);\n    lon = Math.atan2(p.x * sinc, rh * this.cos_p14 * cosc - p.y * this.sin_p14 * sinc);\n    lon = adjust_lon(this.long0 + lon);\n  }\n  else {\n    lat = this.phic0;\n    lon = 0;\n  }\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"gnom\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\nimport qsfnz from '../common/qsfnz';\nimport msfnz from '../common/msfnz';\nimport iqsfnz from '../common/iqsfnz';\n\n/*\n  reference:\n    \"Cartographic Projection Procedures for the UNIX Environment-\n    A User's Manual\" by Gerald I. Evenden,\n    USGS Open File Report 90-284and Release 4 Interim Reports (2003)\n*/\nexport function init() {\n  //no-op\n  if (!this.sphere) {\n    this.k0 = msfnz(this.e, Math.sin(this.lat_ts), Math.cos(this.lat_ts));\n  }\n}\n\n/* Cylindrical Equal Area forward equations--mapping lat,long to x,y\n    ------------------------------------------------------------*/\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  var x, y;\n  /* Forward equations\n      -----------------*/\n  var dlon = adjust_lon(lon - this.long0);\n  if (this.sphere) {\n    x = this.x0 + this.a * dlon * Math.cos(this.lat_ts);\n    y = this.y0 + this.a * Math.sin(lat) / Math.cos(this.lat_ts);\n  }\n  else {\n    var qs = qsfnz(this.e, Math.sin(lat));\n    x = this.x0 + this.a * this.k0 * dlon;\n    y = this.y0 + this.a * qs * 0.5 / this.k0;\n  }\n\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\n/* Cylindrical Equal Area inverse equations--mapping x,y to lat/long\n    ------------------------------------------------------------*/\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n  var lon, lat;\n\n  if (this.sphere) {\n    lon = adjust_lon(this.long0 + (p.x / this.a) / Math.cos(this.lat_ts));\n    lat = Math.asin((p.y / this.a) * Math.cos(this.lat_ts));\n  }\n  else {\n    lat = iqsfnz(this.e, 2 * p.y * this.k0 / this.a);\n    lon = adjust_lon(this.long0 + p.x / (this.a * this.k0));\n  }\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"cea\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import {HALF_PI} from '../constants/values';\n\nexport default function(eccent, q) {\n  var temp = 1 - (1 - eccent * eccent) / (2 * eccent) * Math.log((1 - eccent) / (1 + eccent));\n  if (Math.abs(Math.abs(q) - temp) < 1.0E-6) {\n    if (q < 0) {\n      return (-1 * HALF_PI);\n    }\n    else {\n      return HALF_PI;\n    }\n  }\n  //var phi = 0.5* q/(1-eccent*eccent);\n  var phi = Math.asin(0.5 * q);\n  var dphi;\n  var sin_phi;\n  var cos_phi;\n  var con;\n  for (var i = 0; i < 30; i++) {\n    sin_phi = Math.sin(phi);\n    cos_phi = Math.cos(phi);\n    con = eccent * sin_phi;\n    dphi = Math.pow(1 - con * con, 2) / (2 * cos_phi) * (q / (1 - eccent * eccent) - sin_phi / (1 - con * con) + 0.5 / eccent * Math.log((1 - con) / (1 + con)));\n    phi += dphi;\n    if (Math.abs(dphi) <= 0.0000000001) {\n      return phi;\n    }\n  }\n\n  //console.log(\"IQSFN-CONV:Latitude failed to converge after 30 iterations\");\n  return NaN;\n}\n","import adjust_lon from '../common/adjust_lon';\nimport adjust_lat from '../common/adjust_lat';\n\nexport function init() {\n\n  this.x0 = this.x0 || 0;\n  this.y0 = this.y0 || 0;\n  this.lat0 = this.lat0 || 0;\n  this.long0 = this.long0 || 0;\n  this.lat_ts = this.lat_ts || 0;\n  this.title = this.title || \"Equidistant Cylindrical (Plate Carre)\";\n\n  this.rc = Math.cos(this.lat_ts);\n}\n\n// forward equations--mapping lat,long to x,y\n// -----------------------------------------------------------------\nexport function forward(p) {\n\n  var lon = p.x;\n  var lat = p.y;\n\n  var dlon = adjust_lon(lon - this.long0);\n  var dlat = adjust_lat(lat - this.lat0);\n  p.x = this.x0 + (this.a * dlon * this.rc);\n  p.y = this.y0 + (this.a * dlat);\n  return p;\n}\n\n// inverse equations--mapping x,y to lat/long\n// -----------------------------------------------------------------\nexport function inverse(p) {\n\n  var x = p.x;\n  var y = p.y;\n\n  p.x = adjust_lon(this.long0 + ((x - this.x0) / (this.a * this.rc)));\n  p.y = adjust_lat(this.lat0 + ((y - this.y0) / (this.a)));\n  return p;\n}\n\nexport var names = [\"Equirectangular\", \"Equidistant_Cylindrical\", \"eqc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import e0fn from '../common/e0fn';\nimport e1fn from '../common/e1fn';\nimport e2fn from '../common/e2fn';\nimport e3fn from '../common/e3fn';\nimport adjust_lon from '../common/adjust_lon';\nimport adjust_lat from '../common/adjust_lat';\nimport mlfn from '../common/mlfn';\nimport {EPSLN} from '../constants/values';\n\nimport gN from '../common/gN';\nvar MAX_ITER = 20;\n\nexport function init() {\n  /* Place parameters in static storage for common use\n      -------------------------------------------------*/\n  this.temp = this.b / this.a;\n  this.es = 1 - Math.pow(this.temp, 2); // devait etre dans tmerc.js mais n y est pas donc je commente sinon retour de valeurs nulles\n  this.e = Math.sqrt(this.es);\n  this.e0 = e0fn(this.es);\n  this.e1 = e1fn(this.es);\n  this.e2 = e2fn(this.es);\n  this.e3 = e3fn(this.es);\n  this.ml0 = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0); //si que des zeros le calcul ne se fait pas\n}\n\n/* Polyconic forward equations--mapping lat,long to x,y\n    ---------------------------------------------------*/\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  var x, y, el;\n  var dlon = adjust_lon(lon - this.long0);\n  el = dlon * Math.sin(lat);\n  if (this.sphere) {\n    if (Math.abs(lat) <= EPSLN) {\n      x = this.a * dlon;\n      y = -1 * this.a * this.lat0;\n    }\n    else {\n      x = this.a * Math.sin(el) / Math.tan(lat);\n      y = this.a * (adjust_lat(lat - this.lat0) + (1 - Math.cos(el)) / Math.tan(lat));\n    }\n  }\n  else {\n    if (Math.abs(lat) <= EPSLN) {\n      x = this.a * dlon;\n      y = -1 * this.ml0;\n    }\n    else {\n      var nl = gN(this.a, this.e, Math.sin(lat)) / Math.tan(lat);\n      x = nl * Math.sin(el);\n      y = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, lat) - this.ml0 + nl * (1 - Math.cos(el));\n    }\n\n  }\n  p.x = x + this.x0;\n  p.y = y + this.y0;\n  return p;\n}\n\n/* Inverse equations\n  -----------------*/\nexport function inverse(p) {\n  var lon, lat, x, y, i;\n  var al, bl;\n  var phi, dphi;\n  x = p.x - this.x0;\n  y = p.y - this.y0;\n\n  if (this.sphere) {\n    if (Math.abs(y + this.a * this.lat0) <= EPSLN) {\n      lon = adjust_lon(x / this.a + this.long0);\n      lat = 0;\n    }\n    else {\n      al = this.lat0 + y / this.a;\n      bl = x * x / this.a / this.a + al * al;\n      phi = al;\n      var tanphi;\n      for (i = MAX_ITER; i; --i) {\n        tanphi = Math.tan(phi);\n        dphi = -1 * (al * (phi * tanphi + 1) - phi - 0.5 * (phi * phi + bl) * tanphi) / ((phi - al) / tanphi - 1);\n        phi += dphi;\n        if (Math.abs(dphi) <= EPSLN) {\n          lat = phi;\n          break;\n        }\n      }\n      lon = adjust_lon(this.long0 + (Math.asin(x * Math.tan(phi) / this.a)) / Math.sin(lat));\n    }\n  }\n  else {\n    if (Math.abs(y + this.ml0) <= EPSLN) {\n      lat = 0;\n      lon = adjust_lon(this.long0 + x / this.a);\n    }\n    else {\n\n      al = (this.ml0 + y) / this.a;\n      bl = x * x / this.a / this.a + al * al;\n      phi = al;\n      var cl, mln, mlnp, ma;\n      var con;\n      for (i = MAX_ITER; i; --i) {\n        con = this.e * Math.sin(phi);\n        cl = Math.sqrt(1 - con * con) * Math.tan(phi);\n        mln = this.a * mlfn(this.e0, this.e1, this.e2, this.e3, phi);\n        mlnp = this.e0 - 2 * this.e1 * Math.cos(2 * phi) + 4 * this.e2 * Math.cos(4 * phi) - 6 * this.e3 * Math.cos(6 * phi);\n        ma = mln / this.a;\n        dphi = (al * (cl * ma + 1) - ma - 0.5 * cl * (ma * ma + bl)) / (this.es * Math.sin(2 * phi) * (ma * ma + bl - 2 * al * ma) / (4 * cl) + (al - ma) * (cl * mlnp - 2 / Math.sin(2 * phi)) - mlnp);\n        phi -= dphi;\n        if (Math.abs(dphi) <= EPSLN) {\n          lat = phi;\n          break;\n        }\n      }\n\n      //lat=phi4z(this.e,this.e0,this.e1,this.e2,this.e3,al,bl,0,0);\n      cl = Math.sqrt(1 - this.es * Math.pow(Math.sin(lat), 2)) * Math.tan(lat);\n      lon = adjust_lon(this.long0 + Math.asin(x * cl / this.a) / Math.sin(lat));\n    }\n  }\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Polyconic\", \"poly\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import {SEC_TO_RAD} from '../constants/values';\n\n/*\n  reference\n    Department of Land and Survey Technical Circular 1973/32\n      http://www.linz.govt.nz/docs/miscellaneous/nz-map-definition.pdf\n    OSG Technical Report 4.1\n      http://www.linz.govt.nz/docs/miscellaneous/nzmg.pdf\n  */\n\n/**\n * iterations: Number of iterations to refine inverse transform.\n *     0 -> km accuracy\n *     1 -> m accuracy -- suitable for most mapping applications\n *     2 -> mm accuracy\n */\nexport var iterations = 1;\n\nexport function init() {\n  this.A = [];\n  this.A[1] = 0.6399175073;\n  this.A[2] = -0.1358797613;\n  this.A[3] = 0.063294409;\n  this.A[4] = -0.02526853;\n  this.A[5] = 0.0117879;\n  this.A[6] = -0.0055161;\n  this.A[7] = 0.0026906;\n  this.A[8] = -0.001333;\n  this.A[9] = 0.00067;\n  this.A[10] = -0.00034;\n\n  this.B_re = [];\n  this.B_im = [];\n  this.B_re[1] = 0.7557853228;\n  this.B_im[1] = 0;\n  this.B_re[2] = 0.249204646;\n  this.B_im[2] = 0.003371507;\n  this.B_re[3] = -0.001541739;\n  this.B_im[3] = 0.041058560;\n  this.B_re[4] = -0.10162907;\n  this.B_im[4] = 0.01727609;\n  this.B_re[5] = -0.26623489;\n  this.B_im[5] = -0.36249218;\n  this.B_re[6] = -0.6870983;\n  this.B_im[6] = -1.1651967;\n\n  this.C_re = [];\n  this.C_im = [];\n  this.C_re[1] = 1.3231270439;\n  this.C_im[1] = 0;\n  this.C_re[2] = -0.577245789;\n  this.C_im[2] = -0.007809598;\n  this.C_re[3] = 0.508307513;\n  this.C_im[3] = -0.112208952;\n  this.C_re[4] = -0.15094762;\n  this.C_im[4] = 0.18200602;\n  this.C_re[5] = 1.01418179;\n  this.C_im[5] = 1.64497696;\n  this.C_re[6] = 1.9660549;\n  this.C_im[6] = 2.5127645;\n\n  this.D = [];\n  this.D[1] = 1.5627014243;\n  this.D[2] = 0.5185406398;\n  this.D[3] = -0.03333098;\n  this.D[4] = -0.1052906;\n  this.D[5] = -0.0368594;\n  this.D[6] = 0.007317;\n  this.D[7] = 0.01220;\n  this.D[8] = 0.00394;\n  this.D[9] = -0.0013;\n}\n\n/**\n    New Zealand Map Grid Forward  - long/lat to x/y\n    long/lat in radians\n  */\nexport function forward(p) {\n  var n;\n  var lon = p.x;\n  var lat = p.y;\n\n  var delta_lat = lat - this.lat0;\n  var delta_lon = lon - this.long0;\n\n  // 1. Calculate d_phi and d_psi    ...                          // and d_lambda\n  // For this algorithm, delta_latitude is in seconds of arc x 10-5, so we need to scale to those units. Longitude is radians.\n  var d_phi = delta_lat / SEC_TO_RAD * 1E-5;\n  var d_lambda = delta_lon;\n  var d_phi_n = 1; // d_phi^0\n\n  var d_psi = 0;\n  for (n = 1; n <= 10; n++) {\n    d_phi_n = d_phi_n * d_phi;\n    d_psi = d_psi + this.A[n] * d_phi_n;\n  }\n\n  // 2. Calculate theta\n  var th_re = d_psi;\n  var th_im = d_lambda;\n\n  // 3. Calculate z\n  var th_n_re = 1;\n  var th_n_im = 0; // theta^0\n  var th_n_re1;\n  var th_n_im1;\n\n  var z_re = 0;\n  var z_im = 0;\n  for (n = 1; n <= 6; n++) {\n    th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n    th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n    th_n_re = th_n_re1;\n    th_n_im = th_n_im1;\n    z_re = z_re + this.B_re[n] * th_n_re - this.B_im[n] * th_n_im;\n    z_im = z_im + this.B_im[n] * th_n_re + this.B_re[n] * th_n_im;\n  }\n\n  // 4. Calculate easting and northing\n  p.x = (z_im * this.a) + this.x0;\n  p.y = (z_re * this.a) + this.y0;\n\n  return p;\n}\n\n/**\n    New Zealand Map Grid Inverse  -  x/y to long/lat\n  */\nexport function inverse(p) {\n  var n;\n  var x = p.x;\n  var y = p.y;\n\n  var delta_x = x - this.x0;\n  var delta_y = y - this.y0;\n\n  // 1. Calculate z\n  var z_re = delta_y / this.a;\n  var z_im = delta_x / this.a;\n\n  // 2a. Calculate theta - first approximation gives km accuracy\n  var z_n_re = 1;\n  var z_n_im = 0; // z^0\n  var z_n_re1;\n  var z_n_im1;\n\n  var th_re = 0;\n  var th_im = 0;\n  for (n = 1; n <= 6; n++) {\n    z_n_re1 = z_n_re * z_re - z_n_im * z_im;\n    z_n_im1 = z_n_im * z_re + z_n_re * z_im;\n    z_n_re = z_n_re1;\n    z_n_im = z_n_im1;\n    th_re = th_re + this.C_re[n] * z_n_re - this.C_im[n] * z_n_im;\n    th_im = th_im + this.C_im[n] * z_n_re + this.C_re[n] * z_n_im;\n  }\n\n  // 2b. Iterate to refine the accuracy of the calculation\n  //        0 iterations gives km accuracy\n  //        1 iteration gives m accuracy -- good enough for most mapping applications\n  //        2 iterations bives mm accuracy\n  for (var i = 0; i < this.iterations; i++) {\n    var th_n_re = th_re;\n    var th_n_im = th_im;\n    var th_n_re1;\n    var th_n_im1;\n\n    var num_re = z_re;\n    var num_im = z_im;\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      num_re = num_re + (n - 1) * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      num_im = num_im + (n - 1) * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    }\n\n    th_n_re = 1;\n    th_n_im = 0;\n    var den_re = this.B_re[1];\n    var den_im = this.B_im[1];\n    for (n = 2; n <= 6; n++) {\n      th_n_re1 = th_n_re * th_re - th_n_im * th_im;\n      th_n_im1 = th_n_im * th_re + th_n_re * th_im;\n      th_n_re = th_n_re1;\n      th_n_im = th_n_im1;\n      den_re = den_re + n * (this.B_re[n] * th_n_re - this.B_im[n] * th_n_im);\n      den_im = den_im + n * (this.B_im[n] * th_n_re + this.B_re[n] * th_n_im);\n    }\n\n    // Complex division\n    var den2 = den_re * den_re + den_im * den_im;\n    th_re = (num_re * den_re + num_im * den_im) / den2;\n    th_im = (num_im * den_re - num_re * den_im) / den2;\n  }\n\n  // 3. Calculate d_phi              ...                                    // and d_lambda\n  var d_psi = th_re;\n  var d_lambda = th_im;\n  var d_psi_n = 1; // d_psi^0\n\n  var d_phi = 0;\n  for (n = 1; n <= 9; n++) {\n    d_psi_n = d_psi_n * d_psi;\n    d_phi = d_phi + this.D[n] * d_psi_n;\n  }\n\n  // 4. Calculate latitude and longitude\n  // d_phi is calcuated in second of arc * 10^-5, so we need to scale back to radians. d_lambda is in radians.\n  var lat = this.lat0 + (d_phi * SEC_TO_RAD * 1E5);\n  var lon = this.long0 + d_lambda;\n\n  p.x = lon;\n  p.y = lat;\n\n  return p;\n}\n\nexport var names = [\"New_Zealand_Map_Grid\", \"nzmg\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\n\n/*\n  reference\n    \"New Equal-Area Map Projections for Noncircular Regions\", John P. Snyder,\n    The American Cartographer, Vol 15, No. 4, October 1988, pp. 341-355.\n  */\n\n\n/* Initialize the Miller Cylindrical projection\n  -------------------------------------------*/\nexport function init() {\n  //no-op\n}\n\n/* Miller Cylindrical forward equations--mapping lat,long to x,y\n    ------------------------------------------------------------*/\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  /* Forward equations\n      -----------------*/\n  var dlon = adjust_lon(lon - this.long0);\n  var x = this.x0 + this.a * dlon;\n  var y = this.y0 + this.a * Math.log(Math.tan((Math.PI / 4) + (lat / 2.5))) * 1.25;\n\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\n/* Miller Cylindrical inverse equations--mapping x,y to lat/long\n    ------------------------------------------------------------*/\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n\n  var lon = adjust_lon(this.long0 + p.x / this.a);\n  var lat = 2.5 * (Math.atan(Math.exp(0.8 * p.y / this.a)) - Math.PI / 4);\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Miller_Cylindrical\", \"mill\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\nimport adjust_lat from '../common/adjust_lat';\nimport pj_enfn from '../common/pj_enfn';\nvar MAX_ITER = 20;\nimport pj_mlfn from '../common/pj_mlfn';\nimport pj_inv_mlfn from '../common/pj_inv_mlfn';\nimport {EPSLN, HALF_PI} from '../constants/values';\n\nimport asinz from '../common/asinz';\n\n\nexport function init() {\n  /* Place parameters in static storage for common use\n    -------------------------------------------------*/\n\n\n  if (!this.sphere) {\n    this.en = pj_enfn(this.es);\n  }\n  else {\n    this.n = 1;\n    this.m = 0;\n    this.es = 0;\n    this.C_y = Math.sqrt((this.m + 1) / this.n);\n    this.C_x = this.C_y / (this.m + 1);\n  }\n\n}\n\n/* Sinusoidal forward equations--mapping lat,long to x,y\n  -----------------------------------------------------*/\nexport function forward(p) {\n  var x, y;\n  var lon = p.x;\n  var lat = p.y;\n  /* Forward equations\n    -----------------*/\n  lon = adjust_lon(lon - this.long0);\n\n  if (this.sphere) {\n    if (!this.m) {\n      lat = this.n !== 1 ? Math.asin(this.n * Math.sin(lat)) : lat;\n    }\n    else {\n      var k = this.n * Math.sin(lat);\n      for (var i = MAX_ITER; i; --i) {\n        var V = (this.m * lat + Math.sin(lat) - k) / (this.m + Math.cos(lat));\n        lat -= V;\n        if (Math.abs(V) < EPSLN) {\n          break;\n        }\n      }\n    }\n    x = this.a * this.C_x * lon * (this.m + Math.cos(lat));\n    y = this.a * this.C_y * lat;\n\n  }\n  else {\n\n    var s = Math.sin(lat);\n    var c = Math.cos(lat);\n    y = this.a * pj_mlfn(lat, s, c, this.en);\n    x = this.a * lon * c / Math.sqrt(1 - this.es * s * s);\n  }\n\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\nexport function inverse(p) {\n  var lat, temp, lon, s;\n\n  p.x -= this.x0;\n  lon = p.x / this.a;\n  p.y -= this.y0;\n  lat = p.y / this.a;\n\n  if (this.sphere) {\n    lat /= this.C_y;\n    lon = lon / (this.C_x * (this.m + Math.cos(lat)));\n    if (this.m) {\n      lat = asinz((this.m * lat + Math.sin(lat)) / this.n);\n    }\n    else if (this.n !== 1) {\n      lat = asinz(Math.sin(lat) / this.n);\n    }\n    lon = adjust_lon(lon + this.long0);\n    lat = adjust_lat(lat);\n  }\n  else {\n    lat = pj_inv_mlfn(p.y / this.a, this.es, this.en);\n    s = Math.abs(lat);\n    if (s < HALF_PI) {\n      s = Math.sin(lat);\n      temp = this.long0 + p.x * Math.sqrt(1 - this.es * s * s) / (this.a * Math.cos(lat));\n      //temp = this.long0 + p.x / (this.a * Math.cos(lat));\n      lon = adjust_lon(temp);\n    }\n    else if ((s - EPSLN) < HALF_PI) {\n      lon = this.long0;\n    }\n  }\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Sinusoidal\", \"sinu\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\nexport function init() {}\nimport {EPSLN} from '../constants/values';\n/* Mollweide forward equations--mapping lat,long to x,y\n    ----------------------------------------------------*/\nexport function forward(p) {\n\n  /* Forward equations\n      -----------------*/\n  var lon = p.x;\n  var lat = p.y;\n\n  var delta_lon = adjust_lon(lon - this.long0);\n  var theta = lat;\n  var con = Math.PI * Math.sin(lat);\n\n  /* Iterate using the Newton-Raphson method to find theta\n      -----------------------------------------------------*/\n  while (true) {\n    var delta_theta = -(theta + Math.sin(theta) - con) / (1 + Math.cos(theta));\n    theta += delta_theta;\n    if (Math.abs(delta_theta) < EPSLN) {\n      break;\n    }\n  }\n  theta /= 2;\n\n  /* If the latitude is 90 deg, force the x coordinate to be \"0 + false easting\"\n       this is done here because of precision problems with \"cos(theta)\"\n       --------------------------------------------------------------------------*/\n  if (Math.PI / 2 - Math.abs(lat) < EPSLN) {\n    delta_lon = 0;\n  }\n  var x = 0.900316316158 * this.a * delta_lon * Math.cos(theta) + this.x0;\n  var y = 1.4142135623731 * this.a * Math.sin(theta) + this.y0;\n\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\nexport function inverse(p) {\n  var theta;\n  var arg;\n\n  /* Inverse equations\n      -----------------*/\n  p.x -= this.x0;\n  p.y -= this.y0;\n  arg = p.y / (1.4142135623731 * this.a);\n\n  /* Because of division by zero problems, 'arg' can not be 1.  Therefore\n       a number very close to one is used instead.\n       -------------------------------------------------------------------*/\n  if (Math.abs(arg) > 0.999999999999) {\n    arg = 0.999999999999;\n  }\n  theta = Math.asin(arg);\n  var lon = adjust_lon(this.long0 + (p.x / (0.900316316158 * this.a * Math.cos(theta))));\n  if (lon < (-Math.PI)) {\n    lon = -Math.PI;\n  }\n  if (lon > Math.PI) {\n    lon = Math.PI;\n  }\n  arg = (2 * theta + Math.sin(2 * theta)) / Math.PI;\n  if (Math.abs(arg) > 1) {\n    arg = 1;\n  }\n  var lat = Math.asin(arg);\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Mollweide\", \"moll\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import e0fn from '../common/e0fn';\nimport e1fn from '../common/e1fn';\nimport e2fn from '../common/e2fn';\nimport e3fn from '../common/e3fn';\nimport msfnz from '../common/msfnz';\nimport mlfn from '../common/mlfn';\nimport adjust_lon from '../common/adjust_lon';\nimport adjust_lat from '../common/adjust_lat';\nimport imlfn from '../common/imlfn';\nimport {EPSLN} from '../constants/values';\n\nexport function init() {\n\n  /* Place parameters in static storage for common use\n      -------------------------------------------------*/\n  // Standard Parallels cannot be equal and on opposite sides of the equator\n  if (Math.abs(this.lat1 + this.lat2) < EPSLN) {\n    return;\n  }\n  this.lat2 = this.lat2 || this.lat1;\n  this.temp = this.b / this.a;\n  this.es = 1 - Math.pow(this.temp, 2);\n  this.e = Math.sqrt(this.es);\n  this.e0 = e0fn(this.es);\n  this.e1 = e1fn(this.es);\n  this.e2 = e2fn(this.es);\n  this.e3 = e3fn(this.es);\n\n  this.sinphi = Math.sin(this.lat1);\n  this.cosphi = Math.cos(this.lat1);\n\n  this.ms1 = msfnz(this.e, this.sinphi, this.cosphi);\n  this.ml1 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat1);\n\n  if (Math.abs(this.lat1 - this.lat2) < EPSLN) {\n    this.ns = this.sinphi;\n  }\n  else {\n    this.sinphi = Math.sin(this.lat2);\n    this.cosphi = Math.cos(this.lat2);\n    this.ms2 = msfnz(this.e, this.sinphi, this.cosphi);\n    this.ml2 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat2);\n    this.ns = (this.ms1 - this.ms2) / (this.ml2 - this.ml1);\n  }\n  this.g = this.ml1 + this.ms1 / this.ns;\n  this.ml0 = mlfn(this.e0, this.e1, this.e2, this.e3, this.lat0);\n  this.rh = this.a * (this.g - this.ml0);\n}\n\n/* Equidistant Conic forward equations--mapping lat,long to x,y\n  -----------------------------------------------------------*/\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  var rh1;\n\n  /* Forward equations\n      -----------------*/\n  if (this.sphere) {\n    rh1 = this.a * (this.g - lat);\n  }\n  else {\n    var ml = mlfn(this.e0, this.e1, this.e2, this.e3, lat);\n    rh1 = this.a * (this.g - ml);\n  }\n  var theta = this.ns * adjust_lon(lon - this.long0);\n  var x = this.x0 + rh1 * Math.sin(theta);\n  var y = this.y0 + this.rh - rh1 * Math.cos(theta);\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\n/* Inverse equations\n  -----------------*/\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y = this.rh - p.y + this.y0;\n  var con, rh1, lat, lon;\n  if (this.ns >= 0) {\n    rh1 = Math.sqrt(p.x * p.x + p.y * p.y);\n    con = 1;\n  }\n  else {\n    rh1 = -Math.sqrt(p.x * p.x + p.y * p.y);\n    con = -1;\n  }\n  var theta = 0;\n  if (rh1 !== 0) {\n    theta = Math.atan2(con * p.x, con * p.y);\n  }\n\n  if (this.sphere) {\n    lon = adjust_lon(this.long0 + theta / this.ns);\n    lat = adjust_lat(this.g - rh1 / this.a);\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n  else {\n    var ml = this.g - rh1 / this.a;\n    lat = imlfn(ml, this.e0, this.e1, this.e2, this.e3);\n    lon = adjust_lon(this.long0 + theta / this.ns);\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n\n}\n\nexport var names = [\"Equidistant_Conic\", \"eqdc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\n\nimport {HALF_PI, EPSLN} from '../constants/values';\n\nimport asinz from '../common/asinz';\n\n/* Initialize the Van Der Grinten projection\n  ----------------------------------------*/\nexport function init() {\n  //this.R = 6370997; //Radius of earth\n  this.R = this.a;\n}\n\nexport function forward(p) {\n\n  var lon = p.x;\n  var lat = p.y;\n\n  /* Forward equations\n    -----------------*/\n  var dlon = adjust_lon(lon - this.long0);\n  var x, y;\n\n  if (Math.abs(lat) <= EPSLN) {\n    x = this.x0 + this.R * dlon;\n    y = this.y0;\n  }\n  var theta = asinz(2 * Math.abs(lat / Math.PI));\n  if ((Math.abs(dlon) <= EPSLN) || (Math.abs(Math.abs(lat) - HALF_PI) <= EPSLN)) {\n    x = this.x0;\n    if (lat >= 0) {\n      y = this.y0 + Math.PI * this.R * Math.tan(0.5 * theta);\n    }\n    else {\n      y = this.y0 + Math.PI * this.R * -Math.tan(0.5 * theta);\n    }\n    //  return(OK);\n  }\n  var al = 0.5 * Math.abs((Math.PI / dlon) - (dlon / Math.PI));\n  var asq = al * al;\n  var sinth = Math.sin(theta);\n  var costh = Math.cos(theta);\n\n  var g = costh / (sinth + costh - 1);\n  var gsq = g * g;\n  var m = g * (2 / sinth - 1);\n  var msq = m * m;\n  var con = Math.PI * this.R * (al * (g - msq) + Math.sqrt(asq * (g - msq) * (g - msq) - (msq + asq) * (gsq - msq))) / (msq + asq);\n  if (dlon < 0) {\n    con = -con;\n  }\n  x = this.x0 + con;\n  //con = Math.abs(con / (Math.PI * this.R));\n  var q = asq + g;\n  con = Math.PI * this.R * (m * q - al * Math.sqrt((msq + asq) * (asq + 1) - q * q)) / (msq + asq);\n  if (lat >= 0) {\n    //y = this.y0 + Math.PI * this.R * Math.sqrt(1 - con * con - 2 * al * con);\n    y = this.y0 + con;\n  }\n  else {\n    //y = this.y0 - Math.PI * this.R * Math.sqrt(1 - con * con - 2 * al * con);\n    y = this.y0 - con;\n  }\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\n/* Van Der Grinten inverse equations--mapping x,y to lat/long\n  ---------------------------------------------------------*/\nexport function inverse(p) {\n  var lon, lat;\n  var xx, yy, xys, c1, c2, c3;\n  var a1;\n  var m1;\n  var con;\n  var th1;\n  var d;\n\n  /* inverse equations\n    -----------------*/\n  p.x -= this.x0;\n  p.y -= this.y0;\n  con = Math.PI * this.R;\n  xx = p.x / con;\n  yy = p.y / con;\n  xys = xx * xx + yy * yy;\n  c1 = -Math.abs(yy) * (1 + xys);\n  c2 = c1 - 2 * yy * yy + xx * xx;\n  c3 = -2 * c1 + 1 + 2 * yy * yy + xys * xys;\n  d = yy * yy / c3 + (2 * c2 * c2 * c2 / c3 / c3 / c3 - 9 * c1 * c2 / c3 / c3) / 27;\n  a1 = (c1 - c2 * c2 / 3 / c3) / c3;\n  m1 = 2 * Math.sqrt(-a1 / 3);\n  con = ((3 * d) / a1) / m1;\n  if (Math.abs(con) > 1) {\n    if (con >= 0) {\n      con = 1;\n    }\n    else {\n      con = -1;\n    }\n  }\n  th1 = Math.acos(con) / 3;\n  if (p.y >= 0) {\n    lat = (-m1 * Math.cos(th1 + Math.PI / 3) - c2 / 3 / c3) * Math.PI;\n  }\n  else {\n    lat = -(-m1 * Math.cos(th1 + Math.PI / 3) - c2 / 3 / c3) * Math.PI;\n  }\n\n  if (Math.abs(xx) < EPSLN) {\n    lon = this.long0;\n  }\n  else {\n    lon = adjust_lon(this.long0 + Math.PI * (xys - 1 + Math.sqrt(1 + 2 * (xx * xx - yy * yy) + xys * xys)) / 2 / xx);\n  }\n\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"Van_der_Grinten_I\", \"VanDerGrinten\", \"vandg\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\nimport {HALF_PI, EPSLN} from '../constants/values';\n\nimport mlfn from '../common/mlfn';\nimport e0fn from '../common/e0fn';\nimport e1fn from '../common/e1fn';\nimport e2fn from '../common/e2fn';\nimport e3fn from '../common/e3fn';\nimport gN from '../common/gN';\nimport asinz from '../common/asinz';\nimport imlfn from '../common/imlfn';\n\n\n\nexport function init() {\n  this.sin_p12 = Math.sin(this.lat0);\n  this.cos_p12 = Math.cos(this.lat0);\n}\n\nexport function forward(p) {\n  var lon = p.x;\n  var lat = p.y;\n  var sinphi = Math.sin(p.y);\n  var cosphi = Math.cos(p.y);\n  var dlon = adjust_lon(lon - this.long0);\n  var e0, e1, e2, e3, Mlp, Ml, tanphi, Nl1, Nl, psi, Az, G, H, GH, Hs, c, kp, cos_c, s, s2, s3, s4, s5;\n  if (this.sphere) {\n    if (Math.abs(this.sin_p12 - 1) <= EPSLN) {\n      //North Pole case\n      p.x = this.x0 + this.a * (HALF_PI - lat) * Math.sin(dlon);\n      p.y = this.y0 - this.a * (HALF_PI - lat) * Math.cos(dlon);\n      return p;\n    }\n    else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {\n      //South Pole case\n      p.x = this.x0 + this.a * (HALF_PI + lat) * Math.sin(dlon);\n      p.y = this.y0 + this.a * (HALF_PI + lat) * Math.cos(dlon);\n      return p;\n    }\n    else {\n      //default case\n      cos_c = this.sin_p12 * sinphi + this.cos_p12 * cosphi * Math.cos(dlon);\n      c = Math.acos(cos_c);\n      kp = c ? c / Math.sin(c) : 1;\n      p.x = this.x0 + this.a * kp * cosphi * Math.sin(dlon);\n      p.y = this.y0 + this.a * kp * (this.cos_p12 * sinphi - this.sin_p12 * cosphi * Math.cos(dlon));\n      return p;\n    }\n  }\n  else {\n    e0 = e0fn(this.es);\n    e1 = e1fn(this.es);\n    e2 = e2fn(this.es);\n    e3 = e3fn(this.es);\n    if (Math.abs(this.sin_p12 - 1) <= EPSLN) {\n      //North Pole case\n      Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);\n      Ml = this.a * mlfn(e0, e1, e2, e3, lat);\n      p.x = this.x0 + (Mlp - Ml) * Math.sin(dlon);\n      p.y = this.y0 - (Mlp - Ml) * Math.cos(dlon);\n      return p;\n    }\n    else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {\n      //South Pole case\n      Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);\n      Ml = this.a * mlfn(e0, e1, e2, e3, lat);\n      p.x = this.x0 + (Mlp + Ml) * Math.sin(dlon);\n      p.y = this.y0 + (Mlp + Ml) * Math.cos(dlon);\n      return p;\n    }\n    else {\n      //Default case\n      tanphi = sinphi / cosphi;\n      Nl1 = gN(this.a, this.e, this.sin_p12);\n      Nl = gN(this.a, this.e, sinphi);\n      psi = Math.atan((1 - this.es) * tanphi + this.es * Nl1 * this.sin_p12 / (Nl * cosphi));\n      Az = Math.atan2(Math.sin(dlon), this.cos_p12 * Math.tan(psi) - this.sin_p12 * Math.cos(dlon));\n      if (Az === 0) {\n        s = Math.asin(this.cos_p12 * Math.sin(psi) - this.sin_p12 * Math.cos(psi));\n      }\n      else if (Math.abs(Math.abs(Az) - Math.PI) <= EPSLN) {\n        s = -Math.asin(this.cos_p12 * Math.sin(psi) - this.sin_p12 * Math.cos(psi));\n      }\n      else {\n        s = Math.asin(Math.sin(dlon) * Math.cos(psi) / Math.sin(Az));\n      }\n      G = this.e * this.sin_p12 / Math.sqrt(1 - this.es);\n      H = this.e * this.cos_p12 * Math.cos(Az) / Math.sqrt(1 - this.es);\n      GH = G * H;\n      Hs = H * H;\n      s2 = s * s;\n      s3 = s2 * s;\n      s4 = s3 * s;\n      s5 = s4 * s;\n      c = Nl1 * s * (1 - s2 * Hs * (1 - Hs) / 6 + s3 / 8 * GH * (1 - 2 * Hs) + s4 / 120 * (Hs * (4 - 7 * Hs) - 3 * G * G * (1 - 7 * Hs)) - s5 / 48 * GH);\n      p.x = this.x0 + c * Math.sin(Az);\n      p.y = this.y0 + c * Math.cos(Az);\n      return p;\n    }\n  }\n\n\n}\n\nexport function inverse(p) {\n  p.x -= this.x0;\n  p.y -= this.y0;\n  var rh, z, sinz, cosz, lon, lat, con, e0, e1, e2, e3, Mlp, M, N1, psi, Az, cosAz, tmp, A, B, D, Ee, F, sinpsi;\n  if (this.sphere) {\n    rh = Math.sqrt(p.x * p.x + p.y * p.y);\n    if (rh > (2 * HALF_PI * this.a)) {\n      return;\n    }\n    z = rh / this.a;\n\n    sinz = Math.sin(z);\n    cosz = Math.cos(z);\n\n    lon = this.long0;\n    if (Math.abs(rh) <= EPSLN) {\n      lat = this.lat0;\n    }\n    else {\n      lat = asinz(cosz * this.sin_p12 + (p.y * sinz * this.cos_p12) / rh);\n      con = Math.abs(this.lat0) - HALF_PI;\n      if (Math.abs(con) <= EPSLN) {\n        if (this.lat0 >= 0) {\n          lon = adjust_lon(this.long0 + Math.atan2(p.x, - p.y));\n        }\n        else {\n          lon = adjust_lon(this.long0 - Math.atan2(-p.x, p.y));\n        }\n      }\n      else {\n        /*con = cosz - this.sin_p12 * Math.sin(lat);\n        if ((Math.abs(con) < EPSLN) && (Math.abs(p.x) < EPSLN)) {\n          //no-op, just keep the lon value as is\n        } else {\n          var temp = Math.atan2((p.x * sinz * this.cos_p12), (con * rh));\n          lon = adjust_lon(this.long0 + Math.atan2((p.x * sinz * this.cos_p12), (con * rh)));\n        }*/\n        lon = adjust_lon(this.long0 + Math.atan2(p.x * sinz, rh * this.cos_p12 * cosz - p.y * this.sin_p12 * sinz));\n      }\n    }\n\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n  else {\n    e0 = e0fn(this.es);\n    e1 = e1fn(this.es);\n    e2 = e2fn(this.es);\n    e3 = e3fn(this.es);\n    if (Math.abs(this.sin_p12 - 1) <= EPSLN) {\n      //North pole case\n      Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);\n      rh = Math.sqrt(p.x * p.x + p.y * p.y);\n      M = Mlp - rh;\n      lat = imlfn(M / this.a, e0, e1, e2, e3);\n      lon = adjust_lon(this.long0 + Math.atan2(p.x, - 1 * p.y));\n      p.x = lon;\n      p.y = lat;\n      return p;\n    }\n    else if (Math.abs(this.sin_p12 + 1) <= EPSLN) {\n      //South pole case\n      Mlp = this.a * mlfn(e0, e1, e2, e3, HALF_PI);\n      rh = Math.sqrt(p.x * p.x + p.y * p.y);\n      M = rh - Mlp;\n\n      lat = imlfn(M / this.a, e0, e1, e2, e3);\n      lon = adjust_lon(this.long0 + Math.atan2(p.x, p.y));\n      p.x = lon;\n      p.y = lat;\n      return p;\n    }\n    else {\n      //default case\n      rh = Math.sqrt(p.x * p.x + p.y * p.y);\n      Az = Math.atan2(p.x, p.y);\n      N1 = gN(this.a, this.e, this.sin_p12);\n      cosAz = Math.cos(Az);\n      tmp = this.e * this.cos_p12 * cosAz;\n      A = -tmp * tmp / (1 - this.es);\n      B = 3 * this.es * (1 - A) * this.sin_p12 * this.cos_p12 * cosAz / (1 - this.es);\n      D = rh / N1;\n      Ee = D - A * (1 + A) * Math.pow(D, 3) / 6 - B * (1 + 3 * A) * Math.pow(D, 4) / 24;\n      F = 1 - A * Ee * Ee / 2 - D * Ee * Ee * Ee / 6;\n      psi = Math.asin(this.sin_p12 * Math.cos(Ee) + this.cos_p12 * Math.sin(Ee) * cosAz);\n      lon = adjust_lon(this.long0 + Math.asin(Math.sin(Az) * Math.sin(Ee) / Math.cos(psi)));\n      sinpsi = Math.sin(psi);\n      lat = Math.atan2((sinpsi - this.es * F * this.sin_p12) * Math.tan(psi), sinpsi * (1 - this.es));\n      p.x = lon;\n      p.y = lat;\n      return p;\n    }\n  }\n\n}\n\nexport var names = [\"Azimuthal_Equidistant\", \"aeqd\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import adjust_lon from '../common/adjust_lon';\nimport asinz from '../common/asinz';\nimport {EPSLN, HALF_PI} from '../constants/values';\n\nexport function init() {\n  //double temp;      /* temporary variable    */\n\n  /* Place parameters in static storage for common use\n      -------------------------------------------------*/\n  this.sin_p14 = Math.sin(this.lat0);\n  this.cos_p14 = Math.cos(this.lat0);\n}\n\n/* Orthographic forward equations--mapping lat,long to x,y\n    ---------------------------------------------------*/\nexport function forward(p) {\n  var sinphi, cosphi; /* sin and cos value        */\n  var dlon; /* delta longitude value      */\n  var coslon; /* cos of longitude        */\n  var ksp; /* scale factor          */\n  var g, x, y;\n  var lon = p.x;\n  var lat = p.y;\n  /* Forward equations\n      -----------------*/\n  dlon = adjust_lon(lon - this.long0);\n\n  sinphi = Math.sin(lat);\n  cosphi = Math.cos(lat);\n\n  coslon = Math.cos(dlon);\n  g = this.sin_p14 * sinphi + this.cos_p14 * cosphi * coslon;\n  ksp = 1;\n  if ((g > 0) || (Math.abs(g) <= EPSLN)) {\n    x = this.a * ksp * cosphi * Math.sin(dlon);\n    y = this.y0 + this.a * ksp * (this.cos_p14 * sinphi - this.sin_p14 * cosphi * coslon);\n  }\n  p.x = x;\n  p.y = y;\n  return p;\n}\n\nexport function inverse(p) {\n  var rh; /* height above ellipsoid      */\n  var z; /* angle          */\n  var sinz, cosz; /* sin of z and cos of z      */\n  var con;\n  var lon, lat;\n  /* Inverse equations\n      -----------------*/\n  p.x -= this.x0;\n  p.y -= this.y0;\n  rh = Math.sqrt(p.x * p.x + p.y * p.y);\n  z = asinz(rh / this.a);\n\n  sinz = Math.sin(z);\n  cosz = Math.cos(z);\n\n  lon = this.long0;\n  if (Math.abs(rh) <= EPSLN) {\n    lat = this.lat0;\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n  lat = asinz(cosz * this.sin_p14 + (p.y * sinz * this.cos_p14) / rh);\n  con = Math.abs(this.lat0) - HALF_PI;\n  if (Math.abs(con) <= EPSLN) {\n    if (this.lat0 >= 0) {\n      lon = adjust_lon(this.long0 + Math.atan2(p.x, - p.y));\n    }\n    else {\n      lon = adjust_lon(this.long0 - Math.atan2(-p.x, p.y));\n    }\n    p.x = lon;\n    p.y = lat;\n    return p;\n  }\n  lon = adjust_lon(this.long0 + Math.atan2((p.x * sinz), rh * this.cos_p14 * cosz - p.y * this.sin_p14 * sinz));\n  p.x = lon;\n  p.y = lat;\n  return p;\n}\n\nexport var names = [\"ortho\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","// QSC projection rewritten from the original PROJ4\n// https://github.com/OSGeo/proj.4/blob/master/src/PJ_qsc.c\n\nimport {EPSLN, TWO_PI, SPI, HALF_PI, FORTPI} from '../constants/values';\n\n/* constants */\nvar FACE_ENUM = {\n    FRONT: 1,\n    RIGHT: 2,\n    BACK: 3,\n    LEFT: 4,\n    TOP: 5,\n    BOTTOM: 6\n};\n\nvar AREA_ENUM = {\n    AREA_0: 1,\n    AREA_1: 2,\n    AREA_2: 3,\n    AREA_3: 4\n};\n\nexport function init() {\n\n  this.x0 = this.x0 || 0;\n  this.y0 = this.y0 || 0;\n  this.lat0 = this.lat0 || 0;\n  this.long0 = this.long0 || 0;\n  this.lat_ts = this.lat_ts || 0;\n  this.title = this.title || \"Quadrilateralized Spherical Cube\";\n\n  /* Determine the cube face from the center of projection. */\n  if (this.lat0 >= HALF_PI - FORTPI / 2.0) {\n    this.face = FACE_ENUM.TOP;\n  } else if (this.lat0 <= -(HALF_PI - FORTPI / 2.0)) {\n    this.face = FACE_ENUM.BOTTOM;\n  } else if (Math.abs(this.long0) <= FORTPI) {\n    this.face = FACE_ENUM.FRONT;\n  } else if (Math.abs(this.long0) <= HALF_PI + FORTPI) {\n    this.face = this.long0 > 0.0 ? FACE_ENUM.RIGHT : FACE_ENUM.LEFT;\n  } else {\n    this.face = FACE_ENUM.BACK;\n  }\n\n  /* Fill in useful values for the ellipsoid <-> sphere shift\n   * described in [LK12]. */\n  if (this.es !== 0) {\n    this.one_minus_f = 1 - (this.a - this.b) / this.a;\n    this.one_minus_f_squared = this.one_minus_f * this.one_minus_f;\n  }\n}\n\n// QSC forward equations--mapping lat,long to x,y\n// -----------------------------------------------------------------\nexport function forward(p) {\n  var xy = {x: 0, y: 0};\n  var lat, lon;\n  var theta, phi;\n  var t, mu;\n  /* nu; */\n  var area = {value: 0};\n\n  // move lon according to projection's lon\n  p.x -= this.long0;\n\n  /* Convert the geodetic latitude to a geocentric latitude.\n   * This corresponds to the shift from the ellipsoid to the sphere\n   * described in [LK12]. */\n  if (this.es !== 0) {//if (P->es != 0) {\n    lat = Math.atan(this.one_minus_f_squared * Math.tan(p.y));\n  } else {\n    lat = p.y;\n  }\n\n  /* Convert the input lat, lon into theta, phi as used by QSC.\n   * This depends on the cube face and the area on it.\n   * For the top and bottom face, we can compute theta and phi\n   * directly from phi, lam. For the other faces, we must use\n   * unit sphere cartesian coordinates as an intermediate step. */\n  lon = p.x; //lon = lp.lam;\n  if (this.face === FACE_ENUM.TOP) {\n    phi = HALF_PI - lat;\n    if (lon >= FORTPI && lon <= HALF_PI + FORTPI) {\n      area.value = AREA_ENUM.AREA_0;\n      theta = lon - HALF_PI;\n    } else if (lon > HALF_PI + FORTPI || lon <= -(HALF_PI + FORTPI)) {\n      area.value = AREA_ENUM.AREA_1;\n      theta = (lon > 0.0 ? lon - SPI : lon + SPI);\n    } else if (lon > -(HALF_PI + FORTPI) && lon <= -FORTPI) {\n      area.value = AREA_ENUM.AREA_2;\n      theta = lon + HALF_PI;\n    } else {\n      area.value = AREA_ENUM.AREA_3;\n      theta = lon;\n    }\n  } else if (this.face === FACE_ENUM.BOTTOM) {\n    phi = HALF_PI + lat;\n    if (lon >= FORTPI && lon <= HALF_PI + FORTPI) {\n      area.value = AREA_ENUM.AREA_0;\n      theta = -lon + HALF_PI;\n    } else if (lon < FORTPI && lon >= -FORTPI) {\n      area.value = AREA_ENUM.AREA_1;\n      theta = -lon;\n    } else if (lon < -FORTPI && lon >= -(HALF_PI + FORTPI)) {\n      area.value = AREA_ENUM.AREA_2;\n      theta = -lon - HALF_PI;\n    } else {\n      area.value = AREA_ENUM.AREA_3;\n      theta = (lon > 0.0 ? -lon + SPI : -lon - SPI);\n    }\n  } else {\n    var q, r, s;\n    var sinlat, coslat;\n    var sinlon, coslon;\n\n    if (this.face === FACE_ENUM.RIGHT) {\n      lon = qsc_shift_lon_origin(lon, +HALF_PI);\n    } else if (this.face === FACE_ENUM.BACK) {\n      lon = qsc_shift_lon_origin(lon, +SPI);\n    } else if (this.face === FACE_ENUM.LEFT) {\n      lon = qsc_shift_lon_origin(lon, -HALF_PI);\n    }\n    sinlat = Math.sin(lat);\n    coslat = Math.cos(lat);\n    sinlon = Math.sin(lon);\n    coslon = Math.cos(lon);\n    q = coslat * coslon;\n    r = coslat * sinlon;\n    s = sinlat;\n\n    if (this.face === FACE_ENUM.FRONT) {\n      phi = Math.acos(q);\n      theta = qsc_fwd_equat_face_theta(phi, s, r, area);\n    } else if (this.face === FACE_ENUM.RIGHT) {\n      phi = Math.acos(r);\n      theta = qsc_fwd_equat_face_theta(phi, s, -q, area);\n    } else if (this.face === FACE_ENUM.BACK) {\n      phi = Math.acos(-q);\n      theta = qsc_fwd_equat_face_theta(phi, s, -r, area);\n    } else if (this.face === FACE_ENUM.LEFT) {\n      phi = Math.acos(-r);\n      theta = qsc_fwd_equat_face_theta(phi, s, q, area);\n    } else {\n      /* Impossible */\n      phi = theta = 0;\n      area.value = AREA_ENUM.AREA_0;\n    }\n  }\n\n  /* Compute mu and nu for the area of definition.\n   * For mu, see Eq. (3-21) in [OL76], but note the typos:\n   * compare with Eq. (3-14). For nu, see Eq. (3-38). */\n  mu = Math.atan((12 / SPI) * (theta + Math.acos(Math.sin(theta) * Math.cos(FORTPI)) - HALF_PI));\n  t = Math.sqrt((1 - Math.cos(phi)) / (Math.cos(mu) * Math.cos(mu)) / (1 - Math.cos(Math.atan(1 / Math.cos(theta)))));\n\n  /* Apply the result to the real area. */\n  if (area.value === AREA_ENUM.AREA_1) {\n    mu += HALF_PI;\n  } else if (area.value === AREA_ENUM.AREA_2) {\n    mu += SPI;\n  } else if (area.value === AREA_ENUM.AREA_3) {\n    mu += 1.5 * SPI;\n  }\n\n  /* Now compute x, y from mu and nu */\n  xy.x = t * Math.cos(mu);\n  xy.y = t * Math.sin(mu);\n  xy.x = xy.x * this.a + this.x0;\n  xy.y = xy.y * this.a + this.y0;\n\n  p.x = xy.x;\n  p.y = xy.y;\n  return p;\n}\n\n// QSC inverse equations--mapping x,y to lat/long\n// -----------------------------------------------------------------\nexport function inverse(p) {\n  var lp = {lam: 0, phi: 0};\n  var mu, nu, cosmu, tannu;\n  var tantheta, theta, cosphi, phi;\n  var t;\n  var area = {value: 0};\n\n  /* de-offset */\n  p.x = (p.x - this.x0) / this.a;\n  p.y = (p.y - this.y0) / this.a;\n\n  /* Convert the input x, y to the mu and nu angles as used by QSC.\n   * This depends on the area of the cube face. */\n  nu = Math.atan(Math.sqrt(p.x * p.x + p.y * p.y));\n  mu = Math.atan2(p.y, p.x);\n  if (p.x >= 0.0 && p.x >= Math.abs(p.y)) {\n    area.value = AREA_ENUM.AREA_0;\n  } else if (p.y >= 0.0 && p.y >= Math.abs(p.x)) {\n    area.value = AREA_ENUM.AREA_1;\n    mu -= HALF_PI;\n  } else if (p.x < 0.0 && -p.x >= Math.abs(p.y)) {\n    area.value = AREA_ENUM.AREA_2;\n    mu = (mu < 0.0 ? mu + SPI : mu - SPI);\n  } else {\n    area.value = AREA_ENUM.AREA_3;\n    mu += HALF_PI;\n  }\n\n  /* Compute phi and theta for the area of definition.\n   * The inverse projection is not described in the original paper, but some\n   * good hints can be found here (as of 2011-12-14):\n   * http://fits.gsfc.nasa.gov/fitsbits/saf.93/saf.9302\n   * (search for \"Message-Id: <9302181759.AA25477 at fits.cv.nrao.edu>\") */\n  t = (SPI / 12) * Math.tan(mu);\n  tantheta = Math.sin(t) / (Math.cos(t) - (1 / Math.sqrt(2)));\n  theta = Math.atan(tantheta);\n  cosmu = Math.cos(mu);\n  tannu = Math.tan(nu);\n  cosphi = 1 - cosmu * cosmu * tannu * tannu * (1 - Math.cos(Math.atan(1 / Math.cos(theta))));\n  if (cosphi < -1) {\n    cosphi = -1;\n  } else if (cosphi > +1) {\n    cosphi = +1;\n  }\n\n  /* Apply the result to the real area on the cube face.\n   * For the top and bottom face, we can compute phi and lam directly.\n   * For the other faces, we must use unit sphere cartesian coordinates\n   * as an intermediate step. */\n  if (this.face === FACE_ENUM.TOP) {\n    phi = Math.acos(cosphi);\n    lp.phi = HALF_PI - phi;\n    if (area.value === AREA_ENUM.AREA_0) {\n      lp.lam = theta + HALF_PI;\n    } else if (area.value === AREA_ENUM.AREA_1) {\n      lp.lam = (theta < 0.0 ? theta + SPI : theta - SPI);\n    } else if (area.value === AREA_ENUM.AREA_2) {\n      lp.lam = theta - HALF_PI;\n    } else /* area.value == AREA_ENUM.AREA_3 */ {\n      lp.lam = theta;\n    }\n  } else if (this.face === FACE_ENUM.BOTTOM) {\n    phi = Math.acos(cosphi);\n    lp.phi = phi - HALF_PI;\n    if (area.value === AREA_ENUM.AREA_0) {\n      lp.lam = -theta + HALF_PI;\n    } else if (area.value === AREA_ENUM.AREA_1) {\n      lp.lam = -theta;\n    } else if (area.value === AREA_ENUM.AREA_2) {\n      lp.lam = -theta - HALF_PI;\n    } else /* area.value == AREA_ENUM.AREA_3 */ {\n      lp.lam = (theta < 0.0 ? -theta - SPI : -theta + SPI);\n    }\n  } else {\n    /* Compute phi and lam via cartesian unit sphere coordinates. */\n    var q, r, s;\n    q = cosphi;\n    t = q * q;\n    if (t >= 1) {\n      s = 0;\n    } else {\n      s = Math.sqrt(1 - t) * Math.sin(theta);\n    }\n    t += s * s;\n    if (t >= 1) {\n      r = 0;\n    } else {\n      r = Math.sqrt(1 - t);\n    }\n    /* Rotate q,r,s into the correct area. */\n    if (area.value === AREA_ENUM.AREA_1) {\n      t = r;\n      r = -s;\n      s = t;\n    } else if (area.value === AREA_ENUM.AREA_2) {\n      r = -r;\n      s = -s;\n    } else if (area.value === AREA_ENUM.AREA_3) {\n      t = r;\n      r = s;\n      s = -t;\n    }\n    /* Rotate q,r,s into the correct cube face. */\n    if (this.face === FACE_ENUM.RIGHT) {\n      t = q;\n      q = -r;\n      r = t;\n    } else if (this.face === FACE_ENUM.BACK) {\n      q = -q;\n      r = -r;\n    } else if (this.face === FACE_ENUM.LEFT) {\n      t = q;\n      q = r;\n      r = -t;\n    }\n    /* Now compute phi and lam from the unit sphere coordinates. */\n    lp.phi = Math.acos(-s) - HALF_PI;\n    lp.lam = Math.atan2(r, q);\n    if (this.face === FACE_ENUM.RIGHT) {\n      lp.lam = qsc_shift_lon_origin(lp.lam, -HALF_PI);\n    } else if (this.face === FACE_ENUM.BACK) {\n      lp.lam = qsc_shift_lon_origin(lp.lam, -SPI);\n    } else if (this.face === FACE_ENUM.LEFT) {\n      lp.lam = qsc_shift_lon_origin(lp.lam, +HALF_PI);\n    }\n  }\n\n  /* Apply the shift from the sphere to the ellipsoid as described\n   * in [LK12]. */\n  if (this.es !== 0) {\n    var invert_sign;\n    var tanphi, xa;\n    invert_sign = (lp.phi < 0 ? 1 : 0);\n    tanphi = Math.tan(lp.phi);\n    xa = this.b / Math.sqrt(tanphi * tanphi + this.one_minus_f_squared);\n    lp.phi = Math.atan(Math.sqrt(this.a * this.a - xa * xa) / (this.one_minus_f * xa));\n    if (invert_sign) {\n      lp.phi = -lp.phi;\n    }\n  }\n\n  lp.lam += this.long0;\n  p.x = lp.lam;\n  p.y = lp.phi;\n  return p;\n}\n\n/* Helper function for forward projection: compute the theta angle\n * and determine the area number. */\nfunction qsc_fwd_equat_face_theta(phi, y, x, area) {\n  var theta;\n  if (phi < EPSLN) {\n    area.value = AREA_ENUM.AREA_0;\n    theta = 0.0;\n  } else {\n    theta = Math.atan2(y, x);\n    if (Math.abs(theta) <= FORTPI) {\n      area.value = AREA_ENUM.AREA_0;\n    } else if (theta > FORTPI && theta <= HALF_PI + FORTPI) {\n      area.value = AREA_ENUM.AREA_1;\n      theta -= HALF_PI;\n    } else if (theta > HALF_PI + FORTPI || theta <= -(HALF_PI + FORTPI)) {\n      area.value = AREA_ENUM.AREA_2;\n      theta = (theta >= 0.0 ? theta - SPI : theta + SPI);\n    } else {\n      area.value = AREA_ENUM.AREA_3;\n      theta += HALF_PI;\n    }\n  }\n  return theta;\n}\n\n/* Helper function: shift the longitude. */\nfunction qsc_shift_lon_origin(lon, offset) {\n  var slon = lon + offset;\n  if (slon < -SPI) {\n    slon += TWO_PI;\n  } else if (slon > +SPI) {\n    slon -= TWO_PI;\n  }\n  return slon;\n}\n\nexport var names = [\"Quadrilateralized Spherical Cube\", \"Quadrilateralized_Spherical_Cube\", \"qsc\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n\n","// Robinson projection\n// Based on https://github.com/OSGeo/proj.4/blob/master/src/PJ_robin.c\n// Polynomial coeficients from http://article.gmane.org/gmane.comp.gis.proj-4.devel/6039\n\nimport {HALF_PI, D2R, R2D, EPSLN} from '../constants/values';\nimport adjust_lon from '../common/adjust_lon';\n\nvar COEFS_X = [\n    [1.0000, 2.2199e-17, -7.15515e-05, 3.1103e-06],\n    [0.9986, -0.000482243, -2.4897e-05, -1.3309e-06],\n    [0.9954, -0.00083103, -4.48605e-05, -9.86701e-07],\n    [0.9900, -0.00135364, -5.9661e-05, 3.6777e-06],\n    [0.9822, -0.00167442, -4.49547e-06, -5.72411e-06],\n    [0.9730, -0.00214868, -9.03571e-05, 1.8736e-08],\n    [0.9600, -0.00305085, -9.00761e-05, 1.64917e-06],\n    [0.9427, -0.00382792, -6.53386e-05, -2.6154e-06],\n    [0.9216, -0.00467746, -0.00010457, 4.81243e-06],\n    [0.8962, -0.00536223, -3.23831e-05, -5.43432e-06],\n    [0.8679, -0.00609363, -0.000113898, 3.32484e-06],\n    [0.8350, -0.00698325, -6.40253e-05, 9.34959e-07],\n    [0.7986, -0.00755338, -5.00009e-05, 9.35324e-07],\n    [0.7597, -0.00798324, -3.5971e-05, -2.27626e-06],\n    [0.7186, -0.00851367, -7.01149e-05, -8.6303e-06],\n    [0.6732, -0.00986209, -0.000199569, 1.91974e-05],\n    [0.6213, -0.010418, 8.83923e-05, 6.24051e-06],\n    [0.5722, -0.00906601, 0.000182, 6.24051e-06],\n    [0.5322, -0.00677797, 0.000275608, 6.24051e-06]\n];\n\nvar COEFS_Y = [\n    [-5.20417e-18, 0.0124, 1.21431e-18, -8.45284e-11],\n    [0.0620, 0.0124, -1.26793e-09, 4.22642e-10],\n    [0.1240, 0.0124, 5.07171e-09, -1.60604e-09],\n    [0.1860, 0.0123999, -1.90189e-08, 6.00152e-09],\n    [0.2480, 0.0124002, 7.10039e-08, -2.24e-08],\n    [0.3100, 0.0123992, -2.64997e-07, 8.35986e-08],\n    [0.3720, 0.0124029, 9.88983e-07, -3.11994e-07],\n    [0.4340, 0.0123893, -3.69093e-06, -4.35621e-07],\n    [0.4958, 0.0123198, -1.02252e-05, -3.45523e-07],\n    [0.5571, 0.0121916, -1.54081e-05, -5.82288e-07],\n    [0.6176, 0.0119938, -2.41424e-05, -5.25327e-07],\n    [0.6769, 0.011713, -3.20223e-05, -5.16405e-07],\n    [0.7346, 0.0113541, -3.97684e-05, -6.09052e-07],\n    [0.7903, 0.0109107, -4.89042e-05, -1.04739e-06],\n    [0.8435, 0.0103431, -6.4615e-05, -1.40374e-09],\n    [0.8936, 0.00969686, -6.4636e-05, -8.547e-06],\n    [0.9394, 0.00840947, -0.000192841, -4.2106e-06],\n    [0.9761, 0.00616527, -0.000256, -4.2106e-06],\n    [1.0000, 0.00328947, -0.000319159, -4.2106e-06]\n];\n\nvar FXC = 0.8487;\nvar FYC = 1.3523;\nvar C1 = R2D/5; // rad to 5-degree interval\nvar RC1 = 1/C1;\nvar NODES = 18;\n\nvar poly3_val = function(coefs, x) {\n    return coefs[0] + x * (coefs[1] + x * (coefs[2] + x * coefs[3]));\n};\n\nvar poly3_der = function(coefs, x) {\n    return coefs[1] + x * (2 * coefs[2] + x * 3 * coefs[3]);\n};\n\nfunction newton_rapshon(f_df, start, max_err, iters) {\n    var x = start;\n    for (; iters; --iters) {\n        var upd = f_df(x);\n        x -= upd;\n        if (Math.abs(upd) < max_err) {\n            break;\n        }\n    }\n    return x;\n}\n\nexport function init() {\n    this.x0 = this.x0 || 0;\n    this.y0 = this.y0 || 0;\n    this.long0 = this.long0 || 0;\n    this.es = 0;\n    this.title = this.title || \"Robinson\";\n}\n\nexport function forward(ll) {\n    var lon = adjust_lon(ll.x - this.long0);\n\n    var dphi = Math.abs(ll.y);\n    var i = Math.floor(dphi * C1);\n    if (i < 0) {\n        i = 0;\n    } else if (i >= NODES) {\n        i = NODES - 1;\n    }\n    dphi = R2D * (dphi - RC1 * i);\n    var xy = {\n        x: poly3_val(COEFS_X[i], dphi) * lon,\n        y: poly3_val(COEFS_Y[i], dphi)\n    };\n    if (ll.y < 0) {\n        xy.y = -xy.y;\n    }\n\n    xy.x = xy.x * this.a * FXC + this.x0;\n    xy.y = xy.y * this.a * FYC + this.y0;\n    return xy;\n}\n\nexport function inverse(xy) {\n    var ll = {\n        x: (xy.x - this.x0) / (this.a * FXC),\n        y: Math.abs(xy.y - this.y0) / (this.a * FYC)\n    };\n\n    if (ll.y >= 1) { // pathologic case\n        ll.x /= COEFS_X[NODES][0];\n        ll.y = xy.y < 0 ? -HALF_PI : HALF_PI;\n    } else {\n        // find table interval\n        var i = Math.floor(ll.y * NODES);\n        if (i < 0) {\n            i = 0;\n        } else if (i >= NODES) {\n            i = NODES - 1;\n        }\n        for (;;) {\n            if (COEFS_Y[i][0] > ll.y) {\n                --i;\n            } else if (COEFS_Y[i+1][0] <= ll.y) {\n                ++i;\n            } else {\n                break;\n            }\n        }\n        // linear interpolation in 5 degree interval\n        var coefs = COEFS_Y[i];\n        var t = 5 * (ll.y - coefs[0]) / (COEFS_Y[i+1][0] - coefs[0]);\n        // find t so that poly3_val(coefs, t) = ll.y\n        t = newton_rapshon(function(x) {\n            return (poly3_val(coefs, x) - ll.y) / poly3_der(coefs, x);\n        }, t, EPSLN, 100);\n\n        ll.x /= poly3_val(COEFS_X[i], t);\n        ll.y = (5 * i + t) * D2R;\n        if (xy.y < 0) {\n            ll.y = -ll.y;\n        }\n    }\n\n    ll.x = adjust_lon(ll.x + this.long0);\n    return ll;\n}\n\nexport var names = [\"Robinson\", \"robin\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import {\n    geodeticToGeocentric,\n    geocentricToGeodetic\n} from '../datumUtils';\n\nexport function init() {\n    this.name = 'geocent';\n\n}\n\nexport function forward(p) {\n    var point = geodeticToGeocentric(p, this.es, this.a);\n    return point;\n}\n\nexport function inverse(p) {\n    var point = geocentricToGeodetic(p, this.es, this.a, this.b);\n    return point;\n}\n\nexport var names = [\"Geocentric\", 'geocentric', \"geocent\", \"Geocent\"];\nexport default {\n    init: init,\n    forward: forward,\n    inverse: inverse,\n    names: names\n};","\nvar mode = {\n  N_POLE: 0,\n  S_POLE: 1,\n  EQUIT: 2,\n  OBLIQ: 3\n};\n\nimport { D2R, HALF_PI, EPSLN } from \"../constants/values\";\nimport hypot from \"../common/hypot\";\n\nvar params = {\n  h:     { def: 100000, num: true },           // default is Karman line, no default in PROJ.7\n  azi:   { def: 0, num: true, degrees: true }, // default is North\n  tilt:  { def: 0, num: true, degrees: true }, // default is Nadir\n  long0: { def: 0, num: true },                // default is Greenwich, conversion to rad is automatic\n  lat0:  { def: 0, num: true }                 // default is Equator, conversion to rad is automatic\n};\n\nexport function init() {\n  Object.keys(params).forEach(function (p) {\n    if (typeof this[p] === \"undefined\") {\n      this[p] = params[p].def;\n    } else if (params[p].num && isNaN(this[p])) {\n      throw new Error(\"Invalid parameter value, must be numeric \" + p + \" = \" + this[p]);\n    } else if (params[p].num) {\n      this[p] = parseFloat(this[p]);\n    }\n    if (params[p].degrees) {\n      this[p] = this[p] * D2R;\n    }\n  }.bind(this));\n\n  if (Math.abs((Math.abs(this.lat0) - HALF_PI)) < EPSLN) {\n    this.mode = this.lat0 < 0 ? mode.S_POLE : mode.N_POLE;\n  } else if (Math.abs(this.lat0) < EPSLN) {\n    this.mode = mode.EQUIT;\n  } else {\n    this.mode = mode.OBLIQ;\n    this.sinph0 = Math.sin(this.lat0);\n    this.cosph0 = Math.cos(this.lat0);\n  }\n\n  this.pn1 = this.h / this.a;  // Normalize relative to the Earth's radius\n\n  if (this.pn1 <= 0 || this.pn1 > 1e10) {\n    throw new Error(\"Invalid height\");\n  }\n  \n  this.p = 1 + this.pn1;\n  this.rp = 1 / this.p;\n  this.h1 = 1 / this.pn1;\n  this.pfact = (this.p + 1) * this.h1;\n  this.es = 0;\n\n  var omega = this.tilt;\n  var gamma = this.azi;\n  this.cg = Math.cos(gamma);\n  this.sg = Math.sin(gamma);\n  this.cw = Math.cos(omega);\n  this.sw = Math.sin(omega);\n}\n\nexport function forward(p) {\n  p.x -= this.long0;\n  var sinphi = Math.sin(p.y);\n  var cosphi = Math.cos(p.y);\n  var coslam = Math.cos(p.x);\n  var x, y;\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y = this.sinph0 * sinphi + this.cosph0 * cosphi * coslam;\n      break;\n    case mode.EQUIT:\n      y = cosphi * coslam;\n      break;\n    case mode.S_POLE:\n      y = -sinphi;\n      break;\n    case mode.N_POLE:\n      y = sinphi;\n      break;\n  }\n  y = this.pn1 / (this.p - y);\n  x = y * cosphi * Math.sin(p.x);\n\n  switch (this.mode) {\n    case mode.OBLIQ:\n      y *= this.cosph0 * sinphi - this.sinph0 * cosphi * coslam;\n      break;\n    case mode.EQUIT:\n      y *= sinphi;\n      break;\n    case mode.N_POLE:\n      y *= -(cosphi * coslam);\n      break;\n    case mode.S_POLE:\n      y *= cosphi * coslam;\n      break;\n  }\n\n  // Tilt \n  var yt, ba;\n  yt = y * this.cg + x * this.sg;\n  ba = 1 / (yt * this.sw * this.h1 + this.cw);\n  x = (x * this.cg - y * this.sg) * this.cw * ba;\n  y = yt * ba;\n\n  p.x = x * this.a;\n  p.y = y * this.a;\n  return p;\n}\n\nexport function inverse(p) {\n  p.x /= this.a;\n  p.y /= this.a;\n  var r = { x: p.x, y: p.y };\n\n  // Un-Tilt\n  var bm, bq, yt;\n  yt = 1 / (this.pn1 - p.y * this.sw);\n  bm = this.pn1 * p.x * yt;\n  bq = this.pn1 * p.y * this.cw * yt;\n  p.x = bm * this.cg + bq * this.sg;\n  p.y = bq * this.cg - bm * this.sg;\n\n  var rh = hypot(p.x, p.y);\n  if (Math.abs(rh) < EPSLN) {\n    r.x = 0;\n    r.y = p.y;\n  } else {\n    var cosz, sinz;\n    sinz = 1 - rh * rh * this.pfact;\n    sinz = (this.p - Math.sqrt(sinz)) / (this.pn1 / rh + rh / this.pn1);\n    cosz = Math.sqrt(1 - sinz * sinz);\n    switch (this.mode) {\n      case mode.OBLIQ:\n        r.y = Math.asin(cosz * this.sinph0 + p.y * sinz * this.cosph0 / rh);\n        p.y = (cosz - this.sinph0 * Math.sin(r.y)) * rh;\n        p.x *= sinz * this.cosph0;\n        break;\n      case mode.EQUIT:\n        r.y = Math.asin(p.y * sinz / rh);\n        p.y = cosz * rh;\n        p.x *= sinz;\n        break;\n      case mode.N_POLE:\n        r.y = Math.asin(cosz);\n        p.y = -p.y;\n        break;\n      case mode.S_POLE:\n        r.y = -Math.asin(cosz);\n        break;\n    }\n    r.x = Math.atan2(p.x, p.y);\n  }\n\n  p.x = r.x + this.long0;\n  p.y = r.y;\n  return p;\n}\n\nexport var names = [\"Tilted_Perspective\", \"tpers\"];\nexport default {\n  init: init,\n  forward: forward,\n  inverse: inverse,\n  names: names\n};\n","import proj4 from './core';\nimport Proj from \"./Proj\";\nimport Point from \"./Point\";\nimport common from \"./common/toPoint\";\nimport defs from \"./defs\";\nimport nadgrid from \"./nadgrid\";\nimport transform from \"./transform\";\nimport mgrs from \"mgrs\";\nimport includedProjections from \"../projs\";\n\nproj4.defaultDatum = 'WGS84'; //default datum\nproj4.Proj = Proj;\nproj4.WGS84 = new proj4.Proj('WGS84');\nproj4.Point = Point;\nproj4.toPoint = common;\nproj4.defs = defs;\nproj4.nadgrid = nadgrid;\nproj4.transform = transform;\nproj4.mgrs = mgrs;\nproj4.version = '__VERSION__';\nincludedProjections(proj4);\nexport default proj4;\n","import tmerc from './lib/projections/tmerc';\nimport etmerc from './lib/projections/etmerc';\nimport utm from './lib/projections/utm';\nimport sterea from './lib/projections/sterea';\nimport stere from './lib/projections/stere';\nimport somerc from './lib/projections/somerc';\nimport omerc from './lib/projections/omerc';\nimport lcc from './lib/projections/lcc';\nimport krovak from './lib/projections/krovak';\nimport cass from './lib/projections/cass';\nimport laea from './lib/projections/laea';\nimport aea from './lib/projections/aea';\nimport gnom from './lib/projections/gnom';\nimport cea from './lib/projections/cea';\nimport eqc from './lib/projections/eqc';\nimport poly from './lib/projections/poly';\nimport nzmg from './lib/projections/nzmg';\nimport mill from './lib/projections/mill';\nimport sinu from './lib/projections/sinu';\nimport moll from './lib/projections/moll';\nimport eqdc from './lib/projections/eqdc';\nimport vandg from './lib/projections/vandg';\nimport aeqd from './lib/projections/aeqd';\nimport ortho from './lib/projections/ortho';\nimport qsc from './lib/projections/qsc';\nimport robin from './lib/projections/robin';\nimport geocent from './lib/projections/geocent';\nimport tpers from './lib/projections/tpers';\nexport default function(proj4){\n  proj4.Proj.projections.add(tmerc);\n  proj4.Proj.projections.add(etmerc);\n  proj4.Proj.projections.add(utm);\n  proj4.Proj.projections.add(sterea);\n  proj4.Proj.projections.add(stere);\n  proj4.Proj.projections.add(somerc);\n  proj4.Proj.projections.add(omerc);\n  proj4.Proj.projections.add(lcc);\n  proj4.Proj.projections.add(krovak);\n  proj4.Proj.projections.add(cass);\n  proj4.Proj.projections.add(laea);\n  proj4.Proj.projections.add(aea);\n  proj4.Proj.projections.add(gnom);\n  proj4.Proj.projections.add(cea);\n  proj4.Proj.projections.add(eqc);\n  proj4.Proj.projections.add(poly);\n  proj4.Proj.projections.add(nzmg);\n  proj4.Proj.projections.add(mill);\n  proj4.Proj.projections.add(sinu);\n  proj4.Proj.projections.add(moll);\n  proj4.Proj.projections.add(eqdc);\n  proj4.Proj.projections.add(vandg);\n  proj4.Proj.projections.add(aeqd);\n  proj4.Proj.projections.add(ortho);\n  proj4.Proj.projections.add(qsc);\n  proj4.Proj.projections.add(robin);\n  proj4.Proj.projections.add(geocent);\n  proj4.Proj.projections.add(tpers);\n}","import proj4 from 'proj4';\nimport pkg from 'point-in-polygon';\n\n/** @module src/km100 */\n\n/** @constant\n  * @description This the array from which the default object is derived. If you\n  * need to work with an array of objects where the 100 km grid reference is a property\n  * of the object alongside x, y, and proj, you can use this.\n  * @type {array}\n*/\nconst a100km = [\n  {\n    \"GridRef\": \"SV\",\n    \"x\": 0,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NL\",\n    \"x\": 0,\n    \"y\": 7,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NF\",\n    \"x\": 0,\n    \"y\": 8,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NA\",\n    \"x\": 0,\n    \"y\": 9,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SW\",\n    \"x\": 1,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SR\",\n    \"x\": 1,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SM\",\n    \"x\": 1,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NW\",\n    \"x\": 1,\n    \"y\": 5,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NR\",\n    \"x\": 1,\n    \"y\": 6,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NM\",\n    \"x\": 1,\n    \"y\": 7,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NG\",\n    \"x\": 1,\n    \"y\": 8,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NB\",\n    \"x\": 1,\n    \"y\": 9,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HW\",\n    \"x\": 1,\n    \"y\": 10,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SX\",\n    \"x\": 2,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SS\",\n    \"x\": 2,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SN\",\n    \"x\": 2,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SH\",\n    \"x\": 2,\n    \"y\": 3,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SC\",\n    \"x\": 2,\n    \"y\": 4,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NX\",\n    \"x\": 2,\n    \"y\": 5,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NS\",\n    \"x\": 2,\n    \"y\": 6,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NN\",\n    \"x\": 2,\n    \"y\": 7,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NH\",\n    \"x\": 2,\n    \"y\": 8,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NC\",\n    \"x\": 2,\n    \"y\": 9,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HX\",\n    \"x\": 2,\n    \"y\": 10,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SY\",\n    \"x\": 3,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"ST\",\n    \"x\": 3,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SO\",\n    \"x\": 3,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SJ\",\n    \"x\": 3,\n    \"y\": 3,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SD\",\n    \"x\": 3,\n    \"y\": 4,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NY\",\n    \"x\": 3,\n    \"y\": 5,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NT\",\n    \"x\": 3,\n    \"y\": 6,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NO\",\n    \"x\": 3,\n    \"y\": 7,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NJ\",\n    \"x\": 3,\n    \"y\": 8,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"ND\",\n    \"x\": 3,\n    \"y\": 9,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HY\",\n    \"x\": 3,\n    \"y\": 10,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HT\",\n    \"x\": 3,\n    \"y\": 11,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SZ\",\n    \"x\": 4,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SU\",\n    \"x\": 4,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SP\",\n    \"x\": 4,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SK\",\n    \"x\": 4,\n    \"y\": 3,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"SE\",\n    \"x\": 4,\n    \"y\": 4,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NZ\",\n    \"x\": 4,\n    \"y\": 5,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NU\",\n    \"x\": 4,\n    \"y\": 6,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"NK\",\n    \"x\": 4,\n    \"y\": 8,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HZ\",\n    \"x\": 4,\n    \"y\": 10,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HU\",\n    \"x\": 4,\n    \"y\": 11,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"HP\",\n    \"x\": 4,\n    \"y\": 12,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TV\",\n    \"x\": 5,\n    \"y\": 0,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TQ\",\n    \"x\": 5,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TL\",\n    \"x\": 5,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TF\",\n    \"x\": 5,\n    \"y\": 3,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TA\",\n    \"x\": 5,\n    \"y\": 4,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"OV\",\n    \"x\": 5,\n    \"y\": 5,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TR\",\n    \"x\": 6,\n    \"y\": 1,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TM\",\n    \"x\": 6,\n    \"y\": 2,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"TG\",\n    \"x\": 6,\n    \"y\": 3,\n    \"proj\": \"gb\"\n  },\n  {\n    \"GridRef\": \"V\",\n    \"x\": 0,\n    \"y\": 0,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"Q\",\n    \"x\": 0,\n    \"y\": 1,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"L\",\n    \"x\": 0,\n    \"y\": 2,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"F\",\n    \"x\": 0,\n    \"y\": 3,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"A\",\n    \"x\": 0,\n    \"y\": 4,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"W\",\n    \"x\": 1,\n    \"y\": 0,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"R\",\n    \"x\": 1,\n    \"y\": 1,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"M\",\n    \"x\": 1,\n    \"y\": 2,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"G\",\n    \"x\": 1,\n    \"y\": 3,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"B\",\n    \"x\": 1,\n    \"y\": 4,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"X\",\n    \"x\": 2,\n    \"y\": 0,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"S\",\n    \"x\": 2,\n    \"y\": 1,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"N\",\n    \"x\": 2,\n    \"y\": 2,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"H\",\n    \"x\": 2,\n    \"y\": 3,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"C\",\n    \"x\": 2,\n    \"y\": 4,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"Y\",\n    \"x\": 3,\n    \"y\": 0,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"T\",\n    \"x\": 3,\n    \"y\": 1,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"O\",\n    \"x\": 3,\n    \"y\": 2,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"J\",\n    \"x\": 3,\n    \"y\": 3,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"D\",\n    \"x\": 3,\n    \"y\": 4,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"Z\",\n    \"x\": 4,\n    \"y\": 0,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"U\",\n    \"x\": 4,\n    \"y\": 1,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"P\",\n    \"x\": 4,\n    \"y\": 2,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"K\",\n    \"x\": 4,\n    \"y\": 3,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"E\",\n    \"x\": 4,\n    \"y\": 4,\n    \"proj\": \"ir\"\n  },\n  {\n    \"GridRef\": \"WV\",\n    \"x\": 5,\n    \"y\": 54,\n    \"proj\": \"ci\"\n  },\n  {\n    \"GridRef\": \"WA\",\n    \"x\": 5,\n    \"y\": 55,\n    \"proj\": \"ci\"\n  }\n];\n\n/** @constant\n  * @description The default export from this module is an object with a property\n  * for every 100 km square reference for Britain (Brtish National Grid),\n  * Ireland (Irish National Grid) and the Channel Islands (abbreviated UTM 30N).\n  * Each grid reference references an object that has properties x, y and proj.\n  * The x and y coordinates represent the centroid of the 100 km square in the\n  * coordinate reference system corresponding to the aforementioned areas, respectively\n  * epsg:27700, epsg:29903 and epsg:32630. Another property, proj, indicates the region/CRS\n  * with two letter codes, respectively gb, ir and ci.\n  * <p>An example of the object referenced through the property 'SO' is shown below:</p>\n  * <pre>\n  * {\n  *   \"x\": 3,\n  *   \"y\": 2,\n  *   \"proj\": \"gb\"\n  * }\n  * </pre>\n  * @type {object}\n*/\nvar km100s = a100km.reduce(function(acc, km100) {\n    acc[km100.GridRef] = {\n      x: km100.x,\n      y: km100.y,\n      proj: km100.proj\n    };\n    return acc\n  }, {});\n\n/** @module src/checkGr */\n\nfunction invalidGridRef(gr) {\n  throw `The value '${gr}' is not recognised as a valid grid reference.` \n}\n\n/**\n * Given a grid reference (British National Grid, Irish Grid or UTM zone 30N shorthand),\n * check that ths is a valid GR. If it is, return an object which includes the \n * GR precision in metres, the prefix and the two-letter projection code.\n * If an invalid grid reference is supplied throws an error.\n * @param {string} gr - the grid reference.\n * @returns {object} Object of the form {precision: n, prefix: 'prefix', projection: 'code'}.\n */\nfunction checkGr (gr) {\n\n  const r100km = RegExp('^[a-zA-Z]{1,2}$');\n  const rHectad = RegExp('^[a-zA-Z]{1,2}[0-9]{2}$');\n  const rQuandrant = RegExp('^[a-zA-Z]{1,2}[0-9]{2}[SsNn][WwEe]$');\n  const rTetrad = RegExp('^[a-zA-Z]{1,2}[0-9]{2}[a-np-zA-NP-Z]$');\n  const rMonad = RegExp('^[a-zA-Z]{1,2}[0-9]{4}$');\n  const r6fig = RegExp('^[a-zA-Z]{1,2}[0-9]{6}$');\n  const r8fig = RegExp('^[a-zA-Z]{1,2}[0-9]{8}$');\n  const r10fig = RegExp('^[a-zA-Z]{1,2}[0-9]{10}$');\n\n  const match = gr.match(/^[A-Za-z]+/);\n  if (!match) invalidGridRef(gr); \n\n  const prefix = match[0].toUpperCase();\n  const km100 = km100s[prefix];\n  \n  if (!km100) invalidGridRef(gr); \n\n  const ret = {precision: null, prefix: prefix, projection: km100.proj};\n\n  if (r100km.test(gr)) {\n\n    // The GR is a 100 km square reference\n    ret.precision = 100000;\n\n  } else if (rHectad.test(gr)) {\n\n    // The GR is a hectad\n    ret.precision = 10000;\n\n  } else if (rQuandrant.test(gr)) {\n\n    // The GR is a quandrant\n    ret.precision = 5000;\n\n  } else if (rTetrad.test(gr)) {\n    \n     // The GR is a tetrad\n     ret.precision = 2000;\n\n  } else if (rMonad.test(gr)) {\n\n    // The GR is a monad\n    ret.precision = 1000;\n  \n  } else if (r6fig.test(gr)) {\n\n    // The GR is a 6 figure GR\n    ret.precision = 100;\n  \n  } else if (r8fig.test(gr)) {\n\n    // The GR is a 8 figure GR\n    ret.precision = 10;\n  \n  } else if (r10fig.test(gr)) {\n\n    // The GR is a 10 figure GR\n    ret.precision = 1;\n  \n  } else {\n    invalidGridRef(gr); \n  }\n\n  return ret\n}\n\n/** @module src/projections */\n\n/** @constant\n  * @description This object describes the coordinate reference systems used in this project corresponding\n  * to the British National Grid, Irish Grid, UTM zone 30N (used for the Channel Islands)  and WGS 84. The object contains\n  * four properties, each named with the two letter code used throughout this package to represent one of the\n  * three systems: gb, ir, ci and wg. Each of these properties provides access to an object defining the name,\n  * epsg code and proj4 string for the CRS.\n  * @type {array}\n*/\n\nvar projections = {\n  gb: {\n    name: 'OSGB 1936 / British National Grid',\n    epsg: '27700',\n    proj4: '+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs',\n  },\n  ir: {\n    name: 'TM75 / Irish Grid',\n    epsg: '29903',\n    proj4: '+proj=tmerc +lat_0=53.5 +lon_0=-8 +k=1.000035 +x_0=200000 +y_0=250000 +ellps=mod_airy +towgs84=482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15 +units=m +no_defs',\n  },\n  ci: {\n    name: 'WGS 84 / UTM zone 30N',\n    epsg: '32630',\n    proj4: '+proj=utm +zone=30 +datum=WGS84 +units=m +no_defs',\n  },\n  wg: {\n    name: 'WGS 84',\n    epsg: '4326',\n    proj4: '+proj=longlat +datum=WGS84 +no_defs',\n  }\n};\n\n/** @module src/quadrants */\n\n/** @constant\n  * @description This object specifies the x, y offsets associated with suffixes for quandrant grid refs.\n  * @type {Object}\n*/\n\nvar qOffsets = {\n  sw: {\n    x: 0,\n    y: 0\n  },\n  se: {\n    x: 5000,\n    y: 0\n  },\n  nw: {\n    x: 0,\n    y: 5000\n  },\n  ne: {\n    x: 5000,\n    y: 5000\n  }\n};\n\n/** @module src/tetrads */\n\n/** @constant\n  * @description This object specifies the x, y offsets associated with suffixes for tetrad grid refs.\n  * @type {Object}\n*/\n\nvar tOffsets = {\n  a: {\n    x: 0,\n    y: 0\n  },\n  b: {\n    x: 0,\n    y: 2000\n  },\n  c: {\n    x: 0,\n    y: 4000\n  },\n  d: {\n    x: 0,\n    y: 6000\n  },\n  e: {\n    x: 0,\n    y: 8000\n  },\n  f: {\n    x: 2000,\n    y: 0\n  },\n  g: {\n    x: 2000,\n    y: 2000\n  },\n  h: {\n    x: 2000,\n    y: 4000\n  },\n  i: {\n    x: 2000,\n    y: 6000\n  },\n  j: {\n    x: 2000,\n    y: 8000\n  },\n  k: {\n    x: 4000,\n    y: 0\n  },\n  l: {\n    x: 4000,\n    y: 2000\n  },\n  m: {\n    x: 4000,\n    y: 4000\n  },\n  n: {\n    x: 4000,\n    y: 6000\n  },\n  p: {\n    x: 4000,\n    y: 8000\n  },\n  q: {\n    x: 6000,\n    y: 0\n  },\n  r: {\n    x: 6000,\n    y: 2000\n  },\n  s: {\n    x: 6000,\n    y: 4000\n  },\n  t: {\n    x: 6000,\n    y: 6000\n  },\n  u: {\n    x: 6000,\n    y: 8000\n  },\n  v: {\n    x: 8000,\n    y: 0\n  },\n  w: {\n    x: 8000,\n    y: 2000\n  },\n  x: {\n    x: 8000,\n    y: 4000\n  },\n  y: {\n    x: 8000,\n    y: 6000\n  },\n  z: {\n    x: 8000,\n    y: 8000\n  }\n};\n\n/** @module src/getCentroid */\n\n/**\n * Given a grid reference (British National Grid, Irish Grid or UTM zone 30N shorthand),\n * and a two-letter code defining the requested output projection, this function\n * returns the centroid of the grid reference.\n * @param {string} gr - the grid reference\n * @param {string} toProjection - two letter code specifying the required output CRS.\n * @returns {object} - of the form {centroid: [x, y], proj: 'code'}; x and y are \n * coordinates in CRS specified by toProjection. The proj code indicates the source projection.\n */\nfunction getCentroid (gr, toProjection) {\n\n  let x, y, outCoords, suffix;\n  const grType = checkGr(gr);\n  const prefix = grType.prefix;\n  const km100 = km100s[prefix];\n\n  switch(grType.precision) {\n    case 100000:\n      x = km100.x * 100000 + 50000;\n      y = km100.y * 100000 + 50000;\n      break;\n    case 10000:\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,1)) * 10000 + 5000;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+1,1)) * 10000 + 5000;\n      break;\n    case 5000:\n      suffix = gr.substr(prefix.length+2,2).toLowerCase();\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,1)) * 10000 + qOffsets[suffix].x + 2500;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+1,1)) * 10000 + qOffsets[suffix].y + 2500;\n      break\n    case 2000:\n      suffix = gr.substr(prefix.length+2,1).toLowerCase();\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,1)) * 10000 + tOffsets[suffix].x + 1000;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+1,1)) * 10000 + tOffsets[suffix].y + 1000;\n      break\n    case 1000:\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,2)) * 1000 + 500;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+2,2)) * 1000 + 500;\n      break\n    case 100:\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,3)) * 100 + 50;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+3,3)) * 100 + 50;\n      break\n    case 10:\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,4)) * 10 + 5;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+4,4)) * 10 + 5;\n      break\n    default:\n      x = km100.x * 100000 + Number(gr.substr(prefix.length,5)) + 0.5;\n      y = km100.y * 100000 + Number(gr.substr(prefix.length+5,5)) + 0.5;\n  }\n\n  // If the required output projection does not match the projection of the input GR\n  // then use proj4 to reproject\n  if (toProjection !== km100.proj)  {\n    outCoords = proj4(projections[km100.proj].proj4, projections[toProjection].proj4, [x, y]);\n  } else {\n    outCoords = [x, y];\n  }\n  return {\n    centroid: outCoords,\n    proj: km100.proj\n  }\n}\n\n/** @module src/getGjson */\n\nfunction convertCoords(fromProjection, toProjection, x, y) {\n\n  let outCoords;\n  // If the required output projection does not match the projection of the input GR\n  // then use proj4 to reproject\n  if (toProjection !== fromProjection)  {\n    outCoords = proj4(projections[fromProjection].proj4, projections[toProjection].proj4, [x, y]);\n  } else {\n    outCoords = [x, y];\n  }\n  return outCoords\n}\n\n/**\n * Given a grid reference (British National Grid, Irish Grid or UTM zone 30N shorthand),\n * a two-letter code defining the requested output projection, and a string indicating\n * the shape of the required 'symbol', this function returns a GeoJson pth geometry object.\n * @param {string} gr - the grid reference.\n * @param {string} toProjection - two letter code specifying the required output CRS.\n * @param {string} shape - string specifying the requested output shape type.\n * @param {number} scale - number between 0 and 1 to scale the output object.\n * @returns {object} - a GeoJson path geometry object.\n * @todo Extend to return all symbol types\n */\nfunction getGjson (gr, toProjection, shape, scale) {\n\n  const size = scale ? scale : 1; \n  const grType = checkGr(gr);\n  const km100 = km100s[grType.prefix];\n  const centroid = getCentroid(gr, km100.proj).centroid;\n  const xmin = centroid[0] - grType.precision / 2 * size;\n  const xmax = centroid[0] + grType.precision / 2 * size;\n  const ymin = centroid[1] - grType.precision / 2 * size;\n  const ymax = centroid[1] + grType.precision / 2 * size;\n  const xmid = xmin + (xmax-xmin)/2;\n  const ymid = ymin + (ymax-ymin)/2;\n\n  let coords;\n  let type = \"Polygon\";\n  if (shape === \"square\") {\n    coords = [[\n      convertCoords(km100.proj, toProjection, xmin, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymin)\n    ]];\n  } else if (shape === \"triangle-up\") {\n    coords = [[\n      convertCoords(km100.proj, toProjection, xmin, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymin),\n      convertCoords(km100.proj, toProjection, xmid, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymin)\n    ]];\n  } else if (shape === \"triangle-down\") {\n    coords = [[\n      convertCoords(km100.proj, toProjection, xmid, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymax),\n      convertCoords(km100.proj, toProjection, xmid, ymin)\n    ]];\n  } else if (shape === \"diamond\") {\n    coords = [[\n      convertCoords(km100.proj, toProjection, xmid, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymid),\n      convertCoords(km100.proj, toProjection, xmid, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymid),\n      convertCoords(km100.proj, toProjection, xmid, ymin)\n    ]];\n  } else if (shape === \"circle\") {\n    const rad = grType.precision / 2 * size;\n    coords = [[]];\n    for(let deg  = 0; deg <= 360;  deg += 15){\n      const angle = deg * Math.PI / 180;\n      const x = rad * Math.cos(angle) + centroid[0];\n      const y = rad * Math.sin(angle) + centroid[1];\n      coords[0].push(convertCoords(km100.proj, toProjection, x, y));\n    }\n  } else if (shape === \"circlerad\") {\n    coords = [[\n      convertCoords(km100.proj, toProjection, centroid[0], centroid[1]),\n      convertCoords(km100.proj, toProjection, xmax, centroid[1])\n    ]];\n  } else if (shape === \"cross\") {\n    type = \"MultiLineString\";\n    coords = [\n      [convertCoords(km100.proj, toProjection, xmin, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymax),\n      convertCoords(km100.proj, toProjection, xmin, ymin)],\n      [convertCoords(km100.proj, toProjection, xmin, ymin),\n      convertCoords(km100.proj, toProjection, xmax, ymax)],\n      [convertCoords(km100.proj, toProjection, xmin, ymax),\n      convertCoords(km100.proj, toProjection, xmax, ymin)]\n    ];\n  } else if (shape === \"point\") {\n    type = \"Point\";\n    coords = convertCoords(km100.proj, toProjection, centroid[0], centroid[1]);\n  }\n\n  return {\n    \"type\": type,\n    \"coordinates\": coords\n  }\n}\n\n/** @module src/pntToArea */\nconst inside = pkg;\n\nconst polyGb = [[-5.079346,54.356181],[-5.218856,54.352538],[-5.238015,54.577735],[-5.594707,55.067578],[-5.85957,55.233056],[-6.1989,55.442175],[-6.754907,55.520643],[-6.826016,56.098271],[-8.4242,56.025199],[-8.577402,56.917818],[-8.739734,57.810026],[-8.911963,58.7018],[-7.193942,58.782764],[-7.332053,59.676983],[-5.560279,59.737099],[-3.782533,59.77326],[-3.831945,60.670683],[-2.001839,60.683214],[-2.0019,61.58096],[-0.119146,61.568018],[-0.17173,60.67074],[-0.22103,59.773315],[-0.267328,58.875744],[-2.00173,58.887355],[-2.00168,57.989238],[-0.310874,57.978026],[-0.351892,57.080161],[-2.001633,57.090993],[-2.001588,56.192619],[-0.390579,56.182148],[-0.427115,55.283988],[1.145328,55.253591],[1.076342,54.356271],[1.011037,53.458761],[2.513016,53.411393],[2.420466,52.515203],[2.332666,51.618767],[2.249301,50.722093],[0.834724,50.76511],[0.781771,49.866861],[-0.609132,49.891897],[-2.001337,49.900236],[-3.39354,49.891859],[-4.784439,49.866784],[-6.172738,49.825069],[-7.55716,49.766807],[-7.662447,50.661841],[-6.252021,50.721974],[-6.33545,51.618645],[-5.822792,52.024604],[-5.051366,52.558456],[-5.051366,52.558457],[-4.952011,52.560978],[-5.013966,53.458674],[-5.079346,54.356181]];\nconst polyIr = [[-10.863443,51.218565],[-10.920638,52.116175],[-10.980909,53.013601],[-11.044479,53.91084],[-11.111595,54.80789],[-11.182531,55.704747],[-9.592679,55.735662],[-8.000759,55.74598],[-6.781597,55.739941],[-6.754907,55.520643],[-6.419264,55.473617],[-6.1989,55.442175],[-5.85957,55.233056],[-5.594707,55.067578],[-5.413363,54.820209],[-5.238015,54.577735],[-5.218856,54.352538],[-5.079346,54.356181],[-5.046624,53.9131],[-5.013966,53.458674],[-5.001631,53.283731],[-5.020559,53.013619],[-5.051336,52.558457],[-5.051366,52.558457],[-5.051366,52.558456],[-5.673366,52.129388],[-5.822792,52.024604],[-6.33545,51.618645],[-6.299809,51.241244],[-6.568641,51.244838],[-8.000721,51.253594],[-9.432801,51.24483],[-10.863443,51.218565]];\nconst polyCi = [[-1.614831,49.644257],[-1.639721,48.744984],[-3,48.753013],[-3,49.652543],[-3,49.895922],[-2.001337,49.900236],[-1.607534,49.899573],[-1.614831,49.644257]];\n\n/**\n * Given a WGS 84 lon, lat pair, return the two letter code corresponding to the area\n * that the point is in. The three polygons describe the regions covered by the 100 km\n * squares for the British, Irish and Channel Island coordinate systems. These areas are\n * exclusive. Where they overlap, e.g. British and Irish, they have been divided by a line\n * through the Irish see roughly midway between the land masses. For the Channel Islands\n * and Britain, the CI UTM 30 grid is truncated where it overlaps the British grid. The\n * function returns the two-letter code corresponding to the area: gb, ir or ci.\n * It returns null if the point doesn't fall within any of these areas.\n * @param {number} lon - Longitude.\n * @param {number} lat - Latitude.\n * @returns {string} - Two-letter code corresponding to the area, or null.\n */\nfunction pntToArea (lon, lat) {\n  if (inside([ lon, lat ], polyGb)) return 'gb'\n  if (inside([ lon, lat ], polyIr)) return 'ir'\n  if (inside([ lon, lat ], polyCi)) return 'ci'\n  return null\n}\n\n/** @module src/getGrFromCoords */\n\n/**\n * Given a coordinate pair (British National Grid, Irish Grid, UTM zone 30N shorthand or WGS84),\n * a two-letter code defining the projection of the passed in coordinates,\n * a two-letter code defining the required output projection, and an array of numbers\n * indicating the required output precisions, returns an object with the grid references\n * at the requested precisions in the requested projection. If the requested projection is\n * an empty string, automatic selection will be used based on location of input coords.\n * @param {number} x - the x coordinate (longitude if in WGS 84).\n * @param {number} y - the y coordinate (latitude if in WGS 84).\n * @param {string} fromProjection - two letter code for projection of the passed in coords.\n * @param {string} toProjection - two letter code specifying the required output projection - leave empty for automatic selection.\n * @param {array<number>} precisions - array of numbers corresponding to the precisions of the requested grid references.\n * @returns {object} - of the form {p10000: 'gr-hectad', p100: 'gr-6fig'} etc, with a property for each of the requested grid reference precisions.\n */\nfunction getGrFromCoords (x, y, fromProjection, toProjection, precisions) {\n\n  // Set the output projection automatically if not aleady set\n  if (!toProjection) {\n    if (fromProjection === 'wg') {\n      toProjection = pntToArea(x, y);\n    } else {\n      const lonlat = proj4(projections[fromProjection].proj4, projections['wg'].proj4, [x, y]);\n      toProjection = pntToArea(lonlat[0], lonlat[1]);\n    }\n  }\n\n  if (!toProjection) {\n    const grs = {};\n    precisions.forEach(p => {\n      grs[`p${p}`] = null;\n    });\n    return grs\n  }\n  \n  // Convert input coordinates if the input projection does not match requested output projection\n  if (fromProjection !== toProjection)  {\n    const outCoords = proj4(projections[fromProjection].proj4, projections[toProjection].proj4, [x, y]);\n    x = outCoords[0];\n    y = outCoords[1];\n  }\n\n  let km100;\n  for (let i = 0; i < a100km.length; i++) {\n    if (a100km[i].proj === toProjection &&\n      x >= a100km[i].x * 100000 &&\n      x < (a100km[i].x + 1) * 100000 &&\n      y >= a100km[i].y * 100000 &&\n      y < (a100km[i].y + 1) * 100000) {\n\n      km100 = a100km[i];\n      break\n    }\n  }\n\n  if(!km100) {\n    // The output coordinates do not fall within the range of 100 km grid squares defined for the output projection.\n    // Return an empty array.\n    return {\n      p100000: null,\n      p10000: null,\n      p5000: null,\n      p2000: null,\n      p1000: null,\n      p100: null,\n      p10: null,\n      p1: null\n    }\n  }\n\n  const grs = {};\n  precisions.forEach(p => {\n    let gr = km100.GridRef;\n    if (p < 100000){\n\n      let divisor;\n      if (p === 5000 || p === 2000) {\n        divisor = 10000;\n      } else {\n        divisor = p;\n      }\n\n      const pad = {\n        10000: 1,\n        1000: 2,\n        100: 3,\n        10: 4,\n        1: 5\n      };\n\n      const dx = Math.floor((x - km100.x * 100000) / divisor);\n      const dy = Math.floor((y - km100.y * 100000) / divisor);\n      const sx = String(dx).padStart(pad[divisor], '0');\n      const sy = String(dy).padStart(pad[divisor], '0');\n\n      gr = `${gr}${sx}${sy}`;\n\n      if (p === 5000 || p === 2000) {\n        let rx = (x - km100.x * 100000) % divisor;\n        let ry = (y - km100.y * 100000) % divisor;\n        if (p === 5000) {\n\n          for (const suffix in qOffsets) {\n            if (rx >= qOffsets[suffix].x &&\n              rx < qOffsets[suffix].x + 5000 && \n              ry >= qOffsets[suffix].y &&\n              ry < qOffsets[suffix].y + 5000) {\n              gr = `${gr}${suffix.toUpperCase()}`;\n              break\n            }\n          }\n        } else {\n          for (const suffix in tOffsets) {\n            if (rx >= tOffsets[suffix].x &&\n              rx < tOffsets[suffix].x + 2000 && \n              ry >= tOffsets[suffix].y &&\n              ry < tOffsets[suffix].y + 2000) {\n              gr = `${gr}${suffix.toUpperCase()}`;\n              break\n            }\n          }\n        }\n      }\n    }\n    grs[`p${p}`] = gr;\n  });\n  return grs\n}\n\n/** @module src/getLowerResGrs */\n\n/**\n * Given a grid reference (British National Grid, Irish Grid, UTM zone 30N shorthand),\n * return an object with a corresponsing GR for each precision. For all precisions higher\n * than the precision of the passed in GR, the return GR is set to null. In the special\n * returned Quadrant (5 km) grid references are in an array to allow for the case where\n * the input grid reference is a tetrad and overlaps more than one quadrant.\n * @param {string} gr - Grid reference.\n * @returns {object} - of the form {p100000: 'gr-100km', p10000: 'gr-hectad', p5000: ['gr_quad1', ...], p2000: 'gr-tetrad', ...}, with a property for each precisions.\n */\nfunction getLowerResGrs (gr) {\n\n  const grType = checkGr(gr);\n\n  const ret = {\n    p100000: grType.prefix, \n    p10000: null, \n    p5000: grType.precision <= 5000 ? [] : null, \n    p2000: null, \n    p1000: null, \n    p100: null, \n    p10: null, \n    p1: null\n  };\n\n  // Set the passed in GR in the return value\n  if (grType.precision === 5000) {\n    ret.p5000.push(gr);\n  } else {\n    ret[`p${grType.precision}`] = gr;\n  }\n  \n  const c = getCentroid(gr, grType.projection).centroid;\n  const precisions = [10000, 5000, 2000, 1000, 100, 10, 1].filter(p => p > grType.precision);\n  const grs = getGrFromCoords(c[0], c[1], grType.projection, grType.projection, precisions);\n\n  precisions.forEach(p => {\n    if (p === 5000) {\n      if (grType.precision === 2000) {\n        const hectad = gr.substring(0,gr.length-1);\n        if ('ABCFGHKLM'.indexOf(gr.substr(-1)) > -1) {\n          ret.p5000.push(`${hectad}SW`);\n        }\n        if ('KLMQRSVWX'.indexOf(gr.substr(-1)) > -1) {\n          ret.p5000.push(`${hectad}SE`);\n        }\n        if ('CDEHIJMNP'.indexOf(gr.substr(-1)) > -1) {\n          ret.p5000.push(`${hectad}NW`);\n        }\n        if ('MNPSTUXYZ'.indexOf(gr.substr(-1)) > -1) {\n          ret.p5000.push(`${hectad}NE`);\n        }\n      } else {\n        ret.p5000.push(grs.p5000);\n      }\n    } else {\n      ret[`p${p}`] = grs[`p${p}`];\n    }\n  });\n  return ret\n}\n\nexport { checkGr, getCentroid, getGjson, getGrFromCoords, getLowerResGrs, pntToArea };\n","export const constants = {\r\n    thisCdn: 'https://cdn.jsdelivr.net/gh/biologicalrecordscentre/brc-charts@latest/dist'\r\n}","import { pie } from './src/pie/pie'\r\nimport { phen1 } from './src/phen1/phen1'\r\nimport { phen2 } from './src/phen2'\r\nimport { accum } from './src/accum'\r\nimport { links } from './src/links'\r\nimport { trend } from './src/trend'\r\nimport { trend2 } from './src/trend2/trend2'\r\nimport { trend3 } from './src/trend3/trend3'\r\nimport { density } from './src/density/density'\r\nimport { bar } from './src/bar/bar'\r\nimport { yearly } from './src/yearly/yearly'\r\nimport { temporal } from './src/temporal/temporal'\r\nimport { altlat } from './src/altlat'\r\nimport pkg from './package.json'\r\n\r\n// Output version from package json to console\r\n// to assist with trouble shooting.\r\nconsole.log(`Running ${pkg.name} version ${pkg.version}`)\r\n\r\nexport {\r\n  pie,\r\n  phen1,\r\n  phen2,\r\n  accum,\r\n  links,\r\n  trend,\r\n  trend2,\r\n  trend3,\r\n  density,\r\n  bar,\r\n  yearly,\r\n  temporal,\r\n  altlat\r\n} ","/** @module accum */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from './general'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG.\r\n * @param {string} opts.elid - The id for the dom object created.\r\n * @param {number} opts.width - The width of the main chart area in pixels (excludes margins).\r\n * @param {number} opts.height - The height of the main chart area in pixels (excludes margins).\r\n * @param {Object} opts.margin - An object indicating the margins to add around the main chart area. \r\n * @param {number} opts.margin.left - Left margin in pixels. \r\n * @param {number} opts.margin.right - Right margin in pixels. \r\n * @param {number} opts.margin.top - Top margin in pixels. \r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. \r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized.\r\n * @param {string} opts.title - Title for the chart.\r\n * @param {string} opts.subtitle - Subtitle for the chart.\r\n * @param {string} opts.footer - Footer for the chart.\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text.\r\n * @param {string} opts.axisLeft - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn otherwise not.\r\n * @param {string} opts.axisTaxaLabel - Value for labelling taxa accumulation axis.\r\n * @param {string} opts.axisCountLabel - Value for labelling count accumulation axis.\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axis labels.\r\n * @param {string} opts.show - Indicates whether to show accumulation curves for taxa, counts or both. Permitted values: 'taxa', 'counts' or 'both'.\r\n * @param {boolean} opts.swapYaxes - The default display is number of taxa on left axis and counts on right. Set this to true to swap that.\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds.\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'.\r\n * If empty, graphs for all taxa are created.\r\n * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input\r\n * data for which taxa and/or count accumulation lines should be generated on the chart.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>prop</b> - the name of the numeric property in the data (count properties - 'c1' or 'c2' in the example below).\r\n * <li> <b>labelTaxa</b> - a label for the taxa accumulation metric.\r\n * <li> <b>labelCounts</b> - a label for the counts accumulation metric.\r\n * <li> <b>key</b> - a base key for this metric. If the options are updated using the setChartOpts API method, then if this value is set, it is used to uniquely identify the graphic elements. If not set, then the label is used.\r\n * <li> <b>ColourTaxa</b> - optional colour to give the line for the taxa accumulation metric. Any accepted way of specifying web colours can be used. Use the special term 'fading' to successively fading shades of grey.\r\n * <li> <b>ColourCounts</b> - optional colour to give the line for the counts accumulation metric. Any accepted way of specifying web colours can be used. Use the special term 'fading' to successively fading shades of grey.\r\n * <li> <b>styleTaxa</b> - options style to give the line for the taxa accumulation metric. Accepted value is 'dashed' which results in a dashed line. Anything else results in a solid line.\r\n * <li> <b>styleCounts</b> - options style to give the line for the counts accumulation metric. Accepted value is 'dashed' which results in a dashed line. Anything else results in a solid line.\r\n * </ul>\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>week</b> - a number between 1 and 53 indicating the week of the year.\r\n * <li> <b>c1</b> - a count for a given time period (can have any name). \r\n * <li> <b>c2</b> - a count for a given time period (can have any name).\r\n * ... - there can be any number of these count columns.\r\n * </ul>\r\n * @returns {module:accum~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function accum({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'accum-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 0, right: 0, top: 0, bottom: 0},\r\n  ytype = 'count',\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = 'tick',\r\n  axisTop = '',\r\n  axisTaxaLabel = '',\r\n  axisCountLabel = '',\r\n  axisLabelFontSize = 10,\r\n  show = 'both',\r\n  swapYaxes = false,\r\n  duration = 1000,\r\n  interactivity = 'mousemove',\r\n  data = [],\r\n  metrics = []\r\n} = {}) {\r\n\r\n  let metricsPlus\r\n  \r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .attr('class', 'brc-chart-accum')\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, null, false)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart')\r\n\r\n  preProcessMetrics()\r\n  makeChart()\r\n\r\n  // Texts must come after chart because \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n  gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  gen.positionMainElements(svg, expand)\r\n\r\n  function preProcessMetrics () {\r\n    // Look for 'fading' colour in taxa and colour appropriately \r\n    // in fading shades of grey.\r\n    \r\n    let iFadingTaxa = 0\r\n    let iFadingCounts = 0\r\n    let iFadeTaxa, iFadeCounts, strokeWidth\r\n    metricsPlus = metrics.map(m => {\r\n      if (m.colourCounts === 'fading') {\r\n        iFadeCounts = ++iFadingCounts\r\n        strokeWidth = 1\r\n      } else {\r\n        strokeWidth = 2\r\n      }\r\n      if (m.colourTaxa === 'fading') {\r\n        iFadeTaxa = ++iFadingTaxa\r\n        strokeWidth = 1\r\n      } else {\r\n        strokeWidth = 2\r\n      }\r\n\r\n      return {\r\n        prop: m.prop,\r\n        key: m.key,\r\n        labelTaxa: m.labelTaxa,\r\n        labelCounts: m.labelCounts,\r\n        colourTaxa: m.colourTaxa,\r\n        colourCounts: m.colourCounts,\r\n        styleTaxa: m.styleTaxa,\r\n        styleCounts: m.styleCounts,\r\n        fadingTaxa: iFadeTaxa,\r\n        fadingCounts: iFadeCounts,\r\n        strokeWidth: strokeWidth\r\n      }\r\n    }).reverse()\r\n\r\n    const greyTaxa = d3.scaleLinear()\r\n      .range(['#808080', '#E0E0E0'])\r\n      .domain([1, iFadeTaxa])\r\n    const greyCounts = d3.scaleLinear()\r\n      .range(['#808080', '#E0E0E0'])\r\n      .domain([1, iFadeCounts])\r\n\r\n    metricsPlus.forEach(m => {\r\n      if (m.fadingTaxa) {\r\n        m.colourTaxa = greyTaxa(m.fadingTaxa)\r\n      }\r\n      if (m.fadingCounts) {\r\n        m.colourCounts = greyCounts(m.fadingCounts)\r\n      }\r\n    })\r\n  }\r\n\r\n  function makeChart () {\r\n\r\n    const showTaxa = (show === 'taxa' || show === 'both')\r\n    const showCounts = (show === 'counts' || show === 'both') \r\n    let lineData = [] \r\n\r\n    metricsPlus.forEach(m => {\r\n\r\n      const pointsTaxa = []\r\n      const pointsCount = []\r\n      let accumTaxa = []\r\n      let accumCount = 0\r\n\r\n      for (let week = 1; week <= 53; week++) {\r\n        // Taxa for this week and property (normally a year)\r\n        // Must have at least one non-zero) count to contribute to taxa count\r\n        const weekStats = data.filter(d => d.week === week).reduce((a, d) => {\r\n          a.total = a.total + d[m.prop]\r\n          if (!a.taxa.includes(d.taxon) && d[m.prop]) {\r\n            a.taxa.push(d.taxon)\r\n          }\r\n          return(a)\r\n        }, {total: 0, taxa: []})\r\n\r\n        accumTaxa = [...new Set([...accumTaxa, ...weekStats.taxa])]\r\n        accumCount = accumCount + weekStats.total\r\n        pointsTaxa.push({\r\n          num: weekStats.taxa.length,\r\n          accum: accumTaxa.length,\r\n          week: week\r\n        })\r\n        pointsCount.push({\r\n          num: weekStats.total,\r\n          accum: accumCount,\r\n          week: week\r\n        })\r\n      }\r\n\r\n      if (showTaxa) {\r\n        lineData.push({\r\n          id: `${gen.safeId(m.labelTaxa)}`,\r\n          key: m.key ? `${m.key}_taxa` : `${gen.safeId(m.labelTaxa)}`,\r\n          type: 'taxa',\r\n          label: m.labelTaxa,\r\n          colour: m.colourTaxa,\r\n          style: m.styleTaxa,\r\n          strokeWidth: m.strokeWidth,\r\n          max: Math.max(...pointsTaxa.map(p => p.accum)),\r\n          points: pointsTaxa\r\n        })\r\n      }\r\n\r\n      if (showCounts){\r\n        lineData.push({\r\n          id: `${gen.safeId(m.labelCounts)}`,\r\n          key: m.key ? `${m.key}_counts` : `${gen.safeId(m.labelCounts)}`,\r\n          type: 'count',\r\n          label: m.labelCounts,\r\n          colour: m.colourCounts,\r\n          style: m.styleCounts,\r\n          strokeWidth: m.strokeWidth,\r\n          max: Math.max(...pointsCount.map(p => p.accum)),\r\n          points: pointsCount\r\n        })\r\n      }\r\n    })\r\n\r\n    // Do the legend\r\n    const legendHeight = makeLegend(lineData)\r\n\r\n    // Value scales\r\n    const xScale = d3.scaleLinear().domain([1, 53]).range([0, width])\r\n    let yScaleCount, yScaleTaxa\r\n    if (showCounts) {\r\n      yScaleCount = d3.scaleLinear().domain([0, Math.max(...lineData.filter(l => l.type ==='count').map(l => l.max))]).range([height, 0])\r\n    }\r\n    if (showTaxa) {\r\n      yScaleTaxa = d3.scaleLinear().domain([0, Math.max(...lineData.filter(l => l.type ==='taxa').map(l => l.max))]).range([height, 0])\r\n    }\r\n\r\n    // Top axis\r\n    let tAxis\r\n    if (axisTop === 'on') {\r\n      tAxis = d3.axisTop()\r\n        .scale(xScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Bottom axis\r\n    let xAxis\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      xAxis = gen.xAxisMonth(width, axisBottom === 'tick')\r\n    }\r\n\r\n    const yScaleRight = swapYaxes ? yScaleTaxa : yScaleCount\r\n    const yScaleLeft = swapYaxes ?  yScaleCount : yScaleTaxa\r\n    \r\n    // Left axis\r\n    let yAxisLeft\r\n    if (axisLeft === 'on' || axisLeft === 'tick') {\r\n      if (yScaleLeft) {\r\n        yAxisLeft = d3.axisLeft()\r\n          .scale(yScaleLeft)\r\n          .ticks(5)\r\n        if (axisLeft !== 'tick') {\r\n          yAxisLeft.tickValues([]).tickSizeOuter(0)\r\n        } else if (ytype === 'count') {\r\n          yAxisLeft.tickFormat(d3.format(\"d\"))\r\n        }\r\n      } else {\r\n        yAxisLeft = d3.axisLeft()\r\n          .scale(d3.scaleLinear().range([height, 0]))\r\n          .tickValues([])\r\n          .tickSizeOuter(0)\r\n      }\r\n    }\r\n    // Right axis\r\n    let yAxisRight\r\n    if (axisRight === 'on' || axisRight === 'tick') {\r\n      if (yScaleRight) {\r\n        yAxisRight = d3.axisRight()\r\n          .scale(yScaleRight)\r\n          .ticks(5)\r\n        if (axisRight !== 'tick') {\r\n          yAxisRight.tickValues([]).tickSizeOuter(0)\r\n        } else if (ytype === 'count') {\r\n          yAxisRight.tickFormat(d3.format(\"d\"))\r\n        }\r\n      } else {\r\n        yAxisRight = d3.axisRight()\r\n          .scale(d3.scaleLinear().range([height, 0]))\r\n          .tickValues([])\r\n          .tickSizeOuter(0)\r\n      }\r\n    }\r\n    \r\n    // Line path generators\r\n    let lineTaxa\r\n    if (showTaxa) {\r\n      lineTaxa = d3.line()\r\n        .curve(d3.curveMonotoneX)\r\n        .x(d => xScale(d.week))\r\n        .y(d => yScaleTaxa(d.accum))\r\n    }\r\n\r\n    let lineCount\r\n    if (showCounts) {\r\n      lineCount = d3.line()\r\n        .curve(d3.curveMonotoneX)\r\n        .x(d => xScale(d.week))\r\n        .y(d => yScaleCount(d.accum))\r\n    }\r\n\r\n    // Create or get the relevant chart svg\r\n    let init, svgAccum, gAccum\r\n    if (svgChart.select('.brc-chart-accum').size()) {\r\n      svgAccum = svgChart.select('.brc-chart-accum')\r\n      gAccum = svgAccum.select('.brc-chart-accum-g')\r\n      init = false\r\n    } else {\r\n      svgAccum = svgChart.append('svg')\r\n        .classed('brc-chart-accum', true)\r\n        .style('overflow', 'visible')\r\n      gAccum = svgAccum.append('g')\r\n        .classed('brc-chart-accum-g', true)\r\n      init = true\r\n    }\r\n    \r\n    // Create/update the line paths with D3\r\n    const mlines = gAccum.selectAll(\"path\")\r\n      .data(lineData,  d => d.key)\r\n      \r\n    const eLines = mlines.enter()\r\n      .append(\"path\")\r\n      //.attr(\"class\", d => `accum-path accum-path-${d.id}`)\r\n      .attr(\"class\", d => `accum-path accum-path-${d.key}`)\r\n      .style(\"fill\", \"none\")\r\n      .attr(\"d\", d => {\r\n        const lineGen = d.type === 'taxa' ? lineTaxa : lineCount\r\n        return lineGen(d.points.map(p => {\r\n          return {\r\n            accum: 0,\r\n            week: p.week\r\n          }\r\n        }))\r\n      })\r\n\r\n    addEventHandlers(eLines)\r\n\r\n    mlines.merge(eLines)\r\n      .transition()\r\n      .duration(duration)\r\n      .attr(\"d\", d => {\r\n        const lineGen = d.type === 'taxa' ? lineTaxa : lineCount\r\n        return lineGen(d.points)\r\n      })\r\n      .attr(\"stroke\", d => d.colour)\r\n      .attr(\"stroke-dasharray\", d => d.style === 'dashed' ? '5,5' : '')\r\n      .attr(\"stroke-width\", d => d.strokeWidth)\r\n\r\n    mlines.exit()\r\n      .transition()\r\n      .duration(duration)\r\n      .attr(\"d\", d => {\r\n        const lineGen = d.type === 'taxa' ? lineTaxa : lineCount\r\n        return lineGen(d.points.map(p => {\r\n          return {\r\n            accum: 0,\r\n            week: p.week\r\n          }\r\n        }))\r\n      })\r\n      .remove()\r\n\r\n    if (init) {\r\n      const axisLeftPadX = margin.left ? margin.left : 0\r\n      const axisRightPadX = margin.right ? margin.right : 0\r\n      const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n      const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n      // Size SVG\r\n      svgAccum\r\n        .attr('width', width + axisLeftPadX + axisRightPadX)\r\n        .attr('height', height + axisBottomPadY + axisTopPadY + legendHeight)\r\n\r\n      // Position chart\r\n      gAccum.attr(\"transform\", `translate(${axisLeftPadX},${legendHeight + axisTopPadY})`)\r\n      \r\n      // Create axes and position within SVG\r\n      const leftYaxisTrans = `translate(${axisLeftPadX},${legendHeight + axisTopPadY})`\r\n      const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${legendHeight + axisTopPadY + height/2}) rotate(270)`\r\n      const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${legendHeight + axisTopPadY})`\r\n      const rightYaxisLabelTrans = `translate(${axisLeftPadX + width + axisRightPadX - axisLabelFontSize}, ${legendHeight + axisTopPadY + height/2}) rotate(90)`\r\n\r\n      if (yAxisLeft) {\r\n        const axisLabelClass = swapYaxes ? 'brc-accum-axis-count' : 'brc-accum-axis-taxa'\r\n        const gYaxisLeft = svgAccum.append(\"g\")\r\n          .attr(\"class\", \"y-axis y-axis-left\")\r\n          .classed(axisLabelClass, true)\r\n        gYaxisLeft.attr(\"transform\", leftYaxisTrans)\r\n\r\n        if ((!swapYaxes && showTaxa) || (swapYaxes && showCounts )) {\r\n          const axisLeftLabel = swapYaxes ? axisCountLabel : axisTaxaLabel\r\n          const tYaxisLeftLabel = svgAccum.append(\"text\")\r\n            .classed(axisLabelClass, true)\r\n            .style(\"text-anchor\", \"middle\")\r\n            .style('font-size', axisLabelFontSize)\r\n            .text(axisLeftLabel) \r\n          tYaxisLeftLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n        }\r\n      }\r\n\r\n      if (yAxisRight) {\r\n        const axisLabelClass = swapYaxes ? 'brc-accum-axis-taxa' : 'brc-accum-axis-count'\r\n        const gYaxisCount = svgAccum.append(\"g\")\r\n          .attr(\"class\", \"y-axis y-axis-right\")\r\n          .classed(axisLabelClass, true)\r\n        gYaxisCount.attr(\"transform\", rightYaxisTrans)\r\n\r\n        if ((!swapYaxes && showCounts) || (swapYaxes && showTaxa )) {\r\n          const axisRightLabel = swapYaxes ? axisTaxaLabel : axisCountLabel\r\n          const tYaxisCountLabel = svgAccum.append(\"text\")\r\n            .classed(axisLabelClass, true)\r\n            .style(\"text-anchor\", \"middle\")\r\n            .style('font-size', axisLabelFontSize)\r\n            .text(axisRightLabel) \r\n          tYaxisCountLabel.attr(\"transform\", rightYaxisLabelTrans)\r\n        }\r\n      }\r\n\r\n      if (xAxis) {\r\n        const gXaxis = svgAccum.append(\"g\")\r\n          .attr(\"class\", \"x axis\")\r\n          .call(xAxis)\r\n\r\n        gXaxis.selectAll(\".tick text\")\r\n          .style(\"text-anchor\", \"start\")\r\n          .attr(\"x\", 6)\r\n          .attr(\"y\", 6)\r\n\r\n        gXaxis.attr(\"transform\", `translate(${axisLeftPadX},${legendHeight + axisTopPadY + height})`)\r\n      }\r\n      if (tAxis) {\r\n        const gTaxis = svgAccum.append(\"g\")\r\n          .call(tAxis)\r\n        gTaxis.attr(\"transform\", `translate(${axisLeftPadX},${legendHeight + axisTopPadY})`)\r\n      }\r\n    }\r\n\r\n    if (yAxisLeft) {\r\n      svgAccum.select(\".y-axis-left\")\r\n        .transition()\r\n        .duration(duration)\r\n        .call(yAxisLeft)\r\n    }\r\n\r\n    if (yAxisRight) {\r\n      svgAccum.select(\".y-axis-right\")\r\n        .transition()\r\n        .duration(duration)\r\n        .call(yAxisRight)\r\n    }\r\n\r\n    svgChart.attr(\"width\", svgAccum.attr('width'))\r\n    svgChart.attr(\"height\", svgAccum.attr('height'))\r\n\r\n    return svgAccum\r\n  }\r\n\r\n  function makeLegend (lineData) {\r\n\r\n    const legendWidth = width + margin.left + margin.right\r\n    const swatchSize = 20\r\n    const swatchFact = 1.3\r\n\r\n    // Loop through all the legend elements and work out their positions\r\n    // based on swatch size, item label text size and legend width.\r\n    const metricsReversed = gen.cloneData(lineData).reverse()\r\n\r\n    let rows = 0\r\n    let lineWidth = -swatchSize\r\n    metricsReversed.forEach(m => {\r\n      const tmpText = svgChart.append('text')\r\n        .text(m.label)\r\n        .style('font-size', legendFontSize)\r\n\r\n      const widthText = tmpText.node().getBBox().width\r\n      tmpText.remove()\r\n\r\n      if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n        ++rows\r\n        lineWidth = -swatchSize\r\n      }\r\n      m.x = lineWidth + swatchSize\r\n      m.y = rows * swatchSize * swatchFact\r\n\r\n      lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n    })\r\n    \r\n    const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n      .data(metricsReversed, m => m.key)\r\n      .join(enter => {\r\n          const path = enter.append(\"path\")\r\n            .attr(\"class\", m => `brc-legend-item brc-legend-item-rect brc-legend-item-${m.key}`)\r\n            .attr('d', m => `M ${m.x} ${m.y + swatchSize/2} L ${m.x + swatchSize} ${m.y + swatchSize/2}`)\r\n          return path\r\n      })\r\n      .attr('fill', m => m.colour)\r\n      .attr(\"stroke\", m => m.colour)\r\n      .attr(\"stroke-dasharray\", m => m.style === 'dashed' ? '5,5' : '')\r\n      .attr(\"stroke-width\", m => m.strokeWidth)\r\n\r\n    const lt = svgChart.selectAll('.brc-legend-item-text')\r\n      .data(metricsReversed, m => m.key)\r\n      .join(\r\n        enter => {\r\n          const text = enter.append(\"text\")\r\n            .attr(\"class\", m=> `brc-legend-item brc-legend-item-text brc-legend-item-${m.key}`)\r\n            .style('font-size', legendFontSize)\r\n          return text\r\n        })\r\n      .text(m => m.label)\r\n      .attr('x', m => m.x + swatchSize * swatchFact)\r\n      .attr('y', m => m.y + legendFontSize * 1)\r\n\r\n    addEventHandlers(ls)\r\n    addEventHandlers(lt)\r\n\r\n    return swatchSize * swatchFact * (rows + 1)\r\n  }\r\n\r\n  function highlightItem(key, type, highlight) {\r\n\r\n    // Graph lines\r\n    svgChart.selectAll('.accum-path')\r\n      .classed('lowlight', highlight)\r\n\r\n    svgChart.selectAll(`.accum-path-${key}`)\r\n      .classed('lowlight', false)\r\n  \r\n    svgChart.selectAll(`.accum-path`)\r\n      .classed('highlight', false)\r\n\r\n    if (key) {\r\n      svgChart.selectAll(`.accum-path-${key}`)\r\n        .classed('highlight', highlight)\r\n    }\r\n    \r\n    // Legend items\r\n    svgChart.selectAll('.brc-legend-item')\r\n      .classed('lowlight', highlight)\r\n\r\n    if (key) {\r\n      svgChart.selectAll(`.brc-legend-item-${key}`)\r\n        .classed('lowlight', false)\r\n    }\r\n\r\n    if (key) {\r\n      svgChart.selectAll(`.brc-legend-item-${key}`)\r\n        .classed('highlight', highlight)\r\n    } else {\r\n      svgChart.selectAll(`.brc-legend-item`)\r\n        .classed('highlight', false)\r\n    }\r\n\r\n    // Axes and axis labels\r\n    svgChart.selectAll('.brc-accum-axis-taxa, .brc-accum-axis-count')\r\n      .classed('lowlight', highlight)\r\n\r\n    if (key) {\r\n      svgChart.selectAll(`.brc-accum-axis-${type}`)\r\n        .classed('lowlight', false)\r\n    }\r\n\r\n    if (key) {\r\n      svgChart.selectAll(`.brc-accum-axis-${type}`)\r\n        .classed('highlight', highlight)\r\n    } else {\r\n      svgChart.selectAll(`.brc-accum-axis-taxa, .brc-accum-axis-count`)\r\n        .classed('highlight', false)\r\n    }\r\n  }\r\n\r\n  function addEventHandlers(sel) {\r\n    sel\r\n      .on(\"mouseover\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d.key, d.type, true)\r\n        }\r\n      })\r\n      .on(\"mouseout\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d.key,  d.type, false)\r\n        }\r\n      })\r\n      .on(\"click\", function(d) {\r\n        if (interactivity === 'mouseclick') {\r\n          highlightItem(d.key, d.type, true)\r\n          d3.event.stopPropagation()\r\n        }\r\n      })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input data (see main interface for details).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @description <b>This function is exposed as a method on the API returned from the accum function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let remakeChart = false\r\n\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('metrics' in opts) {\r\n      metrics = opts.metrics\r\n      preProcessMetrics()\r\n      remakeChart = true\r\n    }\r\n\r\n    if (remakeChart) makeChart()\r\n    gen.positionMainElements(svg, expand)\r\n  }\r\n\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the accum function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the accum function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the accum function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return gen.saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:accum~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:accum~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:accum~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:accum~setChartOpts} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:accum~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module altlat */\r\n\r\nimport * as d3 from 'd3'\r\nimport { makeText, positionMainElements, safeId, saveChartImage, transPromise } from './general'\r\nimport { getCentroid } from 'brc-atlas-bigr'\r\nimport { constants } from './constants.js'\r\nimport backData from './altlat.json'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG. (Default - 'body'.)\r\n * @param {string} opts.elid - The id for the dom object created. (Default - 'altlat-chart'.)\r\n * @param {number} opts.width - The width of each sub-chart area in pixels. (Default - 300.)\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels. (Default - 200.)\r\n * @param {Object} opts.margin - An object indicating the margins to add around each sub-chart area.\r\n * @param {number} opts.margin.left - Left margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.right - Right margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.top - Top margin in pixels. (Default - 20.)\r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. (Default - 20.)\r\n * @param {number} opts.perRow - The number of sub-charts per row. (Default - 2.)\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized. (Default - false.)\r\n * @param {string } opts.font - Font to use for chart. (Default - sans-serif.)\r\n * @param {string} opts.title - Title for the chart. (Default - ''.)\r\n * @param {string} opts.subtitle - Subtitle for the chart. (Default - ''.)\r\n * @param {string} opts.footer - Footer for the chart. (Default - ''.)\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title. (Default - 24.)\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle. (Default - 16.)\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer. (Default - 10.)\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph. (Default - true.)\r\n * @param {boolean} opts.showLegend - Whether or not to show an overall chart legend. (Default - true.)\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label. (Default - 10.)\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.(Default - true.)\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text. (Default - 10.)\r\n * @param {number | null} opts.legendSpacing - A value (pixels) the separate the centres of the legend cirles. If not set, calcualted automatically. (Default - null.)\r\n * @param {string} opts.legendBaseline - Allows the 'dominant-baseline' CSS property to be set on legend text. (Default - 'central'.)\r\n * @param {number} opts.legendXoffset - Allows the legend to be positioned precisely. This is the x value in pixels. (Default - 1050.)\r\n * @param {number} opts.legendYoffset - Allows the legend to be positioned precisely. This is the y value in pixels. (Default - 1150.)* @param {string} opts.axisLeftLabel - Value for labelling left axis. (Default - 'Altitude (m)'.)\r\n * @param {string} opts.axisBottomLabel - Value for labelling bottom axis. (Default - 'Distance north (km)'.)\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axist labels. (Default - 10.)\r\n * @param {string} opts.axisLeft -  If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn without ticks. Any other value results in no axis. (Default - ''.)\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn without ticks. Any other value results in no axis. (Default - ''.)\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {string | number | null} opts.axisTickFontSize - Sets the font size of the axis values. Will accept any valid SVG font-size units. If not set, uses D3 default. (Default - null.)\r\n * @param {boolean} opts.yAxisLabelToTop - If set to true the y-axis label is moved to the top of the axis and not rotated. (Default - false.)\r\n * @param {string | number} opts.lineWidth - Sets the stroke-width of all lines on the chart. Can use any permitted SVG stroke-width units. (Default - 1.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds. (Default - 1000.)\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick', 'toggle' or 'none'. (Default - 'none'.)\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * For each taxon, there is assumed to be a single data item for each rounded distance/altitude combination for which there is a metric value.\r\n * <ul>\r\n * <li> <b>taxon</b> - The taxon for which this point refers.\r\n * <li> <b>distance</b> - The distance north (OS northing) in kilometers rounded down to the nearest 50 km.\r\n * <li> <b>altitude</b> - The altitude (asl) in metres rounded down to the nearest 100 m.\r\n * <li> <b>metric</b> - a metric (number) for the given distance and altitude. \r\n * </ul>\r\n * @param {Array.<Object>} opts.ranges - Specifies an array of objects defining ranges for displaying the metrics.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order affects how they appear in the legend.)\r\n * <ul>\r\n * <li> <b>min</b> - The minimum metric value to be included in this range.\r\n * <li> <b>max</b> - The maximum metric value to be included in this range.\r\n * <li> <b>radius</b> - The radius of the dot to be drawn for this range.\r\n * <li> <b>legend</b> - Text for the legend item for this range. \r\n * </ul>\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created. (Default - [].)\r\n * @returns {module:altlat~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function altlat({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'altlat-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 30, right: 30, top: 15, bottom: 15},\r\n  perRow = 2,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  font = 'sans-serif',\r\n  lineWidth = 1,\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 10,\r\n  showLegend = true,\r\n  legendSpacing = null,\r\n  axisLeftLabel = 'Altitude (m)',\r\n  axisBottomLabel = 'Distance north (km)',\r\n  axisLabelFontSize = 10,\r\n  axisTickFontSize = null,\r\n  yAxisLabelToTop = false,\r\n  legendBaseline = 'central',\r\n  legendXoffset = 1050,\r\n  legendYoffset = 1150,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 10,\r\n  taxonLabelItalics = false,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  duration = 1000,\r\n  interactivity = 'none',\r\n  data = [],\r\n  taxa = [],\r\n  ranges = [],\r\n} = {}) {\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem({}, false)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart brc-chart-altlat')\r\n\r\n  // Value scales\r\n  const xScale = d3.scaleLinear().domain([0, 1250]).range([0, width])\r\n  const yScale = d3.scaleLinear().domain([0, 1200]).range([height, 0])\r\n  \r\n  makeChart().then(() => {\r\n    // Texts must come after chartbecause \r\n    // the chart width is required\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n    positionMainElements(svg, expand)\r\n\r\n    svg.selectAll('rect, path, line').style('stroke-width', lineWidth)\r\n  })\r\n  \r\n  function makeChart () {\r\n\r\n    // If taxa for graphs not set, set to all in dataset\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    const subChartPad = 10\r\n    const pSvgsTaxa = taxa.map(t => makeAltLat(t))\r\n\r\n    return Promise.all(pSvgsTaxa).then(svgsTaxa => {\r\n      const subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n      const subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n\r\n      svgsTaxa.forEach((svgTaxon, i) => {\r\n        \r\n        const col = i%perRow\r\n        const row = Math.floor(i/perRow)\r\n\r\n        svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n        svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad))\r\n      })\r\n\r\n      svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n      svgChart.attr(\"height\", Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n    })\r\n  }\r\n\r\n  function makeAltLat (taxon) {\r\n\r\n    // Filter out any empty rows\r\n    data = data.filter(d => d.metric !== 0)\r\n\r\n    // Top axis\r\n    let tAxis\r\n    if (axisTop === 'on') {\r\n      tAxis = d3.axisTop()\r\n        .scale(xScale) // Actual scale doesn't matter, but needs one\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Bottom axis\r\n    let bAxis\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      const tickVals = axisBottom === 'tick' ? [200, 400, 600, 800, 1000, 1200] : []\r\n      bAxis = d3.axisBottom()\r\n        .scale(xScale)\r\n        .tickValues(tickVals) // km north\r\n        .tickFormat(d3.format(\"d\"))\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Left axis\r\n    let lAxis\r\n    if (axisLeft === 'on' || axisLeft === 'tick') {\r\n      const tickVals = axisLeft === 'tick' ? [200, 400, 600, 800, 1000, 1200] : []\r\n      lAxis = d3.axisLeft()\r\n        .scale(yScale)\r\n        .tickValues(tickVals) // m above sea level\r\n        .tickFormat(d3.format(\"d\"))\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // right axis\r\n    let rAxis\r\n    if (axisRight === 'on') {\r\n      rAxis = d3.axisRight()\r\n        .scale(yScale) // Actual scale doesn't matter, but needs one\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Create or get the relevant chart svg\r\n    let init, svgAltLat, gAltLat\r\n    if (taxa.length === 1 && svgChart.selectAll('.brc-chart-altlat').size() === 1) {\r\n      svgAltLat = svgChart.select('.brc-chart-altlat')\r\n      gAltLat = svgAltLat.select('.brc-chart-altlat-g')\r\n      init = false\r\n    } else if (svgChart.select(`#${safeId(taxon)}`).size()) {\r\n      svgAltLat = svgChart.select(`#${safeId(taxon)}`)\r\n      gAltLat = svgAltLat.select('.brc-chart-altlat-g')\r\n      init = false\r\n    } else {\r\n      svgAltLat = svgChart.append('svg')\r\n        .classed('brc-chart-altlat', true)\r\n        .attr('id', safeId(taxon))\r\n        .style('overflow', 'visible')\r\n      gAltLat = svgAltLat.append('g')\r\n        .classed('brc-chart-altlat-g', true)\r\n      init = true\r\n    }\r\n\r\n    const backSquareWidth = xScale(50)\r\n    const backSquareHeight = height - yScale(100)\r\n\r\n    // Create the background squares\r\n    gAltLat.selectAll(\"rect\")\r\n      .data(backData)\r\n      .join(\r\n        enter => enter.append(\"rect\")\r\n          .attr('width',backSquareWidth)\r\n          .attr('height',backSquareHeight)\r\n          .attr('stroke', 'black')\r\n          .attr('stroke-width', 0.5)\r\n          .attr('fill', d => {\r\n            if (d[1] < 200) {\r\n              return 'white'\r\n            }\r\n            if (d[1] < 400) {\r\n              return '#CCE192'\r\n            }\r\n             if (d[1] < 600) {\r\n              return '#AED367'\r\n            }\r\n             if (d[1] < 800) {\r\n              return '#ECDA49'\r\n            }\r\n             if (d[1] < 1000) {\r\n              return '#D9A738'\r\n            }\r\n            return '#BE8D66'\r\n          })\r\n          .attr('y', d => yScale(d[1]) - backSquareHeight)\r\n          .attr('x', d => xScale(d[0])),\r\n      )\r\n  \r\n    // Create the metric circles\r\n    const t = svgAltLat.transition()\r\n      .duration(duration)\r\n\r\n    const mainTrans = gAltLat.selectAll(\".brc-altlat-metric-circle\")\r\n      .data(data, d => `${d.distance}-${d.altitude}`)\r\n      .join(\r\n        enter => enter.append(\"circle\")\r\n          .attr(\"r\", 0)\r\n          .attr(\"cx\", d => xScale(d.distance + 25))\r\n          .attr(\"cy\", d => yScale(d.altitude + 50)),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => exit.transition(t)\r\n            .attr(\"r\", 0)\r\n            .remove())\r\n      )\r\n      .attr(\"class\", d => `brc-altlat-metric-circle brc-altlat brc-altlat-${getRadius(d.metric)}`)\r\n      .transition(t)\r\n        // The selection returned by the join function is the merged\r\n        // enter and update selections\r\n        .attr(\"r\", d => xScale(getRadius(d.metric)))\r\n\r\n    addEventHandlers(gAltLat.selectAll(\".brc-altlat-metric-circle\"))\r\n        \r\n    if (init) {\r\n\r\n      // Constants for positioning\r\n      const axisLeftPadX = margin.left ? margin.left : 0\r\n      const axisRightPadX = margin.right ? margin.right : 0\r\n      const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n      const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n      // Taxon title\r\n      if (showTaxonLabel) {\r\n        const taxonLabel = svgAltLat\r\n          .append('text')\r\n          .classed('brc-chart-altlat-label', true)\r\n          .text(taxon)\r\n          .style('font-family', font)\r\n          .style('font-size', taxonLabelFontSize)\r\n          .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n        const labelHeight = taxonLabel.node().getBBox().height\r\n        taxonLabel.attr(\"transform\", `translate(${axisLeftPadX}, ${labelHeight})`)\r\n      }\r\n      \r\n      // Size SVG\r\n      svgAltLat\r\n        .attr('width', width + axisLeftPadX + axisRightPadX)\r\n        .attr('height', height + axisBottomPadY + axisTopPadY)\r\n\r\n      // Position chart and legend\r\n      gAltLat.attr(\"transform\", `translate(${axisLeftPadX},${axisTopPadY})`)\r\n      \r\n      // Create axes and position within SVG\r\n      const leftYaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n      //const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${axisTopPadY + height/2}) rotate(270)`\r\n      let leftYaxisLabelTrans\r\n      if (yAxisLabelToTop) {\r\n        leftYaxisLabelTrans = `translate(0,0)`\r\n      } else {\r\n        leftYaxisLabelTrans = `translate(0,${axisTopPadY + height/2}) rotate(270)`\r\n      }\r\n      const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${axisTopPadY})`\r\n      const topXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n      const bottomXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY + height})`\r\n      const bottomXaxisLabelTrans = `translate(${axisLeftPadX + width/2},  ${height + axisTopPadY + axisBottomPadY})`\r\n\r\n      // Create axes and position within SVG\r\n      if (lAxis) {\r\n        const gLaxis = svgAltLat.append(\"g\")\r\n          .style('font-family', font)\r\n          .style('font-size', axisTickFontSize)\r\n          .call(lAxis)\r\n        gLaxis.attr(\"transform\", leftYaxisTrans)\r\n      }\r\n      if (bAxis) {\r\n        const gBaxis = svgAltLat.append(\"g\")\r\n          .style('font-family', font)\r\n          .style('font-size', axisTickFontSize)\r\n          .call(bAxis)\r\n        gBaxis.attr(\"transform\", bottomXaxisTrans)\r\n      }\r\n      if (tAxis) {\r\n        const gTaxis = svgAltLat.append(\"g\")\r\n          .style('font-family', font)\r\n          .style('font-size', axisTickFontSize)\r\n          .call(tAxis)\r\n        gTaxis.attr(\"transform\", topXaxisTrans)\r\n      }\r\n      if (rAxis) {\r\n        const gRaxis = svgAltLat.append(\"g\")\r\n          .style('font-family', font)\r\n          .style('font-size', axisTickFontSize)\r\n          .call(rAxis)\r\n        gRaxis.attr(\"transform\", rightYaxisTrans)\r\n      }\r\n\r\n      const tYaxisLabel = svgAltLat.append(\"text\")\r\n        .style(\"text-anchor\", yAxisLabelToTop ? \"left\" : \"middle\")\r\n        .style('font-size', axisLabelFontSize)\r\n        .style('font-family', font)\r\n        .style('dominant-baseline', 'hanging')\r\n        .text(axisLeftLabel) \r\n      tYaxisLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n\r\n      const tXaxisLabel = svgAltLat.append(\"text\")\r\n        .style(\"text-anchor\", \"middle\")\r\n        .style('font-size', axisLabelFontSize)\r\n        .style('font-family', font)\r\n        .text(axisBottomLabel) \r\n      tXaxisLabel.attr(\"transform\", bottomXaxisLabelTrans)\r\n\r\n    } else if (taxa.length === 1) {\r\n      // Update taxon label\r\n      if (showTaxonLabel) {\r\n        svgAltLat.select('.brc-chart-altlat-label').text(taxon)\r\n      }\r\n    }\r\n\r\n    // Make the legend\r\n    let pLegend\r\n    if (showLegend) {\r\n      pLegend = makeLegend(gAltLat)\r\n    } else {\r\n      pLegend = Promise.resolve()\r\n    }\r\n\r\n    // Return a promise which resolves to the svg when transitions complete\r\n    return new Promise((resolve) => {\r\n\r\n      const pTrans = [pLegend]\r\n      transPromise(mainTrans, pTrans)\r\n\r\n      Promise.allSettled(pTrans).then(() => {\r\n        resolve(svgAltLat)\r\n      })//.catch(e => console.log(e))\r\n    })\r\n  }\r\n\r\n  function makeLegend (gAltLat) {\r\n\r\n    const items = ranges.map(r => {\r\n      return {\r\n        text: r.legend,\r\n        radiusTrans: xScale(r.radius),\r\n        radius: r.radius\r\n      }\r\n    })\r\n\r\n    const maxRadius = Math.max(...items.map(i => i.radiusTrans))\r\n    let spacing\r\n    if (legendSpacing) {\r\n      spacing = legendSpacing\r\n    } else {\r\n      spacing = maxRadius * 2.2\r\n    }\r\n\r\n    const xOffset = xScale(legendXoffset)\r\n    const yOffset = yScale(legendYoffset)\r\n\r\n    const t = gAltLat.transition()\r\n      .duration(duration)\r\n\r\n    const lt = gAltLat.selectAll('.brc-altlat-legend-item-text')\r\n      .data(items, i => safeId(i.text))\r\n      .join(\r\n        enter => {\r\n          const text = enter.append(\"text\")\r\n            .text(i => i.text)\r\n            .style('font-family', font)\r\n            .style('font-size', legendFontSize)\r\n            .style('dominant-baseline', legendBaseline)\r\n            .attr('x', xOffset + maxRadius * 1.3)\r\n            .attr('y', (i,j) => yOffset + spacing * j)\r\n            .style('opacity', 0)\r\n          return text\r\n        },\r\n        update => update\r\n      )\r\n      .attr(\"class\", i => `brc-altlat-legend-item-text brc-altlat brc-altlat-${i.radius}`)\r\n\r\n    const ls = gAltLat.selectAll('.brc-altlat-legend-item-circle')\r\n      .data(items, i => safeId(i.text))\r\n      .join(\r\n        enter => {\r\n          const swatches = enter.append(\"circle\")\r\n            .attr('r', 0)\r\n            .attr('cx', xOffset)\r\n            .attr('cy', (i,j) => yOffset + spacing * j)\r\n          return swatches\r\n        },\r\n        update => update\r\n      )\r\n      .attr(\"class\", i => `brc-altlat-legend-item-circle brc-altlat brc-altlat-${i.radius}`)\r\n\r\n    const textTrans = lt.transition(t)\r\n      .attr('x', xOffset + maxRadius * 1.3)\r\n      .attr('y', (i,j) => yOffset + spacing * j)\r\n      .style('opacity', 1)\r\n\r\n    const swatchTrans = ls.transition(t)\r\n      .attr('r', i => i.radiusTrans)\r\n      .attr('cx', xOffset)\r\n      .attr('cy', (i,j) => yOffset + spacing * j)\r\n\r\n    addEventHandlers(ls)\r\n    addEventHandlers(lt)\r\n\r\n    const pTrans = []\r\n    transPromise(swatchTrans, pTrans)\r\n    transPromise(textTrans, pTrans)\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n\r\n  function getRadius (metric) {\r\n    for (let i=0; i<ranges.length; i++) {\r\n      if (metric >= ranges[i].min && metric <= ranges[i].max) {\r\n        return ranges[i].radius\r\n      }\r\n    }\r\n  }\r\n\r\n  function highlightItem(d, highlight) {\r\n\r\n    svgChart.selectAll(`.brc-altlat`)\r\n      .classed('lowlight', false)\r\n\r\n    const rad = d.radius ? d.radius : d.metric ? getRadius(d.metric) : null\r\n\r\n    if (highlight && rad) {\r\n      svgChart.selectAll(`.brc-altlat`)\r\n        .classed('lowlight', true)\r\n\r\n      svgChart.selectAll(`.brc-altlat-${rad}`)\r\n        .classed('lowlight', false)\r\n    }\r\n  }\r\n\r\n  function highlightItemToggle(d) {\r\n    const rad = d.radius ? d.radius : d.metric ? getRadius(d.metric) : null\r\n    if (rad) {\r\n      const lowlighted = svgChart.selectAll(`.brc-altlat-${rad}`).classed('lowlight')\r\n      svgChart.selectAll(`.brc-altlat-${rad}`).classed('lowlight', !lowlighted)\r\n    }\r\n  }\r\n\r\n  function addEventHandlers(sel) {\r\n    sel\r\n      .on(\"mouseover\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d, true)\r\n        }\r\n      })\r\n      .on(\"mouseout\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d, false)\r\n        }\r\n      })\r\n      .on(\"click\", function(d) {\r\n        if (interactivity === 'mouseclick') {\r\n          highlightItem(d, true)\r\n          d3.event.stopPropagation()\r\n        }\r\n        if (interactivity === 'toggle') {\r\n          highlightItemToggle(d)\r\n          d3.event.stopPropagation()\r\n        }\r\n      })\r\n  }\r\n\r\n/** @function dataFromTetrads\r\n  * @param {Array.<string>} tetrads\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * This function takes a single list of tetrad references and returns a promise that resolves to a\r\n  * data object suitable for displaying with the chart.\r\n  */\r\n  function dataFromTetrads(tetrads) {\r\n\r\n    let altlatTetrads \r\n    if (location.hostname === \"localhost\" || location.hostname === \"127.0.0.1\") {\r\n      altlatTetrads = `../dist/altlat-tetrads.csv`\r\n    } else {\r\n      altlatTetrads = `${constants.thisCdn}/altlat-tetrads.csv`\r\n    }\r\n\r\n    return d3.csv(altlatTetrads).then(function(altlat){\r\n\r\n      // To maximise the performance of this function, both the altlat and tetrad arrays\r\n      // are sorted on tetrad name. Then when we loop the tetrad array, when a match is\r\n      // found and the tetrad processed, all the leading tetrads in the altlat list, up\r\n      // to and including the matched tetrad, are removed from the list.\r\n\r\n      const altlatSorted = altlat.sort((a,b) => {\r\n        if (a.tetrad < b.tetrad) {\r\n          return -1\r\n        }\r\n        if (a.tetrad > b.tetrad) {\r\n          return 1\r\n        }\r\n        return 0\r\n      })\r\n\r\n      const tetradsSorted = tetrads.sort((a,b) => {\r\n        if (a.tetrad < b.tetrad) {\r\n          return -1\r\n        }\r\n        if (a.tetrad > b.tetrad) {\r\n          return 1\r\n        }\r\n        return 0\r\n      })\r\n\r\n      const groups = []\r\n\r\n      console.time(\"process tetrads\")\r\n      tetradsSorted.forEach(t => {\r\n        //const tmi = altlatSorted.findIndex(al => al.tetrad === t)\r\n        // A for loop is faster that the findIndex array method\r\n        let tmi\r\n        for (let i=0; i<altlatSorted.length; i++) {\r\n          if (altlatSorted[i].tetrad === t) {\r\n            tmi = i\r\n            break\r\n          }\r\n        }\r\n        const tm = altlatSorted[tmi]\r\n    \r\n        if (tm) {\r\n          const c = getCentroid(t, 'gb')\r\n          const distance = c.centroid[1]/1000\r\n          const gDistance = Math.floor(distance/50) * 50\r\n          const gAltitude = Math.floor(Math.abs(tm.altMean)/100) * 100 //Altitudes below zero considered in lowest cat\r\n\r\n          const group = groups.find(g => g.distance === gDistance && g.altitude === gAltitude)\r\n\r\n          if (group) {\r\n            group.tetrads += 1\r\n          } else {\r\n            groups.push({\r\n              distance: gDistance,\r\n              altitude: gAltitude,\r\n              tetrads: 1,\r\n            })\r\n          }\r\n        }\r\n        // Remove all tetrads from the altlat array up to and including the matched tetrad\r\n        // to speed up subsequent searches.\r\n        altlatSorted.splice(0, tmi+1)\r\n      })\r\n      console.timeEnd(\"process tetrads\")\r\n\r\n      // Convert the tetrad counts to a proportion of all tetrads in group\r\n      const pgroupss = groups.map(g => {\r\n        const backSquare = backData.find(bd =>  g.distance === bd[0] && g.altitude === bd[1])\r\n        const totalTetrads = backSquare[2]\r\n\r\n        //console.log(g.tetrads, totalTetrads)\r\n        return {\r\n          distance: g.distance,\r\n          altitude: g.altitude,\r\n          metric: g.tetrads/totalTetrads * 100,\r\n          taxon: 'dummy'\r\n        }\r\n      })\r\n\r\n      return new Promise((resolve) => {\r\n        resolve(pgroupss)\r\n      })\r\n    })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick', 'toggle' or 'none'. (Default - 'none'.)\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @param {Array.<Object>} opts.ranges - Specifies an array of objects defining ranges for displaying the metrics (see main interface for details).\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    if ('interactivity' in opts) {\r\n      interactivity = opts.interactivity\r\n    }\r\n\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let remakeChart = false\r\n\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('ranges' in opts) {\r\n      ranges = opts.ranges\r\n      remakeChart = true\r\n    }\r\n\r\n    if (remakeChart) {\r\n      return makeChart().then(() => {\r\n        positionMainElements(svg, expand)\r\n      })\r\n    } else {\r\n      return Promise.resolve()\r\n    }\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} taxon - The taxon to display.\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * This allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n    } else {\r\n      taxa = [taxon]\r\n      highlightItem({}, false)\r\n      return makeChart()\r\n    }\r\n  }\r\n\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the altlat function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:altlat~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:altlat~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:altlat~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:altlat~setTaxon} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:altlat~dataFromTetrads} dataFromTetrads - Generates data in the format required for the chart from a raw list of tetrad references. \r\n   * @property {module:altlat~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    dataFromTetrads: dataFromTetrads,\r\n    saveImage: saveImage\r\n  }\r\n}","/** @module links */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from './general'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG.\r\n * @param {string} opts.elid - The id for the dom object created.\r\n * @param {number} opts.width - The width of the main chart area in pixels (excludes margins).\r\n * @param {number} opts.height - The height of the main chart area in pixels (excludes margins).\r\n * @param {number} opts.radius - The radius of the node in pixels. (Default - 5.)\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized.\r\n * @param {string} opts.title - Title for the chart.\r\n * @param {string} opts.subtitle - Subtitle for the chart.\r\n * @param {string} opts.footer - Footer for the chart.\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.interactivityLink - Specifies how link interactivity occurs. Can be 'mousemove', 'mouseclick' or 'none'. (Default - 'none'.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds (when nodes removed). (Default - 1000.)\r\n * @param {string} opts.backgroundColour - The background colour of the main chart area. Can be set to empty string for none. (Default - empty.)\r\n * @param {string} opts.taxa1colour - The colour to use for taxa in column taxa1. Can be any valid CSS colour string or 'auto' to specify a colour automatically. (Deafult - 'black'.)\r\n * @param {string} opts.taxa2colour - The colour to use for taxa in column taxa2. Can be any valid CSS colour string or 'auto' to specify a colour automatically. (Deafult - 'black'.)\r\n * @param {boolean} opts.overflow - A boolean that indicates whether or not to show graphics that overflow the svg boundary. (Default - true.)\r\n * @param {boolean} opts.zoom - A boolean that indicates whether or not implement zoom behaviour. (Default - true.)\r\n * @param {Object} opts.taxonInfoFn - A function called when the user interacts with a taxon node. \r\n * Two arguments are passed to the function: the taxon name and a boolean indicating if this was from the field taxon1 in the input data. \r\n * If the function returns a non-null value, it is displayed in a tool-tip. If no value is returned, no tool-tip is generated.\r\n * (Default - null.)\r\n * @param {Object} opts.linkInfoFn - A function called when the user interacts with a link.\r\n * Three arguments are passed to the function: the taxon name from the taxon1 property, the taxon name from the taxon2 property,\r\n * and the data object from the data property. If no value is returned, no tool-tip is generated.\r\n * If the function returns a non-null value, it is displayed in a tool-tip.\r\n * (Default - null.)\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon1</b> - the name of a taxon.\r\n * <li> <b>taxon2</b> - the name of a taxon linked with the taxon specified in taxon1.\r\n * <li> <b>data</b> - a data object, e.g. with data describing the relationship between taxon1 and taxon2, that will be passed to any\r\n * function specified in the linkInfoFn parameter.\r\n * </ul>\r\n * @returns {module:links~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function links({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'link-chart',\r\n  width = 300,\r\n  height = 200,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 14,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  duration = 1000,\r\n  overflow = true,\r\n  zoom = true,\r\n  interactivityLink = 'none',\r\n  backgroundColour = '',\r\n  taxa1colour = 'auto',\r\n  taxa2colour = 'black',\r\n  taxonInfoFn = null,\r\n  linkInfoFn = null,\r\n  radius = 5,\r\n  data = []\r\n} = {}) {\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .attr('class', 'brc-chart-links')\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n  \r\n  mainDiv.classed('chart-overflow', overflow)\r\n\r\n  // Define the div for the tooltip\r\n  const popupDiv = d3.select(\"body\").append(\"div\")\t\r\n    .attr(\"class\", \"brc-chart-links-popup\")\t\t\t\t\r\n    .style(\"opacity\", 0)\r\n \r\n  const svg = mainDiv.append('svg')\r\n    .style(\"cursor\", zoom ? \"move\" : null)\r\n\r\n  if (backgroundColour) {\r\n    svg.style('background-color', backgroundColour)\r\n  }\r\n\r\n  svg.on(\"click\", function() {\r\n    if (interactivityLink === 'mouseclick' && d3.event.srcElement.tagName === 'svg') {\r\n      unhighlightAllLinks()\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg')\r\n    .attr('class', 'mainChart')\r\n    .attr(\"width\", width)\r\n    .attr(\"height\", height)\r\n\r\n  const gChart = svgChart.append('g')\r\n  const gLinks = gChart.append('g')\r\n  const gNodes = gChart.append('g')\r\n\r\n  if (zoom) {\r\n    svg.call(d3.zoom()\r\n      .scaleExtent([1/4, 4])\r\n      .on('zoom', function () {\r\n        gChart.attr('transform', d3.event.transform)\r\n      }))\r\n  }\r\n\r\n  const simulation = d3.forceSimulation()\r\n  let nodes\r\n\r\n  makeChart(data)\r\n  // Texts must come after chart because \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n  gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  gen.positionMainElements(svg, expand)\r\n\r\n  function makeChart(data) {\r\n\r\n    // Make two separate arrays - one for nodes and one for links\r\n    // We are using Set to get unique values and then spread these into an array\r\n    const taxa1 = [...new Set(data.map(d => d.taxon1))]\r\n    const taxa2 = [...new Set(data.map(d => d.taxon2))]\r\n    const taxa = [...taxa1, ...taxa2]\r\n\r\n    // Good example of modifying force layout here:\r\n    // https://observablehq.com/@d3/modifying-a-force-directed-graph\r\n    // In a force directed layout, the current positions of the nodes is stored\r\n    // within the data objects - NOT the DOM ojbects. So to preserve current\r\n    // position of elements when data is updated, we have to keep previous\r\n    // version of the node object.\r\n    let nodesPrev\r\n    if (nodes) {\r\n      // Map gives a dictionary that can be used to lookup\r\n      nodesPrev = new Map(nodes.map(d => [d.id, d]))\r\n    }\r\n    nodes = taxa.map(t => {\r\n      return {\r\n        id: t,\r\n        t1: taxa1.includes(t),\r\n      }\r\n    })\r\n    if (nodesPrev) {\r\n      // Use previous node where it exists\r\n      nodes = nodes.map(d => Object.assign(nodesPrev.get(d.id) || {}, d))\r\n    }\r\n    \r\n    const links = data.map(d => {\r\n      return {\r\n        key: gen.safeId(`${d.taxon1}-${d.taxon2}`),\r\n        source: d.taxon1,\r\n        target: d.taxon2,\r\n        data: d.data\r\n      }\r\n    })\r\n\r\n    //const simulation = d3.forceSimulation(nodes)\r\n    simulation.nodes(nodes)\r\n      .force(\"link\", d3.forceLink(links).id(d => d.id))\r\n      .force(\"charge\", d3.forceManyBody().strength(-30)) // default strength is -30 (repel)\r\n      .force(\"center\", d3.forceCenter(width / 2, height / 2))\r\n    simulation.alpha(1).restart()\r\n\r\n    const link = gLinks.selectAll(\".display-link\")\r\n      .data(links, d => d.key)\r\n      .join(\r\n        enter => enter.append(\"line\")\r\n          .classed('display-link', true)\r\n          .attr(\"id\", d => d.key),\r\n        update => update,\r\n        exit => exit.remove()\r\n      )\r\n\r\n    const selectLink = gLinks.selectAll(\".select-link\")\r\n      .data(links, d => d.key)\r\n      .join(\r\n        enter => enter.append(\"line\")\r\n          .classed('select-link', true)\r\n          .style(\"cursor\", interactivityLink !== \"none\" ? \"pointer\" : \"\")\r\n          .on(\"mouseover\", function(d) {\t\r\n            linkHit(d, \"mouseover\")\r\n          })\r\n          .on(\"click\", function(d) {\t\r\n            linkHit(d, \"click\")\r\n          })\t\t\t\t\t\r\n          .on(\"mouseout\", function(d) {\t\t\r\n            linkHitRemove(d)\r\n          }),\r\n        update => update,\r\n        exit => exit.remove()\r\n      )\r\n\r\n    function linkHit (d, eventType) {\r\n      if ((eventType == \"mouseover\" && interactivityLink === \"mousemove\") ||\r\n        (eventType == \"click\" && interactivityLink === \"mouseclick\")) {\r\n\r\n        if (eventType == \"click\") {\r\n          unhighlightAllLinks()\r\n        }\r\n        d3.select(`.display-link#${d.key}`).classed('highlighted', true)\r\n        d3.select(`circle#${gen.safeId(d.source.id)}`).classed('highlighted', true)\r\n        d3.select(`circle#${gen.safeId(d.target.id)}`).classed('highlighted', true)\r\n        const html = linkInfoFn ? linkInfoFn(d.source.id, d.target.id, d.data) : ''\r\n        if (html) {\r\n          popupDiv.transition()\t\t\r\n            .duration(200)\t\t\r\n            .style(\"opacity\", 0.9)\r\n          popupDiv.html(html)\r\n            .style(\"left\", (d3.event.pageX + 10) + \"px\")\t\t\r\n            .style(\"top\", (d3.event.pageY - 30) + \"px\")\r\n        }\r\n      }\r\n    }\r\n\r\n    function linkHitRemove(d) {\r\n      if (interactivityLink === \"mousemove\") {\r\n        d3.select(`.display-link#${d.key}`).classed('highlighted', false)\r\n        d3.select(`circle#${gen.safeId(d.source.id)}`).classed('highlighted', false)\r\n        d3.select(`circle#${gen.safeId(d.target.id)}`).classed('highlighted', false)\r\n        popupDiv.transition()\t\t\r\n          .duration(500)\t\t\r\n          .style(\"opacity\", 0)\r\n      }\r\n    }\r\n\r\n    const node = gNodes.selectAll(\"circle\")\r\n      .data(nodes, d => d.id)\r\n      .join(\r\n        enter => enter.append(\"circle\")\r\n          .attr('id', d => gen.safeId(d.id))\r\n          .attr(\"r\", radius)\r\n          .attr(\"x\", width/2)\r\n          .attr(\"y\", height/2)\r\n          .attr(\"fill\", (d, i) => getColour(taxa1, taxa2, taxa, d, i))\r\n          .style(\"cursor\", \"pointer\")\r\n          .on(\"click\", function(d) {\r\n            delete d.fx\r\n            delete d.fy\r\n            d3.select(this).classed(\"fixed\", false)\r\n            simulation.alpha(1).restart()\r\n          })\r\n          .on(\"mouseover\", function(d) {\r\n              //gNodes.selectAll('circle').classed(\"lowlighted\", true)\r\n              //d3.select(this).classed(\"lowlighted\", false)\r\n              d3.select(this).classed(\"highlighted\", true)\r\n              highLightLinks(d.id, true)\r\n              const html = taxonInfoFn ? taxonInfoFn(d.id, d.t1) : d.id\r\n              if (html) {\r\n                popupDiv.transition()\t\t\r\n                  .duration(200)\t\t\r\n                  .style(\"opacity\", 0.9)\r\n                popupDiv.html(html)\t\r\n                  .style(\"left\", (d3.event.pageX + 10) + \"px\")\t\t\r\n                  .style(\"top\", (d3.event.pageY - 30) + \"px\")\r\n              }\r\n          })\t\t\t\r\n          .on(\"mouseout\", function() {\r\n              //gNodes.selectAll('circle').classed(\"lowlighted\", false)\r\n\r\n              gLinks.selectAll(`.display-link`).classed('lowlighted', false)\r\n\r\n              d3.select(this).classed(\"highlighted\", false)\r\n              //highLightLinks(d.id, false)\r\n              popupDiv.transition()\t\t\r\n                .duration(500)\t\t\r\n                .style(\"opacity\", 0)\r\n          }),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => exit.transition().duration(duration)\r\n            .attr(\"r\", 0)\r\n            .remove())\r\n      )\r\n        .call(drag(simulation))\r\n\r\n    simulation.on(\"tick\", () => {\r\n      node\r\n        .attr(\"cx\", d => {\r\n          if (overflow) {\r\n            return d.x\r\n          } else {\r\n            return d.x\r\n            //Restrain to SVG\r\n            //return d.x = Math.max(radius, Math.min(width - radius, d.x))\r\n          }\r\n        })\r\n        .attr(\"cy\", d => {\r\n          if (overflow) {\r\n            return d.y\r\n          } else {\r\n            return d.y\r\n            //Restrain to SVG\r\n            //return d.y = Math.max(radius, Math.min(height - radius, d.y))\r\n          }\r\n        })\r\n      link\r\n        .attr(\"x1\", d => d.source.x)\r\n        .attr(\"y1\", d => d.source.y)\r\n        .attr(\"x2\", d => d.target.x)\r\n        .attr(\"y2\", d => d.target.y)\r\n      selectLink\r\n        .attr(\"x1\", d => d.source.x)\r\n        .attr(\"y1\", d => d.source.y)\r\n        .attr(\"x2\", d => d.target.x)\r\n        .attr(\"y2\", d => d.target.y)\r\n    })\r\n\r\n    function highLightLinks(id, highlight) {\r\n      const hLinks = links.filter(l => l.source.id === id || l.target.id === id)\r\n\r\n      gLinks.selectAll(`.display-link`).classed('lowlighted', true)\r\n\r\n      hLinks.forEach(link => {\r\n        //d3.selectAll(`.display-link#${link.key}`).classed('highlighted', highlight)\r\n        d3.selectAll(`.display-link#${link.key}`).classed('lowlighted', !highlight)\r\n      })\r\n    }\r\n  }\r\n\r\n  function getColour(taxa1, taxa2, taxa, d) {\r\n    let iAuto\r\n    if (taxa1colour === 'auto' && taxa2colour === 'auto') {\r\n      iAuto = taxa.indexOf(d.id)\r\n    } else if (taxa1colour === 'auto') {\r\n      iAuto = taxa1.indexOf(d.id)\r\n    } else if (taxa2colour === 'auto') {\r\n      iAuto = taxa2.indexOf(d.id)\r\n    }\r\n\r\n    if (d.t1) {\r\n      if (taxa1colour === 'auto') {\r\n        return autoColour(iAuto)\r\n      } else {\r\n        return taxa1colour\r\n      }\r\n    } else {\r\n      if (taxa2colour === 'auto') {\r\n        return autoColour(iAuto)\r\n      } else {\r\n        return taxa2colour\r\n      }\r\n    }\r\n\r\n    function autoColour(i) {\r\n\r\n      //console.log(i)\r\n\r\n      if (!d.colour) {\r\n        if (i < 10) {\r\n          return d3.schemeCategory10[i]\r\n        }\r\n        else if (i < 18) {\r\n          return d3.schemeDark2[i - 10]\r\n        }\r\n        else if (i < 26) {\r\n          return d3.schemeAccent[i - 18]\r\n        }\r\n        else {\r\n          return d3.interpolateSpectral(Math.random())\r\n        }\r\n      }\r\n    }\r\n  \r\n  }\r\n\r\n  function drag(simulation) {\r\n  \r\n    function dragstart() {\r\n      d3.select(this).classed(\"fixed\", true)\r\n    }\r\n\r\n    function dragged() {\r\n      d3.event.subject.fx = clamp(d3.event.x, 0, width)\r\n      d3.event.subject.fy = clamp(d3.event.y, 0, height)\r\n      simulation.alpha(1).restart()\r\n    }\r\n\r\n    return d3.drag()\r\n      .on(\"start\", dragstart)\r\n      .on(\"drag\", dragged)\r\n  }\r\n\r\n  function clamp(x) {\r\n    //return x < lo ? lo : x > hi ? hi : x;\r\n    return x\r\n  }\r\n\r\n  function unhighlightAllLinks() {\r\n    d3.selectAll(`.display-link`).classed('highlighted', false)\r\n    d3.selectAll(`circle`).classed('highlighted', false)\r\n    d3.selectAll(`circle`).classed('highlighted', false)\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n  * @description <b>This function is exposed as a method on the API returned from the links function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n\r\n    const textWidth = Number(svgChart.attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    if ('data' in opts) {\r\n      makeChart(opts.data)\r\n    }\r\n\r\n    //positionElements()\r\n    gen.positionMainElements(svg, expand)\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the links function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the links function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:links~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:links~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:links~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts\r\n  }\r\n}","/** @module phen1 */\r\n\r\nimport * as d3 from 'd3'\r\nimport { makeText,  positionMainElements, saveChartImage } from '../general'\r\nimport { makePhen } from './makephen'\r\nimport { highlightItem } from './highlightitem'\r\nimport { preProcessMetrics } from './metricsplus'\r\nimport { makeLegend } from './legend'\r\n\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG.\r\n * @param {string} opts.elid - The id for the dom object created.\r\n * @param {number} opts.width - The width of each sub-chart area in pixels.\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels.\r\n * @param {Object} opts.margin - An object indicating the margins to add around each sub-chart area.\r\n * @param {number} opts.margin.left - Left margin in pixels. (Default - 35.)\r\n * @param {number} opts.margin.right - Right margin in pixels. (Default - 0.)\r\n * @param {number} opts.margin.top - Top margin in pixels. (Default - 20.)\r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. (Default - 5.)\r\n * @param {number} opts.perRow - The number of sub-charts per row.\r\n * @param {string} opts.ytype - Type of metric to show on the y axis, can be 'count', 'proportion' or 'normalized'.\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized.\r\n * @param {boolean} opts.spread - Indicates whether multiple metrics are to be spread vertically across the chart.\r\n * @param {string} opts.style - Indicates the type of graphics to be used for the chart. Can be 'lines', 'bars' or 'areas'. (Default - 'lines'.)\r\n * @param {boolean} opts.stacked - Indicates whether to stack metrics or superimpose them. If true, the metrics are stacked. This\r\n * is only relevant for charts of style 'bars' or 'areas'. It has no effect on charts with the style 'lines'. (Default - false.)\r\n * @param {string} opts.title - Title for the chart.\r\n * @param {string} opts.subtitle - Subtitle for the chart.\r\n * @param {string} opts.footer - Footer for the chart.\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart sub-title.\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph.\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label.\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axist labels. (Default - 10.)\r\n * @param {string | number} opts.monthFontSize - Font size for month labels. Can be specified in any permitted SVG units. (Default - 12.)\r\n * @param {string } opts.font - Font to use for chart. (Default - sans-serif.)\r\n * @param {boolean} opts.showLegend - Whether or not to show the legend.\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text.\r\n * @param {string | number} opts.lineWidth - Sets the stroke-width of all lines on the chart. Can use any permitted SVG stroke-width units. (Default - 1.)* @param {string} opts.axisLeft - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn otherwise not.\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn otherwise not.\r\n * @param {string} opts.axisLeftLabel - Value for labelling left axis. (Default - ''.)\r\n * @param {Array.<string>} opts.bands - An array of up to 12 colours (any standard colour notation), used to display bands for each month\r\n * as a background on the chart. (Default is an empty array.)\r\n * @param {Array.<string>} opts.lines - An array of up to 12 colours (any standard colour notation), used to display vertical lines to\r\n * delineat each month as a background on the chart. (Default is an empty array.)\r\n * @param {number} opts.monthLineWidth - The width of lines used to delineate months.\r\n * @param {number} opts.headPad - A left hand offset, in pixels, for title, subtitle, legend and footer. (Default 0.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds.\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'.\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created.\r\n * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input\r\n * data for which a line should be generated on the chart.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>prop</b> - the name of the numeric property in the data (count properties - 'c1' or 'c2' in the example below).\r\n * <li> <b>label</b> - a label for this metric.\r\n * <li> <b>colour</b> - optional colour to give the line for this metric. Any accepted way of specifying web colours can be used. Use the special term 'fading' to successively fading shades of grey.\r\n * <li> <b>fill</b> - optional colour to colour the graph area for this metric. Any accepted way of specifying web colours can be used.\r\n * </ul>\r\n * Note that if a metric has no data for a given taxon, then the graphics representing it will be\r\n * marked with the CSS class 'phen-path-no-data'. You can use this to style as you see fit.\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> either <b>week</b> - a number between 1 and 53 indicating the week of the year,\r\n * <li> or <b>month</b> - a number between 1 and 12 indicating the month of the year,\r\n * <li> <b>c1</b> - a count for a given time period (can have any name). \r\n * <li> <b>c2</b> - a count for a given time period (can have any name).\r\n * ... - there must be at least one count column, but there can be any number of them.\r\n * </ul>\r\n * @returns {module:phen1~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function phen1({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'phen1-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 35, right: 0, top: 20, bottom: 5},\r\n  bands= [],\r\n  lines=[],\r\n  monthLineWidth = 1,\r\n  perRow = 2,\r\n  ytype = 'count',\r\n  expand = false,\r\n  spread = false,\r\n  style = 'lines',\r\n  stacked = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  axisLabelFontSize = 10,\r\n  monthFontSize = 12,\r\n  lineWidth = 1,\r\n  font = 'sans-serif',\r\n  showLegend = true,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 16,\r\n  taxonLabelItalics = false,\r\n  axisLeft = 'tick',\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  axisLeftLabel = '',\r\n  headPad = 0,\r\n  duration = 1000,\r\n  interactivity = 'mousemove',\r\n  data = [],\r\n  taxa = [],\r\n  metrics = []\r\n} = {}) {\r\n\r\n  metrics = preProcessMetrics(metrics)\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .classed('brc-chart-phen1-top', true)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, false, svgChart)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart').style('overflow', 'visible')\r\n  \r\n  makeChart()\r\n\r\n  // Texts must come after chart because \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\") - headPad)\r\n  makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  positionMainElements(svg, expand, headPad)\r\n\r\n  svg.selectAll('text').style('font-family', font)\r\n  svg.selectAll('line, path').style('stroke-width', lineWidth)\r\n\r\n  function makeChart () {\r\n\r\n    // Give warning and return if invalid option combinations are used\r\n    if (stacked && spread) {\r\n      console.log('You cannot set both the stacked and spread options to true.')\r\n      return\r\n    }\r\n    if ((ytype === 'normalized' || ytype === 'proportion') && stacked) {\r\n      console.log('You cannot used a y axis type of normalized or proportion with a stacked display.')\r\n      return\r\n    }\r\n\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    const subChartPad = 10\r\n    const pTrans = []\r\n\r\n    const svgsTaxa = taxa.map(t => {\r\n      return makePhen (t, taxa, data, metrics, svgChart, width, height, \r\n        ytype, spread, axisTop, axisBottom, axisLeft, axisRight, monthLineWidth, bands, lines,\r\n        style, stacked, duration, margin, showTaxonLabel, taxonLabelFontSize, taxonLabelItalics,\r\n        axisLabelFontSize, axisLeftLabel, interactivity, pTrans, monthFontSize, font)\r\n    })\r\n\r\n    const subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n    const subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n\r\n    let legendHeight = 0\r\n    if (showLegend) {\r\n      const legendWidth = perRow * (subChartWidth + subChartPad) - headPad\r\n      legendHeight = makeLegend(legendWidth, metrics, svgChart, legendFontSize, headPad, interactivity, style) + subChartPad\r\n    }\r\n\r\n    svgsTaxa.forEach((svgTaxon, i) => {\r\n      \r\n      const col = i%perRow\r\n      const row = Math.floor(i/perRow)\r\n\r\n      svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n      svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad) + legendHeight)\r\n    })\r\n\r\n    svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n    svgChart.attr(\"height\", legendHeight +  Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.ytype - Type of metric to show on the y axis, can be 'count', 'proportion' or 'normalized'.\r\n  * @param {boolean} opts.spread - Indicates whether multiple metrics are to be spread vertically across the chart.\r\n  * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input data (see main interface for details).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen1 function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    \r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let remakeChart = false\r\n\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('ytype' in opts) {\r\n      ytype = opts.ytype\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('metrics' in opts) {\r\n      metrics = preProcessMetrics(opts.metrics)\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('spread' in opts) {\r\n      spread = opts.spread\r\n      remakeChart = true\r\n    }\r\n\r\n    let pRet\r\n    if (remakeChart) {\r\n      pRet = makeChart()\r\n      positionMainElements(svg, expand)\r\n    } else {\r\n      pRet = Promise.resolve()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} opts.taxon - The taxon to display.\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen1 function</b>.\r\n  * For single species charts, this allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    let pRet\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n      pRet = Promise.resolve()\r\n    } else {\r\n      taxa = [taxon]\r\n      pRet = makeChart()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the phen1 function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the phen1 function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen1 function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:phen1~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:phen1~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:phen1~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:phen1~setChartOpts} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:phen1~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module phen2 */\r\n\r\nimport * as d3 from 'd3'\r\nimport { safeId, makeText, positionMainElements, saveChartImage, xAxisMonthNoText, xAxisMonthText, cloneData, transPromise } from './general'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG.\r\n * @param {string} opts.elid - The id for the dom object created.\r\n * @param {number} opts.width - The width of each sub-chart area in pixels.\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels.\r\n * @param {number} opts.split - Set to true to split bands over seperate lines - defalt is false.\r\n * @param {number} opts.perRow - The number of sub-charts per row.\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized.\r\n * @param {string} opts.title - Title for the chart.\r\n * @param {string} opts.subtitle - Subtitle for the chart.\r\n * @param {string} opts.footer - Footer for the chart.\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n * @param {string | number} opts.monthFontSize - Font size for month labels. Can be specified in any permitted SVG units. (Default - 12.)\r\n * @param {string } opts.font - Font to use for chart. (Default - sans-serif.)\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph.\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label.\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.\r\n * @param {boolean} opts.displayLegend - Indicates whether or not to display a legend. (Default - true.)\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text.\r\n * @param {string | number} opts.lineWidth - Sets the stroke-width of all lines on the chart. Can use any permitted SVG stroke-width units. (Default - 1.)\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis.\r\n * @param {string} opts.axisLeft - If set to 'on' line is drawn otherwise not.\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn otherwise not.\r\n * @param {string} opts.axisTop- If set to 'on' line is drawn otherwise not.\r\n * @param {number} opts.headPad - A left hand offset, in pixels, for title, subtitle, legend and footer. (Default 0.)\r\n * @param {number} opts.chartPad - A left hand offset, in pixels, for the chart. (Default 0.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds.\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'.\r\n * @param {string} opts.backColour - Background colour of the chart. Any accepted way of specifying web colours can be used. (Default - white.)\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created.\r\n * @param {Array.<Object>} opts.metrics - An array of objects, each describing a property in the input\r\n * data for which a band should be generated on the chart.\r\n * Each of the objects in the metrics array must be sepecified with the properties shown below.\r\n * <ul>\r\n * <li> <b>prop</b> - the name of the property in the data (properties - 'p1' or 'p2' in the example below).\r\n * <li> <b>label</b> - a label for this property.\r\n * <li> <b>colour</b> - colour to give the band for this property. Any accepted way of specifying web colours can be used.\r\n * <li> <b>opacity</b> - Optional opacity to give the band for this property. A value between 0 and 1 - default is 1.\r\n * <li> <b>svg</b> - Optional string defining an SVG path of an icon to use in place of a colour swatch in the legend.\r\n * <li> <b>svgScale</b> - Optional number defining a scaling factor to apply to SVG icon (relative to others) - default is 1.\r\n * <li> <b>legendOrder</b> - Optional number used to sort the legend items. Low to high = left to right. If supplied, it\r\n * should be supplied for all metrics items otherwise results undefined. If not defined, default is to reverse the order.\r\n * Numbering should start at one and increase in increments of 1. For split bands it is also used to position the bands\r\n * from top to bottom\r\n * </ul>\r\n * The order in which the metrics are specified determines the order in which properties are drawn on the chart. Each is\r\n * drawn over the previous so for overlapping properties (split = false), the one you want to draw on top should\r\n * come last. \r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. \r\n * There should only be one object per taxon. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>p1</b> - an array of date band objects (see below), indicating start and end weeks for the property (can have any name).\r\n * <li> <b>p2</b> - an array of date band objects (see below), indicating start and end weeks for the property (can have any name).\r\n * ... - there must be at leas one property column, but there can be any number of them.\r\n * </ul>\r\n * The objects in each data band array have the following structure:\r\n * <ul>\r\n * <li> <b>start</b> - a number between 1 and 365 indicating the day of the year the band starts.\r\n * <li> <b>end</b> - a number between 1 and 365 indicating the day of the year the band ends.\r\n*  </ul>\r\n * @returns {module:phen2~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function phen2({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'phen2-chart',\r\n  width = 300,\r\n  height = 30,\r\n  split = false,\r\n  perRow = 2,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  font = 'sans-serif',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  displayLegend = true,\r\n  monthFontSize = 12,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 16,\r\n  taxonLabelItalics = false,\r\n  axisBottom = 'tick',\r\n  axisTop = 'on',\r\n  axisLeft = 'on',\r\n  axisRight = 'on',\r\n  lineWidth = 1,\r\n  headPad = 0,\r\n  chartPad = 0,\r\n  duration = 1000,\r\n  interactivity = 'mousemove',\r\n  //backColour = 'white',\r\n  data = [],\r\n  taxa = [],\r\n  metrics = []\r\n} = {}) {\r\n\r\n  let metricsPlus\r\n  let pTrans\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .classed('brc-chart-phen2-top', true)\r\n    .attr('id', elid)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, false)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart')\r\n  \r\n  makeChart()\r\n  // Texts must come after chart because \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\") - headPad)\r\n  makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  positionMainElements(svg, expand, headPad)\r\n\r\n  svg.selectAll('line, path').style('stroke-width', lineWidth)\r\n  svg.selectAll('text').style('font-family', font)\r\n\r\n  function makeChart () {\r\n\r\n    pTrans = []\r\n\r\n    metricsPlus = metrics.map((m,i) => {\r\n      return {\r\n        id:  safeId(m.label),\r\n        prop: m.prop,\r\n        label: m.label,\r\n        colour: m.colour,\r\n        opacity: m.opacity ? m.opacity : 1,\r\n        svg: m.svg,\r\n        // By default legend order is reversed\r\n        legendOrder: m.legendOrder ?  m.legendOrder : metrics.length - i,\r\n        svgScale: m.svgScale ? m.svgScale : 1\r\n      }\r\n    })\r\n\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    const subChartPad = 10\r\n    const svgsTaxa = taxa.map(t => makePhen(t))\r\n\r\n    const subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n    const subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n\r\n    let legendHeight = 0\r\n    if (displayLegend) {\r\n      legendHeight = makeLegend(perRow * (subChartWidth + subChartPad) - headPad) + subChartPad\r\n    }\r\n \r\n    svgsTaxa.forEach((svgTaxon, i) => {\r\n      \r\n      const col = i%perRow\r\n      const row = Math.floor(i/perRow)\r\n\r\n      svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n      svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad) + legendHeight)\r\n    })\r\n\r\n    svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n    svgChart.attr(\"height\", legendHeight +  Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n\r\n  function makePhen (taxon) {\r\n    // Get data for named taxon\r\n    const dataFiltered = data.find(d => d.taxon === taxon)\r\n    const rectData = []\r\n    if (dataFiltered) {\r\n      metricsPlus.forEach((m, im) => {\r\n        dataFiltered[m.prop].forEach((d,i) => {\r\n          rectData.push({\r\n            id: `${m.id}-${i}`,\r\n            iMetric: m.legendOrder ? m.legendOrder - 1 : im,\r\n            class: m.id,\r\n            colour: m.colour,\r\n            opacity: m.opacity,\r\n            start: d.start,\r\n            end:  d.end\r\n          })\r\n        })\r\n      })\r\n    }\r\n\r\n    // Value scale\r\n    const xScale = d3.scaleLinear().domain([1, 365]).range([0, width])\r\n    const yScale = d3.scaleLinear().domain([0, 100]).range([height, 0])\r\n\r\n    // X (bottom) axis\r\n    let xAxis1, xAxis2\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      //xAxis = xAxisMonth(width, axisBottom === 'tick', monthFontSize, font)\r\n      xAxis1 = xAxisMonthNoText(width)\r\n      xAxis2 = xAxisMonthText(width, axisBottom === 'tick', monthFontSize, font)\r\n    }\r\n\r\n    // Top axis\r\n    let tAxis\r\n    if (axisTop === 'on') {\r\n      tAxis = d3.axisTop()\r\n        .scale(xScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n     // Right axis\r\n    let rAxis\r\n    if (axisRight === 'on') {\r\n      rAxis = d3.axisRight()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Y (left) axis\r\n    let yAxis\r\n    if (axisLeft === 'on') {\r\n      yAxis = d3.axisLeft()\r\n        .scale(yScale)\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Create or get the relevant chart svg\r\n    let init, svgPhen2, gPhen2\r\n    if (taxa.length === 1 && svgChart.selectAll('.brc-chart-phen2').size() === 1) {\r\n      svgPhen2 = svgChart.select('.brc-chart-phen2')\r\n      gPhen2 = svgPhen2.select('.brc-chart-phen2-g')\r\n      init = false\r\n    } else if (svgChart.select(`#${safeId(taxon)}`).size()) {\r\n      svgPhen2 = svgChart.select(`#${safeId(taxon)}`)\r\n      gPhen2 = svgPhen2.select('.brc-chart-phen2-g')\r\n      init = false\r\n    } else {\r\n      svgPhen2 = svgChart.append('svg')\r\n        .classed('brc-chart-phen2', true)\r\n        .attr('id', safeId(taxon))\r\n        .style('overflow', 'visible')\r\n      gPhen2 = svgPhen2.append('g')\r\n        .classed('brc-chart-phen2-g', true)\r\n      init = true\r\n    }\r\n    \r\n    // Create/update the band rectangles with D3\r\n    const mrects = gPhen2.selectAll(\"rect\")\r\n      .data(rectData,  d => d.id)\r\n\r\n    const erects = mrects.enter()\r\n      .append(\"rect\")\r\n      .attr(\"class\", d => `phen-rect-${d.class} phen-rect`)\r\n      .attr(\"width\", 0)\r\n      .attr(\"height\", 0)\r\n      .attr(\"x\", d => xScale(d.start+(d.end-d.start)/2))\r\n\r\n    addEventHandlers(erects, 'class')\r\n\r\n    transPromise(mrects.merge(erects)\r\n      .transition()\r\n      .duration(duration)\r\n      .attr(\"width\", d => xScale(d.end) - xScale(d.start))\r\n      .attr(\"height\",  split ? height/metricsPlus.length : height)\r\n      .attr(\"x\", d => xScale(d.start))\r\n      .attr(\"y\", d => split ? d.iMetric * height/metricsPlus.length : 0)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .attr(\"fill\", d => d.colour), pTrans)\r\n    \r\n    transPromise(mrects.exit()\r\n      .transition()\r\n      .duration(duration)\r\n      .attr(\"width\", 0)\r\n      .attr(\"height\", 0)\r\n      .remove(), pTrans)\r\n\r\n    if (init) {\r\n      // Constants for positioning\r\n      const axisPadX = chartPad\r\n      const axisPadY = axisBottom === 'tick' ? 15 : 0\r\n      let labelPadY \r\n\r\n      // Taxon title\r\n      if (showTaxonLabel) {\r\n        const taxonLabel = svgPhen2\r\n          .append('text')\r\n          .classed('brc-chart-phen2-label', true)\r\n          .text(taxon)\r\n          //.style('font-family', font)\r\n          .style('font-size', taxonLabelFontSize)\r\n          .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n        const labelHeight = taxonLabel.node().getBBox().height\r\n        taxonLabel.attr(\"transform\", `translate(${axisPadX}, ${labelHeight})`)\r\n        labelPadY = labelHeight * 1.5\r\n      } else {\r\n        labelPadY = 0\r\n      }\r\n      \r\n      // Size SVG\r\n      svgPhen2\r\n        .attr('width', width + axisPadX + 1)\r\n        .attr('height', height + axisPadY + labelPadY + 1)\r\n\r\n      // Position chart\r\n      gPhen2.attr(\"transform\", `translate(${axisPadX},${labelPadY})`)\r\n      \r\n      // Create axes and position within SVG\r\n      if (xAxis1 && xAxis2) {\r\n        // const gXaxis = svgPhen2.append(\"g\")\r\n        //   .attr(\"class\", \"x axis\")\r\n        //   .style('font-size', monthFontSize)\r\n        //   .call(xAxis)\r\n\r\n        const gXaxis1 = svgPhen2.append(\"g\")\r\n          .attr(\"class\", \"x axis\")\r\n          .style('font-size', monthFontSize)\r\n          .call(xAxis1)\r\n\r\n        const gXaxis2 = svgPhen2.append(\"g\")\r\n          .attr(\"class\", \"x axis\")\r\n          .style('font-size', monthFontSize)\r\n          .call(xAxis2)\r\n\r\n        // gXaxis.selectAll(\".tick text\")\r\n        //   .style(\"text-anchor\", \"start\")\r\n        //   .attr(\"x\", 6)\r\n        //   .attr(\"y\", 6)\r\n\r\n        gXaxis2.selectAll(\".tick text\")\r\n          .style(\"text-anchor\", \"middle\")\r\n\r\n        gXaxis1.attr(\"transform\", `translate(${axisPadX},${height + labelPadY})`)\r\n        gXaxis2.attr(\"transform\", `translate(${axisPadX},${height + labelPadY})`)\r\n\r\n        //gXaxis.attr(\"transform\", `translate(${axisPadX},${height + labelPadY})`)\r\n      }\r\n\r\n      if (yAxis) {\r\n        const gYaxis = svgPhen2.append(\"g\")\r\n          //.attr(\"class\", \"y-axis\")\r\n          .call(yAxis)\r\n        gYaxis.attr(\"transform\", `translate(${axisPadX},${labelPadY})`)\r\n      }\r\n      if (tAxis) {\r\n        const gTaxis = svgPhen2.append(\"g\")\r\n          .call(tAxis)\r\n        gTaxis.attr(\"transform\", `translate(${axisPadX},${labelPadY})`)\r\n      }\r\n      if (rAxis) {\r\n        const gRaxis = svgPhen2.append(\"g\")\r\n          .call(rAxis)\r\n        gRaxis.attr(\"transform\", `translate(${axisPadX + width},${labelPadY})`)\r\n      }\r\n\r\n    } else if (taxa.length === 1) {\r\n      // Update taxon label\r\n      if (showTaxonLabel) {\r\n        svgPhen2.select('.brc-chart-phen2-label').text(taxon)\r\n      }\r\n    }\r\n    return svgPhen2\r\n  }\r\n\r\n  function makeLegend (legendWidth) {\r\n    \r\n    const swatchSize = 20\r\n    const swatchFact = 1.3\r\n\r\n    // Loop through all the legend elements and work out their\r\n    // positions based on swatch size, item lable text size and\r\n    // legend width.\r\n    let rows = 0\r\n    let lineWidth = -swatchSize\r\n\r\n    //const metricsSorted = cloneData(metricsPlus).reverse()\r\n    const metricsSorted = cloneData(metricsPlus)\r\n      .filter(m => m.label)\r\n      .sort((a,b) => a.legendOrder > b.legendOrder ? 1 : -1)\r\n  \r\n    // Get the bbox of any SVG icons in metrics\r\n    metricsSorted.filter(m => m.svg).forEach(m => {\r\n      const path = svgChart.append('path').attr('d', m.svg).style('visibility', 'hidden')\r\n      m.svgbbox = path.node().getBBox()\r\n      path.remove()\r\n    })\r\n\r\n    metricsSorted.forEach(m => {\r\n      const tmpText = svgChart.append('text') //.style('display', 'none')\r\n        .text(m.label)\r\n        //.style('font-family', font)\r\n        .style('font-size', legendFontSize)\r\n\r\n      const widthText = tmpText.node().getBBox().width\r\n      tmpText.remove()\r\n\r\n      if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n        ++rows\r\n        lineWidth = -swatchSize\r\n      }\r\n      m.x = lineWidth + swatchSize + headPad\r\n      m.y = rows * swatchSize * swatchFact\r\n\r\n      lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n    })\r\n\r\n    // Note that the stuff below uses the D3 Join general udpate pattern\r\n    // https://observablehq.com/@d3/selection-join\r\n\r\n    // Swatch\r\n    const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n      .data(metricsSorted, m => m.id)\r\n      .join(enter => {\r\n          const rect = enter.append(\"rect\")\r\n            .attr(\"class\", m => `brc-legend-item brc-legend-item-rect brc-legend-item-${m.id}`)\r\n            .attr('width', swatchSize)\r\n            .attr('height', swatchSize/2)\r\n            .attr('display', m => m.svg ? 'none' : '')\r\n          return rect\r\n      })\r\n      .attr('x', m => m.x)\r\n      .attr('y', m => m.y + swatchSize/3)\r\n      .attr(\"opacity\", d => d.opacity)\r\n      .attr('fill', m => m.colour)\r\n\r\n    // SVG icon\r\n    const li = svgChart.selectAll('.brc-legend-item-icon')\r\n      .data(metricsSorted, m => m.id)\r\n      .join(enter => enter\r\n        .append(\"path\")\r\n        .attr(\"class\", m=> `brc-legend-item brc-legend-item-icon brc-legend-item-${m.id}`)\r\n        .attr(\"d\", m => m.svg)\r\n      )\r\n      // The transform has to come outside the enter selection so that it is executed whenever\r\n      // the code is called. Important because the bbox stuff only works if gui is visible and\r\n      // the first time this code is called, it may not be visible.\r\n      // The svg is also scaled by a factor passed in the metrics (svgScale) which\r\n      // defaults to 1.\r\n      .attr('transform', m => {\r\n        if (m.svg && m.svgbbox &&  m.svgbbox.width) {\r\n          const iScale = swatchSize / m.svgbbox.width * m.svgScale\r\n          const xAdj =  m.svgbbox.x * iScale\r\n          const yAdj = m.svgbbox.y * iScale - (swatchSize - m.svgbbox.height * iScale)/2\r\n          return `translate(${m.x - xAdj} ${m.y - yAdj}) scale(${iScale} ${iScale})`\r\n        } else {\r\n          return ''\r\n        }\r\n      })\r\n      .attr('fill', m => m.colour)\r\n      .attr('opacity', m => m.opacity)\r\n\r\n    // Text\r\n    const lt = svgChart.selectAll('.brc-legend-item-text')\r\n      .data(metricsSorted, m => safeId(m.label))\r\n      .join(enter => {\r\n          const text = enter.append(\"text\")\r\n            .attr(\"class\", m=> `brc-legend-item brc-legend-item-text brc-legend-item-${m.id}`)\r\n            .text(m => m.label)\r\n            //.style('font-family', font)\r\n            .style('font-size', legendFontSize)\r\n          return text\r\n      })\r\n      .attr('x', m => m.x + swatchSize * swatchFact *  m.svgScale)\r\n      .attr('y', m => m.y + legendFontSize * 1)\r\n\r\n    addEventHandlers(ls, 'label')\r\n    addEventHandlers(lt, 'label')\r\n    addEventHandlers(li, 'label')\r\n\r\n    return swatchSize * swatchFact * (rows + 1)\r\n  }\r\n\r\n  function highlightItem(cls, highlight) {\r\n\r\n    svgChart.selectAll('.phen-rect')\r\n      .classed('lowlight', highlight)\r\n\r\n    svgChart.selectAll(`.phen-rect-${cls}`)\r\n      .classed('lowlight', false)\r\n  \r\n    svgChart.selectAll(`.phen-rect`)\r\n      .classed('highlight', false)\r\n\r\n    if (cls) {\r\n      svgChart.selectAll(`.phen-rect-${cls}`)\r\n        .classed('highlight', highlight)\r\n    }\r\n    \r\n    svgChart.selectAll('.brc-legend-item')\r\n      .classed('lowlight', highlight)\r\n\r\n    if (cls) {\r\n      svgChart.selectAll(`.brc-legend-item-${cls}`)\r\n        .classed('lowlight', false)\r\n    }\r\n\r\n    if (cls) {\r\n      svgChart.selectAll(`.brc-legend-item-${cls}`)\r\n        .classed('highlight', highlight)\r\n    } else {\r\n      svgChart.selectAll(`.brc-legend-item`)\r\n        .classed('highlight', false)\r\n    }\r\n  }\r\n\r\n  function addEventHandlers(sel, prop) {\r\n    sel\r\n      .on(\"mouseover\", function(d) {\r\n      if (interactivity === 'mousemove') {\r\n          highlightItem(safeId(d[prop]), true)\r\n        }\r\n      })\r\n      .on(\"mouseout\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(safeId(d[prop]), false)\r\n        }\r\n      })\r\n      .on(\"click\", function(d) {\r\n        if (interactivity === 'mouseclick') {\r\n          highlightItem(safeId(d[prop]), true)\r\n          d3.event.stopPropagation()\r\n        }\r\n      })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input data (see main interface for details).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen2 function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let remakeChart = false\r\n\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n      remakeChart = true\r\n    }\r\n\r\n    if ('metrics' in opts) {\r\n      metrics = opts.metrics\r\n      remakeChart = true\r\n    }\r\n\r\n    let pRet\r\n    if (remakeChart) {\r\n      pRet = makeChart()\r\n      positionMainElements(svg, expand)\r\n    } else {\r\n      pRet = Promise.resolve()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} opts.taxon - The taxon to display.\r\n  * @returns {Promise} promise resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen2 function</b>.\r\n  * For single species charts, this allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    let pRet\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n      pRet = Promise.resolve()\r\n    } else {\r\n      taxa = [taxon]\r\n      pRet = makeChart()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the phen2 function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the phen2 function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the phen2 function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return saveChartImage(svg, expand, asSvg, filename, font) \r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:phen2~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:phen2~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:phen2~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:phen2~setChartOpts} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:phen2~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module pie */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from '../general'\r\nimport { makePie } from './makepie'\r\nimport { makeLegend } from './legend'\r\nimport { highlightItem} from './highlightitem'\r\n\r\n//https://www.d3-graph-gallery.com/graph/pie_annotation.html\r\n//https://github.com/d3/d3-shape/blob/v2.0.0/README.md#pie\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG.\r\n * @param {string} opts.elid - The id for the dom object created.\r\n * @param {number} opts.strokeWidth - The desired width of the line delineating chart segments in pixels.\r\n * @param {number} opts.radius - The desired radius of the chart in pixels.\r\n * @param {number} opts.innerRadius - The desired inner radius of the chart in pixels. Default of zero gives a pie chart. Specify a value for donut chart.\r\n * If your data specify more than one dataset (for concentric donuts), this value is also the out-radius of the second set.\r\n * @param {number} opts.innerRadius2 - The desired inner radius of the second dataset in pixels, for a donut chart with two concentric donuts.\r\n * Default of zero gives a pie char. Specify a value for donut chart.\r\n * @param {number} opts.imageWidth - The width of images in pixels. Images will be resized to this width.\r\n * @param {string} opts.sort - Sort function. Set to 'asc' for ascending, 'desc' for descending or '' for no sort.\r\n * @param {string} opts.label - How to label sections. Set to 'value' for raw number, 'percent' for percentage or\r\n * 'pervalue' for percentage and count together.\r\n * @param {string} opts.labelFontSize - Specifies the size of label and legend text.\r\n * @param {string} opts.labelColour - Specifies the colour of label text.\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized.\r\n * @param {string} opts.legendTitle - Specifies text, if required, for a legend title.\r\n * @param {string} opts.legendTitle2 - Specifies text, if required, for a legend title for second dataset (inner concentric donut).\r\n * @param {string} opts.legendTitleFontSize - Font size (pixels) of legend title(s).\r\n * @param {string} opts.legendSwatchSize - Specifies the size of legend swatches.\r\n * @param {string} opts.legendSwatchGap - Specifies the size of gap between legend swatches.\r\n * @param {number} opts.legendWidth - The width of the legend in pixels.\r\n * @param {string} opts.title - Title for the chart.\r\n * @param {string} opts.subtitle - Subtitle for the chart.\r\n * @param {string} opts.footer - Footer for the chart.\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'.\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds.\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>set</b> - a number to indicate to which 'dataset' this item belongs. Used when concentric donuts are requred.\r\n * <li> <b>name</b> - the name of the data item uniquely identifies it and is shown in the legend.\r\n * <li> <b>number</b> - a numeric value associated with the item.\r\n * <li> <b>colour</b> - an optional colour for the symbol which can be hex format, e.g. #FFA500, \r\n * RGB format, e.g. rgb(100, 255, 0) or a named colour, e.g. red. If not specified, a colour will be assigned.\r\n * <li> <b>image</b> - this optional property allows you to specify the url of an image file\r\n * which can be displayed when a user selects the associated item.\r\n * </ul>\r\n * @param {function} opts.callback - A callback function executed when a pie segment is highlighted. Gets passed\r\n * the name property of the highlighted data.\r\n * @returns {module:pie~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function pie({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'piechart',\r\n  strokeWidth = 2,\r\n  radius = 180,\r\n  innerRadius = 0,\r\n  innerRadius2 = 0,\r\n  sort = '',\r\n  label = 'percent',\r\n  labelFontSize = 14,\r\n  labelColour = 'white',\r\n  expand = false,\r\n  legendTitle = '',\r\n  legendTitle2 = '',\r\n  legendTitleFontSize = 16,\r\n  legendSwatchSize = 30,\r\n  legendSwatchGap = 10,\r\n  legendWidth = 200,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 14,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  imageWidth = 150,\r\n  duration = 1000,\r\n  interactivity = 'mousemove',\r\n  data = [],\r\n  callback = function(){return}\r\n} = {}) {\r\n\r\n  let dataPrev\r\n  //let block = false\r\n\r\n  colourData(data)\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .attr('class', 'brc-chart-pie')\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const chartDiv = mainDiv\r\n    .append('div')\r\n\r\n  const svg = chartDiv.append('svg').attr('overflow', 'visible')\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart')\r\n\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(svg, null, false, dataPrev, imageWidth, callback)\r\n    }\r\n  })\r\n\r\n  makeChart(data)\r\n  const textWidth = Number(svgChart.attr(\"width\"))\r\n  // Texts must come after chart and legend because the \r\n  // width of those is required to do wrap text\r\n  gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  gen.positionMainElements(svg, expand)\r\n\r\n  function makeChart(data) {\r\n\r\n    dataPrev = makePie (data, dataPrev, sort, strokeWidth, radius, innerRadius, innerRadius2, svg, svgChart, imageWidth, interactivity, duration, label, labelColour, labelFontSize, callback)\r\n    \r\n    makeLegend (data, svg, svgChart, legendWidth, labelFontSize, legendSwatchSize, legendSwatchGap, legendTitle, legendTitle2, legendTitleFontSize, duration, interactivity, dataPrev, imageWidth, callback)\r\n    const svgPie = svgChart.select('.brc-chart-pie')\r\n    const svgLegend = svgChart.select('.brc-chart-legend')\r\n    svgPie.attr(\"x\", Number(svgLegend.attr(\"width\")) + legendSwatchGap)\r\n    svgChart.attr(\"width\", Number(svgLegend.attr(\"width\")) + legendSwatchGap + Number(svgPie.attr(\"width\")))\r\n    svgChart.attr(\"height\", Math.max(Number(svgLegend.attr(\"height\")), Number(svgPie.attr(\"height\"))))\r\n  }\r\n\r\n  function colourData(data) {\r\n    data.forEach((d,i) => {\r\n      if (!d.colour) {\r\n        if (i < 10) {\r\n          d.colour = d3.schemeCategory10[i]\r\n        }\r\n        else if (i < 18) {\r\n          d.colour = d3.schemeDark2[i - 10]\r\n        }\r\n        else if (i < 26) {\r\n          d.colour = d3.schemeAccent[i - 18]\r\n        }\r\n        else {\r\n          d.colour = d3.interpolateSpectral(Math.random())\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {number} opts.radius - The desired radius of the chart in pixels.\r\n  * @param {number} opts.innerRadius - The desired inner radius of the chart in pixels. Default of zero gives a pie chart. Specify a value for donut chart.\r\n  * If your data specify more than one dataset (for concentric donuts), this value is also the out-radius of the second set.\r\n  * @param {number} opts.innerRadius2 - The desired inner radius of the second dataset in pixels, for a donut chart with two concentric donuts.\r\n  * Default of zero gives a pie char. Specify a value for donut chart.\r\n  * @param {string} opts.legendTitle - Specifies text, if requiredi, for a legend title.\r\n  * @param {string} opts.legendTitle2 - Specifies text, if required, for a legend title for second dataset (inner concentric donut).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n  * @description <b>This function is exposed as a method on the API returned from the pie function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    //if (!block) {\r\n\r\n      highlightItem(svg, null, false, dataPrev, imageWidth, callback)\r\n\r\n      if ('title' in opts) {\r\n        title = opts.title\r\n      }\r\n      if ('subtitle' in opts) {\r\n        subtitle = opts.subtitle\r\n      }\r\n      if ('footer' in opts) {\r\n        footer = opts.footer\r\n      }\r\n      if ('titleFontSize' in opts) {\r\n        titleFontSize = opts.titleFontSize\r\n      }\r\n      if ('subtitleFontSize' in opts) {\r\n        subtitleFontSize = opts.subtitleFontSize\r\n      }\r\n      if ('footerFontSize' in opts) {\r\n        footerFontSize = opts.footerFontSize\r\n      }\r\n      if ('titleAlign' in opts) {\r\n        titleAlign = opts.titleAlign\r\n      }\r\n      if ('subtitleAlign' in opts) {\r\n        subtitleAlign = opts.subtitleAlign\r\n      }\r\n      if ('footerAlign' in opts) {\r\n        footerAlign = opts.footerAlign\r\n      }\r\n      if ('radius' in opts) {\r\n        radius = opts.radius\r\n      }\r\n      if ('innerRadius' in opts) {\r\n        innerRadius = opts.innerRadius\r\n      }\r\n      if ('innerRadius2' in opts) {\r\n        innerRadius2 = opts.innerRadius2\r\n      }\r\n       if ('legendTitle' in opts) {\r\n        legendTitle = opts.legendTitle\r\n      }\r\n      if ('legendTitle2' in opts) {\r\n        legendTitle2 = opts.legendTitle2\r\n      }\r\n\r\n      const textWidth = Number(svgChart.attr(\"width\"))\r\n      gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n      gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n      gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n      if ('data' in opts) {\r\n        colourData(opts.data)\r\n        makeChart(opts.data)\r\n      }\r\n\r\n      //positionElements()\r\n      gen.positionMainElements(svg, expand)\r\n    // } else {\r\n    //   console.log('Transition in progress')\r\n    // }\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the pie function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the pie function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the pie function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return gen.saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:pie~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:pie~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:pie~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:pie~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module temporal */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from '../general'\r\nimport { makeTemporal } from './makeTemporal'\r\nimport { makeLegend } from './legend'\r\nimport { highlightItem } from './highlightitem'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG. (Default - 'body'.)\r\n * @param {string} opts.elid - The id for the dom object created. (Default - 'temporal-chart'.)\r\n * @param {number} opts.width - The width of each sub-chart area in pixels. (Default - 300.)\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels. (Default - 200.)\r\n * @param {Object} opts.margin - An object indicating the margins to add around each sub-chart area.\r\n * @param {number} opts.margin.left - Left margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.right - Right margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.top - Top margin in pixels. (Default - 20.)\r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. (Default - 20.)\r\n * @param {number} opts.perRow - The number of sub-charts per row. (Default - 2.)\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized. (Default - false.)\r\n * @param {string} opts.title - Title for the chart. (Default - ''.)\r\n * @param {string} opts.subtitle - Subtitle for the chart. (Default - ''.)\r\n * @param {string} opts.footer - Footer for the chart. (Default - ''.)\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title. (Default - 24.)\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle. (Default - 16.)\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer. (Default - 10.)\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph. (Default - true.)\r\n * @param {boolean} opts.showLegend - Whether or not to show an overall chart legend. (Default - true.)\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label. (Default - 10.)\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.(Default - true.)\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text. (Default - 16.)\r\n * @param {string} opts.axisLeftLabel - Value for labelling left axis. (Default - ''.)\r\n * @param {string} opts.axisRightLabel - Value for labelling right axis. (Default - ''.)\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axist labels. (Default - 10.)\r\n * @param {string} opts.axisLeft - If set to 'on' line is drawn without ticks. \r\n * If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn without ticks. \r\n * If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - ''.)\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn otherwise not. (Default - ''.)\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {string} opts.yAxisOpts - Specifies options for scaling and displaying left axis.\r\n * @param {string} opts.yAxisOpts.numFormat - Indicates format for displaying numeric values (uses d3 format values - https://github.com/d3/d3-format). (Default is 'd'.)\r\n * @param {number} opts.yAxisOpts.minMax - Indicates a minumum value for the maximum value. Set to null for no minimum value. (Default is 5.)\r\n * @param {number} opts.yAxisOpts.fixedMin - Sets a fixed minimum. Set to null for no fixed minimum. (Default is 0.)\r\n * @param {number} opts.yAxisOpts.padding - Sets padding to add to the y axis limits as a proportion of data range. (Default is 0.)\r\n * @param {number} opts.headPad - A left hand offset, in pixels, for title, subtitle, legend and footer. (Default 0.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds. (Default - 1000.)\r\n * @param {string} opts.chartStyle - The type of the graphic 'bar' for a barchart and 'line' for a line graph. (Default - 'bar'.)\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'. (Default - 'none'.)\r\n * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input\r\n * data for which graphics should be generated on the chart.\r\n * Each of the objects in the data array can be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>prop</b> - the name of the numeric property in the data (metric properties - 'c1' or 'c2' in the example below).\r\n * <li> <b>label</b> - a label for this metric. (Optional - the default label will be the property name.)\r\n * <li> <b>colour</b> - optional colour to give the graphic for this metric. Any accepted way of \r\n * specifying web colours can be used. Use the special term 'fading' to successively fading shades of grey.\r\n * (Optional - default is 'blue'.)\r\n * <li> <b>opacity</b> - optional opacity to give the graphic for this metric. \r\n * (Optional - default is 0.5.)\r\n * <li> <b>linewidth</b> - optional width of line for line for this metric if displayed as a line graph. \r\n * (Optional - default is 1.)\r\n * <li> <b>bandUpper</b> - optional name of a numeric property in the data which indicates the upper value\r\n * of a confidence band. Can only be used where <i>chartStyle</i> is 'line'. \r\n * <li> <b>bandLower</b> - optional name of a numeric property in the data which indicates the lower value\r\n * of a confidence band. Can only be used where <i>chartStyle</i> is 'line'. \r\n * <li> <b>bandFill</b> - optional colour to use for a confidence band. Any accepted way of \r\n * specifying web colours can be used. \r\n * (Optional - default is 'silver'.)\r\n * <li> <b>bandStroke</b> - optional colour to use for the uppder and lower boundaries of a confidence band. Any accepted way of \r\n * specifying web colours can be used. \r\n * (Optional - default is 'grey'.)\r\n * <li> <b>bandOpacity</b> - optional opacity to give the confidence band for this metric. \r\n * (Optional - default is 0.5.)\r\n * <li> <b>bandStrokeOpacity</b> - optional opacity to give the boundaries of the confidence band for this metric. \r\n * (Optional - default is 1.)\r\n * <li> <b>bandStrokewidth</b> - optional width of line for bounary lines of the confidence band this metric if displayed as a line graph. \r\n * (Optional - default is 1.)\r\n * <li> <b>points</b> - optional name of a numeric property in the data which indicates where a point is to be displayed.\r\n * <li> <b>errorBarUpper</b> - optional name of a numeric property in the data which indicates the upper value\r\n * of an error bar. Used in conjunction with the <i>errorBarLower</i> property. \r\n* <li> <b>errorBarLower</b> - optional name of a numeric property in the data which indicates the lower value\r\n * of an error bar. Used in conjunction with the <i>errorBarUpper</i> property. \r\n * </ul>\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>period</b> - a number indicating a week or a year.\r\n * <li> <b>c1</b> - a metric for a given period (can have any name). \r\n * <li> <b>c2</b> - a metric for a given period (can have any name).\r\n * ... - there must be at least one metric column, but there can be any number of them.\r\n * </ul>\r\n * @param {Array.<Object>} opts.dataPoints - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>period</b> - a number indicating a week or a year.\r\n * <li> <b>y</b> - y value for a given period. \r\n * <li> <b>upper</b> - a value for upper confidence band.\r\n * <li> <b>lower</b> - a value for lower confidence band.\r\n * </ul>\r\n * @param {Array.<Object>} opts.dataTrendLines - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>gradient</b> - a gradient for the line.\r\n * <li> <b>inercept</b> - the y axis intercept value (at x = 0) for the line. \r\n * <li> <b>colour</b> - the colour of the line the line. Any accepted way of specifying web colours can be used. (Default - red.)\r\n * <li> <b>width</b> - the width the line the line in pixels. (Default - 1.)\r\n * <li> <b>opacity</b> - the opacity of the line. (Default - 1.)\r\n * </ul>\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created. (Default - [].)\r\n * @param {string} opts.periodType Indicates the type of period data to be specified. Can be 'year' or 'week. (Default - 'year'.)\r\n * @param {number} opts.minPeriod Indicates the earliest period to use on the x axis. If left unset, the earliest period in the dataset is used. (Default - null.)\r\n * @param {number} opts.maxPeriod Indicates the latest period to use on the x axis. If left unset, the latest period in the dataset is used. (Default - null.)\r\n * @param {number} opts.minPeriodTrans If set, this indicates the lowest possible period. It is only useful if transitioning between datasets with different\r\n * temporal ranges - its purpose is to facilitate smooth transitions of lines and bands in these cases. (Default - null.)\r\n * @param {number} opts.maxPeriodTrans If set, this indicates the highest possible period. It is only useful if transitioning between datasets with different\r\n * temporal ranges - its purpose is to facilitate smooth transitions of lines and bands in these cases. (Default - null.)\r\n * @param {number} opts.minY Indicates the lowest value to use on the y axis. If left unset, the lowest value in the dataset is used. (Default - null.)\r\n * @param {number} opts.maxY Indicates the highest value to use on the y axis. If left unset, the highest value in the dataset is used. (Default - null.)\r\n * @param {number} opts.xPadPercent Padding to add either side of min and max period value - expressed as percentage of temporal range. Can only be used on line charts. (Default - 0.)\r\n * @param {number} opts.yPadPercent Padding to add either side of min and max y value - expressed as percentage of y range. Can only be used on line charts. (Default - 0.)\r\n * @param {string|number} opts.missingValues A value which indicates how gaps in temporal data are treated. Can either be the string value 'break' which\r\n * causes trend lines to break where no value, 'bridge' which causes gaps to be bridged with straight line or a numeric value. (Default - 0.)\r\n * @returns {module:temporal~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function temporal({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'temporal-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 30, right: 30, top: 15, bottom: 20},\r\n  perRow = 2,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  showLegend = false,\r\n  axisLeftLabel = '',\r\n  axisRightLabel = '',\r\n  axisLabelFontSize = 10,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 10,\r\n  taxonLabelItalics = false,\r\n  axisLeft = 'tick',\r\n  yAxisOpts = {numFormat: 'd', minMax: 5, fixedMin: 0, padding: 0},\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  chartStyle = 'bar', \r\n  headPad = 0,\r\n  duration = 1000,\r\n  interactivity = 'none',\r\n  data = [],\r\n  dataPoints = [],\r\n  dataTrendLines = [],\r\n  taxa = [],\r\n  metrics = [],\r\n  minPeriod = null,\r\n  maxPeriod = null,\r\n  minPeriodTrans = null,\r\n  maxPeriodTrans = null,\r\n  minY = null,\r\n  maxY = null,\r\n  xPadPercent = 0,\r\n  yPadPercent = 0,\r\n  missingValues = 0,\r\n  periodType = 'year'\r\n} = {}) {\r\n\r\n  // xPadPercent and yPadPercent can not be used with charts of bar type.\r\n  if (chartStyle === 'bar') {\r\n    xPadPercent = 0\r\n    yPadPercent = 0\r\n  }\r\n\r\n  let metricsPlus\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, false, svgChart)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart brc-chart-temporal')\r\n  \r\n  preProcessMetrics()\r\n  makeChart()\r\n  // Texts must come after chartbecause \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\") - headPad)\r\n  gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  gen.positionMainElements(svg, expand, headPad)\r\n\r\n  function makeChart () {\r\n\r\n    // Set min and max period from data if not set\r\n    if (!minPeriod) {\r\n      minPeriod = Math.min(...data.map(d => d.period))\r\n    }\r\n    if (!maxPeriod) {\r\n      maxPeriod = Math.max(...data.map(d => d.period))\r\n    }\r\n\r\n    // If taxa for graphs not set, set to all in dataset\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    const subChartPad = 10\r\n    const pTrans = []\r\n\r\n    const svgsTaxa = taxa.map(t => makeTemporal (\r\n      svgChart,\r\n      t,\r\n      taxa,\r\n      data,\r\n      dataPoints,\r\n      dataTrendLines,\r\n      periodType,\r\n      minPeriod,\r\n      maxPeriod,\r\n      minPeriodTrans,\r\n      maxPeriodTrans,\r\n      minY,\r\n      maxY,\r\n      xPadPercent,\r\n      yPadPercent,\r\n      metricsPlus,\r\n      width,\r\n      height,\r\n      axisTop,\r\n      axisBottom,\r\n      chartStyle,\r\n      axisLeft,\r\n      yAxisOpts,\r\n      axisRight,\r\n      duration,\r\n      interactivity,\r\n      margin,\r\n      showTaxonLabel,\r\n      taxonLabelFontSize,\r\n      taxonLabelItalics,\r\n      axisLabelFontSize,\r\n      axisLeftLabel,\r\n      axisRightLabel,\r\n      missingValues,\r\n      pTrans\r\n    ))\r\n\r\n    const subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n    const subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n\r\n    const legendHeight = showLegend ? makeLegend(\r\n      svgChart,\r\n      metricsPlus,\r\n      perRow * (subChartWidth + subChartPad) - headPad,\r\n      legendFontSize,\r\n      headPad,\r\n      chartStyle,\r\n      interactivity\r\n    ) + subChartPad : 0\r\n\r\n    svgsTaxa.forEach((svgTaxon, i) => {\r\n      \r\n      const col = i%perRow\r\n      const row = Math.floor(i/perRow)\r\n\r\n      svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n      svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad) + legendHeight)\r\n    })\r\n\r\n    svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n    svgChart.attr(\"height\", legendHeight +  Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n\r\n  function preProcessMetrics () {\r\n    // Look for 'fading' colour in taxa and colour appropriately \r\n    // in fading shades of grey.\r\n    \r\n    let iFading = 0\r\n    metricsPlus = metrics.map(m => {\r\n      let iFade, strokeWidth\r\n      if (m.colour === 'fading') {\r\n        iFade = ++iFading\r\n        strokeWidth = 1\r\n      } else {\r\n        strokeWidth = m.linewidth ? m.linewidth : 2\r\n      }\r\n      return {\r\n        prop: m.prop,\r\n        label: m.label ?  m.label : m.prop,\r\n        opacity: m.opacity !== 'undefined' ? m.opacity : 0.5,\r\n        colour: m.colour ? m.colour : 'blue',\r\n        fading: iFade,\r\n        strokeWidth: strokeWidth,\r\n        bandUpper: m.bandUpper,\r\n        bandLower: m.bandLower,\r\n        bandFill: m.bandFill,\r\n        bandOpacity: m.bandOpacity,\r\n        bandStroke: m.bandStroke,\r\n        bandStrokeWidth: m.bandStrokeWidth,\r\n        bandStrokeOpacity: m.bandStrokeOpacity,\r\n        points: m.points,\r\n        errorBarUpper: m.errorBarUpper,\r\n        errorBarLower: m.errorBarLower\r\n      }\r\n    }).reverse()\r\n\r\n    const grey = d3.scaleLinear()\r\n      .range(['#808080', '#E0E0E0'])\r\n      .domain([1, iFading])\r\n\r\n    metricsPlus.forEach(m => {\r\n      if (m.fading) {\r\n        m.colour = grey(m.fading)\r\n      }\r\n    })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {number} opts.minPeriod Indicates the earliest period to use on the y axis.\r\n  * @param {number} opts.maxPeriod Indicates the latest period to use on the y axis.\r\n  * @param {Array.<Object>} opts.metrics - Specifies an array of metrics objects (see main interface for details).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @param {Array.<Object>} opts.dataPoints - Specifies an array of data objects (see main interface for details).\r\n  * @returns {Promise} promise that resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the temporal function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    if ('minPeriod' in opts) {\r\n      minPeriod = opts.minPeriod\r\n    }\r\n    if ('maxPeriod' in opts) {\r\n      maxPeriod = opts.maxPeriod\r\n    }\r\n    if ('minY' in opts) {\r\n      minY = opts.minY\r\n    }\r\n    if ('maxY' in opts) {\r\n      maxY = opts.maxY\r\n    }\r\n    if ('metrics' in opts) {\r\n      metrics = opts.metrics\r\n    }\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n    }\r\n    if ('dataPoints' in opts) {\r\n      dataPoints = opts.dataPoints\r\n    }\r\n    if ('dataTrendLines' in opts) {\r\n      dataTrendLines = opts.dataTrendLines\r\n    }\r\n\r\n    if ('taxa' in opts) {\r\n      taxa = opts.taxa\r\n      highlightItem(null, false, svgChart)\r\n    }\r\n\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let pRet\r\n    if ('taxa' in opts || 'data' in opts || 'minPeriod' in opts || 'maxPeriod' in opts || 'metrics' in opts || 'minY' in opts || 'maxY' in opts) {\r\n      preProcessMetrics()\r\n      pRet = makeChart()\r\n      gen.positionMainElements(svg, expand)\r\n    } else {\r\n      pRet = Promise.resolve()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} opts.taxon - The taxon to display.\r\n  * @returns {Promise} promise that resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the temporal function</b>.\r\n  * For single species charts, this allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    let pRet\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n      pRet = Promise.resolve()\r\n    } else {\r\n      taxa = [taxon]\r\n      highlightItem(null, false, svgChart)\r\n      pRet = makeChart()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the temporal function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the temporal function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the temporal function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return gen.saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:temporal~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:temporal~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:temporal~setChartOpts} setChartOpts - Sets various options for the chart. \r\n   * @property {module:temporal~setChartOpts} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:temporal~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module trend */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from './general'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG. (Default - 'body'.)\r\n * @param {string} opts.elid - The id for the dom object created. (Default - 'trend-chart'.)\r\n * @param {number} opts.width - The width of each sub-chart area in pixels. (Default - 300.)\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels. (Default - 200.)\r\n * @param {Object} opts.margin - An object indicating the margins to add around each sub-chart area.\r\n * @param {number} opts.margin.left - Left margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.right - Right margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.top - Top margin in pixels. (Default - 20.)\r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. (Default - 20.)\r\n * @param {number} opts.perRow - The number of sub-charts per row. (Default - 2.)\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized. (Default - false.)\r\n * @param {string} opts.title - Title for the chart. (Default - ''.)\r\n * @param {string} opts.subtitle - Subtitle for the chart. (Default - ''.)\r\n * @param {string} opts.footer - Footer for the chart. (Default - ''.)\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title. (Default - 24.)\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle. (Default - 16.)\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer. (Default - 10.)\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph. (Default - true.)\r\n * @param {boolean} opts.showLegend - Whether or not to show an overall chart legend. (Default - true.)\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label. (Default - 10.)\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.(Default - true.)\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text. (Default - 16.)\r\n * @param {string} opts.axisLeftLabel - Value for labelling left axis. (Default - ''.)\r\n * @param {string} opts.axisRightLabel - Value for labelling right axis. (Default - ''.)\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axist labels. (Default - 10.)\r\n * @param {string} opts.axisLeft - If set to 'on' line is drawn without ticks. \r\n * If set to 'counts' line and ticks drawn for counts scale. If set to 'proportions' line and ticks drawn for proportion scale (0-1). \r\n * If set to 'percentages' line and ticks drawn for percentage scale (1-100). Any other value results in no axis. (Default - 'percentages'.)\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn without ticks. \r\n * If set to 'counts' line and ticks drawn for counts scale. If set to 'proportions' line and ticks drawn for proportion scale (0-1). \r\n * If set to 'percentages' line and ticks drawn for percentage scale (1-100). Any other value results in no axis. (Default - 'counts'.)\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn otherwise not. (Default - ''.)\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds. (Default - 1000.)\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'. (Default - 'none'.)\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>year</b> - a four digit number indicating a year.\r\n * <li> <b>count</b> - a count for the given year. \r\n * </ul>\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created. (Default - [].)\r\n * @param {Array.<string>} opts.group - An array of taxa (names), indicating which taxa comprise the whole group for which proportion stats are calculated. \r\n * If empty, all taxa are part of the group from which proportion data is calculated. (Default - [].)\r\n * @param {number} opts.minYear- Indicates the earliest year to use on the y axis. If left unset, the earliest year in the dataset is used. (Default - null.)\r\n * @param {number} opts.maxYear- Indicates the latest year to use on the y axis. If left unset, the latest year in the dataset is used. (Default - null.)\r\n * @param {string} opts.showCounts- Indicates whether or not to plot the actual number of records for each taxon and, if so, the style of chart to use.\r\n * Can be 'line' for a line graph or 'bar' for a bar chart. Any other value means that the metric will not be plotted. (Default - 'bar'.)\r\n * @param {string} opts.showProps- Indicates whether or not to plot the proportion of all records in the group accounted for by each taxon and, if so, the style of chart to use.\r\n * Can be 'line' for a line graph or 'bar' for a bar chart. Any other value means that the metric will not be plotted. (Default - 'line'.)\r\n * @param {Object} opts.styleCounts - An object specifying the style to use for the count graphic.\r\n * @param {string} opts.styleCounts.colour - Colour of bars or line (as determined by showCounts property). (Default - 'CornflowerBlue'.)\r\n * @param {number} opts.styleCounts.strokeWidth - If the showCounts property is set to 'line' then this property indicates the line width. (Default - not set.)\r\n * @param {number} opts.styleCounts.opacity - The opacity of the lines/bars in the chart. A number between 0 and 1. (Default - 1.)\r\n * @param {string} opts.styleCounts.legend - Text to use for the counts metric in the legend. (Default - ''.)\r\n * @param {Object} opts.styleProps - An object specifying the style to use for the proportions/percentage graphic.\r\n * @param {string} opts.styleProps.colour - Colour of bars or line (as determined by showProps property). (Default - 'black'.)\r\n * @param {number} opts.styleProps.strokeWidth - If the showProps property is set to 'line' then this property indicates the line width. (Default - 2.)\r\n * @param {number} opts.styleProps.opacity - The opacity of the lines/bars in the chart. A number between 0 and 1. (Default - 1.)\r\n * @param {string} opts.styleProps.legend - Text to use for the proportion/percentage metric in the legend. (Default - ''.)\r\n * @returns {module:trend~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function trend({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'trend-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 30, right: 30, top: 15, bottom: 15},\r\n  perRow = 2,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  showLegend = false,\r\n  axisLeftLabel = '',\r\n  axisRightLabel = '',\r\n  axisLabelFontSize = 10,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 10,\r\n  taxonLabelItalics = false,\r\n  axisLeft = 'counts',\r\n  axisBottom = 'tick',\r\n  axisRight = 'percentages',\r\n  axisTop = '',\r\n  showCounts = 'bar', \r\n  showProps = 'line', \r\n  styleCounts = {colour: 'CornflowerBlue', opacity: 1},\r\n  styleProps = {colour: 'black', opacity: 1, strokeWidth: 2},\r\n  duration = 1000,\r\n  interactivity = 'none',\r\n  data = [],\r\n  taxa = [],\r\n  group = [],\r\n  minYear = null,\r\n  maxYear = null,\r\n} = {}) {\r\n\r\n  // Store list of currently displayed taxa charts in case of taxa list\r\n  // being updated.\r\n  let currentTaxa = []\r\n\r\n  // If store explicitly set min and max year so that changes in setChartOpts\r\n  // can be dealt with properly. These can also be reset in setChartOpts.\r\n  let minYearExplicit = minYear\r\n  let maxYearExplicit = maxYear\r\n\r\n  // Ensure style prop objects have the required properties.\r\n  styleCounts.colour = styleCounts.colour ? styleCounts.colour : 'CornflowerBlue'\r\n  styleCounts.opacity = styleCounts.opacity ? styleCounts.opacity : 1\r\n  styleCounts.strokeWidth = styleCounts.strokeWidth ? styleCounts.strokeWidth : 2\r\n  styleProps.colour = styleProps.colour ? styleProps.colour : 'black'\r\n  styleProps.opacity = styleProps.opacity ? styleProps.opacity : 1\r\n  styleProps.strokeWidth = styleProps.strokeWidth ? styleProps.strokeWidth : 2\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, false)\r\n    }\r\n  })\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart brc-chart-trend')\r\n  makeChart()\r\n  makeTexts()\r\n\r\n  function makeTexts() {\r\n    // Texts must come after chartbecause \r\n    // the chart width is required\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n    gen.positionMainElements(svg, expand)\r\n  }\r\n\r\n  function makeChart () {\r\n\r\n    // Set min and max year from data if not set\r\n    if (!minYearExplicit) {\r\n      minYear = Math.min(...data.map(d => d.year))\r\n    } else {\r\n      minYear = minYearExplicit\r\n    }\r\n    if (!maxYearExplicit) {\r\n      maxYear = Math.max(...data.map(d => d.year))\r\n    } else {\r\n      maxYear = maxYearExplicit\r\n    }\r\n\r\n    // If taxa for graphs not set, set to all in dataset\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    // If group for proportion/percentage data not set, set to all in dataset\r\n    if (!group.length) {\r\n      group = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    // Generate object with yearly totals\r\n    const yearTotals = {}\r\n    data\r\n      .filter(d => group.indexOf(d.taxon) > -1 && d.year >= minYear && d.year <= maxYear)\r\n      .forEach(d => {\r\n        if (yearTotals[d.year]) {\r\n          yearTotals[d.year] = yearTotals[d.year] + d.count\r\n        } else {\r\n          yearTotals[d.year] = d.count\r\n        }\r\n      })\r\n\r\n    const subChartPad = 10\r\n\r\n    // Delete any existing charts which are not included in the new taxa\r\n    // list - unless there's only one in each\r\n    if (currentTaxa.length === 1 && currentTaxa[0] === '') {\r\n      // This is a dummy taxon to get empty graph displayed.\r\n      // Can't select by id as this is empty string. Select\r\n      // by class.\r\n      svgChart.select('.brc-chart-trend').remove()\r\n    } else if (!(taxa.length === 1 && currentTaxa.length === 1)) {\r\n      currentTaxa.forEach(t => {\r\n        if (taxa.indexOf(t) === -1) {\r\n          svgChart.select( `#${gen.safeId(t)}`).remove()\r\n        }\r\n      })\r\n    }\r\n    // Make charts and update array of current taxa\r\n    const svgsTaxa = taxa.map(t => makeTrend(t, yearTotals))\r\n    currentTaxa = taxa\r\n\r\n    let subChartWidth, subChartHeight\r\n    if (svgsTaxa.length) {\r\n      subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n      subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n    } else {\r\n      // No taxa specified\r\n      subChartWidth =  Number(width)\r\n      subChartHeight = Number(height)\r\n    }\r\n\r\n    const legendHeight = showLegend ? makeLegend(perRow * (subChartWidth + subChartPad)) + subChartPad : 0\r\n\r\n    svgsTaxa.forEach((svgTaxon, i) => {\r\n      \r\n      const col = i%perRow\r\n      const row = Math.floor(i/perRow)\r\n\r\n      svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n      svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad) + legendHeight)\r\n    })\r\n\r\n    svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n    svgChart.attr(\"height\", legendHeight +  Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n  }\r\n\r\n  function makeTrend (taxon, yearTotals) {\r\n\r\n    // Pre-process data.\r\n    // Filter to named taxon and to min and max year and sort in year order\r\n    // Add max value to each.\r\n\r\n    const dataFiltered = data\r\n      .filter(d => d.taxon === taxon && d.year >= minYear && d.year <= maxYear)\r\n      .sort((a, b) => (a.year > b.year) ? 1 : -1)\r\n\r\n    // Set the maximum values for the y axis\r\n    let yMaxProp = Math.max(...dataFiltered.map(d => d.count / yearTotals[d.year]))\r\n    //yMaxProp = yMaxProp < 0.005 ? 0.005 : yMaxProp // Prevents tiny values\r\n    yMaxProp = yMaxProp < 0.001 ? 0.001 : yMaxProp // Prevents tiny values\r\n    let yMaxCount = Math.max(...dataFiltered.map(d => d.count))\r\n    yMaxCount = yMaxCount < 5 ? 5 : yMaxCount // Prevents tiny values\r\n\r\n    // Value scales\r\n    let years = []\r\n    for (let i = minYear; i <= maxYear; i++) {\r\n      years.push(i)\r\n    }\r\n    const xScaleBar = d3.scaleBand().domain(years).range([0, width]).paddingInner(0.1)\r\n    const xScaleLine = d3.scaleLinear().domain([minYear, maxYear]).range([0, width])\r\n    const yScaleCount = d3.scaleLinear().domain([0, yMaxCount]).range([height, 0])\r\n    const yScaleProps = d3.scaleLinear().domain([0, yMaxProp]).range([height, 0])\r\n\r\n    // Top axis\r\n    let tAxis\r\n    if (axisTop === 'on') {\r\n      tAxis = d3.axisTop()\r\n        .scale(xScaleLine) // Actual scale doesn't matter, but needs one\r\n        .tickValues([])\r\n        .tickSizeOuter(0)\r\n    }\r\n\r\n    // Bottom axis\r\n    let bAxis\r\n    if (axisBottom === 'on' || axisBottom === 'tick') {\r\n      bAxis = gen.xAxisYear(width, axisBottom === 'tick', minYear, maxYear, (showCounts === 'bar' || showProps === 'bar'))\r\n    }\r\n\r\n    const makeXaxis = (leftRight, axisOpt) => {\r\n      let axis, format\r\n      const d3axis = leftRight === 'left' ? d3.axisLeft() : d3.axisRight()\r\n      switch(axisOpt) {\r\n        case 'on':\r\n          axis = d3axis.scale(yScaleCount).tickValues([]).tickSizeOuter(0)\r\n          break\r\n        case 'counts':\r\n          axis = d3axis.scale(yScaleCount).ticks(5).tickFormat(d3.format(\"d\"))\r\n          break\r\n        case 'proportions':\r\n          axis = d3axis.scale(yScaleProps).ticks(5)\r\n          break\r\n        case 'percentages':\r\n          //format = yMaxProp < 0.01 ? d3.format(\".2%\") : d3.format(\".0%\")\r\n          if (yMaxProp < 0.01) {\r\n            format = d3.format(\".2%\")\r\n          } else if (yMaxProp < 0.05) {\r\n            format = d3.format(\".1%\")\r\n          } else {\r\n            format = d3.format(\".0%\")\r\n          }\r\n          axis = d3axis.scale(yScaleProps).ticks(5).tickFormat(format)\r\n          break\r\n      }\r\n      return axis\r\n    }\r\n    const lAxis = makeXaxis('left', axisLeft)\r\n    const rAxis = makeXaxis('right', axisRight)\r\n\r\n    // Create or get the relevant chart svg\r\n    let init, svgTrend, gTrend, gTrendRect, gTrendPath\r\n    if (taxa.length === 1 && svgChart.selectAll('.brc-chart-trend').size() === 1) {\r\n      svgTrend = svgChart.select('.brc-chart-trend')\r\n      gTrend = svgTrend.select('.brc-chart-trend-g')\r\n      gTrendPath = svgTrend.select('.brc-chart-trend-g-path')\r\n      gTrendRect = svgTrend.select('.brc-chart-trend-g-rect')\r\n      init = false\r\n    } else if (svgChart.select(`#${gen.safeId(taxon)}`).size()) {\r\n      svgTrend = svgChart.select(`#${gen.safeId(taxon)}`)\r\n      gTrend = svgTrend.select('.brc-chart-trend-g')\r\n      gTrendPath = svgTrend.select('.brc-chart-trend-g-path')\r\n      gTrendRect = svgTrend.select('.brc-chart-trend-g-rect')\r\n      init = false\r\n    } else {\r\n      svgTrend = svgChart.append('svg')\r\n        .classed('brc-chart-trend', true)\r\n        .attr('id', gen.safeId(taxon))\r\n        .style('overflow', 'visible')\r\n      gTrend = svgTrend.append('g')\r\n        .classed('brc-chart-trend-g', true)\r\n      // Add these in correct order so that lines are\r\n      // always shown above bars\r\n      gTrendRect = gTrend.append('g').classed('brc-chart-trend-g-rect', true)\r\n      gTrendPath = gTrend.append('g').classed('brc-chart-trend-g-path', true)\r\n      init = true\r\n    }\r\n\r\n    // Line path generators\r\n    const lineCounts = d3.line()\r\n      .curve(d3.curveMonotoneX)\r\n      .x(d => xScaleLine(d.year))\r\n      .y(d => yScaleCount(d.n))\r\n\r\n    const lineProps = d3.line()\r\n      .curve(d3.curveMonotoneX)\r\n      .x(d => xScaleLine(d.year))\r\n      .y(d => yScaleProps(d.n))\r\n\r\n    const chartLines = []\r\n    const dataDict = dataFiltered.reduce((a,d) => {\r\n      a[d.year]=d.count\r\n      return a\r\n    }, {})\r\n    if (showCounts === 'line') {\r\n      chartLines.push({\r\n        lineGen: lineCounts,\r\n        colour: styleCounts.colour,\r\n        opacity: styleCounts.opacity,\r\n        strokeWidth: styleCounts.strokeWidth,\r\n        type: 'counts',\r\n        points: years.map(y => {\r\n          return {\r\n            year: y,\r\n            n: dataDict[y] ? dataDict[y] : 0,\r\n          }\r\n        })\r\n      })\r\n    }\r\n    if (showProps === 'line') {\r\n      chartLines.push({\r\n        lineGen: lineProps,\r\n        colour: styleProps.colour,\r\n        opacity: styleProps.opacity,\r\n        strokeWidth: styleProps.strokeWidth,\r\n        type: 'props',\r\n        points: years.map(y => {\r\n          return {\r\n            year: y,\r\n            n: dataDict[y] ? dataDict[y]/yearTotals[y] : 0,\r\n          }\r\n        })\r\n      })\r\n    }\r\n    let chartBars = []\r\n    if (showCounts === 'bar') {\r\n      const bars = dataFiltered.map(d => {\r\n        return {\r\n          yScale: yScaleCount,\r\n          colour: styleCounts.colour,\r\n          opacity: styleCounts.opacity,\r\n          type: 'counts',\r\n          year: d.year,\r\n          n: yScaleCount(d.count),\r\n        }\r\n      })\r\n      chartBars = [...chartBars, ...bars]\r\n    }\r\n    if (showProps === 'bar') {\r\n      const bars = dataFiltered.map(d => {\r\n        return {\r\n          yScale: yScaleProps,\r\n          colour: styleProps.colour,\r\n          opacity: styleProps.opacity,\r\n          type: 'props',\r\n          year: d.year,\r\n          n: yScaleProps(d.count / yearTotals[d.year]),\r\n        }\r\n      })\r\n      chartBars = [...chartBars, ...bars]\r\n    }\r\n\r\n    const t = svgTrend.transition()\r\n        .duration(duration)\r\n\r\n    gTrendRect.selectAll(\"rect\")\r\n      .data(chartBars, d => `props-${d.year}`)\r\n      .join(\r\n        enter => enter.append(\"rect\")\r\n          .attr(\"class\", d => `trend-type-${d.type}`)\r\n          .attr('width', xScaleBar.bandwidth())\r\n          .attr('height', 0)\r\n          .attr('fill', d => d.colour)\r\n          .attr('opacity', d => d.opacity)\r\n          .attr('y', height)\r\n          .attr('x', d => xScaleBar(d.year)),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => exit.transition(t)\r\n            .attr('height', 0)\r\n            .attr('y', height)\r\n            .remove())\r\n      ).transition(t)\r\n        // The selection returned by the join function is the merged\r\n        // enter and update selections\r\n        .attr('y', d => d.n)\r\n        .attr('x', d => xScaleBar(d.year))\r\n        .attr('width', xScaleBar.bandwidth())\r\n        .attr('height', d => height - d.n)\r\n        .attr(\"fill\", d => d.colour)\r\n  \r\n    gTrendPath.selectAll(\"path\")\r\n      .data(chartLines, d => d.type)\r\n      .join(\r\n        enter => enter.append(\"path\")\r\n          .attr(\"class\", d => `trend-type-${d.type}`)\r\n          .attr(\"opacity\", d => d.opacity)\r\n          .attr(\"fill\", \"none\")\r\n          .attr(\"stroke\", d => d.colour)\r\n          .attr(\"stroke-width\", d => d.strokeWidth)\r\n          .attr(\"d\", d => {\r\n            return d.lineGen(d.points.map(p => {\r\n              return {\r\n                n: 0,\r\n                year: p.year\r\n              }\r\n            }))}),\r\n        update => update,\r\n        exit => exit\r\n          .call(exit => exit.transition(t)\r\n            .attr(\"d\", d => {\r\n              return d.lineGen(d.points.map(p => {\r\n                return {\r\n                  n: 0,\r\n                  year: p.year\r\n                }\r\n              }))\r\n            })\r\n            .remove())\r\n      ).transition(t)\r\n        // The selection returned by the join function is the merged\r\n        // enter and update selections\r\n        .attr(\"d\", d => d.lineGen(d.points))\r\n\r\n    addEventHandlers(gTrend.selectAll(\"path\"), 'type')\r\n    addEventHandlers(gTrend.selectAll(\"rect\"), 'type')\r\n        \r\n    if (init) {\r\n\r\n      // Constants for positioning\r\n      const axisLeftPadX = margin.left ? margin.left : 0\r\n      const axisRightPadX = margin.right ? margin.right : 0\r\n      const axisBottomPadY = margin.bottom ? margin.bottom : 0\r\n      const axisTopPadY = margin.top ? margin.top : 0\r\n\r\n      // Taxon title\r\n      if (showTaxonLabel) {\r\n        const taxonLabel = svgTrend\r\n          .append('text')\r\n          .classed('brc-chart-trend-label', true)\r\n          .text(taxon)\r\n          .style('font-size', taxonLabelFontSize)\r\n          .style('font-style', taxonLabelItalics ? 'italic' : '')\r\n\r\n        const labelHeight = taxonLabel.node().getBBox().height\r\n        taxonLabel.attr(\"transform\", `translate(${axisLeftPadX}, ${labelHeight})`)\r\n      }\r\n      \r\n       // Size SVG\r\n      svgTrend\r\n        .attr('width', width + axisLeftPadX + axisRightPadX)\r\n        .attr('height', height + axisBottomPadY + axisTopPadY)\r\n\r\n      // Position chart\r\n      gTrend.attr(\"transform\", `translate(${axisLeftPadX},${axisTopPadY})`)\r\n      \r\n      // Create axes and position within SVG\r\n      const leftYaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n      const leftYaxisLabelTrans = `translate(${axisLabelFontSize},${axisTopPadY + height/2}) rotate(270)`\r\n      const rightYaxisTrans = `translate(${axisLeftPadX + width}, ${axisTopPadY})`\r\n      const rightYaxisLabelTrans = `translate(${axisLeftPadX + width + axisRightPadX - axisLabelFontSize}, ${axisTopPadY + height/2}) rotate(90)`\r\n      const topXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY})`\r\n      const bottomXaxisTrans = `translate(${axisLeftPadX},${axisTopPadY + height})`\r\n\r\n      // Create axes and position within SVG\r\n      if (lAxis) {\r\n        const gLaxis = svgTrend.append(\"g\")\r\n          .attr(\"class\", \"l-axis\")\r\n          .classed('trend-type-counts',  axisLeft === 'counts')\r\n          .classed('trend-type-props',  axisLeft !== 'counts')\r\n        gLaxis.attr(\"transform\", leftYaxisTrans)\r\n      }\r\n      if (bAxis) {\r\n        const gBaxis = svgTrend.append(\"g\")\r\n          .attr(\"class\", \"x axis b-axis\")\r\n          .call(bAxis)\r\n        gBaxis.attr(\"transform\", bottomXaxisTrans)\r\n      }\r\n      if (tAxis) {\r\n        const gTaxis = svgTrend.append(\"g\")\r\n          .call(tAxis)\r\n        gTaxis.attr(\"transform\", topXaxisTrans)\r\n      }\r\n      if (rAxis) {\r\n        const gRaxis = svgTrend.append(\"g\")\r\n          //.call(rAxis)\r\n          .attr(\"class\", \"r-axis\")\r\n          .classed('trend-type-counts',  axisRight === 'counts')\r\n          .classed('trend-type-props',  axisRight !== 'counts')\r\n        gRaxis.attr(\"transform\", rightYaxisTrans)\r\n      }\r\n\r\n      const tYaxisLeftLabel = svgTrend.append(\"text\")\r\n        .classed('trend-type-counts',  axisLeft === 'counts')\r\n        .classed('trend-type-props',  axisLeft !== 'counts')\r\n        .style(\"text-anchor\", \"middle\")\r\n        .style('font-size', axisLabelFontSize)\r\n        .text(axisLeftLabel) \r\n      tYaxisLeftLabel.attr(\"transform\", leftYaxisLabelTrans)\r\n\r\n      const tYaxisRightLabel = svgTrend.append(\"text\")\r\n        .classed('trend-type-counts',  axisRight === 'counts')\r\n        .classed('trend-type-props',  axisRight !== 'counts')\r\n        .style(\"text-anchor\", \"middle\")\r\n        .style('font-size', axisLabelFontSize)\r\n        .text(axisRightLabel) \r\n      tYaxisRightLabel.attr(\"transform\", rightYaxisLabelTrans)\r\n\r\n    } else if (taxa.length === 1) {\r\n      // Update taxon label\r\n      if (showTaxonLabel) {\r\n        svgTrend.select('.brc-chart-trend-label').text(taxon)\r\n      }\r\n    }\r\n\r\n    if (svgTrend.selectAll(\".b-axis\").size()){\r\n      svgTrend.select(\".b-axis\")\r\n      .transition()\r\n      .duration(duration)\r\n      .call(bAxis)\r\n    }\r\n\r\n    if (svgTrend.selectAll(\".l-axis\").size()){\r\n      svgTrend.select(\".l-axis\")\r\n      .transition()\r\n      .duration(duration)\r\n      .call(lAxis)\r\n    }\r\n\r\n    if (svgTrend.selectAll(\".r-axis\").size()){\r\n      svgTrend.select(\".r-axis\")\r\n      .transition()\r\n      .duration(duration)\r\n      .call(rAxis)\r\n    }\r\n    \r\n    return svgTrend\r\n  }\r\n\r\n  function makeLegend (legendWidth) {\r\n    \r\n    const swatchSize = 20\r\n    const swatchFact = 1.3\r\n\r\n    const items = []\r\n    if (showCounts === 'line' || showCounts === 'bar') {\r\n      items.push({\r\n        colour: styleCounts.colour,\r\n        opacity: styleCounts.opacity,\r\n        graphic: showCounts,\r\n        text: styleCounts.legend,\r\n        type: 'counts'\r\n      })\r\n    }\r\n    if (showProps === 'line' || showProps === 'bar') {\r\n      items.push({\r\n        colour: styleProps.colour,\r\n        opacity: styleProps.opacity,\r\n        graphic: showProps,\r\n        text: styleProps.legend,\r\n        type: 'props'\r\n      })\r\n    }\r\n\r\n    // Loop through all the legend elements and work out their\r\n    // positions based on swatch size, item label text size and\r\n    // legend width.\r\n    let rows = 0\r\n    let lineWidth = -swatchSize\r\n    items.forEach(i => {\r\n      const tmpText = svgChart.append('text')\r\n        .text(i.text)\r\n        .style('font-size', legendFontSize)\r\n\r\n      const widthText = tmpText.node().getBBox().width\r\n      tmpText.remove()\r\n\r\n      if (lineWidth + swatchSize + swatchSize * swatchFact + widthText > legendWidth) {\r\n        ++rows\r\n        lineWidth = -swatchSize\r\n      }\r\n      i.x = lineWidth + swatchSize\r\n      i.y = rows * swatchSize * swatchFact\r\n\r\n      lineWidth = lineWidth + swatchSize + swatchSize * swatchFact + widthText\r\n    })\r\n\r\n    // Legend does not need to be recreated if it already exists\r\n    if (!svgChart.selectAll('.brc-legend-item').size()) {\r\n    \r\n      const ls = svgChart.selectAll('.brc-legend-item-rect')\r\n        .data(items, i => gen.safeId(i.label))\r\n        .join(enter => {\r\n            const rect = enter.append(\"rect\")\r\n              //.attr(\"class\", i=> `brc-legend-item brc-legend-item-rect brc-legend-item-${gen.safeId(i.label)}`)\r\n              .attr('class', i => `brc-legend-item trend-type-${i.type}`)\r\n              .attr('width', swatchSize)\r\n              .attr('height', i => i.graphic === 'bar' ? swatchSize/2 : 2)\r\n            return rect\r\n        })\r\n        .attr('x', i => i.x)\r\n        .attr('y', i => i.graphic === 'bar' ? i.y + legendFontSize - swatchSize/2 : i.y + legendFontSize - 2)\r\n        .attr('fill', i => i.colour)\r\n        .attr('opacity', i => i.opacity)\r\n\r\n      const lt = svgChart.selectAll('.brc-legend-item-text')\r\n        .data(items, i => gen.safeId(i.label))\r\n        .join(enter => {\r\n            const text = enter.append(\"text\")\r\n              //.attr(\"class\", i=> `brc-legend-item brc-legend-item-text brc-legend-item-${gen.safeId(i.label)}`)\r\n              .attr('class', i => `brc-legend-item trend-type-${i.type}`)\r\n              .text(i => i.text)\r\n              .style('font-size', legendFontSize)\r\n            return text\r\n        })\r\n        .attr('x', i => i.x + swatchSize * swatchFact)\r\n        .attr('y', i => i.y + legendFontSize * 1)\r\n\r\n      addEventHandlers(ls, 'type')\r\n      addEventHandlers(lt, 'type')\r\n    }\r\n    return swatchSize * swatchFact * (rows + 1)\r\n  }\r\n\r\n  function highlightItem(id, highlight) {\r\n\r\n    svgChart.selectAll('.trend-type-counts,.trend-type-props')\r\n      .classed('lowlight', false)\r\n\r\n    if (highlight) {\r\n      svgChart.selectAll('.trend-type-counts,.trend-type-props')\r\n        .classed('lowlight', true)\r\n      svgChart.selectAll(`.trend-type-${id}`)\r\n        .classed('lowlight', false)\r\n    }\r\n  }\r\n\r\n  function addEventHandlers(sel, prop) {\r\n    sel\r\n      .on(\"mouseover\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d[prop], true)\r\n        }\r\n      })\r\n      .on(\"mouseout\", function(d) {\r\n        if (interactivity === 'mousemove') {\r\n          highlightItem(d[prop], false)\r\n        }\r\n      })\r\n      .on(\"click\", function(d) {\r\n        if (interactivity === 'mouseclick') {\r\n          highlightItem(d[prop], true)\r\n          d3.event.stopPropagation()\r\n        }\r\n      })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.taxa - A list of taxa to create charts for.\r\n  * @param {string} opts.group - A list of taxa to used to calculate group totals for percentage of group records.\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @description <b>This function is exposed as a method on the API returned from the trend function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    \r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let remakeChart = false\r\n    let remakeTexts = false\r\n\r\n    if ('minYear' in opts) {\r\n      minYearExplicit = opts.minYear\r\n      remakeChart = true\r\n    }\r\n    if ('maxYear' in opts) {\r\n      maxYearExplicit = opts.maxYear\r\n      remakeChart = true\r\n    }\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n      remakeChart = true\r\n    }\r\n    if ('taxa' in opts) {\r\n      taxa = opts.taxa\r\n      remakeChart = true\r\n      remakeTexts = true\r\n    }\r\n    if ('group' in opts) {\r\n      group = opts.group\r\n      remakeChart = true\r\n    }\r\n\r\n    if (remakeChart) {\r\n      highlightItem(null, false)\r\n      makeChart()\r\n    }\r\n    if (remakeTexts) makeTexts()\r\n    gen.positionMainElements(svg, expand)\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} opts.taxon - The taxon to display.\r\n  * @description <b>This function is exposed as a method on the API returned from the trend function</b>.\r\n  * For single species charts, this allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n    } else {\r\n      taxa = [taxon]\r\n      highlightItem(null, false)\r\n      makeChart()\r\n    }\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the trend function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the trend function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the trend function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return gen.saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:trend~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:trend~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:trend~setChartOpts} setChartOpts - Sets text options for the chart. \r\n   * @property {module:trend~setTaxon} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:trend~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}","/** @module yearly */\r\n\r\nimport * as d3 from 'd3'\r\nimport * as gen from '../general'\r\nimport { makeYearly } from './makeYearly'\r\nimport { makeLegend } from './legend'\r\nimport { highlightItem } from './highlightitem'\r\n\r\n/** \r\n * @param {Object} opts - Initialisation options.\r\n * @param {string} opts.selector - The CSS selector of the element which will be the parent of the SVG. (Default - 'body'.)\r\n * @param {string} opts.elid - The id for the dom object created. (Default - 'yearly-chart'.)\r\n * @param {number} opts.width - The width of each sub-chart area in pixels. (Default - 300.)\r\n * @param {number} opts.height - The height of the each sub-chart area in pixels. (Default - 200.)\r\n * @param {Object} opts.margin - An object indicating the margins to add around each sub-chart area.\r\n * @param {number} opts.margin.left - Left margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.right - Right margin in pixels. (Default - 40.)\r\n * @param {number} opts.margin.top - Top margin in pixels. (Default - 20.)\r\n * @param {number} opts.margin.bottom - Bottom margin in pixels. (Default - 20.)\r\n * @param {number} opts.perRow - The number of sub-charts per row. (Default - 2.)\r\n * @param {boolean} opts.expand - Indicates whether or not the chart will expand to fill parent element and scale as that element resized. (Default - false.)\r\n * @param {string} opts.title - Title for the chart. (Default - ''.)\r\n * @param {string} opts.subtitle - Subtitle for the chart. (Default - ''.)\r\n * @param {string} opts.footer - Footer for the chart. (Default - ''.)\r\n * @param {string} opts.titleFontSize - Font size (pixels) of chart title. (Default - 24.)\r\n * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle. (Default - 16.)\r\n * @param {string} opts.footerFontSize - Font size (pixels) of chart footer. (Default - 10.)\r\n * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'. (Default - 'left'.)\r\n * @param {boolean} opts.showTaxonLabel - Whether or not to show taxon label above each sub-graph. (Default - true.)\r\n * @param {boolean} opts.showLegend - Whether or not to show an overall chart legend. (Default - true.)\r\n * @param {string} opts.taxonLabelFontSize - Font size (pixels) of taxon sub-chart label. (Default - 10.)\r\n * @param {boolean} opts.taxonLabelItalics - Whether or not to italicise taxon label.(Default - true.)\r\n * @param {string} opts.legendFontSize - Font size (pixels) of legend item text. (Default - 16.)\r\n * @param {string} opts.axisLeftLabel - Value for labelling left axis. (Default - ''.)\r\n * @param {string} opts.axisRightLabel - Value for labelling right axis. (Default - ''.)\r\n * @param {string} opts.axisLabelFontSize - Font size (pixels) for axist labels. (Default - 10.)\r\n * @param {string} opts.axisLeft - If set to 'on' line is drawn without ticks. \r\n * If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'count'.)\r\n * @param {string} opts.axisRight - If set to 'on' line is drawn without ticks. \r\n * If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - ''.)\r\n * @param {string} opts.axisTop - If set to 'on' line is drawn otherwise not. (Default - ''.)\r\n * @param {string} opts.axisBottom - If set to 'on' line is drawn without ticks. If set to 'tick' line and ticks drawn. Any other value results in no axis. (Default - 'tick'.)\r\n * @param {string} opts.yAxisOpts - Specifies options for scaling and displaying left axis.\r\n * @param {string} opts.yAxisOpts.numFormat - Indicates format for displaying numeric values (uses d3 format values - https://github.com/d3/d3-format). (Default is 'd'.)\r\n * @param {number} opts.yAxisOpts.minMax - Indicates a minumum value for the maximum value. Set to null for no minimum value. (Default is 5.)\r\n * @param {number} opts.yAxisOpts.fixedMin - Sets a fixed minimum. Set to null for no fixed minimum. (Default is 0.)\r\n * @param {number} opts.yAxisOpts.padding - Sets padding to add to the y axis limits as a proportion of data range. (Default is 0.)\r\n * @param {number} opts.headPad - A left hand offset, in pixels, for title, subtitle, legend and footer. (Default 0.)\r\n * @param {number} opts.duration - The duration of each transition phase in milliseconds. (Default - 1000.)\r\n * @param {string} opts.showCounts - The type of the graphic 'bar' for a barchart and 'line' for a line graph. (Default - 'bar'.)\r\n * @param {string} opts.interactivity - Specifies how item highlighting occurs. Can be 'mousemove', 'mouseclick' or 'none'. (Default - 'none'.)\r\n * @param {Array.<Object>} opts.metrics - An array of objects, each describing a numeric property in the input\r\n * data for which graphics should be generated on the chart.\r\n * Each of the objects in the data array can be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>prop</b> - the name of the numeric property in the data (metric properties - 'c1' or 'c2' in the example below).\r\n * <li> <b>label</b> - a label for this metric. (Optional - the default label will be the property name.)\r\n * <li> <b>colour</b> - optional colour to give the graphic for this metric. Any accepted way of \r\n * specifying web colours can be used. Use the special term 'fading' to successively fading shades of grey.\r\n * (Optional - default is 'blue'.)\r\n * <li> <b>opacity</b> - optional opacity to give the graphic for this metric. \r\n * (Optional - default is 0.5.)\r\n * <li> <b>linewidth</b> - optional width of line for line for this metric if displayed as a line graph. \r\n * (Optional - default is 1.)\r\n * <li> <b>bandUpper</b> - optional name of a numeric property in the data which indicates the upper value\r\n * of a confidence band. Can only be used where <i>showCounts</i> is 'line'. \r\n * <li> <b>bandLower</b> - optional name of a numeric property in the data which indicates the lower value\r\n * of a confidence band. Can only be used where <i>showCounts</i> is 'line'. \r\n * <li> <b>bandFill</b> - optional colour to use for a confidence band. Any accepted way of \r\n * specifying web colours can be used. \r\n * (Optional - default is 'silver'.)\r\n * <li> <b>bandStroke</b> - optional colour to use for the uppder and lower boundaries of a confidence band. Any accepted way of \r\n * specifying web colours can be used. \r\n * (Optional - default is 'grey'.)\r\n * <li> <b>bandOpacity</b> - optional opacity to give the confidence band for this metric. \r\n * (Optional - default is 0.5.)\r\n * <li> <b>bandStrokeOpacity</b> - optional opacity to give the boundaries of the confidence band for this metric. \r\n * (Optional - default is 1.)\r\n * <li> <b>bandStrokewidth</b> - optional width of line for bounary lines of the confidence band this metric if displayed as a line graph. \r\n * (Optional - default is 1.)\r\n * <li> <b>points</b> - optional name of a numeric property in the data which indicates where a point is to be displayed.\r\n * <li> <b>errorBarUpper</b> - optional name of a numeric property in the data which indicates the upper value\r\n * of an error bar. Used in conjunction with the <i>errorBarLower</i> property. \r\n* <li> <b>errorBarLower</b> - optional name of a numeric property in the data which indicates the lower value\r\n * of an error bar. Used in conjunction with the <i>errorBarUpper</i> property. \r\n * </ul>\r\n * @param {Array.<Object>} opts.data - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>year</b> - a four digit number indicating a year.\r\n * <li> <b>c1</b> - a metric for a given year (can have any name). \r\n * <li> <b>c2</b> - a metric for a given year (can have any name).\r\n * ... - there must be at least one metric column, but there can be any number of them.\r\n * </ul>\r\n * @param {Array.<Object>} opts.dataPoints - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>year</b> - a four digit number indicating a year.\r\n * <li> <b>y</b> - y value for a given year. \r\n * <li> <b>upper</b> - a value for upper confidence band.\r\n * <li> <b>lower</b> - a value for lower confidence band.\r\n * </ul>\r\n * @param {Array.<Object>} opts.dataTrendLines - Specifies an array of data objects.\r\n * Each of the objects in the data array must be sepecified with the properties shown below. (The order is not important.)\r\n * <ul>\r\n * <li> <b>taxon</b> - name of a taxon.\r\n * <li> <b>gradient</b> - a gradient for the line.\r\n * <li> <b>inercept</b> - the y axis intercept value (at x = 0) for the line. \r\n * <li> <b>colour</b> - the colour of the line the line. Any accepted way of specifying web colours can be used. (Default - red.)\r\n * <li> <b>width</b> - the width the line the line in pixels. (Default - 1.)\r\n * <li> <b>opacity</b> - the opacity of the line. (Default - 1.)\r\n * </ul>\r\n * @param {Array.<string>} opts.taxa - An array of taxa (names), indicating which taxa create charts for. \r\n * If empty, graphs for all taxa are created. (Default - [].)\r\n\r\n * @param {number} opts.minYear Indicates the earliest year to use on the x axis. If left unset, the earliest year in the dataset is used. (Default - null.)\r\n * @param {number} opts.maxYear Indicates the latest year to use on the x axis. If left unset, the latest year in the dataset is used. (Default - null.)\r\n * @param {number} opts.minYearTrans If set, this indicates the lowest possible year. It is only useful if transitioning between datasets with different\r\n * year ranges - its purpose is to facilitate smooth transitions of lines and bands in these cases. (Default - null.)\r\n * @param {number} opts.maxYearTrans If set, this indicates the highest possible year. It is only useful if transitioning between datasets with different\r\n * year ranges - its purpose is to facilitate smooth transitions of lines and bands in these cases. (Default - null.)\r\n * @param {number} opts.minCount Indicates the lowest value to use on the y axis. If left unset, the lowest value in the dataset is used. (Default - null.)\r\n * @param {number} opts.maxCount Indicates the highest value to use on the y axis. If left unset, the highest value in the dataset is used. (Default - null.)\r\n * @param {number} opts.xPadPercent Padding to add either side of min and max year value - expressed as percentage of year range. Can only be used on line charts. (Default - 0.)\r\n * @param {number} opts.yPadPercent Padding to add either side of min and max y value - expressed as percentage of y range. Can only be used on line charts. (Default - 0.)\r\n * @param {string|number} opts.missingValues A value which indicates how gaps in yearly data are treated. Can either be the string value 'break' which\r\n * causes trend lines to break where no value, 'bridge' which causes gaps to be bridged with straight line or a numeric value. (Default - 0.)\r\n * @returns {module:yearly~api} api - Returns an API for the chart.\r\n */\r\n\r\nexport function yearly({\r\n  // Default options in here\r\n  selector = 'body',\r\n  elid = 'yearly-chart',\r\n  width = 300,\r\n  height = 200,\r\n  margin = {left: 30, right: 30, top: 15, bottom: 20},\r\n  perRow = 2,\r\n  expand = false,\r\n  title = '',\r\n  subtitle = '',\r\n  footer = '',\r\n  titleFontSize = 24,\r\n  subtitleFontSize = 16,\r\n  footerFontSize = 10,\r\n  legendFontSize = 16,\r\n  showLegend = false,\r\n  axisLeftLabel = '',\r\n  axisRightLabel = '',\r\n  axisLabelFontSize = 10,\r\n  titleAlign = 'left',\r\n  subtitleAlign = 'left',\r\n  footerAlign = 'left',\r\n  showTaxonLabel = true,\r\n  taxonLabelFontSize = 10,\r\n  taxonLabelItalics = false,\r\n  axisLeft = 'tick',\r\n  yAxisOpts = {numFormat: 'd', minMax: 5, fixedMin: 0, padding: 0},\r\n  axisBottom = 'tick',\r\n  axisRight = '',\r\n  axisTop = '',\r\n  showCounts = 'bar', \r\n  headPad = 0,\r\n  duration = 1000,\r\n  interactivity = 'none',\r\n  data = [],\r\n  dataPoints = [],\r\n  dataTrendLines = [],\r\n  taxa = [],\r\n  metrics = [],\r\n  minYear = null,\r\n  maxYear = null,\r\n  minYearTrans = null,\r\n  maxYearTrans = null,\r\n  minCount = null,\r\n  maxCount = null,\r\n  xPadPercent = 0,\r\n  yPadPercent = 0,\r\n  missingValues = 0\r\n} = {}) {\r\n\r\n  // xPadPercent and yPadPercent can not be used with charts of bar type.\r\n  if (showCounts === 'bar') {\r\n    xPadPercent = 0\r\n    yPadPercent = 0\r\n  }\r\n\r\n  let metricsPlus\r\n\r\n  const mainDiv = d3.select(`${selector}`)\r\n    .append('div')\r\n    .attr('id', elid)\r\n    .style('position', 'relative')\r\n    .style('display', 'inline')\r\n\r\n  const svg = mainDiv.append('svg')\r\n  svg.on(\"click\", function() {\r\n    if (interactivity === 'mouseclick') {\r\n      highlightItem(null, false, svgChart)\r\n    }\r\n  })\r\n\r\n  const svgChart = svg.append('svg').attr('class', 'mainChart brc-chart-yearly')\r\n  \r\n  preProcessMetrics()\r\n  makeChart()\r\n  // Texts must come after chartbecause \r\n  // the chart width is required\r\n  const textWidth = Number(svg.select('.mainChart').attr(\"width\") - headPad)\r\n  gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n  gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n  gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n  gen.positionMainElements(svg, expand, headPad)\r\n\r\n  function makeChart () {\r\n\r\n    // Set min and max year from data if not set\r\n    if (!minYear) {\r\n      minYear = Math.min(...data.map(d => d.year))\r\n    }\r\n    if (!maxYear) {\r\n      maxYear = Math.max(...data.map(d => d.year))\r\n    }\r\n\r\n    // If taxa for graphs not set, set to all in dataset\r\n    if (!taxa.length) {\r\n      taxa = data.map(d => d.taxon).filter((v, i, a) => a.indexOf(v) === i)\r\n    }\r\n\r\n    const subChartPad = 10\r\n    const pTrans = []\r\n\r\n    const svgsTaxa = taxa.map(t => makeYearly(\r\n      svgChart,\r\n      t,\r\n      taxa,\r\n      data,\r\n      dataPoints,\r\n      dataTrendLines,\r\n      minYear,\r\n      maxYear,\r\n      minYearTrans,\r\n      maxYearTrans,\r\n      minCount,\r\n      maxCount,\r\n      xPadPercent,\r\n      yPadPercent,\r\n      metricsPlus,\r\n      width,\r\n      height,\r\n      axisTop,\r\n      axisBottom,\r\n      showCounts,\r\n      axisLeft,\r\n      yAxisOpts,\r\n      axisRight,\r\n      duration,\r\n      interactivity,\r\n      margin,\r\n      showTaxonLabel,\r\n      taxonLabelFontSize,\r\n      taxonLabelItalics,\r\n      axisLabelFontSize,\r\n      axisLeftLabel,\r\n      axisRightLabel,\r\n      missingValues,\r\n      pTrans\r\n    ))\r\n\r\n    const subChartWidth = Number(svgsTaxa[0].attr(\"width\"))\r\n    const subChartHeight = Number(svgsTaxa[0].attr(\"height\"))\r\n\r\n    const legendHeight = showLegend ? makeLegend(\r\n      svgChart,\r\n      metricsPlus,\r\n      perRow * (subChartWidth + subChartPad) - headPad,\r\n      legendFontSize,\r\n      headPad,\r\n      showCounts,\r\n      interactivity\r\n    ) + subChartPad : 0\r\n\r\n    svgsTaxa.forEach((svgTaxon, i) => {\r\n      \r\n      const col = i%perRow\r\n      const row = Math.floor(i/perRow)\r\n\r\n      svgTaxon.attr(\"x\", col * (subChartWidth + subChartPad))\r\n      svgTaxon.attr(\"y\", row * (subChartHeight + subChartPad) + legendHeight)\r\n    })\r\n\r\n    svgChart.attr(\"width\", perRow * (subChartWidth + subChartPad))\r\n    svgChart.attr(\"height\", legendHeight +  Math.ceil(svgsTaxa.length/perRow) * (subChartHeight + subChartPad))\r\n\r\n    return Promise.allSettled(pTrans)\r\n  }\r\n\r\n  function preProcessMetrics () {\r\n    // Look for 'fading' colour in taxa and colour appropriately \r\n    // in fading shades of grey.\r\n    \r\n    let iFading = 0\r\n    metricsPlus = metrics.map(m => {\r\n      let iFade, strokeWidth\r\n      if (m.colour === 'fading') {\r\n        iFade = ++iFading\r\n        strokeWidth = 1\r\n      } else {\r\n        strokeWidth = m.linewidth ? m.linewidth : 2\r\n      }\r\n      return {\r\n        prop: m.prop,\r\n        label: m.label ?  m.label : m.prop,\r\n        opacity: m.opacity !== 'undefined' ? m.opacity : 0.5,\r\n        colour: m.colour ? m.colour : 'blue',\r\n        fading: iFade,\r\n        strokeWidth: strokeWidth,\r\n        bandUpper: m.bandUpper,\r\n        bandLower: m.bandLower,\r\n        bandFill: m.bandFill,\r\n        bandOpacity: m.bandOpacity,\r\n        bandStroke: m.bandStroke,\r\n        bandStrokeWidth: m.bandStrokeWidth,\r\n        bandStrokeOpacity: m.bandStrokeOpacity,\r\n        points: m.points,\r\n        errorBarUpper: m.errorBarUpper,\r\n        errorBarLower: m.errorBarLower\r\n      }\r\n    }).reverse()\r\n\r\n    const grey = d3.scaleLinear()\r\n      .range(['#808080', '#E0E0E0'])\r\n      .domain([1, iFading])\r\n\r\n    metricsPlus.forEach(m => {\r\n      if (m.fading) {\r\n        m.colour = grey(m.fading)\r\n      }\r\n    })\r\n  }\r\n\r\n/** @function setChartOpts\r\n  * @param {Object} opts - text options.\r\n  * @param {string} opts.title - Title for the chart.\r\n  * @param {string} opts.subtitle - Subtitle for the chart.\r\n  * @param {string} opts.footer - Footer for the chart.\r\n  * @param {string} opts.titleFontSize - Font size (pixels) of chart title.\r\n  * @param {string} opts.subtitleFontSize - Font size (pixels) of chart subtitle.\r\n  * @param {string} opts.footerFontSize - Font size (pixels) of chart footer.\r\n  * @param {string} opts.titleAlign - Alignment of chart title: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.subtitleAlign - Alignment of chart subtitle: either 'left', 'right' or 'centre'.\r\n  * @param {string} opts.footerAlign - Alignment of chart footer: either 'left', 'right' or 'centre'.\r\n  * @param {number} opts.minYear Indicates the earliest year to use on the y axis.\r\n  * @param {number} opts.maxYear Indicates the latest year to use on the y axis.\r\n  * @param {Array.<Object>} opts.metrics - Specifies an array of metrics objects (see main interface for details).\r\n  * @param {Array.<Object>} opts.data - Specifies an array of data objects (see main interface for details).\r\n  * @param {Array.<Object>} opts.dataPoints - Specifies an array of data objects (see main interface for details).\r\n  * @returns {Promise} promise that resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the yearly function</b>.\r\n  * Set's the value of the chart data, title, subtitle and/or footer. If an element is missing from the \r\n  * options object, it's value is not changed.\r\n  */\r\n  function setChartOpts(opts){\r\n\r\n    if ('title' in opts) {\r\n      title = opts.title\r\n    }\r\n    if ('subtitle' in opts) {\r\n      subtitle = opts.subtitle\r\n    }\r\n    if ('footer' in opts) {\r\n      footer = opts.footer\r\n    }\r\n    if ('titleFontSize' in opts) {\r\n      titleFontSize = opts.titleFontSize\r\n    }\r\n    if ('subtitleFontSize' in opts) {\r\n      subtitleFontSize = opts.subtitleFontSize\r\n    }\r\n    if ('footerFontSize' in opts) {\r\n      footerFontSize = opts.footerFontSize\r\n    }\r\n    if ('titleAlign' in opts) {\r\n      titleAlign = opts.titleAlign\r\n    }\r\n    if ('subtitleAlign' in opts) {\r\n      subtitleAlign = opts.subtitleAlign\r\n    }\r\n    if ('footerAlign' in opts) {\r\n      footerAlign = opts.footerAlign\r\n    }\r\n    if ('minYear' in opts) {\r\n      minYear = opts.minYear\r\n    }\r\n    if ('maxYear' in opts) {\r\n      maxYear = opts.maxYear\r\n    }\r\n    if ('minCount' in opts) {\r\n      minCount = opts.minCount\r\n    }\r\n    if ('maxCount' in opts) {\r\n      maxCount = opts.maxCount\r\n    }\r\n    if ('metrics' in opts) {\r\n      metrics = opts.metrics\r\n    }\r\n    if ('data' in opts) {\r\n      data = opts.data\r\n    }\r\n    if ('dataPoints' in opts) {\r\n      dataPoints = opts.dataPoints\r\n    }\r\n    if ('dataTrendLines' in opts) {\r\n      dataTrendLines = opts.dataTrendLines\r\n    }\r\n\r\n    if ('taxa' in opts) {\r\n      taxa = opts.taxa\r\n      highlightItem(null, false, svgChart)\r\n    }\r\n\r\n    const textWidth = Number(svg.select('.mainChart').attr(\"width\"))\r\n    gen.makeText (title, 'titleText', titleFontSize, titleAlign, textWidth, svg)\r\n    gen.makeText (subtitle, 'subtitleText', subtitleFontSize, subtitleAlign, textWidth, svg)\r\n    gen.makeText (footer, 'footerText', footerFontSize, footerAlign, textWidth, svg)\r\n\r\n    let pRet\r\n    if ('taxa' in opts || 'data' in opts || 'minYear' in opts || 'maxYear' in opts || 'metrics' in opts || 'minCount' in opts || 'maxCount' in opts) {\r\n      preProcessMetrics()\r\n      pRet = makeChart()\r\n      gen.positionMainElements(svg, expand)\r\n    } else {\r\n      pRet = Promise.resolve()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function setTaxon\r\n  * @param {string} opts.taxon - The taxon to display.\r\n  * @returns {Promise} promise that resolves when all transitions complete.\r\n  * @description <b>This function is exposed as a method on the API returned from the yearly function</b>.\r\n  * For single species charts, this allows you to change the taxon displayed.\r\n  */\r\n  function setTaxon(taxon){\r\n    let pRet\r\n    if (taxa.length !== 1) {\r\n      console.log(\"You can only use the setTaxon method when your chart displays a single taxon.\")\r\n      pRet = Promise.resolve()\r\n    } else {\r\n      taxa = [taxon]\r\n      highlightItem(null, false, svgChart)\r\n      pRet = makeChart()\r\n    }\r\n    return pRet\r\n  }\r\n\r\n/** @function getChartWidth\r\n  * @description <b>This function is exposed as a method on the API returned from the yearly function</b>.\r\n  * Return the full width of the chart svg.\r\n  */\r\n  function getChartWidth(){\r\n    return svg.attr(\"width\") ? svg.attr(\"width\") : svg.attr(\"viewBox\").split(' ')[2]\r\n  }\r\n\r\n/** @function getChartHeight\r\n  * @description <b>This function is exposed as a method on the API returned from the yearly function</b>.\r\n  * Return the full height of the chart svg.\r\n  */\r\n  function getChartHeight(){\r\n    return svg.attr(\"height\") ? svg.attr(\"height\") : svg.attr(\"viewBox\").split(' ')[3]\r\n  }\r\n\r\n/** @function saveImage\r\n  * @param {boolean} asSvg - If true, file is generated as SVG, otherwise PNG.\r\n  * @param {string} filename - Name of the file (without extension) to generate and download.\r\n  * If the filename is falsey (e.g. blank), it will not automatically download the\r\n  * file. (Allows caller to do something else with the data URL which is returned\r\n  * as the promise's resolved value.)\r\n  * @returns {Promise} promise object represents the data URL of the image.\r\n  * @description <b>This function is exposed as a method on the API returned from the yearly function</b>.\r\n  * Download the chart as an image file.\r\n  */\r\n  function saveImage(asSvg, filename){\r\n    return gen.saveChartImage(svg, expand, asSvg, filename) \r\n  }\r\n\r\n\r\n  /**\r\n   * @typedef {Object} api\r\n   * @property {module:yearly~getChartWidth} getChartWidth - Gets and returns the current width of the chart.\r\n   * @property {module:yearly~getChartHeight} getChartHeight - Gets and returns the current height of the chart. \r\n   * @property {module:yearly~setChartOpts} setChartOpts - Sets various options for the chart. \r\n   * @property {module:yearly~setChartOpts} setTaxon - Changes the displayed taxon for single taxon charts. \r\n   * @property {module:yearly~saveImage} saveImage - Generates and downloads and image file for the SVG. \r\n   */\r\n  return {\r\n    getChartHeight: getChartHeight,\r\n    getChartWidth: getChartWidth,\r\n    setChartOpts: setChartOpts,\r\n    setTaxon: setTaxon,\r\n    saveImage: saveImage\r\n  }\r\n\r\n}"],"names":["safeId","text","replace","cloneData","data","map","d","month2day","monthMid2day","i","length","push","xAxisMonth","width","ticks","fontSize","font","ysDomain","ysRange","xScaleTime","d3","domain","range","xAxis","scale","svg","append","getMaxTextWidth","aText","Math","max","m","tmpText","style","textWidth","node","getBBox","remove","maxFullMonth","maxMedMonth","substr","maxMinMonth","tickSize","tickFormat","month","tickValues","tickSizeOuter","xAxisMonthNoText","xAxisMonthText","xAxisYear","min","bars","xScale","years","year","toString","makeText","classText","textAlign","svgText","select","size","attr","lines","maxWidth","textSplit","split","line","workingText","trim","txt","wrapText","uText","selectAll","eText","enter","merge","exit","height","widths","nodes","n","positionMainElements","expand","headPad","svgTitle","svgSubtitle","svgChart","svgFooter","Number","saveChartImage","asSvg","filename","Promise","resolve","blob1","serialize","download","reject","domSvg","promise","y","image","Image","onerror","onload","rect","getBoundingClientRect","canvas","document","createElement","context","getContext","drawImage","toBlob","src","URL","createObjectURL","rasterize","then","blob2","dataUrl","file","link","href","body","appendChild","dispatchEvent","MouseEvent","bubbles","cancelable","view","window","removeChild","downloadLink","xmlns","cloneSvg","cloneNode","fontOut","setAttributeNS","string","XMLSerializer","serializeToString","Blob","type","transPromise","transition","pArray","p","end","addEventHandlers","sel","isArc","interactivity","dataPrev","imageWidth","callback","on","highlightItem","name","stopPropagation","show","gen","imgSelected","classed","find","imageHeight","loadImage","img","this","makePie","dataPrevIn","sort","strokeWidth","radius","innerRadius","innerRadius2","duration","label","labelColour","labelFontSize","dataDeleted","dataInserted","dataRetained","fnSort","init","dataNew","prevNames","newNames","filter","includes","a","b","dataDeleted2","nd","number","dataComb","arcsPrev","getArcs","arcsComb","data1","set","data2","arcs1","value","sortValues","arcs2","forEach","arcComb","prevArc","arcPrev","deleted","inserted","gPie","arcGenerator","outerRadius","arcGeneratorLables","arcGeneratorLables2","arcTween","arc","_this","trans","radiusx","innerRadiusx","iPrev","_current","iCurr","midRadius","t","uPie","ePie","colour","each","mPie","transDuration","attrTween","arcsNew","total1","reduce","c","total2","uPieLabels","ePieLabels","total","isNaN","l","round","centroid","uPieLabelsHighlight","ePieLabelsHighlight","makeLegend","legendWidth","legendSwatchSize","legendSwatchGap","legendTitle","legendTitle2","legendTitleFontSize","svgLegend","legendTitleHeight","textHeight","legendTitleGap","legendTitleHeight2","legendTitleGap2","uLegendSwatch","durationUpdate","durationExit","eLegendSwatch","delay","uLegendText","legendTextHeight","eLegendText","legendTitles","uLegendTitle","dataSet1Length","legendHeight","dummyText","prop","id","highlight","makePhen","taxon","taxa","metricsin","ytype","spread","axisTop","axisBottom","axisLeft","axisRight","monthLineWidth","bands","stacked","margin","showTaxonLabel","taxonLabelFontSize","taxonLabelItalics","axisLabelFontSize","axisLeftLabel","pTrans","monthFontSize","period","yMax","metrics","_toConsumableArray","reverse","dataFiltered","metricData","stackOffsets","Array","fill","maxProportion","points","maxPeriod","pointsPlus","match","p1","closure","hasData","maxMetricHeight","topProp","spreadHeight","valMax0","valMax1","h1Prop","h2Prop","periodToDay","yScale","tAxis","xAxis1","xAxis2","rAxis","yAxis","sScale","svgPhen1","gPhen1","lineCurved","curve","x","lineNotCurved","agroups","egroups","mgroups","xgroups","flatPath","poly","flat","substring","getPath","lPath","lineFn","so1","so2","p2","join","update","call","barY","getBarY","v","getBarHeight","axisLeftPadX","left","axisRightPadX","right","axisBottomPadY","bottom","axisTopPadY","top","taxonLabel","labelHeight","leftYaxisTrans","rightYaxisTrans","topXaxisTrans","leftYaxisLabelTrans","gXaxis1","gXaxis2","preProcessMetrics","iFading","metricsPlus","iFade","fading","grey","legendFontSize","metricsReversed","rows","lineWidth","widthText","swatchSize","ls","lt","maxY","means","dMax","upper","mMax","mean","sd","minY","dMin","lower","mMin","makeChart","yMin","adjust","yearMin","yearMax","ylines","selector","elid","bAxis","lAxis","svgWidth","svgHeight","svgTrend","updateChart","gChart1","gChart2","yMinBuff","yMaxBuff","dataWork","yearMinBuff","yearMaxBuff","yearMinData","minYear","yearMaxData","maxYear","floor","linePath","vData","d3Line","vStroke","vStrokeWidth","uData","cStroke","cStrokeWidth","lData","pData","cFill","tMeans","bar","gChart","sdStroke","sdStrokeWidth","mRad","mFill","mStroke","mStrokeWidth","d3MeanSd","path","tYlines","stroke","d3Yline","makeUpdateChart","lClass","aData","yStart","gradient","intercept","yEnd","vOpacity","barStart","xMin","xMax","xlines","axisBottomLabel","styles","scaleHeight","svgDensity","xMinBuff","xMaxBuff","ds","slope","minX","maxX","custScale","bandwidths","dataMin","dataMax","densities","kernel","X","k","incr","abs","V","maxDensity","yScales","linePaths","s","getStyle","d3Density","allSettled","lineClass","strokeDasharray","labelPosition","padding","barHeightOnZero","xScaleBottom","labels","ye","bandwidth","d3Bars","makeYearly","dataPoints","dataTrendLines","minYearTrans","maxYearTrans","minCount","maxCount","xPadPercent","yPadPercent","showCounts","yAxisOpts","axisRightLabel","missingValues","dataPointsFiltered","dataTrendLinesFiltered","opacity","y1","y2","maxMetricCounts","bandUpper","maxCountA","yMaxCount","minMetricCounts","bandLower","minCountA","yMinCount","minMax","fixedMin","xPadding","yPadding","xScaleBar","paddingInner","xScaleLine","svgYearly","gYearly","makeXaxis","leftRight","axisOpt","axis","d3axis","numFormat","lineCounts","chartLines","chartBars","chartBands","chartPoints","chartErrorBars","dataDict","isFinite","adjustForTrans","part","pathEnter","ddUpper","ddLower","upperLine","pointsLowerSet","pointsUpperSet","pointsLower","pointsUpper","pointsBand","pointsLowerEnter","pointsUpperEnter","bandFill","bandStroke","fillOpacity","undefined","bandOpacity","strokeOpacity","bandStrokeOpacity","bandStrokeWidth","bandPath","bandPathEnter","bandBorders","bandBordersEnter","errorBarUpper","errorBarLower","errorBars","chartTrendLineSup","x1","x2","minx","maxx","chartPointsSup","chartPointsSupErrorBars","iLine","rightYaxisLabelTrans","bottomXaxisTrans","pntsIn","pntsSplit","retSet","pnts","ret","unshift","makeTemporal","periodType","minPeriod","minPeriodTrans","maxPeriodTrans","chartStyle","maxMetricYs","maxYA","ymaxY","minMetricYs","minYA","yminY","periods","svgTemporal","gTemporal","lineValues","SEC_TO_RAD","HALF_PI","PI","D2R","R2D","FORTPI","TWO_PI","SPI","exports","ft","to_meter","ignoredChar","obj","key","testkey","keys","Object","lkey","toLowerCase","defData","paramName","paramVal","paramOutname","self","paramObj","params","proj","datum","rf","parseFloat","lat_0","lat0","lat_1","lat1","lat_2","lat2","lat_ts","lon_0","long0","lon_1","long1","lon_2","long2","alpha","gamma","rectified_grid_angle","lonc","longc","x_0","x0","y_0","y0","k_0","k0","r_a","R_A","zone","parseInt","south","utmSouth","towgs84","datum_params","units","unit","from_greenwich","pm","PrimeMeridian","nadgrids","datumCode","indexOf","approx","whitespace","latin","keyword","endThings","digets","Parser","Error","level","place","root","stack","currentObject","state","mapit","isArray","thing","out","newObj","item","sExpr","shift","convert","prototype","readCharicter","char","test","neutral","quoted","afterquote","word","afterItem","pop","newObjects","output","d2r","input","wkt","lisp","projName","local","_typeof","PROJECTION","AXIS","axisOrder","ii","UNIT","DATUM","SPHEROID","geogcs","GEOGCS","toMeter","slice","sphere","ellps","TOWGS84","outName","inName","rename","cleanWKT","defs","that","arguments","def","charAt","parseProj","apply","EPSG","ESRI","IAU2000","console","log","WGS84","GOOGLE","globals","codeWords","codes","parse","code","testObj","testDef","some","testWKT","auth","checkMercator","maybeProjStr","ext","checkProjStr","projStr","testProj","destination","source","property","eccent","sinphi","cosphi","con","sqrt","sign","phi","com","pow","tan","ts","dphi","eccnth","atan","sin","identity","pt","projs","es","e","cos","msfnz","forward","lon","lat","adjust_lon","tsfnz","inverse","exp","phi2z","names","projStore","add","len","start","get","ellipseName","wgs84","ellipse","datumName","ch1903","ggrs87","nad83","nad27","potsdam","carthage","hermannskogel","osni52","ire65","rassadiran","nzgd49","osgb36","s_jtsk","beduaram","gunung_segara","rnb72","loadedNadgrids","parseNadgridString","optional","mandatory","grid","isNull","secondsToRadians","seconds","decodeString","String","fromCharCode","Uint8Array","buffer","mapNodes","r","longitudeShift","latitudeShift","readGridHeader","offset","isLittleEndian","parent","lowerLatitude","getFloat64","upperLatitude","lowerLongitude","upperLongitude","latitudeInterval","longitudeInterval","gridNodeCount","getInt32","readGridNodes","gridHeader","nodesOffset","gridShiftRecords","record","getFloat32","latitudeAccuracy","longitudeAccuracy","Projection","srsCode","error","json","parseCode","ourProj","projections","datumDef","Datum","a2","b2","sphere_","Ellipsoid","dc_sphere","ecc","ep2","getNadgrids","datumObj","datum_type","grids","extend","geodeticToGeocentric","Rn","Sin_Lat","Sin2_Lat","Cos_Lat","Longitude","Latitude","Height","z","Infinity","geocentricToGeodetic","P","RR","CT","ST","RX","RK","RN","CPHI0","SPHI0","CPHI","SPHI","SDPHI","iter","Y","Z","atan2","genau","checkParams","dest","point","compareDatums","source_a","source_es","applyGridShift","dest_a","dest_b","dest_es","Dx_BF","Dy_BF","Dz_BF","Rx_BF","Ry_BF","Rz_BF","M_BF","geocentricToWgs84","x_tmp","y_tmp","z_tmp","geocentricFromWgs84","NaN","attemptedGrids","subgrid","subgrids","epsilon","del","ll","lim","applySubgridShift","pin","ct","val","tb","nadInterpolate","dif","inx","indx","frct","f00","cvs","f10","f11","f01","m11","m10","m00","m01","crs","denorm","xin","yin","zin","array","checkCoord","num","TypeError","transform","enforceAxis","toPoint","checkSanity","checkNotWGS","adjust_axis","datum_transform","transformer","from","to","coords","transformedArray","concat","splice","checkProj","oProj","proj4","fromProj","toProj","coord","single","A","I","O","mgrs","bbox","UTMtoLL","decode","toUpperCase","accuracy","utm","seasting","easting","snorthing","northing","zoneNumber","zoneLetter","setParm","get100kSetForZone","setColumn","setRow","column","row","parm","index","colOrigin","charCodeAt","rowOrigin","colInt","rowInt","rollover","encode","N","T","C","M","LongOriginRad","ZoneNumber","Lat","Long","LatRad","degToRad","LongRad","eccSquared","UTMEasting","UTMNorthing","getLetterDesignator","LLtoUTM","deg","radToDeg","rad","N1","T1","C1","R1","D","LongOrigin","mu","phi1Rad","e1","result","topRight","LetterDesignator","mgrsString","testChar","hunK","sb","east100k","curCol","eastingValue","rewindMarker","getEastingFromChar","north100k","curRow","northingValue","getNorthingFromChar","getMinNorthing","remainder","accuracyBonus","sepEastingString","sepNorthingString","sep","sepEasting","sepNorthing","Point","warn","fromMGRS","mgrsStr","toMGRS","C08","en","sphi","cphi","arg","pj_mlfn","pj_enfn","ml0","delta_lon","sin_phi","cos_phi","al","als","cs","tq","ml","acos","pj_inv_mlfn","tan_phi","f","g","temp","h","asin","log1py","hypot","pp","B","cos_2B","h1","h2","arg_r","arg_i","hr2","hi2","sin_arg_r","cos_arg_r","sinh_arg_i","sinh","cosh_arg_i","cosh","j","hr","hi1","hr1","hi","tmerc","cgb","cbg","utg","gtu","np","Qn","gatg","Zb","clens","Ce","Cn","sin_Cn","cos_Cn","sin_Ce","cos_Ce","asinhy","tmp","clens_cmplx","adjust_zone","etmerc","dependsOn","esinp","rc","phic0","ratexp","K","srat","gauss","sinc0","cosc0","R2","title","sinc","cosc","cosl","rho","coslat0","sinlat0","cons","ms1","X0","ssfn_","cosX0","sinX0","sinX","cosX","rh","sinlat","coslat","dlon","ce","Chi","phit","eccen","phy0","lambda0","sinPhy0","semiMajorAxis","flattening","e2","R","b0","k1","k2","k3","Sa1","Sa2","S","rotI","rotB","lambda","phy","prevPhy","iteration","cosph0","F","H","L","sinph0","J","gamma0","projectionName","lamc","lam1","lam2","phi1","phi2","alpha_c","no_off","no_rot","alp","gam","one_es","E","lam0","pi","singam","cosgam","sinrot","cosrot","rB","ArB","BrA","u_0","v_pole_n","v_pole_s","U","W","u","Qp","Sp","Tp","Vp","Up","sin1","cos1","ts1","sin2","cos2","ms2","ts2","ts0","ns","f0","rh1","theta","s45","s90","fi0","alfa","uq","u0","n0","s0","ro0","ad","gfi","deltav","eps","ro","czech","fi1","ok","e0","e3","e0fn","e1fn","e2fn","e3fn","mlfn","lam","nl","gN","tl","asq","cl","dd","imlfn","nl1","rl1","tl1","dl","dsq","adjust_lat","mode","S_POLE","N_POLE","EQUIT","OBLIQ","qp","qsfnz","mmf","apa","APA","authset","rq","xmf","ymf","sinb1","cosb1","coslam","sinlam","q","sinb","cosb","cCe","sCe","ab","beta","cosz","sinz","sin_po","cos_po","t1","qs1","t2","qs2","t3","qs0","ns0","qs","phi1z","asinz","eccnts","sin_p14","cos_p14","infinity_dist","coslon","iqsfnz","dlat","el","bl","tanphi","mln","mlnp","ma","B_re","B_im","C_re","C_im","delta_lat","d_phi","d_lambda","d_phi_n","d_psi","th_n_im1","th_re","th_im","th_n_re","th_n_im","z_re","z_im","z_n_im1","delta_x","z_n_re","z_n_im","iterations","num_re","num_im","den_re","den_im","den2","d_psi_n","C_y","C_x","delta_theta","ml1","ml2","sinth","costh","gsq","msq","xx","yy","xys","c1","c2","c3","a1","m1","th1","sin_p12","cos_p12","Mlp","Ml","Nl1","Nl","psi","Az","G","GH","Hs","kp","cos_c","s2","s3","s4","cosAz","Ee","sinpsi","FACE_ENUM","AREA_ENUM","qsc_fwd_equat_face_theta","area","qsc_shift_lon_origin","slon","face","one_minus_f","one_minus_f_squared","xy","sinlon","nu","cosmu","tannu","tantheta","invert_sign","xa","lp","COEFS_X","COEFS_Y","poly3_val","coefs","NODES","f_df","max_err","iters","upd","newton_rapshon","poly3_der","azi","degrees","tilt","bind","pn1","rp","pfact","omega","cg","sg","cw","sw","yt","ba","bm","bq","defaultDatum","Proj","common","nadgrid","DataView","nFields","detectLittleEndian","header","nSubgridFields","nSubgrids","shiftType","fromSemiMajorAxis","fromSemiMinorAxis","toSemiMajorAxis","toSemiMinorAxis","readHeader","subHeader","lngColumnCount","latColumnCount","count","readSubgrids","version","sterea","stere","somerc","omerc","lcc","krovak","cass","laea","aea","gnom","cea","eqc","nzmg","mill","sinu","moll","eqdc","vandg","aeqd","ortho","qsc","robin","geocent","tpers","includedProjections","km100s","acc","km100","GridRef","invalidGridRef","gr","gb","epsg","ir","ci","wg","qOffsets","se","nw","ne","tOffsets","w","getCentroid","toProjection","suffix","grType","r100km","RegExp","rHectad","rQuandrant","rTetrad","rMonad","r6fig","r8fig","r10fig","prefix","precision","projection","checkGr","constants","pkg","subtitle","footer","titleFontSize","subtitleFontSize","footerFontSize","titleAlign","subtitleAlign","footerAlign","axisTaxaLabel","axisCountLabel","swapYaxes","mainDiv","iFadeTaxa","iFadeCounts","iFadingTaxa","iFadingCounts","colourCounts","colourTaxa","labelTaxa","labelCounts","styleTaxa","styleCounts","fadingTaxa","fadingCounts","greyTaxa","greyCounts","showTaxa","lineData","pointsTaxa","pointsCount","accumTaxa","accumCount","week","weekStats","Set","accum","yScaleCount","yScaleTaxa","yAxisLeft","yAxisRight","lineTaxa","lineCount","svgAccum","gAccum","yScaleRight","yScaleLeft","mlines","eLines","axisLabelClass","gXaxis","setChartOpts","opts","remakeChart","getChartWidth","getChartHeight","saveImage","perRow","showLegend","legendSpacing","axisTickFontSize","yAxisLabelToTop","legendBaseline","legendXoffset","legendYoffset","ranges","pSvgsTaxa","makeAltLat","all","svgsTaxa","subChartWidth","subChartHeight","svgTaxon","col","ceil","svgAltLat","gAltLat","metric","tickVals","backSquareWidth","backSquareHeight","backData","pLegend","mainTrans","distance","altitude","getRadius","bottomXaxisLabelTrans","spacing","items","legend","radiusTrans","maxRadius","xOffset","yOffset","textTrans","swatchTrans","highlightItemToggle","lowlighted","dataFromTetrads","tetrads","altlatTetrads","location","hostname","altlat","altlatSorted","tetrad","tetradsSorted","groups","time","tmi","tm","gDistance","gAltitude","altMean","group","timeEnd","pgroupss","totalTetrads","bd","setTaxon","overflow","zoom","interactivityLink","backgroundColour","taxa1colour","taxa2colour","taxonInfoFn","linkInfoFn","popupDiv","srcElement","tagName","unhighlightAllLinks","gLinks","gNodes","scaleExtent","simulation","nodesPrev","taxa1","taxon1","taxa2","taxon2","Map","assign","links","target","force","strength","restart","selectLink","linkHit","linkHitRemove","eventType","html","pageX","pageY","getColour","fx","fy","hLinks","drag","iAuto","autoColour","random","subject","pRet","displayLegend","chartPad","legendOrder","svgScale","rectData","im","iMetric","svgPhen2","gPhen2","mrects","erects","labelPadY","axisPadX","axisPadY","metricsSorted","svgbbox","li","iScale","xAdj","yAdj","cls","colourData","chartDiv","svgPie","linewidth","showProps","styleProps","currentTaxa","minYearExplicit","maxYearExplicit","makeTexts","yearTotals","makeTrend","yMaxProp","yScaleProps","gTrend","gTrendRect","gTrendPath","format","lineProps","lineGen","graphic","remakeTexts"],"mappings":"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CA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,OACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,MACN,IACA,OACG,MAEV,SACa,OACN,IACA,QACG,MAEV,SACa,OACN,IACA,QACG,OAuBQjvC,QAAO,SAASkvC,EAAKC,UACrCD,EAAIC,EAAMC,SAAW,CACnBjpC,EAAGgpC,EAAMhpC,EACT5O,EAAG43C,EAAM53C,EACTwhB,KAAMo2B,EAAMp2B,MAEPm2B,IACN,IAIL,SAASG,GAAeC,6BACFA,oDA0FtB,IAAI1nB,GAAc,CAChB2nB,GAAI,CACFt0C,KAAM,oCACNu0C,KAAM,QACNvgB,MAAO,oKAETwgB,GAAI,CACFx0C,KAAM,oBACNu0C,KAAM,QACNvgB,MAAO,iKAETygB,GAAI,CACFz0C,KAAM,wBACNu0C,KAAM,QACNvgB,MAAO,qDAET0gB,GAAI,CACF10C,KAAM,SACNu0C,KAAM,OACNvgB,MAAO,wCAWP2gB,GAAW,CACb/D,GAAI,CACF1lC,EAAG,EACH5O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"}